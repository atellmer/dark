{"version":3,"file":"build.js","mappings":"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","sources":["webpack://dark-router-app/webpack/runtime/load script","webpack://dark-router-app/../../packages/core/src/component/component.ts","webpack://dark-router-app/../../packages/core/src/constants.ts","webpack://dark-router-app/../../packages/core/src/jsx-runtime.ts","webpack://dark-router-app/../../packages/core/src/utils/utils.ts","webpack://dark-router-app/../../packages/core/src/view/view.ts","webpack://dark-router-app/webpack/bootstrap","webpack://dark-router-app/webpack/runtime/define property getters","webpack://dark-router-app/webpack/runtime/ensure chunk","webpack://dark-router-app/webpack/runtime/get javascript chunk filename","webpack://dark-router-app/webpack/runtime/global","webpack://dark-router-app/webpack/runtime/hasOwnProperty shorthand","webpack://dark-router-app/webpack/runtime/make namespace object","webpack://dark-router-app/webpack/runtime/publicPath","webpack://dark-router-app/webpack/runtime/jsonp chunk loading","webpack://dark-router-app/../../packages/core/src/fragment/fragment.ts","webpack://dark-router-app/../../packages/core/src/platform/platform.ts","webpack://dark-router-app/../../packages/core/src/emitter/emitter.ts","webpack://dark-router-app/../../packages/core/src/scope/scope.ts","webpack://dark-router-app/../../packages/core/src/fiber/fiber.ts","webpack://dark-router-app/../../packages/core/src/memo/memo.ts","webpack://dark-router-app/../../packages/core/src/walk/walk.ts","webpack://dark-router-app/../../packages/core/src/use-memo/use-memo.ts","webpack://dark-router-app/../../packages/core/src/use-effect/use-effect.ts","webpack://dark-router-app/../../packages/core/src/use-insertion-effect/use-insertion-effect.ts","webpack://dark-router-app/../../packages/core/src/use-layout-effect/use-layout-effect.ts","webpack://dark-router-app/../../packages/core/src/unmount/unmount.ts","webpack://dark-router-app/../../packages/core/src/workloop/workloop.ts","webpack://dark-router-app/../../packages/core/src/scheduler/scheduler.ts","webpack://dark-router-app/../../packages/core/src/use-update/use-update.ts","webpack://dark-router-app/../../packages/core/src/batch/batch.ts","webpack://dark-router-app/../../packages/core/src/context/context.ts","webpack://dark-router-app/../../packages/core/src/use-callback/use-callback.ts","webpack://dark-router-app/../../packages/core/src/use-state/use-state.ts","webpack://dark-router-app/../../packages/core/src/ref/ref.ts","webpack://dark-router-app/../../packages/core/src/shadow/shadow.ts","webpack://dark-router-app/../../packages/core/src/suspense/suspense.ts","webpack://dark-router-app/../../packages/core/src/use-id/use-id.ts","webpack://dark-router-app/../../packages/core/src/lazy/lazy.ts","webpack://dark-router-app/../../packages/platform-browser/src/utils/utils.ts","webpack://dark-router-app/../../packages/platform-browser/src/events/events.ts","webpack://dark-router-app/../../packages/platform-browser/src/portal/portal.ts","webpack://dark-router-app/../../packages/platform-browser/src/constants.ts","webpack://dark-router-app/../../packages/platform-browser/src/dom/dom.ts","webpack://dark-router-app/../../packages/platform-browser/src/render/render.ts","webpack://dark-router-app/../../packages/web-router/src/constants.ts","webpack://dark-router-app/../../packages/web-router/src/context/context.tsx","webpack://dark-router-app/../../packages/web-router/src/link/link.tsx","webpack://dark-router-app/../../packages/web-router/src/use-history/use-history.ts","webpack://dark-router-app/../../packages/core/src/use-event/use-event.ts","webpack://dark-router-app/../../packages/web-router/src/use-location/use-location.ts","webpack://dark-router-app/../../packages/web-router/src/utils/utils.ts","webpack://dark-router-app/../../packages/web-router/src/nav-link/nav-link.tsx","webpack://dark-router-app/../../packages/web-router/src/create-routes/create-routes.ts","webpack://dark-router-app/../../packages/web-router/src/location/location.ts","webpack://dark-router-app/../../packages/web-router/src/history/history.ts","webpack://dark-router-app/../../packages/web-router/src/router/router.tsx","webpack://dark-router-app/../../packages/core/src/use-imperative-handle/use-imperative-handle.ts","webpack://dark-router-app/../../packages/styled/src/constants.ts","webpack://dark-router-app/../../packages/styled/src/utils/utils.ts","webpack://dark-router-app/../../packages/styled/src/keyframes/keyframes.ts","webpack://dark-router-app/../../packages/styled/src/tokens/tokens.ts","webpack://dark-router-app/../../packages/styled/src/theme/theme.ts","webpack://dark-router-app/../../packages/styled/src/server/manager.ts","webpack://dark-router-app/../../packages/styled/src/parse/parse.ts","webpack://dark-router-app/../../packages/styled/src/hash/hash.ts","webpack://dark-router-app/../../packages/styled/src/styled/styled.ts","webpack://dark-router-app/../../packages/styled/src/global/global.ts","webpack://dark-router-app/../../packages/animations/src/state/state.ts","webpack://dark-router-app/../../packages/animations/src/shared/shared.ts","webpack://dark-router-app/../../packages/animations/src/preset/preset.ts","webpack://dark-router-app/../../packages/core/src/atom/atom.ts","webpack://dark-router-app/../../packages/animations/src/spring/spring.ts","webpack://dark-router-app/../../packages/animations/src/utils/utils.ts","webpack://dark-router-app/../../packages/animations/src/stepper/stepper.ts","webpack://dark-router-app/../../packages/animations/src/controller/controller.ts","webpack://dark-router-app/../../packages/animations/src/use-transition/use-transition.ts","webpack://dark-router-app/../../packages/animations/src/animated/animated.ts","webpack://dark-router-app/./page-transition.tsx","webpack://dark-router-app/./index.tsx","webpack://dark-router-app/../../packages/platform-browser/src/create-root/create-root.tsx"],"sourcesContent":["var inProgress = {};\nvar dataWebpackPrefix = \"dark-router-app:\";\n// loadScript function to load a script via script tag\n__webpack_require__.l = (url, done, key, chunkId) => {\n\tif(inProgress[url]) { inProgress[url].push(done); return; }\n\tvar script, needAttach;\n\tif(key !== undefined) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tfor(var i = 0; i < scripts.length; i++) {\n\t\t\tvar s = scripts[i];\n\t\t\tif(s.getAttribute(\"src\") == url || s.getAttribute(\"data-webpack\") == dataWebpackPrefix + key) { script = s; break; }\n\t\t}\n\t}\n\tif(!script) {\n\t\tneedAttach = true;\n\t\tscript = document.createElement('script');\n\n\t\tscript.charset = 'utf-8';\n\t\tscript.timeout = 120;\n\t\tif (__webpack_require__.nc) {\n\t\t\tscript.setAttribute(\"nonce\", __webpack_require__.nc);\n\t\t}\n\t\tscript.setAttribute(\"data-webpack\", dataWebpackPrefix + key);\n\t\tscript.src = url;\n\t}\n\tinProgress[url] = [done];\n\tvar onScriptComplete = (prev, event) => {\n\t\t// avoid mem leaks in IE.\n\t\tscript.onerror = script.onload = null;\n\t\tclearTimeout(timeout);\n\t\tvar doneFns = inProgress[url];\n\t\tdelete inProgress[url];\n\t\tscript.parentNode && script.parentNode.removeChild(script);\n\t\tdoneFns && doneFns.forEach((fn) => (fn(event)));\n\t\tif(prev) return prev(event);\n\t};\n\tvar timeout = setTimeout(onScriptComplete.bind(null, undefined, { type: 'timeout', target: script }), 120000);\n\tscript.onerror = onScriptComplete.bind(null, script.onerror);\n\tscript.onload = onScriptComplete.bind(null, script.onload);\n\tneedAttach && document.head.appendChild(script);\n};","import type { ElementKey, Instance, DarkElement, RefProps, KeyProps, Prettify } from '../shared';\r\nimport { KEY_ATTR } from '../constants';\r\nimport { type Ref } from '../ref';\r\nimport { error } from '../utils';\r\n\r\nconst $$inject = Symbol('inject');\r\nclass Component<P extends StandardComponentProps = any, R = any> {\r\n  type: CreateElement<P>;\r\n  props: P;\r\n  ref?: Ref<R>;\r\n  token?: Symbol;\r\n  displayName?: string;\r\n  shouldUpdate?: ShouldUpdate<P>;\r\n  children: Array<Instance> = [];\r\n\r\n  constructor(\r\n    type: CreateElement<P>,\r\n    token: Symbol,\r\n    props: P,\r\n    ref: Ref<R>,\r\n    shouldUpdate: ShouldUpdate<P>,\r\n    displayName: string,\r\n  ) {\r\n    this.type = type;\r\n    this.props = props;\r\n    ref && (this.ref = ref);\r\n    token && (this.token = token);\r\n    shouldUpdate && (this.shouldUpdate = shouldUpdate);\r\n    displayName && (this.displayName = displayName);\r\n  }\r\n}\r\n\r\nfunction component<P extends object, R = unknown>(type: CreateElement<P, R>, options: ComponentOptions = {}) {\r\n  const { token: $token, displayName } = options;\r\n  type Props = P & StandardComponentProps;\r\n  const factory: ComponentFactoryWithPossiblyInject<Props, R> = (props = {} as Props, ref?: Ref<R>) => {\r\n    const { token = $token, shouldUpdate } = factory[$$inject] || defaultInject;\r\n\r\n    if (props.ref) {\r\n      delete props.ref;\r\n\r\n      if (process.env.NODE_ENV !== 'production') {\r\n        process.env.NODE_ENV === 'development' &&\r\n          error(`[Dark]: to use ref you need to wrap the component with forwardRef!`);\r\n      }\r\n    }\r\n\r\n    return new Component(type, token, props, ref, shouldUpdate, displayName);\r\n  };\r\n\r\n  return factory as ComponentFactory<Prettify<Props>, R>;\r\n}\r\n\r\nconst defaultInject: ComponentInject = {};\r\n\r\nconst detectIsComponent = (x: unknown): x is Component => x instanceof Component;\r\n\r\nconst getComponentKey = (x: Component): ElementKey => x.props[KEY_ATTR] ?? null;\r\n\r\nconst hasComponentFlag = (inst: Component, flag: string) => Boolean(inst.props[flag]);\r\n\r\ntype ComponentOptions = Readonly<{\r\n  displayName?: string;\r\n  token?: Symbol;\r\n}>;\r\n\r\ntype ComponentFactoryWithPossiblyInject<P extends object = {}, R = unknown> = {\r\n  (props?: P, ref?: Ref<R>): Component<P, R>;\r\n  [$$inject]?: ComponentInject<P>;\r\n};\r\n\r\ntype CreateElement<P extends StandardComponentProps, R = unknown> = (props: P, ref?: Ref<R>) => DarkElement;\r\n\r\nexport type ComponentInject<P extends object = {}> = Readonly<{\r\n  token?: Symbol;\r\n  shouldUpdate?: ShouldUpdate<P>;\r\n}>;\r\n\r\nexport type ShouldUpdate<P> = (prevProps: P, nextProps: P) => boolean;\r\n\r\nexport type StandardComponentProps = KeyProps & RefProps;\r\n\r\nexport type ComponentFactory<P extends object = {}, R = unknown> = (props?: P, ref?: Ref<R>) => Component<P, R>;\r\n\r\nexport { Component, component, $$inject, detectIsComponent, getComponentKey, hasComponentFlag };\r\n","export const VERSION = '1.2.0';\r\nexport const ROOT = 'dark:root';\r\nexport const REPLACER = 'dark:matter';\r\nexport const INDEX_KEY = 'dark:idx';\r\nexport const KEY_ATTR = 'key';\r\nexport const REF_ATTR = 'ref';\r\nexport const CREATE_EFFECT_TAG = 'C';\r\nexport const UPDATE_EFFECT_TAG = 'U';\r\nexport const DELETE_EFFECT_TAG = 'D';\r\nexport const SKIP_EFFECT_TAG = 'S';\r\nexport const INSERTION_EFFECT_HOST_MASK = 1;\r\nexport const LAYOUT_EFFECT_HOST_MASK = 2;\r\nexport const ASYNC_EFFECT_HOST_MASK = 4;\r\nexport const ATOM_HOST_MASK = 8;\r\nexport const PORTAL_HOST_MASK = 16;\r\nexport const SHADOW_MASK = 32;\r\nexport const FLUSH_MASK = 64;\r\nexport const MOVE_MASK = 128;\r\nexport const HOOK_DELIMETER = ':';\r\nexport const YIELD_INTERVAL = 6;\r\nexport const STATE_SCRIPT_TYPE = 'text/dark-state';\r\n\r\nexport enum TaskPriority {\r\n  LOW = 0,\r\n  NORMAL = 1,\r\n  HIGH = 2,\r\n}\r\n\r\nexport enum Flag {\r\n  SKIP_SCAN_OPT = '__skipScanOpt',\r\n  MEMO_SLOT_OPT = '__memoSlotOpt',\r\n  STATIC_SLOT_OPT = '__staticSlotOpt',\r\n}\r\n\r\nexport const FLAGS = {\r\n  __skipScanOpt: true,\r\n  __memoSlotOpt: true,\r\n  __staticSlotOpt: true,\r\n};\r\n\r\nexport const ATTR_BLACK_LIST = {\r\n  [KEY_ATTR]: true,\r\n  [REF_ATTR]: true,\r\n  [Flag.SKIP_SCAN_OPT]: true,\r\n  [Flag.MEMO_SLOT_OPT]: true,\r\n  [Flag.STATIC_SLOT_OPT]: true,\r\n};\r\n","import { detectIsString, detectIsFunction, detectIsEmpty, detectIsUndefined } from './utils';\r\nimport { type TagVirtualNodeFactory, type ViewOptions, View } from './view';\r\nimport { type ComponentFactory, type Component } from './component';\r\nimport { type DarkElement, type ElementKey } from './shared';\r\nimport { KEY_ATTR } from './constants';\r\nimport { Fragment } from './fragment';\r\n\r\nfunction jsx(\r\n  element: string | ComponentFactory,\r\n  props: { children?: unknown },\r\n  key?: ElementKey,\r\n): TagVirtualNodeFactory | Component | null {\r\n  const { children, ...$props } = props;\r\n  const slot = children || !detectIsUndefined(children) ? [children as DarkElement] : [];\r\n\r\n  if (key || !detectIsEmpty(key)) {\r\n    $props[KEY_ATTR] = key;\r\n  }\r\n\r\n  if (detectIsString(element)) {\r\n    const options = ($props || {}) as ViewOptions;\r\n\r\n    options.as = element;\r\n    options.slot = slot;\r\n\r\n    return View(options);\r\n  }\r\n\r\n  if (detectIsFunction(element)) {\r\n    const options = ($props || {}) as { slot: unknown };\r\n\r\n    options.slot = slot.length === 1 ? slot[0] : slot;\r\n\r\n    return element(options);\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\nexport { jsx, jsx as jsxs, jsx as jsxDEV, Fragment };\r\n","import type { NestedArray } from '../shared';\r\nimport { INDEX_KEY } from '../constants';\r\n\r\nconst detectIsFunction = (o: any): o is Function => typeof o === 'function';\r\n\r\nconst detectIsUndefined = (o: any): o is undefined => typeof o === 'undefined';\r\n\r\nconst detectIsNumber = (o: any): o is number => typeof o === 'number';\r\n\r\nconst detectIsString = (o: any): o is string => typeof o === 'string';\r\n\r\nconst detectIsTextBased = (o: any): o is string | number => typeof o === 'string' || typeof o === 'number';\r\n\r\nconst detectIsObject = (o: any): o is object => typeof o === 'object';\r\n\r\nconst detectIsBoolean = (o: any): o is boolean => typeof o === 'boolean';\r\n\r\nconst detectIsArray = (o: any): o is Array<any> => Array.isArray(o);\r\n\r\nconst detectIsNull = (o: any): o is null => o === null;\r\n\r\nconst detectIsEmpty = (o: any) => detectIsNull(o) || detectIsUndefined(o);\r\n\r\nconst detectIsFalsy = (o: any) => detectIsEmpty(o) || o === false;\r\n\r\nconst detectIsPromise = <T = unknown>(o: any): o is Promise<T> => o instanceof Promise;\r\n\r\nconst getTime = () => Date.now();\r\n\r\nconst dummyFn = () => {};\r\n\r\nconst trueFn = () => true;\r\n\r\nconst falseFn = () => false;\r\n\r\nconst sameFn = <T = any>(x: T) => x;\r\n\r\nconst error = (...args: Array<any>) => !detectIsUndefined(console) && console.error(...args);\r\n\r\nfunction flatten<T = any>(source: Array<NestedArray<T>>, transform: (x: T) => any = sameFn): Array<T> {\r\n  if (detectIsArray(source)) {\r\n    if (source.length === 0) return [];\r\n  } else {\r\n    return [transform(source)];\r\n  }\r\n  const list: Array<T> = [];\r\n  const stack = [source[0]];\r\n  let idx = 0;\r\n\r\n  while (stack.length > 0) {\r\n    const x = stack.pop();\r\n\r\n    if (detectIsArray(x)) {\r\n      for (let i = x.length - 1; i >= 0; i--) {\r\n        stack.push(x[i]);\r\n      }\r\n    } else {\r\n      list.push(transform(x));\r\n\r\n      if (stack.length === 0 && idx < source.length - 1) {\r\n        idx++;\r\n        stack.push(source[idx]);\r\n      }\r\n    }\r\n  }\r\n\r\n  return list;\r\n}\r\n\r\nfunction keyBy<T = any>(\r\n  list: Array<T>,\r\n  fn: (o: T) => string | number,\r\n  value = false,\r\n): Record<string | number, T | boolean> {\r\n  return list.reduce((acc, x) => ((acc[fn(x)] = value ? x : true), acc), {});\r\n}\r\n\r\nfunction detectAreDepsDifferent(prevDeps: Array<unknown>, nextDeps: Array<unknown>): boolean {\r\n  if (prevDeps === nextDeps || (prevDeps.length === 0 && nextDeps.length === 0)) return false;\r\n  const max = Math.max(prevDeps.length, nextDeps.length);\r\n\r\n  for (let i = 0; i < max; i++) {\r\n    if (!Object.is(prevDeps[i], nextDeps[i])) return true;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nconst nextTick = (callback: () => void) => Promise.resolve().then(callback);\r\n\r\nconst createIndexKey = (idx: number) => `${INDEX_KEY}:${idx}`;\r\n\r\nconst mapRecord = <T extends object>(record: T) => Object.keys(record).map(x => record[x]);\r\n\r\nexport {\r\n  detectIsFunction,\r\n  detectIsUndefined,\r\n  detectIsNumber,\r\n  detectIsString,\r\n  detectIsTextBased,\r\n  detectIsObject,\r\n  detectIsBoolean,\r\n  detectIsArray,\r\n  detectIsNull,\r\n  detectIsEmpty,\r\n  detectIsFalsy,\r\n  detectIsPromise,\r\n  getTime,\r\n  dummyFn,\r\n  trueFn,\r\n  falseFn,\r\n  error,\r\n  flatten,\r\n  keyBy,\r\n  detectAreDepsDifferent,\r\n  nextTick,\r\n  createIndexKey,\r\n  mapRecord,\r\n};\r\n","import type { ElementKey, DarkElement, Instance, SlotProps, RefProps, KeyProps } from '../shared';\r\nimport { type Component, detectIsComponent, getComponentKey, hasComponentFlag } from '../component';\r\nimport { detectIsArray, detectIsFunction } from '../utils';\r\nimport { REPLACER, KEY_ATTR } from '../constants';\r\nimport { $$scope } from '../scope';\r\n\r\nconst $$vNode = Symbol('vNode');\r\nconst ATTR_TYPE = 'type';\r\n\r\nclass VirtualNode {\r\n  type: NodeType = null;\r\n\r\n  constructor(type: NodeType) {\r\n    this.type = type;\r\n  }\r\n}\r\n\r\nclass TagVirtualNode extends VirtualNode {\r\n  name: string;\r\n  attrs: Record<string, any>;\r\n  children: Array<TextVirtualNode | CommentVirtualNode | TagVirtualNode | VirtualNodeFactory | Component>;\r\n\r\n  constructor(name: string, attrs: TagVirtualNode['attrs'], children: TagVirtualNode['children']) {\r\n    super(NodeType.TAG);\r\n    this.name = name;\r\n    this.attrs = attrs;\r\n    this.children = children;\r\n  }\r\n}\r\n\r\nclass TextVirtualNode extends VirtualNode {\r\n  value: string;\r\n\r\n  constructor(source: TextSource) {\r\n    super(NodeType.TEXT);\r\n    this.value = String(source);\r\n  }\r\n}\r\n\r\nclass CommentVirtualNode extends VirtualNode {\r\n  value = '';\r\n\r\n  constructor(text: string) {\r\n    super(NodeType.COMMENT);\r\n    this.value = text;\r\n  }\r\n}\r\n\r\nfunction View(options: ViewOptions) {\r\n  const factory: TagVirtualNodeFactory = () => {\r\n    const { as: name, slot, _void = false, ...attrs } = options;\r\n    const children = (_void ? [] : detectIsArray(slot) ? slot : slot ? [slot] : []) as TagVirtualNode['children'];\r\n\r\n    return new TagVirtualNode(name, attrs, children);\r\n  };\r\n\r\n  factory[$$vNode] = true;\r\n  factory[ATTR_TYPE] = options.as;\r\n  factory[KEY_ATTR] = options.key;\r\n\r\n  return factory;\r\n}\r\n\r\nconst Text = (source: TextSource) => new TextVirtualNode(source);\r\n\r\nText.from = (source: DarkElement) => (detectIsTextVirtualNode(source) ? source.value : String(source));\r\n\r\nconst Comment = (text: string) => new CommentVirtualNode(text);\r\n\r\nconst detectIsVirtualNode = (vNode: unknown): vNode is VirtualNode => vNode instanceof VirtualNode;\r\n\r\nconst detectIsTagVirtualNode = (vNode: unknown): vNode is TagVirtualNode => vNode instanceof TagVirtualNode;\r\n\r\nconst detectIsCommentVirtualNode = (vNode: unknown): vNode is CommentVirtualNode => vNode instanceof CommentVirtualNode;\r\n\r\nconst detectIsTextVirtualNode = (vNode: unknown): vNode is TextVirtualNode => vNode instanceof TextVirtualNode;\r\n\r\nconst detectIsVirtualNodeFactory = (factory: unknown): factory is VirtualNodeFactory =>\r\n  detectIsFunction(factory) && factory[$$vNode] === true;\r\n\r\nconst getTagVirtualNodeKey = (vNode: TagVirtualNode): ElementKey | null =>\r\n  vNode.attrs ? vNode.attrs[KEY_ATTR] ?? null : null;\r\n\r\nconst hasTagVirtualNodeFlag = (vNode: TagVirtualNode, flag: string) => Boolean(vNode.attrs && vNode.attrs[flag]);\r\n\r\nconst getVirtualNodeFactoryKey = (factory: VirtualNodeFactory): ElementKey | null => factory[KEY_ATTR] ?? null;\r\n\r\nconst hasVirtualNodeFactoryFlag = (factory: VirtualNodeFactory, flag: string) => Boolean(factory[flag]);\r\n\r\nconst detectIsPlainVirtualNode = (vNode: unknown): vNode is PlainVirtualNode =>\r\n  detectIsTextVirtualNode(vNode) || detectIsCommentVirtualNode(vNode);\r\n\r\nconst createReplacer = () => new CommentVirtualNode(REPLACER);\r\n\r\nconst detectIsReplacer = (vNode: unknown) => detectIsCommentVirtualNode(vNode) && vNode.value === REPLACER;\r\n\r\nfunction getElementKey(inst: Instance): ElementKey | null {\r\n  return detectIsComponent(inst)\r\n    ? getComponentKey(inst)\r\n    : detectIsVirtualNodeFactory(inst)\r\n    ? getVirtualNodeFactoryKey(inst)\r\n    : detectIsTagVirtualNode(inst)\r\n    ? getTagVirtualNodeKey(inst)\r\n    : null;\r\n}\r\n\r\nfunction hasElementFlag(inst: Instance, flag: string) {\r\n  return detectIsComponent(inst)\r\n    ? hasComponentFlag(inst, flag)\r\n    : detectIsVirtualNodeFactory(inst)\r\n    ? hasVirtualNodeFactoryFlag(inst, flag)\r\n    : detectIsTagVirtualNode(inst)\r\n    ? hasTagVirtualNodeFlag(inst, flag)\r\n    : false;\r\n}\r\n\r\nfunction getElementType(inst: Instance): string | Function {\r\n  return detectIsComponent(inst)\r\n    ? inst.type\r\n    : detectIsVirtualNodeFactory(inst)\r\n    ? inst[ATTR_TYPE]\r\n    : detectIsTagVirtualNode(inst)\r\n    ? inst.name\r\n    : detectIsVirtualNode(inst)\r\n    ? inst.type\r\n    : null;\r\n}\r\n\r\nfunction hasChildrenProp(inst: Instance): inst is TagVirtualNode | Component {\r\n  return detectIsTagVirtualNode(inst) || detectIsComponent(inst);\r\n}\r\n\r\nfunction detectAreSameInstanceTypes(prevInst: Instance, nextInst: Instance, isComponentFactories = false) {\r\n  if (process.env.NODE_ENV !== 'production') {\r\n    if (process.env.NODE_ENV === 'development' && $$scope().getIsHot()) {\r\n      if (detectIsComponent(prevInst) && detectIsComponent(nextInst)) {\r\n        return prevInst.displayName === nextInst.displayName;\r\n      }\r\n    }\r\n  }\r\n\r\n  if (isComponentFactories) {\r\n    const pc = prevInst as Component;\r\n    const nc = nextInst as Component;\r\n\r\n    return pc.type === nc.type;\r\n  }\r\n\r\n  return getElementType(prevInst) === getElementType(nextInst);\r\n}\r\n\r\nfunction detectAreSameComponentTypesWithSameKeys(prevInst: Instance | null, nextInst: Instance | null) {\r\n  if (\r\n    prevInst &&\r\n    nextInst &&\r\n    detectIsComponent(prevInst) &&\r\n    detectIsComponent(nextInst) &&\r\n    detectAreSameInstanceTypes(prevInst, nextInst, true)\r\n  ) {\r\n    return getElementKey(prevInst) === getElementKey(nextInst);\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\ntype TextSource = string | number;\r\n\r\nexport type VirtualNodeFactory = () => VirtualNode;\r\n\r\nexport type TagVirtualNodeFactory = () => TagVirtualNode;\r\n\r\nexport type PlainVirtualNode = TextVirtualNode | CommentVirtualNode;\r\n\r\nexport type ViewOptions = {\r\n  as: string;\r\n  _void?: boolean;\r\n  [prop: string]: any;\r\n} & Partial<SlotProps> &\r\n  RefProps &\r\n  KeyProps;\r\n\r\nexport enum NodeType {\r\n  TAG = 'TAG',\r\n  TEXT = 'TEXT',\r\n  COMMENT = 'COMMENT',\r\n}\r\n\r\nexport {\r\n  View,\r\n  Text,\r\n  Comment,\r\n  VirtualNode,\r\n  TagVirtualNode,\r\n  TextVirtualNode,\r\n  CommentVirtualNode,\r\n  createReplacer,\r\n  detectIsReplacer,\r\n  getElementKey,\r\n  hasElementFlag,\r\n  getElementType,\r\n  hasChildrenProp,\r\n  detectIsVirtualNode,\r\n  detectIsTagVirtualNode,\r\n  detectIsCommentVirtualNode,\r\n  detectIsTextVirtualNode,\r\n  detectIsPlainVirtualNode,\r\n  detectIsVirtualNodeFactory,\r\n  detectAreSameInstanceTypes,\r\n  detectAreSameComponentTypesWithSameKeys,\r\n};\r\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.f = {};\n// This file contains only the entry chunk.\n// The chunk loading function for additional chunks\n__webpack_require__.e = (chunkId) => {\n\treturn Promise.all(Object.keys(__webpack_require__.f).reduce((promises, key) => {\n\t\t__webpack_require__.f[key](chunkId, promises);\n\t\treturn promises;\n\t}, []));\n};","// This function allow to reference async chunks\n__webpack_require__.u = (chunkId) => {\n\t// return url for filenames based on template\n\treturn \"\" + chunkId + \".build.js\";\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript)\n\t\tscriptUrl = document.currentScript.src\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) scriptUrl = scripts[scripts.length - 1].src\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl;","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t179: 0\n};\n\n__webpack_require__.f.j = (chunkId, promises) => {\n\t\t// JSONP chunk loading for javascript\n\t\tvar installedChunkData = __webpack_require__.o(installedChunks, chunkId) ? installedChunks[chunkId] : undefined;\n\t\tif(installedChunkData !== 0) { // 0 means \"already installed\".\n\n\t\t\t// a Promise means \"currently loading\".\n\t\t\tif(installedChunkData) {\n\t\t\t\tpromises.push(installedChunkData[2]);\n\t\t\t} else {\n\t\t\t\tif(true) { // all chunks have JS\n\t\t\t\t\t// setup Promise in chunk cache\n\t\t\t\t\tvar promise = new Promise((resolve, reject) => (installedChunkData = installedChunks[chunkId] = [resolve, reject]));\n\t\t\t\t\tpromises.push(installedChunkData[2] = promise);\n\n\t\t\t\t\t// start chunk loading\n\t\t\t\t\tvar url = __webpack_require__.p + __webpack_require__.u(chunkId);\n\t\t\t\t\t// create error before stack unwound to get useful stacktrace later\n\t\t\t\t\tvar error = new Error();\n\t\t\t\t\tvar loadingEnded = (event) => {\n\t\t\t\t\t\tif(__webpack_require__.o(installedChunks, chunkId)) {\n\t\t\t\t\t\t\tinstalledChunkData = installedChunks[chunkId];\n\t\t\t\t\t\t\tif(installedChunkData !== 0) installedChunks[chunkId] = undefined;\n\t\t\t\t\t\t\tif(installedChunkData) {\n\t\t\t\t\t\t\t\tvar errorType = event && (event.type === 'load' ? 'missing' : event.type);\n\t\t\t\t\t\t\t\tvar realSrc = event && event.target && event.target.src;\n\t\t\t\t\t\t\t\terror.message = 'Loading chunk ' + chunkId + ' failed.\\n(' + errorType + ': ' + realSrc + ')';\n\t\t\t\t\t\t\t\terror.name = 'ChunkLoadError';\n\t\t\t\t\t\t\t\terror.type = errorType;\n\t\t\t\t\t\t\t\terror.request = realSrc;\n\t\t\t\t\t\t\t\tinstalledChunkData[1](error);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\t__webpack_require__.l(url, loadingEnded, \"chunk-\" + chunkId, chunkId);\n\t\t\t\t} else installedChunks[chunkId] = 0;\n\t\t\t}\n\t\t}\n};\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n// no on chunks loaded\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = (parentChunkLoadingFunction, data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some((id) => (installedChunks[id] !== 0))) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunkdark_router_app\"] = self[\"webpackChunkdark_router_app\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","import { component, detectIsComponent } from '../component';\r\nimport type { KeyProps, SlotProps } from '../shared';\r\n\r\ntype FragmentProps = Required<SlotProps> & KeyProps;\r\n\r\nconst $$fragment = Symbol('fragment');\r\n\r\nconst Fragment = component<FragmentProps>(({ slot }) => slot || null, { token: $$fragment });\r\n\r\nconst detectIsFragment = (instance: unknown) => detectIsComponent(instance) && instance.token === $$fragment;\r\n\r\nexport { Fragment, detectIsFragment };\r\n","import { type Fiber } from '../fiber';\r\nimport { type VirtualNode } from '../view';\r\nimport { type Callback } from '../shared';\r\n\r\nexport type Platform = {\r\n  createElement: <N>(vNode: VirtualNode) => N;\r\n  insertElement: <N>(node: N, idx: number, parent: N) => void;\r\n  raf: typeof requestAnimationFrame;\r\n  caf: typeof cancelAnimationFrame;\r\n  spawn: (callback: Callback) => void;\r\n  commit: (fiber: Fiber) => void;\r\n  finishCommit: () => void;\r\n  detectIsDynamic: () => boolean;\r\n  detectIsPortal: (instance: unknown) => boolean;\r\n  unmountPortal: (fiber: Fiber) => void;\r\n  chunk: (fiber: Fiber) => void;\r\n};\r\n\r\nconst defaultRealisation = () => {\r\n  throw new Error('Function not installed by renderer!');\r\n};\r\n\r\nconst platform: Platform = {\r\n  createElement: defaultRealisation,\r\n  insertElement: defaultRealisation,\r\n  raf: defaultRealisation,\r\n  caf: defaultRealisation,\r\n  spawn: defaultRealisation,\r\n  commit: defaultRealisation,\r\n  finishCommit: defaultRealisation,\r\n  detectIsDynamic: defaultRealisation,\r\n  detectIsPortal: defaultRealisation,\r\n  unmountPortal: defaultRealisation,\r\n  chunk: defaultRealisation,\r\n};\r\n\r\nconst detectIsServer = () => !platform.detectIsDynamic();\r\n\r\nexport { platform, detectIsServer };\r\n","import { type SubscriberWithValue } from '../shared';\r\n\r\ntype EventName = 'finish' | 'chunk' | 'error';\r\n\r\nclass EventEmitter<E extends string = EventName, T = unknown> {\r\n  private subscribers: Map<Partial<E>, Set<SubscriberWithValue<unknown>>> = new Map();\r\n\r\n  on<T>(e: E, fn: SubscriberWithValue<T>) {\r\n    !this.subscribers.has(e) && this.subscribers.set(e, new Set());\r\n    this.subscribers.get(e).add(fn);\r\n\r\n    return () => this.subscribers.has(e) && this.subscribers.get(e).delete(fn);\r\n  }\r\n\r\n  emit(e: E, data?: T) {\r\n    this.subscribers.has(e) && this.subscribers.get(e).forEach(x => x(data));\r\n  }\r\n\r\n  kill() {\r\n    this.subscribers = new Map();\r\n  }\r\n\r\n  __getSize() {\r\n    return this.subscribers.size;\r\n  }\r\n}\r\n\r\nexport { EventEmitter };\r\n","import type { Callback, ElementKey, AppResources, AppResource } from '../shared';\r\nimport { type SetPendingStatus } from '../start-transition';\r\nimport { platform, detectIsServer } from '../platform';\r\nimport { EventEmitter } from '../emitter';\r\nimport { type Fiber } from '../fiber';\r\n\r\nclass Scope {\r\n  private root: Fiber = null;\r\n  private wip: Fiber = null;\r\n  private cursor: Fiber = null;\r\n  private unit: Fiber = null;\r\n  private mountDeep = true;\r\n  private mountLevel = 0;\r\n  private mountNav: Record<number, number> = {};\r\n  private events = new Map<string, WeakMap<object, Function>>();\r\n  private unsubs = new Set<Callback>();\r\n  private actions: Actions = {};\r\n  private candidates = new Set<Fiber>();\r\n  private deletions = new Set<Fiber>();\r\n  private cancels: Array<Callback> = [];\r\n  private asyncEffects = new Set<Callback>();\r\n  private layoutEffects = new Set<Callback>();\r\n  private insertionEffects = new Set<Callback>();\r\n  private resourceId = 0;\r\n  private resources: AppResources = new Map();\r\n  private defers: Array<() => Promise<unknown>> = [];\r\n  private setPendingStatus: SetPendingStatus = null;\r\n  private isLayoutEffectsZone = false;\r\n  private isInsertionEffectsZone = false;\r\n  private isUpdateZone = false;\r\n  private isBatchZone = false;\r\n  private isHydrateZone = false;\r\n  private isStreamZone = false;\r\n  private isTransitionZone = false;\r\n  private isEventZone = false;\r\n  private isHot = false;\r\n  private isDynamic = platform.detectIsDynamic();\r\n  private isServer = detectIsServer();\r\n  private emitter = new EventEmitter();\r\n\r\n  private resetActions() {\r\n    this.actions = {};\r\n  }\r\n\r\n  getActionsById(id: number) {\r\n    return this.actions[id];\r\n  }\r\n\r\n  addActionMap(id: number, map: Record<ElementKey, Fiber>) {\r\n    this.actions[id] = {\r\n      map,\r\n      replace: null,\r\n      insert: null,\r\n      remove: null,\r\n      move: null,\r\n      stable: null,\r\n    };\r\n  }\r\n\r\n  addReplaceAction(id: number, nextKey: ElementKey) {\r\n    !this.actions[id].replace && (this.actions[id].replace = {});\r\n    this.actions[id].replace[nextKey] = true;\r\n  }\r\n\r\n  addInsertAction(id: number, nextKey: ElementKey) {\r\n    !this.actions[id].insert && (this.actions[id].insert = {});\r\n    this.actions[id].insert[nextKey] = true;\r\n  }\r\n\r\n  addRemoveAction(id: number, prevKey: ElementKey) {\r\n    !this.actions[id].remove && (this.actions[id].remove = {});\r\n    this.actions[id].remove[prevKey] = true;\r\n  }\r\n\r\n  addMoveAction(id: number, nextKey: ElementKey) {\r\n    !this.actions[id].move && (this.actions[id].move = {});\r\n    this.actions[id].move[nextKey] = true;\r\n  }\r\n\r\n  addStableAction(id: number, nextKey: ElementKey) {\r\n    !this.actions[id].stable && (this.actions[id].stable = {});\r\n    this.actions[id].stable[nextKey] = true;\r\n  }\r\n\r\n  copy() {\r\n    const scope = new Scope();\r\n\r\n    scope.root = null;\r\n    scope.wip = null;\r\n    scope.cursor = null;\r\n    scope.unit = this.unit;\r\n    scope.mountDeep = this.mountDeep;\r\n    scope.mountLevel = this.mountLevel;\r\n    scope.mountNav = { ...this.mountNav };\r\n    scope.events = this.events;\r\n    scope.unsubs = this.unsubs;\r\n    scope.actions = { ...this.actions };\r\n    scope.candidates = new Set([...this.candidates]);\r\n    scope.deletions = new Set([...this.deletions]);\r\n    scope.asyncEffects = new Set([...this.asyncEffects]);\r\n    scope.layoutEffects = new Set([...this.layoutEffects]);\r\n    scope.isUpdateZone = this.isUpdateZone;\r\n    scope.emitter = this.emitter;\r\n\r\n    return scope;\r\n  }\r\n\r\n  getRoot() {\r\n    return this.root;\r\n  }\r\n\r\n  setRoot(fiber: Fiber) {\r\n    this.root = fiber;\r\n  }\r\n\r\n  keepRoot() {\r\n    !this.isUpdateZone && this.setRoot(this.wip);\r\n  }\r\n\r\n  getWorkInProgress() {\r\n    return this.wip;\r\n  }\r\n\r\n  setWorkInProgress(fiber: Fiber) {\r\n    this.wip = fiber;\r\n  }\r\n\r\n  getNextUnitOfWork() {\r\n    return this.unit;\r\n  }\r\n\r\n  setNextUnitOfWork(fiber: Fiber) {\r\n    this.unit = fiber;\r\n  }\r\n\r\n  getCursorFiber() {\r\n    return this.cursor;\r\n  }\r\n\r\n  setCursorFiber(fiber: Fiber) {\r\n    this.cursor = fiber;\r\n  }\r\n\r\n  navToChild() {\r\n    this.mountLevel = this.mountLevel + 1;\r\n    this.mountNav[this.mountLevel] = 0;\r\n  }\r\n\r\n  navToSibling() {\r\n    this.mountNav[this.mountLevel] = this.mountNav[this.mountLevel] + 1;\r\n  }\r\n\r\n  navToParent() {\r\n    this.mountLevel = this.mountLevel - 1;\r\n  }\r\n\r\n  navToPrev() {\r\n    const idx = this.getMountIndex();\r\n\r\n    if (idx === 0) {\r\n      this.navToParent();\r\n      this.setMountDeep(true);\r\n    } else {\r\n      this.mountNav[this.mountLevel] = this.mountNav[this.mountLevel] - 1;\r\n      this.setMountDeep(false);\r\n    }\r\n  }\r\n\r\n  getMountIndex() {\r\n    return this.mountNav[this.mountLevel];\r\n  }\r\n\r\n  getMountDeep() {\r\n    return this.mountDeep;\r\n  }\r\n\r\n  setMountDeep(value: boolean) {\r\n    this.mountDeep = value;\r\n  }\r\n\r\n  resetMount() {\r\n    this.mountLevel = 0;\r\n    this.mountNav = {};\r\n    this.mountDeep = true;\r\n  }\r\n\r\n  getEvents() {\r\n    return this.events;\r\n  }\r\n\r\n  addEventUnsubscriber(fn: Callback) {\r\n    this.unsubs.add(fn);\r\n  }\r\n\r\n  unsubscribeEvents() {\r\n    this.unsubs.forEach(x => x());\r\n    this.unsubs = new Set();\r\n  }\r\n\r\n  getCandidates() {\r\n    return this.candidates;\r\n  }\r\n\r\n  addCandidate(fiber: Fiber) {\r\n    this.candidates.add(fiber);\r\n  }\r\n\r\n  resetCandidates() {\r\n    this.candidates = new Set();\r\n  }\r\n\r\n  getDeletions() {\r\n    return this.deletions;\r\n  }\r\n\r\n  hasDeletion(fiber: Fiber) {\r\n    let nextFiber = fiber;\r\n\r\n    while (nextFiber) {\r\n      if (this.deletions.has(nextFiber)) return true;\r\n      nextFiber = nextFiber.parent;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  addDeletion(fiber: Fiber) {\r\n    !this.hasDeletion(fiber) && this.deletions.add(fiber);\r\n  }\r\n\r\n  resetDeletions() {\r\n    this.deletions = new Set();\r\n  }\r\n\r\n  addAsyncEffect(fn: Callback) {\r\n    this.asyncEffects.add(fn);\r\n  }\r\n\r\n  resetAsyncEffects() {\r\n    this.asyncEffects = new Set();\r\n  }\r\n\r\n  runAsyncEffects() {\r\n    if (!this.isDynamic) return;\r\n    const effects = this.asyncEffects;\r\n    effects.size > 0 && setTimeout(() => effects.forEach(fn => fn()));\r\n  }\r\n\r\n  addLayoutEffect(fn: Callback) {\r\n    this.layoutEffects.add(fn);\r\n  }\r\n\r\n  resetLayoutEffects() {\r\n    this.layoutEffects = new Set();\r\n  }\r\n\r\n  runLayoutEffects() {\r\n    if (!this.isDynamic) return;\r\n    this.setIsLayoutEffectsZone(true);\r\n    this.layoutEffects.forEach(fn => fn());\r\n    this.setIsLayoutEffectsZone(false);\r\n  }\r\n\r\n  addInsertionEffect(fn: Callback) {\r\n    this.insertionEffects.add(fn);\r\n  }\r\n\r\n  resetInsertionEffects() {\r\n    this.insertionEffects = new Set();\r\n  }\r\n\r\n  runInsertionEffects() {\r\n    if (!this.isDynamic) return;\r\n    this.setIsInsertionEffectsZone(true);\r\n    this.insertionEffects.forEach(fn => fn());\r\n    this.setIsInsertionEffectsZone(false);\r\n  }\r\n\r\n  addCancel(fn: Callback) {\r\n    this.cancels.push(fn);\r\n  }\r\n\r\n  applyCancels() {\r\n    for (let i = this.cancels.length - 1; i >= 0; i--) {\r\n      this.cancels[i]();\r\n    }\r\n  }\r\n\r\n  resetCancels() {\r\n    this.cancels = [];\r\n  }\r\n\r\n  getIsLayoutEffectsZone() {\r\n    return this.isLayoutEffectsZone;\r\n  }\r\n\r\n  setIsLayoutEffectsZone(value: boolean) {\r\n    this.isLayoutEffectsZone = value;\r\n  }\r\n\r\n  getIsInsertionEffectsZone() {\r\n    return this.isInsertionEffectsZone;\r\n  }\r\n\r\n  setIsInsertionEffectsZone(value: boolean) {\r\n    this.isInsertionEffectsZone = value;\r\n  }\r\n\r\n  getIsUpdateZone() {\r\n    return this.isUpdateZone;\r\n  }\r\n\r\n  setIsUpdateZone(value: boolean) {\r\n    this.isUpdateZone = value;\r\n  }\r\n\r\n  getIsBatchZone() {\r\n    return this.isBatchZone;\r\n  }\r\n\r\n  setIsBatchZone(value: boolean) {\r\n    this.isBatchZone = value;\r\n  }\r\n\r\n  getIsHydrateZone() {\r\n    return this.isHydrateZone;\r\n  }\r\n\r\n  setIsHydrateZone(value: boolean) {\r\n    this.isHydrateZone = value;\r\n  }\r\n\r\n  getIsStreamZone() {\r\n    return this.isStreamZone;\r\n  }\r\n\r\n  setIsStreamZone(value: boolean) {\r\n    this.isStreamZone = value;\r\n  }\r\n\r\n  getIsTransitionZone() {\r\n    return this.isTransitionZone;\r\n  }\r\n\r\n  setIsTransitionZone(value: boolean) {\r\n    this.isTransitionZone = value;\r\n  }\r\n\r\n  getIsEventZone() {\r\n    return this.isEventZone;\r\n  }\r\n\r\n  setIsEventZone(value: boolean) {\r\n    this.isEventZone = value;\r\n  }\r\n\r\n  getIsHot() {\r\n    return this.isHot;\r\n  }\r\n\r\n  setIsHot(value: boolean) {\r\n    this.isHot = value;\r\n  }\r\n\r\n  getPendingStatusSetter() {\r\n    return this.setPendingStatus;\r\n  }\r\n\r\n  setPendingStatusSetter(fn: SetPendingStatus) {\r\n    this.setPendingStatus = fn;\r\n  }\r\n\r\n  flush() {\r\n    this.keepRoot(); // !\r\n    this.setWorkInProgress(null);\r\n    this.setNextUnitOfWork(null);\r\n    this.setCursorFiber(null);\r\n    this.resetMount();\r\n    this.resetCandidates();\r\n    this.resetDeletions();\r\n    this.resetCancels();\r\n    this.resetInsertionEffects();\r\n    this.resetLayoutEffects();\r\n    this.resetAsyncEffects();\r\n    this.setIsHydrateZone(false);\r\n    this.setIsUpdateZone(false);\r\n    this.resetActions();\r\n  }\r\n\r\n  getEmitter() {\r\n    return this.emitter;\r\n  }\r\n\r\n  defer(fn: () => Promise<unknown>) {\r\n    this.defers.push(fn);\r\n  }\r\n\r\n  getDefers() {\r\n    return this.defers;\r\n  }\r\n\r\n  resetDefers() {\r\n    this.defers = [];\r\n  }\r\n\r\n  getResource(id: number) {\r\n    return this.resources.get(id);\r\n  }\r\n\r\n  setResource(id: number, res: AppResource) {\r\n    this.resources.set(id, res);\r\n  }\r\n\r\n  getResources() {\r\n    return this.resources;\r\n  }\r\n\r\n  getResourceId() {\r\n    return this.resourceId;\r\n  }\r\n\r\n  setResourceId(id: number) {\r\n    this.resourceId = id;\r\n  }\r\n\r\n  getNextResourceId() {\r\n    return ++this.resourceId;\r\n  }\r\n\r\n  runAfterCommit() {\r\n    this.resources = new Map();\r\n    this.isServer && (this.resourceId = 0);\r\n  }\r\n}\r\n\r\ntype Actions = Record<\r\n  number,\r\n  {\r\n    map: Record<ElementKey, Fiber>;\r\n    replace: Record<ElementKey, true>;\r\n    insert: Record<ElementKey, true>;\r\n    remove: Record<ElementKey, true>;\r\n    move: Record<ElementKey, true>;\r\n    stable: Record<ElementKey, true>;\r\n  }\r\n>;\r\n\r\nlet rootId: number = null;\r\nconst scopes = new Map<number, Scope>();\r\n\r\nconst getRootId = () => rootId;\r\n\r\nconst setRootId = (id: number) => {\r\n  rootId = id;\r\n  !scopes.has(rootId) && scopes.set(rootId, new Scope());\r\n};\r\n\r\nconst removeScope = (id: number) => scopes.delete(id);\r\n\r\nconst replaceScope = (scope: Scope, id: number = rootId) => {\r\n  Object.assign(scopes.get(id), scope);\r\n};\r\n\r\nconst $$scope = (id: number = rootId) => scopes.get(id);\r\n\r\nexport { type Scope, getRootId, setRootId, removeScope, replaceScope, $$scope };\r\n","import { detectIsTagVirtualNode, detectIsPlainVirtualNode, detectAreSameComponentTypesWithSameKeys } from '../view';\r\nimport { type Instance, type Callback, type TimerId } from '../shared';\r\nimport { type Context, type ContextProviderValue } from '../context';\r\nimport { detectIsComponent } from '../component';\r\nimport { detectIsFunction, error } from '../utils';\r\nimport { type Atom } from '../atom';\r\nimport { $$scope } from '../scope';\r\n\r\nclass Fiber<N = NativeElement> {\r\n  id = 0;\r\n  cc = 0; // child fibers count\r\n  cec = 0; // child native elements count\r\n  idx = 0; // idx of fiber in the parent fiber\r\n  eidx = 0; // native element idx\r\n  mask = 0; // bit mask\r\n  element: N = null; // native element\r\n  tag: string = null; // effect tag (CREATE, UPDATE, DELETE, SKIP)\r\n  parent: Fiber<N> = null; // parent fiber\r\n  child: Fiber<N> = null; // child fiber\r\n  next: Fiber<N> = null; // next sibling fiber\r\n  alt: Fiber<N> = null; // alternate fiber (previous)\r\n  inst: Instance = null; // instance of component or virtual node\r\n  hook: Hook | null = null; // hook\r\n  provider: Map<Context, ContextProviderValue> = null; // provider of context\r\n  atoms: Map<Atom, Callback> = null;\r\n  marker: string; // for dev\r\n  batch: Batch;\r\n  catch: (error: Error) => void;\r\n\r\n  constructor(hook: Hook = null, provider: Fiber['provider'] = null, idx = 0) {\r\n    this.id = ++Fiber.nextId;\r\n    this.idx = idx;\r\n    hook && (this.hook = hook);\r\n    provider && (this.provider = provider);\r\n  }\r\n\r\n  mutate(fiber: Partial<Fiber<N>>) {\r\n    const keys = Object.keys(fiber);\r\n\r\n    for (const key of keys) {\r\n      this[key] = fiber[key];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  markHost(mask: number) {\r\n    this.mask |= mask;\r\n    this.parent && !(this.parent.mask & mask) && this.parent.markHost(mask);\r\n  }\r\n\r\n  increment(count = 1, force = false) {\r\n    if (!this.parent) return;\r\n    const $scope = $$scope();\r\n    const isUpdateZone = $scope.getIsUpdateZone();\r\n    const wipFiber = $scope.getWorkInProgress();\r\n    const stop = isUpdateZone && wipFiber.parent === this.parent;\r\n\r\n    if (\r\n      detectIsPlainVirtualNode(this.inst) ||\r\n      (detectIsTagVirtualNode(this.inst) && this.inst.children?.length === 0)\r\n    ) {\r\n      this.cec = 1;\r\n    }\r\n\r\n    if (isUpdateZone && stop && !force) return;\r\n\r\n    this.parent.cec += count;\r\n\r\n    if (!this.parent.element) {\r\n      this.parent.increment(count);\r\n    }\r\n  }\r\n\r\n  setError(err: Error) {\r\n    if (detectIsFunction(this.catch)) {\r\n      this.catch(err);\r\n      error(err);\r\n    } else if (this.parent) {\r\n      this.parent.setError(err);\r\n    } else {\r\n      throw err;\r\n    }\r\n  }\r\n\r\n  static setNextId(id: number) {\r\n    Fiber.nextId = id;\r\n  }\r\n\r\n  private static nextId = 0;\r\n}\r\n\r\nclass Hook<T = any> {\r\n  id = 0;\r\n  idx = 0;\r\n  values: Array<T> = [];\r\n  owner: Fiber = null;\r\n  private static nextId = 0;\r\n\r\n  constructor() {\r\n    this.id = ++Hook.nextId;\r\n  }\r\n}\r\n\r\nfunction getHook(alt: Fiber, prevInst: Instance, nextInst: Instance): Hook | null {\r\n  if (alt && detectAreSameComponentTypesWithSameKeys(prevInst, nextInst)) return alt.hook;\r\n  if (detectIsComponent(nextInst)) return new Hook();\r\n\r\n  return null;\r\n}\r\n\r\ntype Batch = {\r\n  timer: TimerId;\r\n  changes: Array<Callback>;\r\n};\r\n\r\nexport type NativeElement = unknown;\r\nexport type HookValue<T = any> = { deps: Array<any>; value: T };\r\n\r\nexport { Fiber, Hook, getHook };\r\n","import {\r\n  type ComponentFactory,\r\n  type StandardComponentProps,\r\n  type ShouldUpdate,\r\n  type ComponentInject,\r\n  $$inject,\r\n  detectIsComponent,\r\n} from '../component';\r\nimport type { SlotProps, RefProps } from '../shared';\r\n\r\nconst $$memo = Symbol('memo');\r\n\r\nconst defaultShouldUpdate = (props: {}, nextProps: {}): boolean => {\r\n  const keys = Object.keys(nextProps);\r\n\r\n  for (const key of keys) {\r\n    if (key !== 'slot' && nextProps[key] !== props[key]) return true;\r\n  }\r\n\r\n  return false;\r\n};\r\n\r\nfunction memo<P extends object, R = unknown>(\r\n  factory: ComponentFactory<P, R>,\r\n  shouldUpdate: ShouldUpdate<P & SlotProps> = defaultShouldUpdate,\r\n) {\r\n  type P1 = P & Omit<StandardComponentProps, 'ref'> & RefProps<R>;\r\n\r\n  factory[$$inject] = {\r\n    token: $$memo,\r\n    shouldUpdate,\r\n  } as ComponentInject<P1>;\r\n\r\n  return factory as ComponentFactory<P1, R>;\r\n}\r\n\r\nconst detectIsMemo = (instance: unknown) => detectIsComponent(instance) && instance.token === $$memo;\r\n\r\nexport { memo, detectIsMemo };\r\n","import {\r\n  DELETE_EFFECT_TAG,\r\n  UPDATE_EFFECT_TAG,\r\n  SKIP_EFFECT_TAG,\r\n  INSERTION_EFFECT_HOST_MASK,\r\n  LAYOUT_EFFECT_HOST_MASK,\r\n  ASYNC_EFFECT_HOST_MASK,\r\n  ATOM_HOST_MASK,\r\n  PORTAL_HOST_MASK,\r\n  MOVE_MASK,\r\n  HOOK_DELIMETER,\r\n} from '../constants';\r\nimport { Fiber } from '../fiber';\r\nimport { platform } from '../platform';\r\nimport { type TagVirtualNode, getElementKey, hasChildrenProp } from '../view';\r\nimport { type Scope } from '../scope';\r\nimport { type Component } from '../component';\r\nimport { detectIsMemo } from '../memo';\r\nimport { type Instance, type ElementKey } from '../shared';\r\nimport { createIndexKey } from '../utils';\r\n\r\nfunction walk<T = unknown>(fiber: Fiber<T>, onWalk: (fiber: Fiber<T>, skip: () => void, stop: () => void) => void) {\r\n  let shouldDeep = true;\r\n  let shouldStop = false;\r\n  const skip = () => (shouldDeep = false);\r\n  const stop = () => (shouldStop = true);\r\n  const stack: Array<Fiber<T>> = [fiber];\r\n\r\n  while (stack.length !== 0) {\r\n    const unit = stack.pop();\r\n\r\n    onWalk(unit, skip, stop);\r\n    if (shouldStop) break;\r\n    unit !== fiber && unit.next && stack.push(unit.next);\r\n    shouldDeep && unit.child && stack.push(unit.child);\r\n    shouldDeep = true;\r\n  }\r\n}\r\n\r\nfunction collectElements<T, P = T>(fiber: Fiber<T>, transform: (fiber: Fiber<T>) => P): Array<P> {\r\n  const elements: Array<P> = [];\r\n\r\n  walk<T>(fiber, (fiber, skip) => {\r\n    if (fiber.element) {\r\n      !platform.detectIsPortal(fiber.inst) && elements.push(transform(fiber));\r\n      return skip();\r\n    }\r\n  });\r\n\r\n  return elements;\r\n}\r\n\r\nfunction getFiberWithElement<T1, T2 = T1>(fiber: Fiber<T1>): Fiber<T2> {\r\n  let $fiber = fiber as unknown as Fiber<T2>;\r\n\r\n  while ($fiber) {\r\n    if ($fiber.element) return $fiber;\r\n    $fiber = $fiber.parent;\r\n  }\r\n\r\n  return $fiber;\r\n}\r\n\r\nfunction detectIsFiberAlive(fiber: Fiber) {\r\n  let $fiber = fiber;\r\n\r\n  while ($fiber) {\r\n    if ($fiber.tag === DELETE_EFFECT_TAG) return false;\r\n    $fiber = $fiber.parent;\r\n  }\r\n\r\n  return Boolean(fiber);\r\n}\r\n\r\nfunction createHookLocation(rootId: number, idx: number, fiber: Fiber) {\r\n  let $fiber = fiber;\r\n  let loc = `${fiber.idx}${HOOK_DELIMETER}${idx}`;\r\n\r\n  while ($fiber) {\r\n    $fiber = $fiber.parent;\r\n    $fiber && (loc = `${$fiber.idx}.${loc}`);\r\n  }\r\n\r\n  loc = `[${rootId}]${loc}`;\r\n\r\n  return loc;\r\n}\r\n\r\nfunction detectIsStableMemoTree(fiber: Fiber, $scope: Scope) {\r\n  if (!hasChildrenProp(fiber.inst)) return;\r\n  const actions = $scope.getActionsById(fiber.id);\r\n  const children = fiber.inst.children;\r\n\r\n  for (let i = 0; i < children.length; i++) {\r\n    const inst = children[i];\r\n    const key = getElementKey(inst);\r\n    if (key === null) return false;\r\n    const alt = actions.map[key];\r\n    if (!alt) return false;\r\n    const pc = alt.inst as Component;\r\n    const nc = inst as Component;\r\n    const isStable =\r\n      detectIsMemo(nc) && detectIsMemo(pc) && nc.type === pc.type && !nc.shouldUpdate(pc.props, nc.props);\r\n\r\n    if (!isStable) return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nfunction tryOptStaticSlot(fiber: Fiber, alt: Fiber, $scope: Scope) {\r\n  const actions = $scope.getActionsById(fiber.id);\r\n  const inst = fiber.inst as Component | TagVirtualNode;\r\n\r\n  alt.element && (fiber.element = alt.element); //!\r\n\r\n  for (let i = 0; i < inst.children.length; i++) {\r\n    buildChildNode(inst.children, fiber, actions.map, i, fiber.eidx);\r\n  }\r\n\r\n  fiber.cc = inst.children.length;\r\n  $scope.setMountDeep(false);\r\n}\r\n\r\nfunction tryOptMemoSlot(fiber: Fiber, alt: Fiber, $scope: Scope) {\r\n  const actions = $scope.getActionsById(fiber.id);\r\n  const hasMove = Boolean(actions.move);\r\n  const hasRemove = Boolean(actions.remove);\r\n  const hasInsert = Boolean(actions.insert);\r\n  const hasReplace = Boolean(actions.replace);\r\n  const canOptimize = ((hasMove && !hasRemove) || (hasRemove && !hasMove)) && !hasInsert && !hasReplace;\r\n\r\n  if (!canOptimize || !detectIsStableMemoTree(fiber, $scope)) return;\r\n\r\n  hasMove && tryOptMov(fiber, alt, $scope);\r\n  hasRemove && tryOptRem(fiber, alt, $scope);\r\n}\r\n\r\nfunction tryOptMov(fiber: Fiber, alt: Fiber, $scope: Scope) {\r\n  const actions = $scope.getActionsById(fiber.id);\r\n\r\n  buildChildNodes(fiber, alt, $scope, (fiber, key) => {\r\n    if (!actions.move[key]) return;\r\n    fiber.alt = new Fiber().mutate(fiber);\r\n    fiber.tag = UPDATE_EFFECT_TAG;\r\n    fiber.mask |= MOVE_MASK;\r\n    $scope.addCandidate(fiber);\r\n  });\r\n}\r\n\r\nfunction tryOptRem(fiber: Fiber, alt: Fiber, $scope: Scope) {\r\n  buildChildNodes(fiber, alt, $scope);\r\n}\r\n\r\nfunction buildChildNodes(fiber: Fiber, alt: Fiber, $scope: Scope, onNode?: (fiber: Fiber, key: ElementKey) => void) {\r\n  const actions = $scope.getActionsById(fiber.id);\r\n  const inst = fiber.inst as Component | TagVirtualNode;\r\n  const children = inst.children;\r\n\r\n  alt.element && (fiber.element = alt.element); //!\r\n\r\n  for (let i = 0; i < children.length; i++) {\r\n    const key = getKey(children[i], i);\r\n    const $fiber = actions.map[key];\r\n\r\n    buildChildNode(children, fiber, actions.map, i, fiber.eidx);\r\n    onNode && onNode($fiber, key);\r\n  }\r\n\r\n  fiber.cc = children.length;\r\n  $scope.setMountDeep(false);\r\n}\r\n\r\nfunction buildChildNode(\r\n  children: Array<Instance>,\r\n  parent: Fiber,\r\n  altMap: Record<string, Fiber>,\r\n  idx: number,\r\n  startEidx: number,\r\n) {\r\n  const prevIdx = idx - 1;\r\n  const nextIdx = idx + 1;\r\n  const key = getKey(children[idx], idx);\r\n  const prevKey = getKey(children[prevIdx], prevIdx);\r\n  const nextKey = getKey(children[nextIdx], nextIdx);\r\n  const fiber = altMap[key];\r\n  const left = altMap[prevKey];\r\n  const right = altMap[nextKey];\r\n  const isFirst = idx === 0;\r\n  const isLast = idx === children.length - 1;\r\n\r\n  isFirst && (parent.child = fiber);\r\n  fiber.alt = null;\r\n  fiber.parent = parent;\r\n  fiber.tag = SKIP_EFFECT_TAG;\r\n  fiber.idx = idx;\r\n  left ? (fiber.eidx = left.eidx + (left.element ? 1 : left.cec)) : (fiber.eidx = startEidx);\r\n  right && (fiber.next = right);\r\n  isLast && (fiber.next = null);\r\n  notifyParents(fiber);\r\n}\r\n\r\nfunction getKey(inst: Instance, idx: number) {\r\n  const key = getElementKey(inst);\r\n  return key !== null ? key : createIndexKey(idx);\r\n}\r\n\r\nfunction notifyParents(fiber: Fiber, alt: Fiber = fiber) {\r\n  fiber.increment(alt.element ? 1 : alt.cec);\r\n  alt.mask & INSERTION_EFFECT_HOST_MASK && fiber.markHost(INSERTION_EFFECT_HOST_MASK);\r\n  alt.mask & LAYOUT_EFFECT_HOST_MASK && fiber.markHost(LAYOUT_EFFECT_HOST_MASK);\r\n  alt.mask & ASYNC_EFFECT_HOST_MASK && fiber.markHost(ASYNC_EFFECT_HOST_MASK);\r\n  alt.mask & ATOM_HOST_MASK && fiber.markHost(ATOM_HOST_MASK);\r\n  alt.mask & PORTAL_HOST_MASK && fiber.markHost(PORTAL_HOST_MASK);\r\n}\r\n\r\nexport {\r\n  walk,\r\n  collectElements,\r\n  getFiberWithElement,\r\n  detectIsFiberAlive,\r\n  createHookLocation,\r\n  tryOptStaticSlot,\r\n  tryOptMemoSlot,\r\n  notifyParents,\r\n};\r\n","import { type VirtualNodeFactory, detectIsVirtualNodeFactory } from '../view';\r\nimport { type Component, detectIsComponent, component } from '../component';\r\nimport { type Hook, type HookValue } from '../fiber';\r\nimport { detectAreDepsDifferent } from '../utils';\r\nimport { $$scope } from '../scope';\r\nimport { memo } from '../memo';\r\n\r\ntype GetMemoValue = () => Component | VirtualNodeFactory;\r\n\r\ntype MemoProps = {\r\n  deps: Array<any>;\r\n  getValue: GetMemoValue;\r\n};\r\n\r\nconst Memo = memo(\r\n  component<MemoProps>(({ getValue }) => getValue()),\r\n  (p, n) => detectAreDepsDifferent(p.deps, n.deps),\r\n);\r\n\r\nfunction detectIsElement<T>(value: T) {\r\n  return detectIsComponent(value) || detectIsVirtualNodeFactory(value);\r\n}\r\n\r\nfunction useMemo<T>(getValue: () => T, deps: Array<any>): T {\r\n  const fiber = $$scope().getCursorFiber();\r\n  const { hook } = fiber;\r\n  const { idx, values } = hook as Hook<HookValue<T>>;\r\n  const state =\r\n    values[idx] ||\r\n    (values[idx] = {\r\n      deps,\r\n      value: getValue(),\r\n    });\r\n  let value: T = null;\r\n  let $value: T = null;\r\n\r\n  if (detectIsElement(state.value)) {\r\n    value = state.value;\r\n    $value = Memo({ getValue: getValue as GetMemoValue, deps }) as unknown as T;\r\n  } else {\r\n    value = detectAreDepsDifferent(state.deps, deps) ? getValue() : state.value;\r\n    $value = value;\r\n  }\r\n\r\n  state.deps = deps;\r\n  state.value = value;\r\n  hook.idx++;\r\n\r\n  return $value;\r\n}\r\n\r\nexport { useMemo };\r\n","import { INSERTION_EFFECT_HOST_MASK, LAYOUT_EFFECT_HOST_MASK, ASYNC_EFFECT_HOST_MASK } from '../constants';\r\nimport { type Hook, type HookValue } from '../fiber';\r\nimport { detectIsFiberAlive } from '../walk';\r\nimport { detectIsFunction } from '../utils';\r\nimport { useMemo } from '../use-memo';\r\nimport { $$scope } from '../scope';\r\n\r\nconst $$useEffect = Symbol('use-effect');\r\n\r\ntype UseEffectValue = {\r\n  token: Symbol;\r\n  cleanup: DropEffect;\r\n};\r\n\r\nfunction createEffect(token: Symbol, type: EffectType) {\r\n  function useEffect(effect: Effect, deps: Array<any> = [{}]) {\r\n    const $scope = $$scope();\r\n    const fiber = $scope.getCursorFiber();\r\n    const scope = useMemo<UseEffectValue>(() => ({ token, cleanup: undefined }), []);\r\n    const isInsertionEffect = type === EffectType.INSERTION;\r\n    const isLayoutEffect = type === EffectType.LAYOUT;\r\n    const isAsyncEffect = type === EffectType.ASYNC;\r\n\r\n    isInsertionEffect && fiber.markHost(INSERTION_EFFECT_HOST_MASK);\r\n    isLayoutEffect && fiber.markHost(LAYOUT_EFFECT_HOST_MASK);\r\n    isAsyncEffect && fiber.markHost(ASYNC_EFFECT_HOST_MASK);\r\n\r\n    useMemo(() => {\r\n      const runEffect = () => {\r\n        scope.cleanup = effect();\r\n\r\n        if (isAsyncEffect && detectIsFunction(scope.cleanup) && !detectIsFiberAlive(fiber)) {\r\n          scope.cleanup();\r\n        }\r\n      };\r\n\r\n      isInsertionEffect && $scope.addInsertionEffect(runEffect);\r\n      isLayoutEffect && $scope.addLayoutEffect(runEffect);\r\n      isAsyncEffect && $scope.addAsyncEffect(runEffect);\r\n\r\n      detectIsFunction(scope.cleanup) && scope.cleanup();\r\n\r\n      return null;\r\n    }, deps);\r\n  }\r\n\r\n  function dropEffects(hook: Hook<HookValue<UseEffectValue>>) {\r\n    for (const { value: effect } of hook.values) {\r\n      effect && effect.token === token && detectIsFunction(effect.cleanup) && effect.cleanup();\r\n    }\r\n  }\r\n\r\n  return {\r\n    useEffect,\r\n    dropEffects,\r\n  };\r\n}\r\n\r\nexport type DropEffect = void | (() => void);\r\n\r\nexport type Effect = () => DropEffect;\r\n\r\nexport enum EffectType {\r\n  ASYNC = 'ASYNC',\r\n  LAYOUT = 'LAYOUT',\r\n  INSERTION = 'INSERTION',\r\n}\r\n\r\nconst { useEffect, dropEffects } = createEffect($$useEffect, EffectType.ASYNC);\r\n\r\nexport { useEffect, dropEffects, createEffect };\r\n","import { createEffect, EffectType } from '../use-effect';\r\n\r\nconst $$useInsertionEffect = Symbol('use-insertion-effect');\r\nconst { useEffect: useInsertionEffect, dropEffects: dropInsertionEffects } = createEffect(\r\n  $$useInsertionEffect,\r\n  EffectType.INSERTION,\r\n);\r\n\r\nexport { useInsertionEffect, dropInsertionEffects };\r\n","import { createEffect, EffectType } from '../use-effect';\r\n\r\nconst $$useLayoutEffect = Symbol('use-layout-effect');\r\nconst { useEffect: useLayoutEffect, dropEffects: dropLayoutEffects } = createEffect(\r\n  $$useLayoutEffect,\r\n  EffectType.LAYOUT,\r\n);\r\n\r\nexport { useLayoutEffect, dropLayoutEffects };\r\n","import { dropInsertionEffects } from '../use-insertion-effect';\r\nimport { dropLayoutEffects } from '../use-layout-effect';\r\nimport { removeScope, $$scope } from '../scope';\r\nimport { detectIsUndefined } from '../utils';\r\nimport { dropEffects } from '../use-effect';\r\nimport { platform } from '../platform';\r\nimport { type Fiber } from '../fiber';\r\nimport { walk } from '../walk';\r\nimport {\r\n  INSERTION_EFFECT_HOST_MASK,\r\n  LAYOUT_EFFECT_HOST_MASK,\r\n  ASYNC_EFFECT_HOST_MASK,\r\n  ATOM_HOST_MASK,\r\n  PORTAL_HOST_MASK,\r\n} from '../constants';\r\n\r\nconst combinedMask =\r\n  INSERTION_EFFECT_HOST_MASK | LAYOUT_EFFECT_HOST_MASK | ASYNC_EFFECT_HOST_MASK | ATOM_HOST_MASK | PORTAL_HOST_MASK;\r\n\r\nconst shouldUnmountFiber = (fiber: Fiber) => fiber.mask & combinedMask;\r\n\r\nfunction unmountFiber(fiber: Fiber) {\r\n  if (!shouldUnmountFiber(fiber)) return;\r\n  walk(fiber, (fiber, skip) => {\r\n    if (!shouldUnmountFiber(fiber)) return skip();\r\n    if (fiber.hook && fiber.hook.values.length > 0) {\r\n      fiber.mask & INSERTION_EFFECT_HOST_MASK && dropInsertionEffects(fiber.hook);\r\n      fiber.mask & LAYOUT_EFFECT_HOST_MASK && dropLayoutEffects(fiber.hook);\r\n      fiber.mask & ASYNC_EFFECT_HOST_MASK && dropEffects(fiber.hook);\r\n    }\r\n\r\n    if (fiber.atoms) {\r\n      for (const [_, cleanup] of fiber.atoms) {\r\n        cleanup();\r\n      }\r\n      fiber.atoms = null;\r\n    }\r\n\r\n    fiber.mask & PORTAL_HOST_MASK && platform.unmountPortal(fiber);\r\n  });\r\n}\r\n\r\nfunction unmountRoot(rootId: number, onCompleted: () => void) {\r\n  if (detectIsUndefined(rootId)) return;\r\n  const $scope = $$scope(rootId);\r\n\r\n  unmountFiber($scope.getRoot());\r\n  $scope.unsubscribeEvents();\r\n  removeScope(rootId);\r\n  onCompleted();\r\n}\r\n\r\nexport { unmountFiber, unmountRoot };\r\n","import { platform } from '../platform';\r\nimport {\r\n  CREATE_EFFECT_TAG,\r\n  UPDATE_EFFECT_TAG,\r\n  DELETE_EFFECT_TAG,\r\n  SKIP_EFFECT_TAG,\r\n  INSERTION_EFFECT_HOST_MASK,\r\n  LAYOUT_EFFECT_HOST_MASK,\r\n  ASYNC_EFFECT_HOST_MASK,\r\n  ATOM_HOST_MASK,\r\n  PORTAL_HOST_MASK,\r\n  MOVE_MASK,\r\n  FLUSH_MASK,\r\n  SHADOW_MASK,\r\n  Flag,\r\n} from '../constants';\r\nimport {\r\n  flatten,\r\n  error,\r\n  detectIsEmpty,\r\n  detectIsFalsy,\r\n  detectIsArray,\r\n  detectIsFunction,\r\n  detectIsTextBased,\r\n  detectIsPromise,\r\n  createIndexKey,\r\n  trueFn,\r\n} from '../utils';\r\nimport { type Scope, setRootId, $$scope, replaceScope } from '../scope';\r\nimport { type Component, detectIsComponent } from '../component';\r\nimport { type ElementKey, type Instance } from '../shared';\r\nimport { Fiber, getHook, Hook } from '../fiber';\r\nimport {\r\n  Text,\r\n  detectIsVirtualNode,\r\n  detectIsVirtualNodeFactory,\r\n  getElementKey,\r\n  hasElementFlag,\r\n  hasChildrenProp,\r\n  detectIsReplacer,\r\n  createReplacer,\r\n  detectAreSameInstanceTypes,\r\n} from '../view';\r\nimport { detectIsMemo } from '../memo';\r\nimport {\r\n  walk,\r\n  getFiberWithElement,\r\n  detectIsFiberAlive,\r\n  notifyParents,\r\n  tryOptStaticSlot,\r\n  tryOptMemoSlot,\r\n} from '../walk';\r\nimport { type RestoreOptions, scheduler } from '../scheduler';\r\nimport { Fragment, detectIsFragment } from '../fragment';\r\nimport { unmountFiber } from '../unmount';\r\n\r\nexport type WorkLoop = (isAsync: boolean) => boolean | Promise<unknown> | null;\r\n\r\nfunction workLoop(isAsync: boolean): boolean | Promise<unknown> | null {\r\n  const $scope = $$scope();\r\n  const wipFiber = $scope.getWorkInProgress();\r\n  let unit = $scope.getNextUnitOfWork();\r\n  let shouldYield = false;\r\n  let hasMoreWork = Boolean(unit);\r\n\r\n  try {\r\n    while (unit && !shouldYield) {\r\n      unit = performUnitOfWork(unit, $scope);\r\n      $scope.setNextUnitOfWork(unit);\r\n      hasMoreWork = Boolean(unit);\r\n      shouldYield = isAsync && scheduler.shouldYield();\r\n      if (shouldYield && scheduler.hasPrimaryTask()) return fork($scope);\r\n    }\r\n\r\n    if (!unit && wipFiber) {\r\n      commit($scope);\r\n    }\r\n  } catch (err) {\r\n    if (detectIsPromise(err)) {\r\n      return err;\r\n    } else {\r\n      const emitter = $scope.getEmitter();\r\n\r\n      $scope.keepRoot(); // !\r\n      emitter.emit('error', String(err));\r\n\r\n      if (!isAsync) {\r\n        throw err;\r\n      }\r\n\r\n      return false;\r\n    }\r\n  }\r\n\r\n  return hasMoreWork;\r\n}\r\n\r\nfunction performUnitOfWork(fiber: Fiber, $scope: Scope): Fiber | null {\r\n  const wipFiber = $scope.getWorkInProgress();\r\n  const isDeepWalking = $scope.getMountDeep();\r\n  const isStream = $scope.getIsStreamZone();\r\n  const hasChildren = isDeepWalking && hasChildrenProp(fiber.inst) && fiber.inst.children.length > 0;\r\n\r\n  fiber.hook && (fiber.hook.idx = 0);\r\n\r\n  if (hasChildren) {\r\n    const child = mountChild(fiber, $scope);\r\n\r\n    isStream && platform.chunk(child);\r\n\r\n    return child;\r\n  } else {\r\n    while (fiber.parent && fiber !== wipFiber) {\r\n      const next = mountSibling(fiber, $scope);\r\n\r\n      isStream && platform.chunk(fiber);\r\n\r\n      if (next) {\r\n        isStream && platform.chunk(next);\r\n        return next;\r\n      }\r\n\r\n      fiber = fiber.parent;\r\n    }\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\nfunction mountChild(parent: Fiber, $scope: Scope) {\r\n  $scope.navToChild();\r\n  const $inst = parent.inst;\r\n  const idx = 0;\r\n  const inst = hasChildrenProp($inst) ? $inst.children[idx] : null;\r\n  const alt = getAlternate(parent, inst, idx, $scope);\r\n  const fiber = createFiber(alt, inst, idx);\r\n\r\n  fiber.parent = parent;\r\n  parent.child = fiber;\r\n  fiber.eidx = parent.element ? 0 : parent.eidx;\r\n\r\n  share(fiber, parent, inst, $scope);\r\n\r\n  return fiber;\r\n}\r\n\r\nfunction mountSibling(left: Fiber, $scope: Scope) {\r\n  $scope.navToSibling();\r\n  const $inst = left.parent.inst;\r\n  const idx = $scope.getMountIndex();\r\n  const inst = hasChildrenProp($inst) && $inst.children ? $inst.children[idx] : null;\r\n  const hasSibling = Boolean(inst);\r\n\r\n  if (!hasSibling) {\r\n    $scope.navToParent();\r\n    $scope.setMountDeep(false);\r\n\r\n    return null;\r\n  }\r\n\r\n  $scope.setMountDeep(true);\r\n  const alt = getAlternate(left, inst, idx, $scope);\r\n  const fiber = createFiber(alt, inst, idx);\r\n\r\n  fiber.parent = left.parent;\r\n  left.next = fiber;\r\n  fiber.eidx = left.eidx + (left.element ? 1 : left.cec);\r\n\r\n  share(fiber, left, inst, $scope);\r\n\r\n  return fiber;\r\n}\r\n\r\nfunction share(fiber: Fiber, prev: Fiber, inst: Instance, $scope: Scope) {\r\n  const { alt } = fiber;\r\n  const shouldMount = alt && detectIsMemo(inst) ? shouldUpdate(fiber, inst, $scope) : true;\r\n\r\n  $scope.setCursorFiber(fiber);\r\n  fiber.inst = inst;\r\n\r\n  if (alt && alt.mask & MOVE_MASK) {\r\n    fiber.mask |= MOVE_MASK;\r\n    alt.mask &= ~MOVE_MASK;\r\n  }\r\n\r\n  fiber.hook && (fiber.hook.owner = fiber); // !\r\n\r\n  if (shouldMount) {\r\n    fiber.inst = mount(fiber, prev, $scope);\r\n    alt && reconcile(fiber, alt, $scope);\r\n    setup(fiber, alt);\r\n  } else if (fiber.mask & MOVE_MASK) {\r\n    fiber.tag = UPDATE_EFFECT_TAG;\r\n  }\r\n\r\n  $scope.addCandidate(fiber); // !\r\n}\r\n\r\nfunction createFiber(alt: Fiber, inst: Instance, idx: number) {\r\n  const fiber = new Fiber(getHook(alt, alt ? alt.inst : null, inst), alt ? alt.provider : null, idx);\r\n\r\n  fiber.alt = alt || null;\r\n\r\n  return fiber;\r\n}\r\n\r\nfunction getAlternate(fiber: Fiber, inst: Instance, idx: number, $scope: Scope) {\r\n  const isChild = idx === 0;\r\n  const key = getElementKey(inst);\r\n  const parentId = isChild ? fiber.id : fiber.parent.id;\r\n  const actions = $scope.getActionsById(parentId);\r\n  let alt: Fiber = null;\r\n\r\n  if (key !== null && actions) {\r\n    const isMove = actions.move && Boolean(actions.move[key]);\r\n    const isStable = actions.stable && Boolean(actions.stable[key]);\r\n\r\n    if (isMove || isStable) {\r\n      alt = actions.map[key];\r\n      isMove && (alt.mask |= MOVE_MASK);\r\n    }\r\n  } else {\r\n    if (fiber.alt) {\r\n      alt = isChild ? fiber.alt.child : fiber.alt.next;\r\n    } else {\r\n      alt = actions ? actions.map[createIndexKey(idx)] || null : null;\r\n    }\r\n  }\r\n\r\n  return alt;\r\n}\r\n\r\nfunction reconcile(fiber: Fiber, alt: Fiber, $scope: Scope) {\r\n  const { id, inst } = fiber;\r\n  const areSameTypes = detectAreSameInstanceTypes(alt.inst, inst);\r\n\r\n  if (!areSameTypes) {\r\n    $scope.addDeletion(alt);\r\n  } else if (hasChildrenProp(alt.inst) && hasChildrenProp(inst) && alt.cc !== 0) {\r\n    const hasSameCount = alt.cc === inst.children.length;\r\n    const check = hasElementFlag(inst, Flag.SKIP_SCAN_OPT) ? !hasSameCount : true;\r\n\r\n    if (check) {\r\n      const { prevKeys, nextKeys, prevKeysMap, nextKeysMap, keyedFibersMap } = extractKeys(alt.child, inst.children);\r\n      const flush = nextKeys.length === 0;\r\n      let size = Math.max(prevKeys.length, nextKeys.length);\r\n      let p = 0;\r\n      let n = 0;\r\n\r\n      $scope.addActionMap(id, keyedFibersMap);\r\n\r\n      for (let i = 0; i < size; i++) {\r\n        const nextKey = nextKeys[i - n] ?? null;\r\n        const prevKey = prevKeys[i - p] ?? null;\r\n        const prevKeyFiber = keyedFibersMap[prevKey] || null;\r\n\r\n        if (nextKey !== prevKey) {\r\n          if (nextKey !== null && !prevKeysMap[nextKey]) {\r\n            if (prevKey !== null && !nextKeysMap[prevKey]) {\r\n              $scope.addReplaceAction(id, nextKey);\r\n              $scope.addDeletion(prevKeyFiber);\r\n            } else {\r\n              $scope.addInsertAction(id, nextKey);\r\n              p++;\r\n              size++;\r\n            }\r\n          } else if (!nextKeysMap[prevKey]) {\r\n            $scope.addRemoveAction(id, prevKey);\r\n            $scope.addDeletion(prevKeyFiber);\r\n            flush && (prevKeyFiber.mask |= FLUSH_MASK);\r\n            n++;\r\n            size++;\r\n          } else if (nextKeysMap[prevKey] && nextKeysMap[nextKey]) {\r\n            $scope.addMoveAction(id, nextKey);\r\n          }\r\n        } else if (nextKey !== null) {\r\n          $scope.addStableAction(id, nextKey);\r\n        }\r\n      }\r\n\r\n      hasElementFlag(inst, Flag.STATIC_SLOT_OPT) && tryOptStaticSlot(fiber, alt, $scope);\r\n      hasElementFlag(inst, Flag.MEMO_SLOT_OPT) && tryOptMemoSlot(fiber, alt, $scope);\r\n    }\r\n  }\r\n}\r\n\r\nfunction setup(fiber: Fiber, alt: Fiber) {\r\n  const inst = fiber.inst;\r\n  let isUpdate = false;\r\n\r\n  fiber.parent.tag === CREATE_EFFECT_TAG && (fiber.tag = fiber.parent.tag);\r\n  fiber.parent.mask & SHADOW_MASK && !fiber.parent.element && !detectIsReplacer(inst) && (fiber.mask |= SHADOW_MASK);\r\n  isUpdate =\r\n    alt &&\r\n    fiber.tag !== CREATE_EFFECT_TAG &&\r\n    detectAreSameInstanceTypes(alt.inst, inst) &&\r\n    getElementKey(alt.inst) === getElementKey(inst);\r\n  isUpdate && !fiber.element && alt.element && (fiber.element = alt.element);\r\n  fiber.tag = isUpdate ? UPDATE_EFFECT_TAG : CREATE_EFFECT_TAG;\r\n  hasChildrenProp(fiber.inst) && (fiber.cc = fiber.inst.children.length);\r\n  !fiber.element && detectIsVirtualNode(fiber.inst) && (fiber.element = platform.createElement(fiber.inst));\r\n  fiber.element && fiber.increment();\r\n}\r\n\r\nfunction shouldUpdate(fiber: Fiber, inst: Instance, $scope: Scope) {\r\n  if (process.env.NODE_ENV !== 'production') {\r\n    if ($scope.getIsHot()) return true;\r\n  }\r\n\r\n  const alt = fiber.alt;\r\n  const pc = alt.inst as Component;\r\n  const nc = inst as Component;\r\n\r\n  if (nc.type !== pc.type || nc.shouldUpdate(pc.props, nc.props)) return true;\r\n\r\n  $scope.setMountDeep(false);\r\n  fiber.tag = SKIP_EFFECT_TAG;\r\n  fiber.child = alt.child;\r\n  fiber.child.parent = fiber;\r\n  fiber.hook = alt.hook;\r\n  fiber.cc = alt.cc;\r\n  fiber.cec = alt.cec;\r\n  alt.element && (fiber.element = alt.element);\r\n  alt.provider && (fiber.provider = alt.provider);\r\n  alt.catch && (fiber.catch = alt.catch);\r\n  alt.atoms && (fiber.atoms = alt.atoms);\r\n\r\n  const diff = fiber.eidx - alt.eidx;\r\n  const deep = diff !== 0;\r\n\r\n  if (deep) {\r\n    walk(fiber.child, ($fiber, skip) => {\r\n      $fiber.eidx += diff;\r\n      if ($fiber.element) return skip();\r\n    });\r\n  }\r\n\r\n  notifyParents(fiber, alt);\r\n\r\n  return false;\r\n}\r\n\r\nfunction mount(fiber: Fiber, prev: Fiber, $scope: Scope) {\r\n  let inst = fiber.inst;\r\n  const isComponent = detectIsComponent(inst);\r\n  const component = inst as Component;\r\n\r\n  if (isComponent) {\r\n    try {\r\n      const id = $scope.getResourceId();\r\n      let result = component.type(component.props, component.ref);\r\n      const defers = $scope.getDefers();\r\n\r\n      if (defers.length > 0) {\r\n        const promise = Promise.all(defers.map(x => x()));\r\n\r\n        $scope.setResourceId(id);\r\n        $scope.resetDefers();\r\n        $scope.navToPrev();\r\n        $scope.setNextUnitOfWork(prev);\r\n        Fiber.setNextId(prev.id);\r\n\r\n        throw promise;\r\n      }\r\n\r\n      if (detectIsArray(result)) {\r\n        !detectIsFragment(component) && (result = Fragment({ slot: result }));\r\n      } else if (detectIsTextBased(result)) {\r\n        result = Text(result);\r\n      }\r\n\r\n      component.children = result as Array<Instance>;\r\n      platform.detectIsPortal(inst) && fiber.markHost(PORTAL_HOST_MASK);\r\n    } catch (err) {\r\n      if (detectIsPromise(err)) throw err;\r\n      component.children = [];\r\n      fiber.setError(err);\r\n    }\r\n  } else if (detectIsVirtualNodeFactory(inst)) {\r\n    inst = inst();\r\n  }\r\n\r\n  if (hasChildrenProp(inst)) {\r\n    inst.children = flatten(inst.children, x => (detectIsTextBased(x) ? Text(x) : x || supportConditional(x)));\r\n    isComponent && component.children.length === 0 && component.children.push(createReplacer());\r\n  }\r\n\r\n  return inst;\r\n}\r\n\r\nfunction extractKeys(alt: Fiber, children: Array<Instance>) {\r\n  let nextFiber = alt;\r\n  let idx = 0;\r\n  const prevKeys: Array<ElementKey> = [];\r\n  const nextKeys: Array<ElementKey> = [];\r\n  const prevKeysMap: Record<ElementKey, boolean> = {};\r\n  const nextKeysMap: Record<ElementKey, boolean> = {};\r\n  const keyedFibersMap: Record<ElementKey, Fiber> = {};\r\n  const usedKeysMap: Record<ElementKey, boolean> = {};\r\n\r\n  while (nextFiber || idx < children.length) {\r\n    if (nextFiber) {\r\n      const key = getElementKey(nextFiber.inst);\r\n      const prevKey = detectIsEmpty(key) ? createIndexKey(idx) : key;\r\n\r\n      if (!prevKeysMap[prevKey]) {\r\n        prevKeysMap[prevKey] = true; // !\r\n        prevKeys.push(prevKey);\r\n      }\r\n\r\n      keyedFibersMap[prevKey] = nextFiber;\r\n    }\r\n\r\n    if (children[idx]) {\r\n      const inst = children[idx];\r\n      const key = getElementKey(inst);\r\n      const nextKey = detectIsEmpty(key) ? createIndexKey(idx) : key;\r\n\r\n      if (process.env.NODE_ENV !== 'production') {\r\n        if (usedKeysMap[nextKey]) {\r\n          error(`[Dark]: the key of node [${nextKey}] already has been used!`, [inst]);\r\n        }\r\n      }\r\n\r\n      if (!nextKeysMap[nextKey]) {\r\n        nextKeysMap[nextKey] = true; // !\r\n        nextKeys.push(nextKey);\r\n      }\r\n\r\n      usedKeysMap[nextKey] = true;\r\n    }\r\n\r\n    nextFiber = nextFiber ? nextFiber.next : null;\r\n    idx++;\r\n  }\r\n\r\n  return {\r\n    prevKeys,\r\n    nextKeys,\r\n    prevKeysMap,\r\n    nextKeysMap,\r\n    keyedFibersMap,\r\n  };\r\n}\r\n\r\nfunction supportConditional(inst: Instance) {\r\n  return detectIsFalsy(inst) ? createReplacer() : inst;\r\n}\r\n\r\nfunction commit($scope: Scope) {\r\n  if (process.env.NODE_ENV !== 'production') {\r\n    process.env.NODE_ENV === 'development' && $scope.setIsHot(false);\r\n  }\r\n\r\n  const wipFiber = $scope.getWorkInProgress();\r\n  const deletions = $scope.getDeletions();\r\n  const candidates = $scope.getCandidates();\r\n  const isUpdateZone = $scope.getIsUpdateZone();\r\n  const unmounts: Array<Fiber> = [];\r\n  const combinedMask = INSERTION_EFFECT_HOST_MASK | LAYOUT_EFFECT_HOST_MASK | ASYNC_EFFECT_HOST_MASK | PORTAL_HOST_MASK;\r\n\r\n  // !\r\n  for (const fiber of deletions) {\r\n    const withNextTick = fiber.mask & ATOM_HOST_MASK && !(fiber.mask & combinedMask);\r\n\r\n    withNextTick ? unmounts.push(fiber) : unmountFiber(fiber);\r\n    fiber.tag = DELETE_EFFECT_TAG;\r\n    platform.commit(fiber);\r\n  }\r\n\r\n  isUpdateZone && sync(wipFiber);\r\n  $scope.runInsertionEffects();\r\n\r\n  for (const fiber of candidates) {\r\n    fiber.tag !== SKIP_EFFECT_TAG && platform.commit(fiber);\r\n    fiber.alt = null;\r\n    hasChildrenProp(fiber.inst) && (fiber.inst.children = null);\r\n  }\r\n\r\n  wipFiber.alt = null;\r\n  platform.finishCommit(); // !\r\n  $scope.runLayoutEffects();\r\n  $scope.runAsyncEffects();\r\n  unmounts.length > 0 && setTimeout(() => unmounts.forEach(x => unmountFiber(x)));\r\n  flush($scope);\r\n}\r\n\r\nfunction flush($scope: Scope, cancel = false) {\r\n  $scope.flush();\r\n  !cancel && $scope.getEmitter().emit('finish');\r\n  $scope.runAfterCommit(); // !\r\n}\r\n\r\nfunction sync(fiber: Fiber) {\r\n  const diff = fiber.cec - fiber.alt.cec;\r\n  if (diff === 0) return;\r\n  const parentFiber = getFiberWithElement(fiber.parent);\r\n  let isRight = false;\r\n\r\n  fiber.increment(diff, true);\r\n\r\n  walk(parentFiber.child, ($fiber, skip) => {\r\n    if ($fiber === fiber) {\r\n      isRight = true;\r\n      return skip();\r\n    }\r\n\r\n    $fiber.element && skip();\r\n    isRight && ($fiber.eidx += diff);\r\n  });\r\n}\r\n\r\nfunction fork($scope: Scope): false {\r\n  const $fork = $scope.copy();\r\n  const wipFiber = $scope.getWorkInProgress();\r\n  const child = wipFiber.child;\r\n  child && (child.parent = null);\r\n  const restore = (options: RestoreOptions) => {\r\n    const { fiber: wipFiber, setValue, resetValue } = options;\r\n    const $scope = $$scope();\r\n\r\n    detectIsFunction(setValue) && setValue();\r\n    detectIsFunction(resetValue) && $fork.addCancel(resetValue);\r\n\r\n    wipFiber.alt = new Fiber().mutate(wipFiber);\r\n    wipFiber.tag = UPDATE_EFFECT_TAG;\r\n    wipFiber.child = child;\r\n    child && (child.parent = wipFiber);\r\n\r\n    if (process.env.NODE_ENV !== 'production') {\r\n      wipFiber.marker = '✌️';\r\n    }\r\n\r\n    $fork.setRoot($scope.getRoot());\r\n    $fork.setWorkInProgress(wipFiber);\r\n    replaceScope($fork);\r\n  };\r\n\r\n  wipFiber.child = wipFiber.alt.child;\r\n  wipFiber.alt = null;\r\n  $scope.runInsertionEffects(); // !\r\n  $scope.applyCancels();\r\n  flush($scope, true);\r\n  scheduler.cancelTask(restore);\r\n\r\n  return false;\r\n}\r\n\r\nexport type CreateCallbackOptions = {\r\n  rootId: number;\r\n  isTransition?: boolean;\r\n  hook: Hook;\r\n  tools?: () => Tools;\r\n};\r\n\r\nfunction createCallback(options: CreateCallbackOptions) {\r\n  const { rootId, hook, isTransition, tools = $tools } = options;\r\n  const callback = (restore?: (options: RestoreOptions) => void) => {\r\n    setRootId(rootId); // !\r\n    const fromRestore = detectIsFunction(restore);\r\n    const { shouldUpdate, setValue, resetValue } = tools();\r\n    const $scope = $$scope();\r\n    const owner = hook.owner;\r\n    const fiber = owner.alt || owner;\r\n\r\n    if (!shouldUpdate() || !detectIsFiberAlive(fiber) || fromRestore) {\r\n      fromRestore && restore({ fiber, setValue, resetValue });\r\n      return;\r\n    }\r\n\r\n    detectIsFunction(setValue) && setValue();\r\n    detectIsFunction(resetValue) && isTransition && $scope.addCancel(resetValue);\r\n\r\n    fiber.alt = new Fiber().mutate(fiber);\r\n    fiber.tag = UPDATE_EFFECT_TAG;\r\n    fiber.cc = 0;\r\n    fiber.cec = 0;\r\n    fiber.child = null;\r\n\r\n    if (process.env.NODE_ENV !== 'production') {\r\n      fiber.marker = '🔥';\r\n    }\r\n\r\n    $scope.setIsUpdateZone(true);\r\n    $scope.resetMount();\r\n    $scope.setWorkInProgress(fiber);\r\n    $scope.setCursorFiber(fiber);\r\n    fiber.inst = mount(fiber, null, $scope);\r\n    $scope.setNextUnitOfWork(fiber);\r\n  };\r\n\r\n  return callback;\r\n}\r\n\r\nexport type Tools = {\r\n  shouldUpdate: () => boolean;\r\n} & Pick<RestoreOptions, 'setValue' | 'resetValue'>;\r\n\r\nconst $tools = (): Tools => ({\r\n  shouldUpdate: trueFn,\r\n  setValue: null,\r\n  resetValue: null,\r\n});\r\n\r\nconst detectIsBusy = () => Boolean($$scope()?.getWorkInProgress());\r\n\r\nexport { Fiber, workLoop, createCallback, detectIsBusy };\r\n","import { ROOT, HOOK_DELIMETER, YIELD_INTERVAL, TaskPriority } from '../constants';\r\nimport { getTime, detectIsFunction, detectIsPromise, nextTick } from '../utils';\r\nimport { type WorkLoop, workLoop, detectIsBusy } from '../workloop';\r\nimport { type SetPendingStatus } from '../start-transition';\r\nimport { type Callback } from '../shared';\r\nimport { EventEmitter } from '../emitter';\r\nimport { platform } from '../platform';\r\nimport { type Fiber } from '../fiber';\r\n\r\nclass MessageChannel extends EventEmitter<PortEvent> {\r\n  port1: MessagePort = null;\r\n  port2: MessagePort = null;\r\n\r\n  constructor() {\r\n    super();\r\n    this.port1 = new MessagePort(this);\r\n    this.port2 = new MessagePort(this);\r\n  }\r\n}\r\n\r\nclass MessagePort {\r\n  channel: MessageChannel;\r\n  offs: Array<Callback> = [];\r\n\r\n  constructor(channel: MessageChannel) {\r\n    this.channel = channel;\r\n  }\r\n\r\n  on(event: PortEvent, callback: PortListener) {\r\n    const off = this.channel.on(event, callback);\r\n\r\n    this.offs.push(off);\r\n  }\r\n\r\n  postMessage(value: unknown) {\r\n    platform.spawn(() => {\r\n      this.channel.emit('message', value);\r\n    });\r\n  }\r\n\r\n  unref() {\r\n    this.offs.forEach(x => x());\r\n  }\r\n}\r\n\r\nclass Scheduler {\r\n  private queue: Record<TaskPriority, Array<Task>> = {\r\n    [TaskPriority.HIGH]: [],\r\n    [TaskPriority.NORMAL]: [],\r\n    [TaskPriority.LOW]: [],\r\n  };\r\n  private deadline = 0;\r\n  private task: Task = null;\r\n  private scheduledCallback: WorkLoop = null;\r\n  private isMessageLoopRunning = false;\r\n  private channel: MessageChannel = null;\r\n  private port: MessagePort = null;\r\n\r\n  constructor() {\r\n    this.channel = new MessageChannel();\r\n    this.port = this.channel.port2;\r\n    this.channel.port1.on('message', this.performWorkUntilDeadline.bind(this));\r\n  }\r\n\r\n  reset() {\r\n    this.deadline = 0;\r\n    this.task = null;\r\n    this.scheduledCallback = null;\r\n    this.isMessageLoopRunning = false;\r\n  }\r\n\r\n  shouldYield() {\r\n    return getTime() >= this.deadline;\r\n  }\r\n\r\n  schedule(callback: Callback, options?: ScheduleCallbackOptions) {\r\n    const {\r\n      priority = TaskPriority.NORMAL,\r\n      forceAsync = false,\r\n      isTransition = false,\r\n      createLocation,\r\n      setPendingStatus,\r\n    } = options || {};\r\n    const task = new Task(callback, priority, forceAsync);\r\n\r\n    task.setIsTransition(isTransition);\r\n    task.setPendingSetter(setPendingStatus);\r\n    task.setLocationCreator(createLocation || createRootLocation);\r\n    this.put(task);\r\n    this.execute();\r\n  }\r\n\r\n  hasPrimaryTask() {\r\n    if (!this.task.getIsTransition()) return false;\r\n    const { high, normal, low } = this.getQueues();\r\n    const hasPrimary = high.length > 0 || normal.length > 0;\r\n    const hasLow = low.length > 0;\r\n\r\n    if (hasPrimary || hasLow) {\r\n      const loc = this.task.createLocation();\r\n\r\n      if (hasPrimary) {\r\n        const has = Task.detectHasRelatedUpdate(loc, high, true) || Task.detectHasRelatedUpdate(loc, normal, true);\r\n\r\n        if (has) {\r\n          this.task.markAsUnnecessary();\r\n        }\r\n\r\n        return true;\r\n      }\r\n\r\n      if (hasLow) {\r\n        const has = Task.detectHasRelatedUpdate(loc, low);\r\n\r\n        if (has) {\r\n          this.task.markAsUnnecessary();\r\n\r\n          return true;\r\n        }\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  cancelTask(fn: TaskRestorer) {\r\n    if (this.task.getIsUnnecessary()) return this.complete(this.task);\r\n    this.task.setTaskRestorer(fn);\r\n    this.defer(this.task);\r\n  }\r\n\r\n  private complete(task: Task) {\r\n    task.pending(false);\r\n  }\r\n\r\n  private put(task: Task) {\r\n    const queue = this.queue[task.getPriority()];\r\n\r\n    if (task.getIsTransition()) {\r\n      const loc = task.createLocation();\r\n      const tasks = queue.filter(x => x.createLocation() !== loc);\r\n\r\n      queue.splice(0, queue.length, ...tasks);\r\n    }\r\n\r\n    queue.push(task);\r\n  }\r\n\r\n  private pick(queue: Array<Task>) {\r\n    if (queue.length === 0) return false;\r\n    this.task = queue.shift();\r\n\r\n    if (this.task.getIsTransition() && this.task.canPending()) {\r\n      const task = this.task;\r\n\r\n      task.markAsPending();\r\n      this.defer(this.task);\r\n      this.task = null;\r\n\r\n      nextTick(() => task.pending(true));\r\n\r\n      return true;\r\n    }\r\n\r\n    this.task.run();\r\n    this.task.getForceAsync() ? this.requestCallbackAsync(workLoop) : this.requestCallback(workLoop);\r\n\r\n    return true;\r\n  }\r\n\r\n  private execute() {\r\n    const isBusy = detectIsBusy();\r\n\r\n    if (!isBusy && !this.isMessageLoopRunning) {\r\n      const { high, normal, low } = this.getQueues();\r\n\r\n      this.pick(high) || this.pick(normal) || this.pick(low);\r\n    }\r\n  }\r\n\r\n  private requestCallbackAsync(callback: WorkLoop) {\r\n    this.scheduledCallback = callback;\r\n\r\n    if (!this.isMessageLoopRunning) {\r\n      this.isMessageLoopRunning = true;\r\n      this.port.postMessage(null);\r\n    }\r\n  }\r\n\r\n  private requestCallback(callback: WorkLoop) {\r\n    const result = callback(false);\r\n\r\n    if (detectIsPromise(result)) {\r\n      result.finally(() => {\r\n        this.requestCallback(callback);\r\n      });\r\n    } else {\r\n      this.task = null;\r\n      this.execute();\r\n    }\r\n  }\r\n\r\n  private performWorkUntilDeadline() {\r\n    if (this.scheduledCallback) {\r\n      this.deadline = getTime() + YIELD_INTERVAL;\r\n      const result = this.scheduledCallback(true);\r\n\r\n      if (detectIsPromise(result)) {\r\n        result.finally(() => {\r\n          this.port.postMessage(null);\r\n        });\r\n      } else if (result) {\r\n        this.port.postMessage(null);\r\n      } else {\r\n        this.complete(this.task);\r\n        this.reset();\r\n        this.execute();\r\n      }\r\n    } else {\r\n      this.isMessageLoopRunning = false;\r\n    }\r\n  }\r\n\r\n  private defer(task: Task) {\r\n    const { low } = this.getQueues();\r\n\r\n    low.unshift(task);\r\n  }\r\n\r\n  private getQueues() {\r\n    const high = this.queue[TaskPriority.HIGH];\r\n    const normal = this.queue[TaskPriority.NORMAL];\r\n    const low = this.queue[TaskPriority.LOW];\r\n\r\n    return {\r\n      high,\r\n      normal,\r\n      low,\r\n    };\r\n  }\r\n}\r\n\r\ntype TaskCallback = (fn: TaskRestorer) => void;\r\ntype TaskRestorer = (options: RestoreOptions) => void;\r\ntype LocationCreator = () => string;\r\n\r\nclass Task {\r\n  private id: number;\r\n  private priority: TaskPriority;\r\n  private forceAsync: boolean;\r\n  private isTransition: boolean;\r\n  private isPending: boolean;\r\n  private isUnnecessary: boolean;\r\n  private callback: TaskCallback;\r\n  private taskRestorer?: TaskRestorer = null;\r\n  private locationCreator?: LocationCreator;\r\n  private pendingSetter?: SetPendingStatus = null;\r\n  private static nextTaskId = 0;\r\n\r\n  constructor(callback: TaskCallback, priority: TaskPriority, forceAsync: boolean) {\r\n    this.id = ++Task.nextTaskId;\r\n    this.callback = callback;\r\n    this.priority = priority;\r\n    this.forceAsync = forceAsync;\r\n  }\r\n\r\n  getPriority() {\r\n    return this.priority;\r\n  }\r\n\r\n  getForceAsync() {\r\n    return this.forceAsync;\r\n  }\r\n\r\n  setIsTransition(value: boolean) {\r\n    this.isTransition = value;\r\n  }\r\n\r\n  getIsTransition() {\r\n    return this.isTransition;\r\n  }\r\n\r\n  run() {\r\n    this.callback(this.taskRestorer);\r\n    this.taskRestorer = null;\r\n  }\r\n\r\n  pending(value: boolean) {\r\n    this.isTransition && this.pendingSetter && this.pendingSetter(value);\r\n  }\r\n\r\n  markAsPending() {\r\n    this.isPending = true;\r\n  }\r\n\r\n  canPending() {\r\n    return !this.isPending && detectIsFunction(this.pendingSetter);\r\n  }\r\n\r\n  markAsUnnecessary() {\r\n    this.isUnnecessary = true;\r\n  }\r\n\r\n  getIsUnnecessary() {\r\n    return this.isUnnecessary;\r\n  }\r\n\r\n  setTaskRestorer(fn: TaskRestorer) {\r\n    this.taskRestorer = fn;\r\n  }\r\n\r\n  setLocationCreator(fn: LocationCreator) {\r\n    this.locationCreator = fn;\r\n  }\r\n\r\n  createLocation() {\r\n    return this.locationCreator();\r\n  }\r\n\r\n  setPendingSetter(fn: SetPendingStatus) {\r\n    this.pendingSetter = fn;\r\n  }\r\n\r\n  static detectHasRelatedUpdate(loc: string, tasks: Array<Task>, deep = false) {\r\n    const [$loc] = loc.split(HOOK_DELIMETER);\r\n\r\n    return tasks.some(x => {\r\n      const $$loc = x.createLocation();\r\n      const has = $$loc === loc || (deep && $$loc.length > loc.length && $$loc.indexOf($loc) !== -1);\r\n\r\n      return has;\r\n    });\r\n  }\r\n}\r\n\r\nconst createRootLocation: LocationCreator = () => ROOT;\r\n\r\ntype PortEvent = 'message';\r\ntype PortListener = (value: unknown) => void;\r\n\r\nexport type RestoreOptions = {\r\n  fiber: Fiber;\r\n  setValue?: () => void;\r\n  resetValue?: () => void;\r\n};\r\n\r\nexport type ScheduleCallbackOptions = {\r\n  priority?: TaskPriority;\r\n  forceAsync?: boolean;\r\n  isTransition?: boolean;\r\n  createLocation?: () => string;\r\n  setPendingStatus?: SetPendingStatus;\r\n  onCompleted?: () => void;\r\n};\r\n\r\nconst scheduler = new Scheduler();\r\n\r\nexport { scheduler };\r\n","import { type ScheduleCallbackOptions, scheduler } from '../scheduler';\r\nimport { type Tools, createCallback } from '../workloop';\r\nimport { getRootId, $$scope } from '../scope';\r\nimport { createHookLocation } from '../walk';\r\nimport { detectIsFunction } from '../utils';\r\nimport { TaskPriority } from '../constants';\r\nimport { addBatch } from '../batch';\r\nimport { type Hook } from '../fiber';\r\n\r\nfunction createUpdate(rootId: number, hook: Hook) {\r\n  const { idx } = hook;\r\n  const update = (tools?: () => Tools) => {\r\n    const $scope = $$scope();\r\n    if ($scope.getIsInsertionEffectsZone()) return;\r\n    const { owner } = hook;\r\n    const hasTools = detectIsFunction(tools);\r\n    const isTransition = $scope.getIsTransitionZone();\r\n    const isBatch = $scope.getIsBatchZone();\r\n    const isEvent = $scope.getIsEventZone();\r\n    const priority = isTransition ? TaskPriority.LOW : isEvent ? TaskPriority.HIGH : TaskPriority.NORMAL; // !\r\n    const forceAsync = isTransition;\r\n    const setPendingStatus = $scope.getPendingStatusSetter();\r\n    const callback = createCallback({\r\n      rootId,\r\n      hook,\r\n      isTransition,\r\n      tools: hasTools ? tools : undefined,\r\n    });\r\n    const createLocation = () => createHookLocation(rootId, idx, owner);\r\n    const callbackOptions: ScheduleCallbackOptions = {\r\n      priority,\r\n      forceAsync,\r\n      isTransition,\r\n      createLocation,\r\n      setPendingStatus,\r\n    };\r\n\r\n    if (isBatch) {\r\n      addBatch(\r\n        owner,\r\n        () => scheduler.schedule(callback, callbackOptions),\r\n        () => hasTools && tools().setValue(),\r\n      );\r\n    } else {\r\n      scheduler.schedule(callback, callbackOptions);\r\n    }\r\n  };\r\n\r\n  return update;\r\n}\r\n\r\nfunction useUpdate() {\r\n  const rootId = getRootId();\r\n  const fiber = $$scope().getCursorFiber();\r\n\r\n  return createUpdate(rootId, fiber.hook);\r\n}\r\n\r\nexport { createUpdate, useUpdate };\r\n","import { $$scope } from '../scope';\r\nimport { type Fiber } from '../fiber';\r\nimport { type Callback } from '../shared';\r\n\r\nfunction batch(callback: () => void) {\r\n  const $scope = $$scope();\r\n\r\n  $scope.setIsBatchZone(true);\r\n  callback();\r\n  $scope.setIsBatchZone(false);\r\n}\r\n\r\nfunction addBatch(fiber: Fiber, callback: Callback, change: Callback) {\r\n  const $scope = $$scope();\r\n\r\n  if ($scope.getIsTransitionZone()) {\r\n    callback();\r\n  } else {\r\n    const batch = fiber.batch || { timer: null, changes: [] };\r\n\r\n    fiber.batch = batch;\r\n    batch.changes.push(change);\r\n    batch.timer && clearTimeout(batch.timer);\r\n    batch.timer = setTimeout(() => {\r\n      batch.changes.splice(-1);\r\n      batch.changes.forEach(x => x());\r\n      fiber.batch = null;\r\n      callback();\r\n    });\r\n  }\r\n}\r\n\r\nexport { batch, addBatch };\r\n","import type { DarkElement, Subscribe, SubscriberWithValue, SlotProps, KeyProps } from '../shared';\r\nimport { type ComponentFactory, component } from '../component';\r\nimport type { Fiber } from '../fiber';\r\nimport { detectIsFunction } from '../utils';\r\nimport { $$scope } from '../scope';\r\nimport { useEffect } from '../use-effect';\r\nimport { useMemo } from '../use-memo';\r\nimport { useUpdate } from '../use-update';\r\n\r\ntype CreateContextOptions = {\r\n  displayName?: string;\r\n};\r\n\r\nfunction createContext<T>(defaultValue: T, options?: CreateContextOptions): Context<T> {\r\n  const { displayName = 'Context' } = options || {};\r\n  const context: Context<T> = {\r\n    displayName,\r\n    defaultValue,\r\n    Provider: null,\r\n    Consumer: null,\r\n  };\r\n\r\n  context.Provider = createProvider(context, defaultValue, displayName);\r\n  context.Consumer = createConsumer(context, displayName);\r\n\r\n  return context;\r\n}\r\n\r\nfunction createProvider<T>(context: Context<T>, defaultValue: T, displayName: string) {\r\n  return component<ContexProviderProps<T>>(\r\n    ({ value = defaultValue, slot }) => {\r\n      const fiber = $$scope().getCursorFiber();\r\n\r\n      if (!fiber.provider) {\r\n        const providerValue: ContextProviderValue<T> = {\r\n          value,\r\n          subscribers: new Set(),\r\n          subscribe: (subscriber: (value: T) => void) => {\r\n            providerValue.subscribers.add(subscriber);\r\n\r\n            return () => providerValue.subscribers.delete(subscriber);\r\n          },\r\n        };\r\n\r\n        fiber.provider = new Map();\r\n        fiber.provider.set(context, providerValue);\r\n      }\r\n\r\n      const provider = fiber.provider.get(context);\r\n\r\n      useEffect(() => {\r\n        provider.subscribers.forEach(fn => fn(value));\r\n      }, [value]);\r\n\r\n      provider.value = value;\r\n\r\n      return slot;\r\n    },\r\n    { displayName: `${displayName}.Provider` },\r\n  );\r\n}\r\n\r\ntype ConsumerProps<T> = {\r\n  slot: (value: T) => DarkElement;\r\n};\r\n\r\nfunction createConsumer<T>(context: Context<T>, displayName: string) {\r\n  return component<ConsumerProps<T>>(\r\n    ({ slot }) => {\r\n      const value = useContext(context);\r\n\r\n      return detectIsFunction(slot) ? slot(value) : null;\r\n    },\r\n    { displayName: `${displayName}.Consumer` },\r\n  );\r\n}\r\n\r\nfunction useContext<T>(context: Context<T>): T {\r\n  const { defaultValue } = context;\r\n  const fiber = $$scope().getCursorFiber();\r\n  const provider = useMemo(() => getProvider<T>(context, fiber), []);\r\n  const value = provider ? provider.value : defaultValue;\r\n  const update = useUpdate();\r\n  const scope = useMemo(() => ({ value }), []);\r\n  const hasProvider = Boolean(provider);\r\n\r\n  useEffect(() => {\r\n    if (!hasProvider) return;\r\n    const unsubscribe = provider.subscribe((value: T) => {\r\n      if (!Object.is(scope.value, value)) {\r\n        update();\r\n      }\r\n    });\r\n\r\n    return unsubscribe;\r\n  }, [hasProvider]);\r\n\r\n  scope.value = value;\r\n\r\n  return value;\r\n}\r\n\r\nfunction getProvider<T>(context: Context<T>, fiber: Fiber): ContextProviderValue<T> {\r\n  let nextFiber = fiber;\r\n\r\n  while (nextFiber) {\r\n    if (nextFiber.provider && nextFiber.provider.get(context)) {\r\n      return nextFiber.provider.get(context) as ContextProviderValue<T>;\r\n    }\r\n\r\n    nextFiber = nextFiber.parent;\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\ntype ContexProviderProps<T> = {\r\n  value: T;\r\n} & SlotProps &\r\n  KeyProps;\r\n\r\nexport type Context<T = unknown> = {\r\n  Provider: ComponentFactory<ContexProviderProps<T>>;\r\n  Consumer: ComponentFactory<SlotProps<(value: T) => DarkElement>>;\r\n  displayName?: string;\r\n  defaultValue: T;\r\n};\r\n\r\nexport type ContextProviderValue<T = unknown> = {\r\n  value: T;\r\n  subscribers: Set<(value: T) => void>;\r\n  subscribe: Subscribe<SubscriberWithValue<T>>;\r\n};\r\n\r\nexport { createContext, useContext };\r\n","import { useMemo } from '../use-memo';\r\n\r\nfunction useCallback<T = Function>(callback: T, deps: Array<any>): T {\r\n  const value = useMemo(() => callback, deps);\r\n\r\n  return value;\r\n}\r\n\r\nexport { useCallback };\r\n","import { useCallback } from '../use-callback';\r\nimport { detectIsFunction } from '../utils';\r\nimport { useUpdate } from '../use-update';\r\nimport { type Tools } from '../workloop';\r\nimport { useMemo } from '../use-memo';\r\nimport { $$scope } from '../scope';\r\nimport { trueFn } from '../utils';\r\n\r\ntype CreateToolsOptions<T> = {\r\n  next: Value<T>;\r\n  get: () => T;\r\n  set: (x: T) => void;\r\n  reset: (x: T) => void;\r\n  shouldUpdate?: (p: T, n: T) => boolean;\r\n};\r\n\r\nfunction createTools<T>(options: CreateToolsOptions<T>) {\r\n  const { get, set, reset, next, shouldUpdate: $shouldUpdate = trueFn } = options;\r\n  const $scope = $$scope();\r\n  const isBatch = $scope.getIsBatchZone();\r\n  const tools = (): Tools => {\r\n    const prevValue = get();\r\n    const newValue = detectIsFunction(next) ? next(prevValue) : next;\r\n    const shouldUpdate = () => isBatch || $shouldUpdate(prevValue, newValue);\r\n    const setValue = () => set(newValue);\r\n    const resetValue = () => reset(prevValue);\r\n\r\n    return { shouldUpdate, setValue, resetValue };\r\n  };\r\n\r\n  return tools;\r\n}\r\n\r\ntype Value<T> = T | ((prevValue: T) => T);\r\n\r\nfunction useState<T = unknown>(initialValue: T | (() => T)): [T, (value: Value<T>) => void] {\r\n  const update = useUpdate();\r\n  const scope = useMemo(\r\n    () => ({\r\n      value: detectIsFunction(initialValue) ? initialValue() : initialValue,\r\n    }),\r\n    [],\r\n  );\r\n  const setState = useCallback((next: Value<T>) => {\r\n    const tools = createTools({\r\n      next,\r\n      get: () => scope.value,\r\n      set: (x: T) => (scope.value = x),\r\n      reset: (x: T) => (scope.value = x),\r\n      shouldUpdate: (p: T, n: T) => !Object.is(p, n),\r\n    });\r\n\r\n    update(tools);\r\n  }, []);\r\n\r\n  return [scope.value, setState];\r\n}\r\n\r\nexport { createTools, useState };\r\n","import { detectIsObject, detectIsNull, detectIsFunction } from '../utils';\r\nimport type { Component, ComponentFactory } from '../component';\r\nimport type { RefProps, KeyProps, Prettify } from '../shared';\r\nimport { useMemo } from '../use-memo';\r\n\r\nfunction forwardRef<P extends object, R>(\r\n  component: ComponentFactory<Prettify<P>, R>,\r\n): ComponentFactory<Prettify<P & RefProps<R> & KeyProps>, R> {\r\n  type Props = P & RefProps<R> & KeyProps;\r\n\r\n  return (props: Props) => {\r\n    const { ref, ...rest } = (props || {}) as Props;\r\n\r\n    return component(rest as P, ref) as Component<Props, R>;\r\n  };\r\n}\r\n\r\nfunction detectIsMutableRef(ref: unknown): ref is MutableRef {\r\n  if (!detectIsObject(ref) || detectIsNull(ref)) return false;\r\n  const mutableRef = ref as MutableRef;\r\n\r\n  for (const key in mutableRef) {\r\n    if (key === 'current' && mutableRef.hasOwnProperty(key)) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nfunction applyRef<T>(ref: Ref<T>, current: T) {\r\n  if (detectIsFunction(ref)) {\r\n    ref(current);\r\n  } else if (detectIsMutableRef(ref)) {\r\n    ref.current = current;\r\n  }\r\n}\r\n\r\nfunction useRef<T>(initialValue: T = null): MutableRef<T> {\r\n  const ref = useMemo(() => ({ current: initialValue }), []) as MutableRef<T>;\r\n\r\n  return ref;\r\n}\r\n\r\nexport type MutableRef<T = unknown> = {\r\n  current: T;\r\n};\r\n\r\nexport type FunctionRef<T = unknown> = (ref: T) => void;\r\n\r\nexport type Ref<T = unknown> = MutableRef<T> | FunctionRef<T>;\r\n\r\nexport { forwardRef, detectIsMutableRef, applyRef, useRef };\r\n","import type { DarkElement } from '../shared';\r\nimport { component } from '../component';\r\nimport { SHADOW_MASK } from '../constants';\r\nimport { useLayoutEffect } from '../use-layout-effect';\r\nimport { $$scope } from '../scope';\r\nimport { collectElements, getFiberWithElement } from '../walk';\r\nimport { platform, detectIsServer } from '../platform';\r\n\r\nconst $$shadow = Symbol('shadow');\r\n\r\ntype ShadowProps = {\r\n  isInserted: boolean;\r\n  slot: DarkElement;\r\n};\r\n\r\nconst Shadow = component<ShadowProps>(\r\n  ({ isInserted, slot }) => {\r\n    const isEnabled = !detectIsServer() && !$$scope().getIsHydrateZone();\r\n    const fiber = $$scope().getCursorFiber();\r\n\r\n    if (isEnabled) {\r\n      if (isInserted) {\r\n        fiber.mask &= ~SHADOW_MASK;\r\n      } else {\r\n        !(fiber.mask & SHADOW_MASK) && (fiber.mask |= SHADOW_MASK);\r\n      }\r\n    }\r\n\r\n    useLayoutEffect(() => {\r\n      if (!isEnabled || !isInserted) return;\r\n      const $fiber = getFiberWithElement(fiber);\r\n      const fibers = collectElements(fiber, x => x);\r\n\r\n      for (const fiber of fibers) {\r\n        platform.insertElement(fiber.element, fiber.eidx, $fiber.element);\r\n      }\r\n    }, [isInserted]);\r\n\r\n    return slot || null;\r\n  },\r\n  { token: $$shadow },\r\n);\r\n\r\nexport { Shadow };\r\n","import type { DarkElement, SlotProps, TextBased } from '../shared';\r\nimport { createContext, useContext } from '../context';\r\nimport { useLayoutEffect } from '../use-layout-effect';\r\nimport { detectIsServer } from '../platform';\r\nimport { detectIsFiberAlive } from '../walk';\r\nimport { useUpdate } from '../use-update';\r\nimport { component } from '../component';\r\nimport { useState } from '../use-state';\r\nimport { Fragment } from '../fragment';\r\nimport { useMemo } from '../use-memo';\r\nimport { forwardRef } from '../ref';\r\nimport { $$scope } from '../scope';\r\nimport { Shadow } from '../shadow';\r\nimport { dummyFn } from '../utils';\r\n\r\ntype SuspenseContextValue = {\r\n  isLoaded: boolean;\r\n  fallback: DarkElement;\r\n  register: (id: TextBased) => void;\r\n  unregister: (id: TextBased) => void;\r\n  update: () => void;\r\n};\r\n\r\nconst SuspenseContext = createContext<SuspenseContextValue>({\r\n  isLoaded: false,\r\n  fallback: null,\r\n  register: dummyFn,\r\n  unregister: dummyFn,\r\n  update: null,\r\n});\r\n\r\nconst useSuspense = () => useContext(SuspenseContext);\r\n\r\ntype SuspenseProps = {\r\n  fallback: DarkElement;\r\n} & Required<SlotProps>;\r\n\r\nconst Suspense = forwardRef<SuspenseProps, unknown>(\r\n  component(({ fallback, slot }) => {\r\n    if (process.env.NODE_ENV !== 'production') {\r\n      if (!fallback) {\r\n        throw new Error(`[Dark]: Suspense fallback not found!`);\r\n      }\r\n    }\r\n    const $scope = $$scope();\r\n    const emitter = $scope.getEmitter();\r\n    const suspense = useSuspense();\r\n    const update = useUpdate();\r\n    const [isLoaded, setIsLoaded] = useState(() => detectIsServer() || $scope.getIsHydrateZone());\r\n    const scope = useMemo<Scope>(() => ({ store: new Set(), isLoaded }), []);\r\n    const value = useMemo<SuspenseContextValue>(\r\n      () => ({ isLoaded, fallback, update: null, register: null, unregister: null }),\r\n      [],\r\n    );\r\n    const fiber = $scope.getCursorFiber();\r\n    const content = [\r\n      Shadow({ key: CONTENT, isInserted: isLoaded, slot }),\r\n      isLoaded ? null : Fragment({ key: FALLBACK, slot: fallback }),\r\n    ].filter(Boolean);\r\n\r\n    useLayoutEffect(() => {\r\n      const off = emitter.on('finish', () => {\r\n        const { store, isLoaded } = scope;\r\n\r\n        if (store.size === 0 && !isLoaded) {\r\n          off();\r\n          setIsLoaded(true);\r\n        }\r\n      });\r\n\r\n      return off;\r\n    }, []);\r\n\r\n    scope.isLoaded = isLoaded;\r\n    value.isLoaded = isLoaded;\r\n    value.fallback = fallback;\r\n    value.update = () => (detectIsFiberAlive(fiber) ? update() : suspense.update && suspense.update());\r\n    value.register = (id: TextBased) => scope.store.add(id);\r\n    value.unregister = (id: TextBased) => scope.store.delete(id);\r\n\r\n    return SuspenseContext.Provider({ value, slot: content });\r\n  }),\r\n);\r\n\r\ntype Scope = { store: Set<TextBased>; isLoaded: boolean };\r\n\r\nconst CONTENT = 1;\r\nconst FALLBACK = 2;\r\n\r\nexport { Suspense, useSuspense };\r\n","import { useMemo } from '../use-memo';\r\nimport { getRootId } from '../scope';\r\n\r\nfunction useId() {\r\n  const id = useMemo(() => getNextId(getRootId()), []);\r\n\r\n  return id;\r\n}\r\n\r\nlet nextId = 1000000;\r\n\r\nconst getNextId = (rootId: number) => `dark:${rootId}:${(++nextId).toString(36)}`;\r\n\r\nexport { useId };\r\n","import { type ComponentFactory, component } from '../component';\r\nimport { detectIsUndefined, dummyFn } from '../utils';\r\nimport { detectIsServer } from '../platform';\r\nimport { detectIsFiberAlive } from '../walk';\r\nimport { useSuspense } from '../suspense';\r\nimport { useUpdate } from '../use-update';\r\nimport { forwardRef } from '../ref';\r\nimport { $$scope } from '../scope';\r\nimport { useId } from '../use-id';\r\n\r\nconst $$lazy = Symbol('lazy');\r\nconst factories = new Map<Function, ComponentFactory>();\r\n\r\nfunction lazy<P extends object, R = unknown>(module: ModuleFn<P>, done: () => void = dummyFn) {\r\n  return forwardRef(\r\n    component<P, R>(\r\n      (props, ref) => {\r\n        const $scope = $$scope();\r\n        const suspense = useSuspense();\r\n        const update = useUpdate();\r\n        const id = useId();\r\n        const factory = factories.get(module);\r\n        const fiber = $scope.getCursorFiber();\r\n        const $update = () => (detectIsFiberAlive(fiber) ? update() : suspense.update && suspense.update());\r\n\r\n        if (detectIsUndefined(factory)) {\r\n          suspense.register(id);\r\n          factories.set(module, null);\r\n          const isServer = detectIsServer();\r\n          const isHydrateZone = $scope.getIsHydrateZone();\r\n          const make = async () => {\r\n            factories.set(module, await load(module));\r\n            suspense.unregister(id);\r\n            done();\r\n          };\r\n\r\n          if (isServer || isHydrateZone) {\r\n            $scope.defer(make);\r\n          } else {\r\n            make().then($update);\r\n          }\r\n        }\r\n\r\n        return factory ? factory(props, ref) : suspense.isLoaded ? suspense.fallback : null;\r\n      },\r\n      { token: $$lazy },\r\n    ),\r\n  );\r\n}\r\n\r\nfunction load<P extends object>(module: ModuleFn<P>) {\r\n  return new Promise<ComponentFactory<P>>(resolve => {\r\n    module().then(module => {\r\n      if (process.env.NODE_ENV !== 'production') {\r\n        if (!module.default) {\r\n          throw new Error('[Dark]: the lazy loaded component should be exported as default!');\r\n        }\r\n      }\r\n\r\n      resolve(module.default);\r\n    });\r\n  });\r\n}\r\n\r\ntype ModuleFn<P extends object> = () => Promise<Module<P>>;\r\n\r\nexport type Module<P extends object = {}> = { default: ComponentFactory<P> };\r\n\r\nexport { lazy };\r\n","import { detectIsUndefined } from '@dark-engine/core';\r\n\r\nconst svgTagNames = new Set([\r\n  'svg',\r\n  'animate',\r\n  'animateMotion',\r\n  'animateTransform',\r\n  'circle',\r\n  'clipPath',\r\n  'defs',\r\n  'desc',\r\n  'ellipse',\r\n  'feBlend',\r\n  'feColorMatrix',\r\n  'feComponentTransfer',\r\n  'feComposite',\r\n  'feConvolveMatrix',\r\n  'feDiffuseLighting',\r\n  'feDisplacementMap',\r\n  'feDistantLight',\r\n  'feDropShadow',\r\n  'feFlood',\r\n  'feFuncA',\r\n  'feFuncB',\r\n  'feFuncG',\r\n  'feFuncR',\r\n  'feGaussianBlur',\r\n  'feImage',\r\n  'feMerge',\r\n  'feMergeNode',\r\n  'feMorphology',\r\n  'feOffset',\r\n  'fePointLight',\r\n  'feSpecularLighting',\r\n  'feSpotLight',\r\n  'feTile',\r\n  'feTurbulence',\r\n  'filter',\r\n  'foreignObject',\r\n  'g',\r\n  'image',\r\n  'line',\r\n  'linearGradient',\r\n  'marker',\r\n  'mask',\r\n  'metadata',\r\n  'mpath',\r\n  'path',\r\n  'pattern',\r\n  'polygon',\r\n  'polyline',\r\n  'radialGradient',\r\n  'rect',\r\n  'stop',\r\n  'switch',\r\n  'symbol',\r\n  'text',\r\n  'textPath',\r\n  'tspan',\r\n  'use',\r\n  'view',\r\n]);\r\nconst voidTagNames = new Set([\r\n  'area',\r\n  'base',\r\n  'br',\r\n  'col',\r\n  'embed',\r\n  'hr',\r\n  'img',\r\n  'input',\r\n  'link',\r\n  'meta',\r\n  'param',\r\n  'source',\r\n  'track',\r\n  'wbr',\r\n]);\r\n\r\nconst detectIsSvgElement = (name: string) => svgTagNames.has(name);\r\n\r\nconst detectIsVoidElement = (name: string) => voidTagNames.has(name);\r\n\r\nconst detectIsBrowser = () => !detectIsUndefined(globalThis.window);\r\n\r\nexport { detectIsSvgElement, detectIsVoidElement, detectIsBrowser };\r\n","import { detectIsFunction, $$scope, detectIsArray } from '@dark-engine/core';\r\n\r\nimport type { TagNativeElement } from '../native-element';\r\n\r\nexport type EventHandler<E extends Event = Event, T = unknown> =\r\n  | ((e: SyntheticEvent<E, T>) => void)\r\n  | [(...args: Array<any>) => void, ...args: Array<any>];\r\n\r\ntype BrowserEventConstructor = (type: string, event: Event) => void;\r\n\r\nclass SyntheticEvent<E extends Event, T = TagNativeElement> {\r\n  type = '';\r\n  sourceEvent: E = null;\r\n  target: T = null;\r\n  propagation = true; // should be private but typescript has a bug\r\n\r\n  constructor(options: Pick<SyntheticEvent<E, T>, 'sourceEvent' | 'target'>) {\r\n    this.type = options.sourceEvent.type;\r\n    this.sourceEvent = options.sourceEvent;\r\n    this.target = options.target;\r\n  }\r\n\r\n  stopPropagation() {\r\n    this.propagation = false;\r\n    this.sourceEvent.stopPropagation();\r\n  }\r\n\r\n  preventDefault() {\r\n    this.sourceEvent.preventDefault();\r\n  }\r\n\r\n  getPropagation() {\r\n    return this.propagation;\r\n  }\r\n}\r\n\r\nfunction delegateEvent(target: Element, eventName: string, handler: EventHandler) {\r\n  const $scope = $$scope();\r\n  const eventsMap = $scope.getEvents();\r\n  const handlersMap = eventsMap.get(eventName);\r\n  const $handler = detectIsArray(handler) ? (e: Event) => handler[0](...handler.slice(1), e) : handler;\r\n\r\n  if (!handlersMap) {\r\n    const rootHandler = (event: Event) => {\r\n      const handler = eventsMap.get(eventName).get(event.target);\r\n      const target = event.target as TagNativeElement;\r\n      let $event: SyntheticEvent<Event> = null;\r\n\r\n      if (detectIsFunction(handler)) {\r\n        $event = new SyntheticEvent({ sourceEvent: event, target });\r\n\r\n        $scope.setIsEventZone(true);\r\n        handler($event);\r\n        $scope.setIsEventZone(false);\r\n      }\r\n\r\n      if (target.parentElement) {\r\n        const shouldPropagate = $event ? $event.getPropagation() : true;\r\n\r\n        if (shouldPropagate) {\r\n          const constructor = event.constructor as BrowserEventConstructor;\r\n\r\n          target.parentElement.dispatchEvent(new constructor(event.type, event));\r\n        }\r\n      }\r\n    };\r\n\r\n    eventsMap.set(eventName, new WeakMap([[target, $handler]]));\r\n    document.addEventListener(eventName, rootHandler, true);\r\n    $scope.addEventUnsubscriber(() => document.removeEventListener(eventName, rootHandler, true));\r\n  } else {\r\n    handlersMap.set(target, $handler);\r\n  }\r\n}\r\n\r\nconst detectIsEvent = (attrName: string) => attrName.startsWith('on');\r\n\r\nconst getEventName = (attrName: string) => attrName.slice(2, attrName.length).toLowerCase();\r\n\r\nexport { SyntheticEvent, delegateEvent, detectIsEvent, getEventName };\r\n","import { type DarkElement, type Fiber, component, useMemo, $$scope, detectIsComponent } from '@dark-engine/core';\r\n\r\nimport type { TagNativeElement } from '../native-element';\r\n\r\nconst $$portal = Symbol('portal');\r\n\r\nfunction createPortal(slot: DarkElement, container: TagNativeElement) {\r\n  if (process.env.NODE_ENV !== 'production') {\r\n    if (!(container instanceof Element)) {\r\n      throw new Error(`[Dark]: createPortal only gets an Element as container!`);\r\n    }\r\n  }\r\n\r\n  return Portal({ container, slot });\r\n}\r\n\r\ntype PortalProps = {\r\n  container: TagNativeElement;\r\n  slot: DarkElement;\r\n};\r\n\r\nconst Portal = component<PortalProps>(\r\n  props => {\r\n    const element = props.container;\r\n    const fiber = $$scope().getCursorFiber();\r\n\r\n    useMemo(() => (element.innerHTML = ''), []);\r\n\r\n    fiber.element = element;\r\n    props.container = null;\r\n\r\n    return props.slot;\r\n  },\r\n  { token: $$portal },\r\n);\r\n\r\nconst detectIsPortal = (instance: unknown) => detectIsComponent(instance) && instance.token === $$portal;\r\n\r\nconst getPortalContainer = (fiber: Fiber<TagNativeElement>): TagNativeElement | null =>\r\n  detectIsPortal(fiber.inst) ? fiber.element : null;\r\n\r\nfunction unmountPortal(fiber: Fiber<TagNativeElement>) {\r\n  const element = getPortalContainer(fiber);\r\n\r\n  element && (element.innerHTML = '');\r\n}\r\n\r\nexport { createPortal, unmountPortal, detectIsPortal };\r\n","export const VERSION = '1.2.0';\r\nexport const INPUT_TAG = 'input';\r\nexport const TEXTAREA_TAG = 'textarea';\r\nexport const CLASS_NAME_ATTR = 'className';\r\nexport const CLASS_ATTR = 'class';\r\nexport const STYLE_ATTR = 'style';\r\nexport const VALUE_ATTR = 'value';\r\nexport const AS_ATTR = '_as';\r\nexport const EXCLUDE_ATTR_MARK = '$';\r\nexport const DANGER_HTML_CONTENT = '__danger';\r\n","import {\r\n  type Fiber,\r\n  type VirtualNode,\r\n  type TagVirtualNode,\r\n  type TextVirtualNode,\r\n  type CommentVirtualNode,\r\n  type PlainVirtualNode,\r\n  type Callback,\r\n  type Ref,\r\n  REF_ATTR,\r\n  ATTR_BLACK_LIST,\r\n  CREATE_EFFECT_TAG,\r\n  UPDATE_EFFECT_TAG,\r\n  DELETE_EFFECT_TAG,\r\n  SKIP_EFFECT_TAG,\r\n  MOVE_MASK,\r\n  FLUSH_MASK,\r\n  SHADOW_MASK,\r\n  detectIsUndefined,\r\n  detectIsBoolean,\r\n  detectIsObject,\r\n  NodeType,\r\n  detectIsTagVirtualNode,\r\n  detectIsTextVirtualNode,\r\n  detectIsPlainVirtualNode,\r\n  getFiberWithElement,\r\n  collectElements,\r\n  walk,\r\n  dummyFn,\r\n  $$scope,\r\n  applyRef,\r\n} from '@dark-engine/core';\r\n\r\nimport { detectIsSvgElement, detectIsVoidElement } from '../utils';\r\nimport { delegateEvent, detectIsEvent, getEventName } from '../events';\r\nimport { detectIsPortal } from '../portal';\r\nimport {\r\n  INPUT_TAG,\r\n  TEXTAREA_TAG,\r\n  STYLE_ATTR,\r\n  CLASS_ATTR,\r\n  CLASS_NAME_ATTR,\r\n  VALUE_ATTR,\r\n  AS_ATTR,\r\n  EXCLUDE_ATTR_MARK,\r\n  DANGER_HTML_CONTENT,\r\n} from '../constants';\r\nimport type {\r\n  NativeElement,\r\n  TagNativeElement,\r\n  TextNativeElement,\r\n  CommentNativeElement,\r\n  NativeNode,\r\n  AttributeValue,\r\n} from '../native-element';\r\n\r\nexport type CSSProperties = Record<string, string | number>;\r\n\r\nlet moves: Array<Callback> = [];\r\nlet patches: Array<Callback> = [];\r\nlet trackUpdate: (nativeElement: NativeElement) => void = null;\r\n\r\nconst createNativeElementMap = {\r\n  [NodeType.TAG]: (vNode: VirtualNode): TagNativeElement => {\r\n    const tagNode = vNode as TagVirtualNode;\r\n    const name = tagNode.name;\r\n\r\n    return detectIsSvgElement(name)\r\n      ? document.createElementNS('http://www.w3.org/2000/svg', name)\r\n      : document.createElement(name);\r\n  },\r\n  [NodeType.TEXT]: (vNode: VirtualNode): TextNativeElement => {\r\n    return document.createTextNode((vNode as TextVirtualNode).value);\r\n  },\r\n  [NodeType.COMMENT]: (vNode: VirtualNode): CommentNativeElement => {\r\n    return document.createComment((vNode as CommentVirtualNode).value);\r\n  },\r\n};\r\n\r\nfunction createNativeElement(node: VirtualNode): NativeElement {\r\n  return createNativeElementMap[node.type](node);\r\n}\r\n\r\nfunction setObjectStyle(element: TagNativeElement, style: CSSProperties) {\r\n  const keys = Object.keys(style);\r\n\r\n  for (const key of keys) {\r\n    (element as HTMLElement).style.setProperty(key, String(style[key]));\r\n  }\r\n}\r\n\r\nfunction addAttributes(element: NativeElement, node: TagVirtualNode, isHydrateZone: boolean) {\r\n  const attrNames = Object.keys(node.attrs);\r\n  const tagElement = element as TagNativeElement;\r\n\r\n  for (let attrName of attrNames) {\r\n    const attrValue = node.attrs[attrName];\r\n    const attribute = performAttribute(tagElement, attrName, attrValue);\r\n\r\n    if (attribute === null) {\r\n      continue;\r\n    } else {\r\n      attrName = attribute;\r\n    }\r\n\r\n    if (detectIsEvent(attrName)) {\r\n      delegateEvent(tagElement, getEventName(attrName), attrValue);\r\n    } else if (!isHydrateZone && !detectIsUndefined(attrValue) && !ATTR_BLACK_LIST[attrName]) {\r\n      const stop = patchProperties({\r\n        tagName: node.name,\r\n        element: tagElement,\r\n        attrValue,\r\n        attrName,\r\n      });\r\n\r\n      !stop && tagElement.setAttribute(attrName, attrValue);\r\n    }\r\n  }\r\n}\r\n\r\nfunction updateAttributes(element: NativeElement, prevNode: TagVirtualNode, nextNode: TagVirtualNode) {\r\n  const attrNames = getAttributeNames(prevNode, nextNode);\r\n  const tagElement = element as TagNativeElement;\r\n\r\n  for (let attrName of attrNames) {\r\n    const prevAttrValue = prevNode.attrs[attrName];\r\n    const nextAttrValue = nextNode.attrs[attrName];\r\n    const attribute = performAttribute(tagElement, attrName, nextAttrValue, prevAttrValue);\r\n\r\n    if (attribute === null) {\r\n      continue;\r\n    } else {\r\n      attrName = attribute;\r\n    }\r\n\r\n    if (!detectIsUndefined(nextAttrValue)) {\r\n      if (detectIsEvent(attrName)) {\r\n        prevAttrValue !== nextAttrValue && delegateEvent(tagElement, getEventName(attrName), nextAttrValue);\r\n      } else if (!ATTR_BLACK_LIST[attrName] && prevAttrValue !== nextAttrValue) {\r\n        const stop = patchProperties({\r\n          tagName: nextNode.name,\r\n          element: tagElement,\r\n          attrValue: nextAttrValue,\r\n          attrName,\r\n        });\r\n\r\n        !stop && tagElement.setAttribute(attrName, nextAttrValue);\r\n      }\r\n    } else {\r\n      tagElement.removeAttribute(attrName);\r\n    }\r\n  }\r\n}\r\n\r\nfunction performAttribute(\r\n  tagElement: TagNativeElement,\r\n  attrName: string,\r\n  nextAttrValue: AttributeValue,\r\n  prevAttrValue?: AttributeValue,\r\n) {\r\n  if (attrName[0] === EXCLUDE_ATTR_MARK) return null;\r\n\r\n  if (attrName === DANGER_HTML_CONTENT && tagElement.innerHTML !== nextAttrValue) {\r\n    tagElement.innerHTML = String(nextAttrValue);\r\n    return null;\r\n  }\r\n\r\n  if (attrName === REF_ATTR) {\r\n    applyRef(nextAttrValue as unknown as Ref<TagNativeElement>, tagElement);\r\n    return null;\r\n  }\r\n\r\n  if ((attrName === CLASS_ATTR || attrName === CLASS_NAME_ATTR) && nextAttrValue !== prevAttrValue) {\r\n    toggleAttribute(tagElement, CLASS_ATTR, nextAttrValue as string);\r\n    return null;\r\n  }\r\n\r\n  if (attrName === STYLE_ATTR && nextAttrValue && nextAttrValue !== prevAttrValue && detectIsObject(nextAttrValue)) {\r\n    setObjectStyle(tagElement, nextAttrValue as CSSProperties);\r\n    return null;\r\n  }\r\n\r\n  if (attrName === AS_ATTR) {\r\n    attrName = attrName.slice(1, AS_ATTR.length);\r\n  }\r\n\r\n  return attrName;\r\n}\r\n\r\nfunction toggleAttribute(element: TagNativeElement, name: string, value: string) {\r\n  value ? element.setAttribute(name, value) : element.removeAttribute(name);\r\n}\r\n\r\nfunction getAttributeNames(prevNode: TagVirtualNode, nextNode: TagVirtualNode) {\r\n  const attrNames = new Set<string>();\r\n  const prevAttrs = Object.keys(prevNode.attrs);\r\n  const nextAttrs = Object.keys(nextNode.attrs);\r\n  const size = Math.max(prevAttrs.length, nextAttrs.length);\r\n\r\n  for (let i = 0; i < size; i++) {\r\n    attrNames.add(prevAttrs[i] || nextAttrs[i]);\r\n  }\r\n\r\n  return attrNames;\r\n}\r\n\r\nconst ATTR_TRANSFORM_MAP = {\r\n  readonly: 'readOnly',\r\n};\r\n\r\ntype PatchPropertiesOptions = {\r\n  tagName: string;\r\n  element: TagNativeElement;\r\n  attrName: string;\r\n  attrValue: AttributeValue;\r\n};\r\n\r\nfunction patchProperties(options: PatchPropertiesOptions): boolean {\r\n  const { tagName, element, attrName, attrValue } = options;\r\n  const fn = specialCasesMap[tagName];\r\n  const $attrName = ATTR_TRANSFORM_MAP[attrName] || attrName;\r\n  let stop = fn ? fn(element, attrName, attrValue) : false;\r\n\r\n  if (canSetProperty(element, $attrName)) {\r\n    element[$attrName] = attrValue;\r\n  }\r\n\r\n  if (!stop && detectIsBoolean(attrValue)) {\r\n    stop = !$attrName.includes('-');\r\n  }\r\n\r\n  return stop;\r\n}\r\n\r\nfunction canSetProperty(element: TagNativeElement, key: string) {\r\n  const prototype = Object.getPrototypeOf(element);\r\n  const descriptor = Object.getOwnPropertyDescriptor(prototype, key);\r\n\r\n  return Boolean(descriptor?.set);\r\n}\r\n\r\nconst specialCasesMap: Record<\r\n  string,\r\n  (element: NativeElement, attrName: string, attrValue: AttributeValue) => boolean\r\n> = {\r\n  [INPUT_TAG]: (element: HTMLInputElement, attrName: string, attrValue: AttributeValue) => {\r\n    if (attrName === VALUE_ATTR) {\r\n      patches.push(() => {\r\n        detectIsBoolean(attrValue) ? (element.checked = attrValue) : (element.value = String(attrValue));\r\n      });\r\n    }\r\n\r\n    return false;\r\n  },\r\n  [TEXTAREA_TAG]: (element: HTMLTextAreaElement, attrName: string, attrValue: AttributeValue) => {\r\n    if (attrName === VALUE_ATTR) {\r\n      element.innerText = String(attrValue);\r\n\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  },\r\n};\r\n\r\nfunction commitCreation(fiber: Fiber<NativeElement>) {\r\n  const parentFiber = getFiberWithElement<NativeElement, TagNativeElement>(fiber.parent);\r\n  const parentElement = parentFiber.element;\r\n  const childNodes = parentElement.childNodes;\r\n  const isHydrateZone = $$scope().getIsHydrateZone();\r\n\r\n  if (isHydrateZone) {\r\n    let nativeElement = childNodes[fiber.eidx] as NativeElement;\r\n\r\n    if (nativeElement instanceof DocumentType) {\r\n      nativeElement = nativeElement.nextSibling as NativeElement;\r\n    }\r\n\r\n    if (\r\n      detectIsTextVirtualNode(fiber.inst) &&\r\n      nativeElement instanceof Text &&\r\n      fiber.inst.value.length !== nativeElement.length\r\n    ) {\r\n      nativeElement.splitText(fiber.inst.value.length);\r\n    }\r\n\r\n    if (fiber.element.nodeName !== nativeElement.nodeName) {\r\n      throw Error('[platform-browser]: inconsistent element for hydration!');\r\n    }\r\n\r\n    fiber.element = nativeElement;\r\n  } else {\r\n    if (!(fiber.mask & SHADOW_MASK)) {\r\n      if (detectIsTagVirtualNode(parentFiber.inst) && parentFiber.inst.attrs[DANGER_HTML_CONTENT]) {\r\n        throw new Error(`[platform-browser]: element with danger content can't have a children!`);\r\n      }\r\n\r\n      if (childNodes.length === 0 || fiber.eidx > childNodes.length - 1) {\r\n        !detectIsVoidElement((parentFiber.inst as TagVirtualNode).name) &&\r\n          appendNativeElement(fiber.element, parentElement);\r\n      } else {\r\n        insertNativeElement(fiber.element, parentElement.childNodes[fiber.eidx], parentElement);\r\n      }\r\n    }\r\n  }\r\n\r\n  detectIsTagVirtualNode(fiber.inst) && addAttributes(fiber.element, fiber.inst, isHydrateZone);\r\n}\r\n\r\nfunction commitUpdate(fiber: Fiber<NativeElement>) {\r\n  const element = fiber.element;\r\n  const prevInstance = fiber.alt.inst as VirtualNode;\r\n  const nextInstance = fiber.inst as VirtualNode;\r\n\r\n  detectIsPlainVirtualNode(nextInstance)\r\n    ? (prevInstance as PlainVirtualNode).value !== nextInstance.value && (element.textContent = nextInstance.value)\r\n    : updateAttributes(element, prevInstance as TagVirtualNode, nextInstance as TagVirtualNode);\r\n}\r\n\r\nfunction commitDeletion(fiber: Fiber<NativeElement>) {\r\n  const parentFiber = getFiberWithElement<NativeElement, TagNativeElement>(fiber.parent);\r\n\r\n  if (fiber.mask & FLUSH_MASK) {\r\n    parentFiber.element.innerHTML && (parentFiber.element.innerHTML = '');\r\n    return;\r\n  }\r\n\r\n  walk<NativeElement>(fiber, (fiber, skip) => {\r\n    if (fiber.element) {\r\n      !detectIsPortal(fiber.inst) &&\r\n        canRemoveNativeElement(fiber.element, parentFiber.element) &&\r\n        removeNativeElement(fiber.element, parentFiber.element);\r\n      return skip();\r\n    }\r\n  });\r\n}\r\n\r\nfunction move(fiber: Fiber<NativeElement>) {\r\n  const sourceNodes = collectElements(fiber, x => x.element);\r\n  const sourceNode = sourceNodes[0];\r\n  const parentElement = sourceNode.parentElement;\r\n  const sourceFragment = new DocumentFragment();\r\n  const elementIdx = fiber.eidx;\r\n  let idx = 0;\r\n  const move = () => {\r\n    for (let i = 1; i < sourceNodes.length; i++) {\r\n      removeNativeElement(parentElement.childNodes[elementIdx + 1], parentElement);\r\n    }\r\n\r\n    replaceNativeElement(sourceFragment, parentElement.childNodes[elementIdx], parentElement);\r\n  };\r\n\r\n  for (const node of sourceNodes) {\r\n    insertNativeElement(document.createComment(`${elementIdx}:${idx}`), node, parentElement);\r\n    appendNativeElement(node, sourceFragment);\r\n    idx++;\r\n  }\r\n\r\n  moves.push(move);\r\n}\r\n\r\nconst commitMap: Record<string, (fiber: Fiber<NativeElement>) => void> = {\r\n  [CREATE_EFFECT_TAG]: (fiber: Fiber<NativeElement>) => {\r\n    if (!fiber.element || detectIsPortal(fiber.inst)) return;\r\n    trackUpdate && trackUpdate(fiber.element);\r\n    commitCreation(fiber);\r\n  },\r\n  [UPDATE_EFFECT_TAG]: (fiber: Fiber<NativeElement>) => {\r\n    fiber.mask & MOVE_MASK && (move(fiber), (fiber.mask &= ~MOVE_MASK));\r\n    if (!fiber.element || detectIsPortal(fiber.inst)) return;\r\n    trackUpdate && trackUpdate(fiber.element);\r\n    commitUpdate(fiber);\r\n  },\r\n  [DELETE_EFFECT_TAG]: commitDeletion,\r\n  [SKIP_EFFECT_TAG]: dummyFn,\r\n};\r\n\r\nfunction finishCommit() {\r\n  moves.forEach(x => x());\r\n  patches.forEach(x => x());\r\n  moves = [];\r\n  patches = [];\r\n}\r\n\r\nconst commit = (fiber: Fiber<NativeElement>) => commitMap[fiber.tag](fiber);\r\n\r\nconst setTrackUpdate = (fn: typeof trackUpdate) => (trackUpdate = fn);\r\n\r\nconst appendNativeElement = (element: NativeNode, parent: NativeNode) => parent.appendChild(element);\r\n\r\nconst insertNativeElement = (element: NativeNode, sibling: NativeNode, parent: TagNativeElement) =>\r\n  parent.insertBefore(element, sibling);\r\n\r\nconst insertNativeElementByIndex = (element: NativeNode, idx: number, parent: TagNativeElement) =>\r\n  parent.insertBefore(element, parent.childNodes[idx]);\r\n\r\nconst replaceNativeElement = (element: NativeNode, candidate: NativeNode, parent: TagNativeElement) =>\r\n  parent.replaceChild(element, candidate);\r\n\r\nconst canRemoveNativeElement = (element: NativeNode, parent: NativeNode) => element.parentElement === parent;\r\n\r\nconst removeNativeElement = (element: NativeNode, parent: TagNativeElement) => parent.removeChild(element);\r\n\r\nexport { createNativeElement, commit, finishCommit, setTrackUpdate, insertNativeElementByIndex };\r\n","import {\r\n  type DarkElement,\r\n  type Callback,\r\n  ROOT,\r\n  Fiber,\r\n  CREATE_EFFECT_TAG,\r\n  UPDATE_EFFECT_TAG,\r\n  platform,\r\n  flatten,\r\n  detectIsUndefined,\r\n  detectIsFunction,\r\n  trueFn,\r\n  TagVirtualNode,\r\n  TaskPriority,\r\n  createReplacer,\r\n  setRootId,\r\n  $$scope,\r\n  dummyFn,\r\n  scheduler,\r\n} from '@dark-engine/core';\r\n\r\nimport { createNativeElement, insertNativeElementByIndex, commit, finishCommit } from '../dom';\r\nimport { detectIsPortal, unmountPortal } from '../portal';\r\nimport type { TagNativeElement } from '../native-element';\r\nimport { detectIsBrowser } from '../utils';\r\n\r\nconst isBrowser = detectIsBrowser();\r\nconst roots = new Map<Element, number>();\r\nconst raf = isBrowser && requestAnimationFrame.bind(this);\r\nconst caf = isBrowser && cancelAnimationFrame.bind(this);\r\nconst spawn = raf;\r\nlet isInjected = false;\r\n\r\nfunction inject() {\r\n  platform.createElement = createNativeElement as typeof platform.createElement;\r\n  platform.insertElement = insertNativeElementByIndex as typeof platform.insertElement;\r\n  platform.raf = raf;\r\n  platform.caf = caf;\r\n  platform.spawn = spawn;\r\n  platform.commit = commit;\r\n  platform.finishCommit = finishCommit;\r\n  platform.detectIsDynamic = trueFn;\r\n  platform.detectIsPortal = detectIsPortal;\r\n  platform.unmountPortal = unmountPortal;\r\n  platform.chunk = dummyFn;\r\n  isInjected = true;\r\n}\r\n\r\nfunction render(element: DarkElement, container: TagNativeElement, hydrate?: Callback) {\r\n  !isInjected && inject();\r\n  if (process.env.NODE_ENV !== 'production') {\r\n    if (!(container instanceof Element) && !((container as unknown) instanceof Document)) {\r\n      throw new Error(`[Dark]: render receives a valid element as container!`);\r\n    }\r\n  }\r\n\r\n  const isMounted = !detectIsUndefined(roots.get(container));\r\n  const isHydrate = detectIsFunction(hydrate);\r\n  let rootId: number = null;\r\n\r\n  if (!isMounted) {\r\n    rootId = roots.size;\r\n    roots.set(container, rootId);\r\n    !isHydrate && (container.innerHTML = '');\r\n  } else {\r\n    rootId = roots.get(container);\r\n  }\r\n\r\n  const $scope = $$scope(rootId);\r\n\r\n  // insertion effect can't schedule renders\r\n  if ($scope?.getIsInsertionEffectsZone()) return;\r\n\r\n  const callback = () => {\r\n    setRootId(rootId); // !\r\n    const $scope = $$scope();\r\n    const rootFiber = $scope.getRoot();\r\n    const isUpdate = Boolean(rootFiber);\r\n    const fiber = new Fiber().mutate({\r\n      element: container,\r\n      inst: new TagVirtualNode(ROOT, {}, flatten([element || createReplacer()]) as TagVirtualNode['children']),\r\n      alt: rootFiber,\r\n      tag: isUpdate ? UPDATE_EFFECT_TAG : CREATE_EFFECT_TAG,\r\n    });\r\n\r\n    $scope.resetMount();\r\n    $scope.setWorkInProgress(fiber);\r\n    $scope.setIsHydrateZone(isHydrate);\r\n    $scope.setNextUnitOfWork(fiber);\r\n    isHydrate && hydrate();\r\n  };\r\n\r\n  scheduler.schedule(callback, { priority: TaskPriority.NORMAL });\r\n}\r\n\r\nexport { render, roots, inject };\r\n","export const VERSION = '1.2.0';\r\nexport const SLASH_MARK = '/';\r\nexport const PARAMETER_MARK = ':';\r\nexport const WILDCARD_MARK = '**';\r\nexport const PROTOCOL_MARK = '://';\r\nexport const SEARCH_MARK = '?';\r\nexport const HASH_MARK = '#';\r\nexport const ROOT_MARK = '__ROOT__';\r\nexport const ACTIVE_LINK_CLASSNAME = 'active-link';\r\n","import { createContext, useContext } from '@dark-engine/core';\r\n\r\nimport { type RouterLocation } from '../location';\r\nimport { type RouterHistory } from '../history';\r\nimport { type Route } from '../create-routes';\r\n\r\nexport type ActiveRouteContextValue = {\r\n  location: RouterLocation;\r\n  params: Map<string, string>;\r\n  route: Route;\r\n};\r\n\r\nconst ActiveRouteContext = createContext<ActiveRouteContextValue>(null, { displayName: 'ActiveRoute' });\r\n\r\nfunction useActiveRouteContext() {\r\n  const value = useContext(ActiveRouteContext);\r\n\r\n  return value;\r\n}\r\n\r\nexport type RouterHistoryContextValue = {\r\n  history: RouterHistory;\r\n};\r\n\r\nconst RouterHistoryContext = createContext<RouterHistoryContextValue>(null, { displayName: 'RouterHistory' });\r\n\r\nfunction useRouterHistoryContext() {\r\n  const value = useContext(RouterHistoryContext);\r\n\r\n  return value;\r\n}\r\n\r\nconst CurrentPathContext = createContext<string>(null, { displayName: 'CurrentPath' });\r\n\r\nfunction useCurrentPathContext() {\r\n  const value = useContext(CurrentPathContext);\r\n\r\n  return value;\r\n}\r\n\r\nfunction checkContextValue(value: ActiveRouteContextValue | RouterHistoryContextValue) {\r\n  if (!value) {\r\n    throw new Error('[web-router]: illegal invoke hook outside router!');\r\n  }\r\n}\r\n\r\nexport {\r\n  ActiveRouteContext,\r\n  useActiveRouteContext,\r\n  RouterHistoryContext,\r\n  useRouterHistoryContext,\r\n  CurrentPathContext,\r\n  useCurrentPathContext,\r\n  checkContextValue,\r\n};\r\n","import { type DarkElement, component, forwardRef, useEvent, detectIsFunction } from '@dark-engine/core';\r\nimport { type SyntheticEvent, type DarkJSX } from '@dark-engine/platform-browser';\r\n\r\nimport { useHistory } from '../use-history';\r\n\r\nexport type LinkProps = {\r\n  to: string;\r\n  slot: DarkElement;\r\n} & Omit<DarkJSX.Elements['a'], 'href'>;\r\n\r\nconst Link = forwardRef<LinkProps, HTMLAnchorElement>(\r\n  component(\r\n    (props, ref) => {\r\n      const { to, class: cn1, className: cn2, slot, onClick, ...rest } = props;\r\n      const history = useHistory();\r\n      const className = cn1 || cn2;\r\n      const handleClick = useEvent((e: SyntheticEvent<MouseEvent, HTMLAnchorElement>) => {\r\n        e.preventDefault();\r\n        history.push(to);\r\n        detectIsFunction(onClick) && onClick(e);\r\n      });\r\n\r\n      return (\r\n        <a ref={ref} {...rest} href={to} class={className} onClick={handleClick}>\r\n          {slot}\r\n        </a>\r\n      );\r\n    },\r\n    {\r\n      displayName: 'Link',\r\n    },\r\n  ),\r\n);\r\n\r\nexport { Link };\r\n","import { useRouterHistoryContext, checkContextValue } from '../context';\r\n\r\nfunction useHistory() {\r\n  const value = useRouterHistoryContext();\r\n\r\n  checkContextValue(value);\r\n\r\n  return value.history;\r\n}\r\n\r\nexport { useHistory };\r\n","import { useMemo } from '../use-memo';\r\nimport { useCallback } from '../use-callback';\r\n\r\nfunction useEvent<T extends (...args: Array<any>) => any>(fn: T) {\r\n  const scope = useMemo(() => ({ fn }), []);\r\n\r\n  scope.fn = fn;\r\n\r\n  const callback = useCallback((...args: Array<any>) => {\r\n    return scope.fn(...args);\r\n  }, []);\r\n\r\n  return callback as unknown as T;\r\n}\r\n\r\nexport { useEvent };\r\n","import { useActiveRouteContext, checkContextValue } from '../context';\r\n\r\nfunction useLocation() {\r\n  const active = useActiveRouteContext();\r\n\r\n  checkContextValue(active);\r\n\r\n  return active.location;\r\n}\r\n\r\nexport { useLocation };\r\n","import { SLASH_MARK, PARAMETER_MARK, PROTOCOL_MARK, HASH_MARK, SEARCH_MARK } from '../constants';\r\n\r\nfunction pipe<T>(...fns: Array<Function>): (...args: Array<any>) => T {\r\n  const [fn, ...rest] = fns;\r\n\r\n  return (...args: Array<any>) => {\r\n    return rest.reduce(\r\n      (fn1, fn2) => () => fn2(fn1()),\r\n      () => fn(...args),\r\n    )();\r\n  };\r\n}\r\n\r\nfunction parseURL(url: string) {\r\n  let body = url;\r\n  let protocol = '';\r\n  let host = '';\r\n  let pathname = '';\r\n  let hash = '';\r\n  let search = '';\r\n\r\n  if (body.indexOf(PROTOCOL_MARK) !== -1) {\r\n    [protocol, body] = body.split(PROTOCOL_MARK).filter((x, _, arr) => (arr.length > 2 ? Boolean(x) : true));\r\n  }\r\n\r\n  const splitted = body.split('');\r\n  const idx = splitted.findIndex(x => x === SLASH_MARK);\r\n\r\n  if (idx !== -1) {\r\n    host = splitted.filter((_, idx1) => idx1 < idx).join('');\r\n    pathname = splitted.filter((_, idx1) => idx1 >= idx).join('');\r\n  } else {\r\n    host = body;\r\n    pathname = pathname || SLASH_MARK;\r\n  }\r\n\r\n  if (pathname.indexOf(SEARCH_MARK) !== -1) {\r\n    [pathname, search] = split(pathname, SEARCH_MARK);\r\n  }\r\n\r\n  if (body.indexOf(HASH_MARK) !== -1) {\r\n    if (search) {\r\n      [search, hash] = split(search, HASH_MARK);\r\n    } else {\r\n      [pathname, hash] = split(pathname, HASH_MARK);\r\n    }\r\n  }\r\n\r\n  return {\r\n    protocol,\r\n    host,\r\n    pathname,\r\n    search: createSearch(search),\r\n    hash: createHash(hash),\r\n  };\r\n}\r\n\r\nconst createSearch = (x: string) => (x ? `${SEARCH_MARK}${x}` : '');\r\n\r\nconst createHash = (x: string) => (x ? `${HASH_MARK}${x}` : '');\r\n\r\nconst detectIsParam = (x: string) => x && x.startsWith(PARAMETER_MARK);\r\n\r\nconst getParamName = (x: string) => (detectIsParam(x) ? x.slice(1, x.length) : null);\r\n\r\nconst split = (x: string, token: string) => x.split(token).filter(Boolean);\r\n\r\nconst splitBySlash = (x: string) => split(x, SLASH_MARK);\r\n\r\nconst startSlash = (x: string) => (x.startsWith(SLASH_MARK) ? x : SLASH_MARK + x);\r\n\r\nconst join = (...args: Array<string>) => args.join('');\r\n\r\nfunction normalizePath(x: string) {\r\n  const { pathname, search, hash } = parseURL(startSlash(x));\r\n\r\n  return reduceSlashes(join(pathname, search, hash));\r\n}\r\n\r\nconst reduceSlashes = (x: string) => x.replaceAll(new RegExp(`${SLASH_MARK}+`, 'g'), SLASH_MARK);\r\n\r\nconst trimSlashes = (x: string) => x.replace(new RegExp(`^${SLASH_MARK}+|${SLASH_MARK}+$`, 'g'), '');\r\n\r\nfunction sort<T>(type: 'asc' | 'desc', list: Array<T>, selector: (x: T) => number) {\r\n  const asc = (a: T, b: T) => selector(a) - selector(b);\r\n  const desc = (a: T, b: T) => selector(b) - selector(a);\r\n  const compare = type === 'asc' ? asc : desc;\r\n\r\n  return list.sort(compare);\r\n}\r\n\r\nconst cm = (...args: Array<string>) => [...args].filter(Boolean).join(' ').trim() || undefined;\r\n\r\nexport {\r\n  pipe,\r\n  parseURL,\r\n  detectIsParam,\r\n  getParamName,\r\n  splitBySlash,\r\n  normalizePath,\r\n  reduceSlashes,\r\n  trimSlashes,\r\n  join,\r\n  sort,\r\n  cm,\r\n};\r\n","import { component, forwardRef, useMemo } from '@dark-engine/core';\r\n\r\nimport { SLASH_MARK, ACTIVE_LINK_CLASSNAME } from '../constants';\r\nimport { type LinkProps, Link } from '../link';\r\nimport { useLocation } from '../use-location';\r\nimport { cm, parseURL } from '../utils';\r\n\r\nexport type NavLinkProps = LinkProps;\r\n\r\nconst NavLink = forwardRef<NavLinkProps, HTMLAnchorElement>(\r\n  component(\r\n    (props, ref) => {\r\n      const { to, class: cn1, className: cn2, slot, ...rest } = props;\r\n      const { pathname: url, hash } = useLocation();\r\n      const className = useMemo(() => {\r\n        const isMatch = detectIsMatch(url, to, hash);\r\n\r\n        return cm(cn1 || cn2, isMatch ? ACTIVE_LINK_CLASSNAME : '');\r\n      }, [cn1, cn2, url, hash, to]);\r\n\r\n      return (\r\n        <Link ref={ref} {...rest} to={to} class={className}>\r\n          {slot}\r\n        </Link>\r\n      );\r\n    },\r\n    {\r\n      displayName: 'NavLink',\r\n    },\r\n  ),\r\n);\r\n\r\nfunction detectIsMatch(url: string, to: string, hash: string) {\r\n  const { pathname: $to, hash: $hash } = parseURL(to);\r\n  const isMatch = ($to === url && hash === $hash) || (hash === $hash && $to !== SLASH_MARK && url.indexOf($to) === 0);\r\n\r\n  return isMatch;\r\n}\r\n\r\nexport { NavLink };\r\n","import { type DarkElement, type ComponentFactory, type SlotProps, keyBy, detectIsString } from '@dark-engine/core';\r\n\r\nimport { pipe, splitBySlash, normalizePath, trimSlashes, detectIsParam, getParamName, sort, join } from '../utils';\r\nimport { SLASH_MARK, WILDCARD_MARK, ROOT_MARK } from '../constants';\r\nimport { CurrentPathContext } from '../context';\r\nimport type { Routes, RouteDescriptor, PathMatchStrategy, Params } from './types';\r\n\r\ntype RouteConstructorOptions = {\r\n  prefix: string;\r\n  parent: Route;\r\n} & RouteDescriptor;\r\n\r\nclass Route {\r\n  path = '';\r\n  pathMatch?: PathMatchStrategy;\r\n  parent: Route = null;\r\n  children: Array<Route> = [];\r\n  level: number = null;\r\n  marker = '';\r\n  redirectTo: {\r\n    path: string;\r\n    route: Route;\r\n  };\r\n  component: RouteConstructorOptions['component'] | null;\r\n\r\n  constructor(options: RouteConstructorOptions) {\r\n    const { prefix, path, redirectTo, pathMatch = 'prefix', children = [], parent, component } = options;\r\n    const rootPath = createRootPath(path);\r\n    const prefixedPath = createPrefixedPath(pathMatch, prefix, rootPath);\r\n\r\n    this.path = prefixedPath;\r\n    this.pathMatch = pathMatch;\r\n    this.parent = parent;\r\n    this.children = createRoutes(children, prefixedPath, this);\r\n    this.level = parent ? parent.level + 1 : 0;\r\n    this.marker = rootPath === '' ? ROOT_MARK : rootPath;\r\n    this.redirectTo = detectIsString(redirectTo)\r\n      ? {\r\n          path: createPrefixedPath(pathMatch, prefix, createRootPath(redirectTo)),\r\n          route: null,\r\n        }\r\n      : null;\r\n    this.component = component || null;\r\n  }\r\n\r\n  private getRoute(): Route {\r\n    return this;\r\n  }\r\n\r\n  getPath() {\r\n    return this.path;\r\n  }\r\n\r\n  render(): DarkElement {\r\n    let slot = null;\r\n    let nextRoute = this.getRoute();\r\n\r\n    while (nextRoute) {\r\n      const value = nextRoute.getPath();\r\n      const component = nextRoute.component as ComponentFactory<SlotProps>;\r\n\r\n      slot = CurrentPathContext.Provider({ value, slot: [component({ slot })] });\r\n      nextRoute = nextRoute.parent;\r\n    }\r\n\r\n    return slot;\r\n  }\r\n}\r\n\r\nfunction createRoutes(routes: Routes, prefix = SLASH_MARK, parent: Route = null): Array<Route> {\r\n  const $routes: Array<Route> = [];\r\n\r\n  for (const route of routes) {\r\n    const $route = new Route({ ...route, prefix, parent });\r\n\r\n    $routes.push($route, ...$route.children);\r\n  }\r\n\r\n  if (!parent) {\r\n    const map = keyBy($routes, x => x.path, true) as Record<string, Route>;\r\n\r\n    for (const $route of $routes) {\r\n      if ($route.redirectTo) {\r\n        $route.redirectTo.route = map[$route.redirectTo.path] || null;\r\n      }\r\n    }\r\n  }\r\n\r\n  return $routes;\r\n}\r\n\r\nfunction resolve(url: string, routes: Array<Route>): Route | null {\r\n  const $match = match(url, routes);\r\n  const $wildcard = wildcard(url, routes);\r\n  const route = pipe<Route>($match, redirect, $wildcard, redirect, root, redirect, canRender)();\r\n\r\n  return route;\r\n}\r\n\r\nfunction match(url: string, routes: Array<Route>) {\r\n  return () => {\r\n    const [route] = routes.filter(x => detectIsMatch(url, x.path));\r\n\r\n    return pick(route);\r\n  };\r\n}\r\n\r\nfunction redirect(route: Route) {\r\n  if (route?.redirectTo) return redirect(route.redirectTo.route);\r\n  if (route?.parent?.redirectTo) return redirect(route.parent.redirectTo.route);\r\n\r\n  return pick(route);\r\n}\r\n\r\nfunction wildcard(path: string, routes: Array<Route>) {\r\n  return (route: Route) => {\r\n    if (route) return route;\r\n    const [$route] = pipe<Array<Route>>(\r\n      (routes: Array<Route>) => routes.filter(x => x.marker === WILDCARD_MARK),\r\n      (routes: Array<Route>) => routes.filter(x => detectIsMatchAsWildcard(path, x.path)) || null,\r\n      (routes: Array<Route>) => sort('desc', routes, x => x.level),\r\n    )(routes);\r\n\r\n    return pick($route);\r\n  };\r\n}\r\n\r\nfunction root(route: Route) {\r\n  const $route = route?.children.find(x => x.marker === ROOT_MARK);\r\n\r\n  if ($route?.children.length > 0) return root($route);\r\n\r\n  return pick($route || route);\r\n}\r\n\r\nfunction canRender(route: Route) {\r\n  if (route?.component) return route;\r\n  throw new Error('[web-router]: the route was not found or it has no component!');\r\n}\r\n\r\nconst pick = (route: Route): Route | null => route || null;\r\n\r\nfunction detectIsMatch(url: string, path: string) {\r\n  const matcher = createMatcher({\r\n    space: (a, b) => Math.max(a.length, b.length),\r\n    skip: ({ isParam }) => isParam,\r\n  });\r\n\r\n  return matcher(url, path);\r\n}\r\n\r\nfunction detectIsMatchAsWildcard(url: string, path: string) {\r\n  const matcher = createMatcher({\r\n    space: (_, b) => b.length,\r\n    skip: ({ isParam, isWildcard }) => isParam || isWildcard,\r\n  });\r\n\r\n  return matcher(url, path);\r\n}\r\n\r\ntype CreateMatcherOptions = {\r\n  space: (a: Array<string>, b: Array<string>) => number;\r\n  skip: (options: SkipOptions) => boolean;\r\n};\r\n\r\ntype SkipOptions = {\r\n  isWildcard: boolean;\r\n  isParam: boolean;\r\n};\r\n\r\nfunction createMatcher(options: CreateMatcherOptions) {\r\n  const { space, skip } = options;\r\n\r\n  return (url: string, path: string) => {\r\n    const [a, b] = split(url, path);\r\n\r\n    for (let i = 0; i < space(a, b); i++) {\r\n      const segment = b[i];\r\n      const isWildcard = segment === WILDCARD_MARK;\r\n      const isParam = detectIsParam(segment);\r\n\r\n      if (segment !== a[i] && !skip({ isWildcard, isParam })) return false;\r\n    }\r\n\r\n    return true;\r\n  };\r\n}\r\n\r\nfunction mergePaths(url: string, path: string) {\r\n  const [a, b] = split(url, path);\r\n  const parts: Array<string> = [];\r\n\r\n  for (let i = 0; i < b.length; i++) {\r\n    const isParam = detectIsParam(b[i]);\r\n\r\n    if (isParam) {\r\n      const param = a[i] || 'null';\r\n\r\n      parts.push(param);\r\n    } else {\r\n      parts.push(b[i]);\r\n    }\r\n  }\r\n\r\n  let $path = normalizePath(parts.join(SLASH_MARK));\r\n\r\n  if ($path[0] !== SLASH_MARK) {\r\n    $path = join(SLASH_MARK, $path);\r\n  }\r\n\r\n  return $path;\r\n}\r\n\r\nfunction createPrefixedPath(pathMatch: PathMatchStrategy, prefix: string, path: string) {\r\n  const $prefix = pathMatch === 'prefix' ? normalizePath(prefix) + SLASH_MARK : '';\r\n\r\n  return trimSlashes(normalizePath($prefix ? `${$prefix}${path}` : path));\r\n}\r\n\r\nfunction getParamsMap(url: string, route: Route): Params {\r\n  const [a, b] = split(url, route.path);\r\n  const map = new Map();\r\n\r\n  for (let i = 0; i < b.length; i++) {\r\n    if (detectIsParam(b[i])) {\r\n      map.set(getParamName(b[i]), a[i]);\r\n    }\r\n  }\r\n\r\n  return map;\r\n}\r\n\r\ntype ResolveRouteValue = {\r\n  route: Route;\r\n  slot: DarkElement;\r\n  params: Params;\r\n};\r\n\r\nfunction resolveRoute(url: string, routes: Array<Route>) {\r\n  const route = resolve(url, routes);\r\n  const slot = route.render();\r\n  const params = getParamsMap(url, route);\r\n  const value: ResolveRouteValue = { route, slot, params };\r\n\r\n  return value;\r\n}\r\n\r\nconst createRootPath = (path: string) => (path === SLASH_MARK ? '' : path);\r\n\r\nconst split = (url: string, path: string) => [splitBySlash(url), splitBySlash(path)];\r\n\r\nconst merge = (url: string, route: Route, s: string, h: string) => join(mergePaths(url, route.getPath()), s, h);\r\n\r\nconst detectIsWildcard = (route: Route) => route.marker === WILDCARD_MARK;\r\n\r\nexport { type Route, createRoutes, resolve, resolveRoute, mergePaths, merge, detectIsWildcard };\r\n","import { detectIsFalsy } from '@dark-engine/core';\r\n\r\nimport { parseURL } from '../utils';\r\n\r\nclass RouterLocation {\r\n  url: string;\r\n  protocol: string;\r\n  host: string;\r\n  pathname: string;\r\n  hash: string;\r\n  search: string;\r\n  key: string;\r\n\r\n  constructor(url: string) {\r\n    if (detectIsFalsy(url)) throw new Error('[web-router]: RouterLocation must have an initial url!');\r\n    const { protocol, host, pathname, hash, search } = parseURL(url);\r\n\r\n    this.url = url;\r\n    this.protocol = protocol;\r\n    this.host = host;\r\n    this.pathname = pathname;\r\n    this.hash = hash;\r\n    this.search = search;\r\n    this.key = createKey(pathname);\r\n    Object.freeze(this);\r\n  }\r\n}\r\n\r\nfunction createKey(path: string): string {\r\n  return path\r\n    .split('')\r\n    .map(x => x.charCodeAt(0))\r\n    .reduce((acc, x) => ((acc += x), acc), 200000)\r\n    .toString(32);\r\n}\r\n\r\nconst createRouterLocation = (url: string) => new RouterLocation(url);\r\n\r\nexport { RouterLocation, createRouterLocation };\r\n","import { type SubscriberWithValue, detectIsFalsy, detectIsUndefined } from '@dark-engine/core';\r\n\r\nimport { normalizePath, parseURL, join } from '../utils';\r\n\r\nconst history = globalThis.history;\r\nclass RouterHistory {\r\n  private stack: Array<string> = [];\r\n  private cursor = -1;\r\n  private subscribers: Set<SubscriberWithValue<string>> = new Set();\r\n  private fromHistory = false;\r\n  dispose: () => void = null;\r\n\r\n  constructor(url: string) {\r\n    if (detectIsFalsy(url)) throw new Error('[web-router]: RouterHistory must have an initial url!');\r\n    const { pathname, search, hash } = parseURL(url);\r\n    const $url = join(pathname, search, hash);\r\n\r\n    this.stack.push($url);\r\n    this.cursor = this.stack.length - 1;\r\n\r\n    if (!detectIsUndefined(history)) {\r\n      const state = this.getState();\r\n\r\n      if (!state) {\r\n        history.replaceState(this.createStateBox(), '');\r\n      } else {\r\n        this.stack = state.stack;\r\n        this.cursor = state.cursor;\r\n      }\r\n\r\n      const handleEvent = () => {\r\n        const state = this.getState();\r\n\r\n        if (state) {\r\n          this.stack = state.stack;\r\n          this.cursor = state.cursor;\r\n        }\r\n\r\n        if (!this.fromHistory) {\r\n          this.mapSubscribers();\r\n        }\r\n\r\n        this.fromHistory = false;\r\n      };\r\n\r\n      window.addEventListener('popstate', handleEvent);\r\n\r\n      this.dispose = () => {\r\n        window.removeEventListener('popstate', handleEvent);\r\n        this.subscribers.clear();\r\n        this.stack = [];\r\n        this.cursor = -1;\r\n      };\r\n    }\r\n  }\r\n\r\n  private mapSubscribers() {\r\n    for (const subscriber of this.subscribers) {\r\n      subscriber(this.getValue());\r\n    }\r\n  }\r\n\r\n  private getValue = () => {\r\n    return normalizePath(this.stack[this.cursor]);\r\n  };\r\n\r\n  private getState(): State {\r\n    return (history.state && history.state[STATE_KEY]) || null;\r\n  }\r\n\r\n  private createStateBox(): StateBox {\r\n    const state = history.state || {};\r\n\r\n    return { ...state, [STATE_KEY]: { cursor: this.cursor, stack: this.stack } };\r\n  }\r\n\r\n  private syncHistory(action: HistoryAction, url: string) {\r\n    if (!history) return;\r\n    const box = this.createStateBox();\r\n    const $url = normalizePath(url);\r\n\r\n    switch (action) {\r\n      case HistoryAction.PUSH:\r\n        return history.pushState(box, '', $url);\r\n      case HistoryAction.REPLACE:\r\n        return history.replaceState(box, '', $url);\r\n    }\r\n  }\r\n\r\n  subscribe = (subscriber: SubscriberWithValue<string>) => {\r\n    this.subscribers.add(subscriber);\r\n\r\n    return () => this.subscribers.delete(subscriber);\r\n  };\r\n\r\n  push(url: string) {\r\n    this.stack.splice(this.cursor + 1, this.stack.length, url);\r\n    this.cursor = this.stack.length - 1;\r\n    this.syncHistory(HistoryAction.PUSH, url);\r\n    this.mapSubscribers();\r\n  }\r\n\r\n  replace(url: string) {\r\n    this.stack[this.stack.length - 1] = url;\r\n    this.syncHistory(HistoryAction.REPLACE, url);\r\n    this.mapSubscribers();\r\n  }\r\n\r\n  forward() {\r\n    this.go(1);\r\n  }\r\n\r\n  back() {\r\n    this.go(-1);\r\n  }\r\n\r\n  go(delta: number) {\r\n    const max = this.stack.length - 1;\r\n    let $delta = delta;\r\n\r\n    this.fromHistory = true;\r\n    this.cursor += delta;\r\n\r\n    if (this.cursor > max) {\r\n      this.cursor = max;\r\n      $delta = max;\r\n    } else if (this.cursor < 0) {\r\n      this.cursor = 0;\r\n      $delta = -max;\r\n    }\r\n\r\n    history?.go($delta);\r\n    this.mapSubscribers();\r\n  }\r\n}\r\n\r\nenum HistoryAction {\r\n  PUSH = 'PUSH',\r\n  REPLACE = 'REPLACE',\r\n}\r\n\r\ntype StateBox = {\r\n  [STATE_KEY]: State;\r\n};\r\n\r\ntype State = {\r\n  cursor: number;\r\n  stack: Array<string>;\r\n};\r\n\r\nconst STATE_KEY = 'web-router';\r\n\r\nconst createRouterHistory = (url: string) => new RouterHistory(url);\r\n\r\nexport { RouterHistory, createRouterHistory };\r\n","import {\r\n  type DarkElement,\r\n  type MutableRef,\r\n  component,\r\n  useMemo,\r\n  useLayoutEffect,\r\n  useState,\r\n  forwardRef,\r\n  useImperativeHandle,\r\n  nextTick,\r\n  detectIsString,\r\n} from '@dark-engine/core';\r\n\r\nimport { type Routes, createRoutes, resolveRoute, merge, detectIsWildcard } from '../create-routes';\r\nimport { type RouterLocation, createRouterLocation } from '../location';\r\nimport { SLASH_MARK, PROTOCOL_MARK } from '../constants';\r\nimport { normalizePath, join, parseURL } from '../utils';\r\nimport { createRouterHistory } from '../history';\r\nimport {\r\n  type RouterHistoryContextValue,\r\n  type ActiveRouteContextValue,\r\n  RouterHistoryContext,\r\n  ActiveRouteContext,\r\n  useActiveRouteContext,\r\n} from '../context';\r\n\r\nexport type RouterProps = {\r\n  routes: Routes;\r\n  url?: string; // for server-side rendering\r\n  baseURL?: string;\r\n  slot: (slot: DarkElement) => DarkElement;\r\n};\r\n\r\nexport type RouterRef = {\r\n  navigateTo: (url: string) => void;\r\n  location: RouterLocation;\r\n};\r\n\r\nconst Router = forwardRef<RouterProps, RouterRef>(\r\n  component(\r\n    ({ url: fullURL, baseURL = SLASH_MARK, routes: sourceRoutes, slot }, ref) => {\r\n      if (useActiveRouteContext()) throw new Error(`[web-router]: the parent active route's context detected!`);\r\n      const sourceURL = fullURL || window.location.href;\r\n      const [location, setLocation] = useState(() => createRouterLocation(sourceURL));\r\n      const history = useMemo(() => createRouterHistory(sourceURL), []);\r\n      const routes = useMemo(() => createRoutes(sourceRoutes, normalizePath(baseURL)), []);\r\n      const { protocol, host, pathname: url, search, hash } = location;\r\n      const { route, slot: $slot, params } = useMemo(() => resolveRoute(url, routes), [url]);\r\n      const scope = useMemo(() => ({ location }), []);\r\n      const historyContext = useMemo<RouterHistoryContextValue>(() => ({ history }), []);\r\n      const routerContext = useMemo<ActiveRouteContextValue>(() => ({ location, route, params }), [location]);\r\n\r\n      scope.location = location;\r\n\r\n      useLayoutEffect(() => {\r\n        if (!detectIsString(fullURL)) return;\r\n        if (sourceURL !== scope.location.url) {\r\n          setLocation(createRouterLocation(sourceURL));\r\n        }\r\n      }, [sourceURL]);\r\n\r\n      useLayoutEffect(() => {\r\n        const unsubscribe = history.subscribe(candidateURL => {\r\n          const { pathname: url1, search: search1, hash: hash1 } = scope.location;\r\n          const { pathname: url2, search: search2, hash: hash2 } = parseURL(candidateURL);\r\n          const { route: nextRoute } = resolveRoute(url2, routes);\r\n          const prevURL = join(url1, search1, hash1);\r\n          const nextURL = merge(url2, nextRoute, search2, hash2);\r\n          const isDifferent = candidateURL !== nextURL;\r\n\r\n          if (isDifferent || prevURL !== nextURL) {\r\n            const href = join(protocol, PROTOCOL_MARK, host, nextURL);\r\n            const location = createRouterLocation(href);\r\n\r\n            setLocation(location);\r\n            isDifferent && !detectIsWildcard(nextRoute) && history.replace(nextURL);\r\n          }\r\n        });\r\n\r\n        return () => {\r\n          unsubscribe();\r\n          history.dispose();\r\n        };\r\n      }, []);\r\n\r\n      // !\r\n      useLayoutEffect(() => {\r\n        if (detectIsWildcard(route)) return;\r\n        const prevURL = join(url, search, hash);\r\n        const nextURL = merge(url, route, search, hash);\r\n\r\n        if (prevURL !== nextURL) {\r\n          history.replace(nextURL);\r\n        }\r\n      }, []);\r\n\r\n      useImperativeHandle(ref as MutableRef<RouterRef>, () => ({\r\n        navigateTo: (url: string) => nextTick(() => history.push(url)),\r\n        location,\r\n      }));\r\n\r\n      return (\r\n        <RouterHistoryContext.Provider value={historyContext}>\r\n          <ActiveRouteContext.Provider value={routerContext}>{slot($slot)}</ActiveRouteContext.Provider>\r\n        </RouterHistoryContext.Provider>\r\n      );\r\n    },\r\n    { displayName: 'Router' },\r\n  ),\r\n);\r\n\r\nexport { Router };\r\n","import { useMemo } from '../use-memo';\r\nimport { type Ref, applyRef } from '../ref';\r\n\r\nfunction useImperativeHandle<T>(ref: Ref<T>, createHandle: () => T, deps?: Array<any>) {\r\n  const current = useMemo(() => createHandle(), deps || [{}]);\r\n\r\n  ref && applyRef(ref, current);\r\n}\r\n\r\nexport { useImperativeHandle };\r\n","export const VERSION = '1.2.0';\r\nexport const STYLE_TAG = 'style';\r\nexport const STYLED_ATTR = 'dark-styled';\r\nexport const GLOBAL_ATTR_VALUE = 'g';\r\nexport const COMPONENTS_ATTR_VALUE = 'c';\r\nexport const INTERLEAVE_GLOBAL_ATTR_VALUE = 'ig';\r\nexport const INTERLEAVE_COMPONENTS_ATTR_VALUE = 'ic';\r\nexport const CLASS_NAME_PREFIX = 'dk';\r\nexport const ANIMATION_NAME_PREFIX = 'dka';\r\nexport const OPENING_CURLY_BRACE_MARK = '{';\r\nexport const CLOSING_CURLY_BRACE_MARK = '}';\r\nexport const OPENING_PARENTHESIS_MARK = '(';\r\nexport const CLOSING_PARENTHESIS_MARK = ')';\r\nexport const COLON_MARK = ':';\r\nexport const SEMICOLON_MARK = ';';\r\nexport const DOT_MARK = '.';\r\nexport const BLANK_SPACE = ' ';\r\nexport const MEDIA_QUERY_MARK = '@media';\r\nexport const CONTAINER_QUERY_MARK = '@container';\r\nexport const KEYFRAMES_MARK = '@keyframes';\r\nexport const NESTING_MARK = '>';\r\nexport const SELF_MARK = '&';\r\nexport const FUNCTION_MARK = '[$]';\r\nexport const SINGLE_LINE_COMMENT_START_MARK = '//';\r\nexport const SINGLE_LINE_COMMENT_END_MARK = '\\n';\r\nexport const MULTI_LINE_COMMENT_START_MARK = '/*';\r\nexport const MULTI_LINE_COMMENT_END_MARK = '*/';\r\nexport const URL_FN_MARK = 'url';\r\n","import { STYLE_TAG, BLANK_SPACE } from '../constants';\r\n\r\nconst uniq = <T>(items: Array<T>, selector: (x: T) => unknown = x => x) => {\r\n  const arr: Array<T> = [];\r\n  const set = new Set();\r\n\r\n  for (const item of items) {\r\n    const key = selector(item);\r\n\r\n    !set.has(key) && arr.push(item);\r\n    set.add(key);\r\n  }\r\n\r\n  return arr;\r\n};\r\n\r\nconst mapProps = <T extends object>(props: T) => Object.keys(props).map(key => props[key]);\r\n\r\nconst mergeClassNames = (classNames: Array<string>) => uniq(classNames.filter(Boolean)).join(BLANK_SPACE);\r\n\r\nconst getElement = (selector: string) => document.querySelector(selector);\r\n\r\nconst getElements = (selector: string) => Array.from(document.querySelectorAll(selector));\r\n\r\nconst createStyleElement = () => document.createElement(STYLE_TAG);\r\n\r\nconst setAttr = (element: Element, attrName: string, attrValue: string) => element.setAttribute(attrName, attrValue);\r\n\r\nconst append = (parent: Element, element: Element) => parent.appendChild(element);\r\n\r\nconst insertBefore = (parent: Element, element: Element, sibling: Element) => parent.insertBefore(element, sibling);\r\n\r\nconst mergeTemplates = (t1: TemplateStringsArray, t2: TemplateStringsArray) => {\r\n  const [first] = t2;\r\n  const $t1 = [...t1];\r\n  const $t2: Array<string> = [];\r\n  let result: Omit<TemplateStringsArray, 'raw'> = null;\r\n\r\n  for (let i = 0; i < t2.length; i++) {\r\n    if (i > 0) {\r\n      $t2.push(t2[i]);\r\n    }\r\n  }\r\n\r\n  $t1[$t1.length - 1] = $t1[$t1.length - 1] + first;\r\n  result = [...$t1, ...$t2];\r\n\r\n  Object.assign(result, { raw: result });\r\n\r\n  return result as TemplateStringsArray;\r\n};\r\n\r\nconst detectIsBrowser = () => typeof globalThis.window !== 'undefined';\r\n\r\nexport {\r\n  uniq,\r\n  mapProps,\r\n  mergeClassNames,\r\n  getElement,\r\n  getElements,\r\n  createStyleElement,\r\n  setAttr,\r\n  append,\r\n  insertBefore,\r\n  mergeTemplates,\r\n  detectIsBrowser,\r\n};\r\n","import { type TextBased, detectIsTextBased } from '@dark-engine/core';\r\n\r\nimport { hash } from '../hash';\r\nimport { parse } from '../parse';\r\nimport {\r\n  KEYFRAMES_MARK,\r\n  FUNCTION_MARK,\r\n  OPENING_CURLY_BRACE_MARK,\r\n  CLOSING_CURLY_BRACE_MARK,\r\n  ANIMATION_NAME_PREFIX,\r\n} from '../constants';\r\nimport { type KeyframesRule } from '../tokens';\r\n\r\nclass Keyframes {\r\n  constructor(private name: string, private token: KeyframesRule) {}\r\n\r\n  getName() {\r\n    return this.name;\r\n  }\r\n\r\n  getToken() {\r\n    return this.token;\r\n  }\r\n}\r\n\r\nfunction keyframes(source: TemplateStringsArray, ...args: Array<TextBased>) {\r\n  const joined = join(pad(source), args);\r\n  const name = genAnimationName(joined);\r\n  const [token] = parse(joined.replace(FUNCTION_MARK, name)).children;\r\n  const keyframes = new Keyframes(name, token as KeyframesRule);\r\n\r\n  return keyframes;\r\n}\r\n\r\nfunction pad(source: TemplateStringsArray) {\r\n  const start = `${KEYFRAMES_MARK} ${FUNCTION_MARK} ${OPENING_CURLY_BRACE_MARK}`;\r\n  const end = CLOSING_CURLY_BRACE_MARK;\r\n  const strings: Array<string> = [];\r\n\r\n  for (let i = 0; i < source.length; i++) {\r\n    const isStart = i === 0;\r\n    const isEnd = i === source.length - 1;\r\n\r\n    if (isStart) {\r\n      strings.push(start + source[i]);\r\n    } else if (isEnd) {\r\n      strings.push(source[i] + end);\r\n    } else {\r\n      strings.push(source[i]);\r\n    }\r\n  }\r\n\r\n  return strings;\r\n}\r\n\r\nfunction join(source: Array<string>, args: Array<TextBased>) {\r\n  let joined = '';\r\n\r\n  for (let i = 0; i < source.length; i++) {\r\n    joined += source[i];\r\n\r\n    if (detectIsTextBased(args[i])) {\r\n      joined += args[i];\r\n    }\r\n  }\r\n\r\n  return joined;\r\n}\r\n\r\nconst genAnimationName = (key: string) => `${ANIMATION_NAME_PREFIX}-${hash(key)}`;\r\n\r\nconst detectIsKeyframes = (x: unknown): x is Keyframes => x instanceof Keyframes;\r\n\r\nexport { Keyframes, keyframes, detectIsKeyframes };\r\n","import {\r\n  OPENING_CURLY_BRACE_MARK,\r\n  CLOSING_CURLY_BRACE_MARK,\r\n  COLON_MARK,\r\n  SEMICOLON_MARK,\r\n  MEDIA_QUERY_MARK,\r\n  CONTAINER_QUERY_MARK,\r\n  KEYFRAMES_MARK,\r\n  NESTING_MARK,\r\n  SELF_MARK,\r\n  DOT_MARK,\r\n  FUNCTION_MARK,\r\n  BLANK_SPACE,\r\n} from '../constants';\r\n\r\nimport { detectIsKeyframes } from '../keyframes';\r\n\r\nabstract class Token {\r\n  name = '';\r\n  value = '';\r\n  parent: Parent;\r\n  isDynamic = false;\r\n\r\n  normalize() {\r\n    this.name = this.name.trim();\r\n    this.value = this.value.trim();\r\n  }\r\n\r\n  markAsDynamic() {\r\n    this.isDynamic = true;\r\n    detectIsToken(this.parent) && !this.parent.isDynamic && this.parent.markAsDynamic();\r\n  }\r\n\r\n  abstract generate(): string | Tuple;\r\n  abstract generate(props: object, args: Array<Function>): string | Tuple;\r\n  abstract generate(className: string | null, props: object, args: Array<Function>): string | Tuple;\r\n}\r\n\r\nclass StyleRule extends Token {\r\n  override generate(): string {\r\n    return `${this.name}${COLON_MARK}${this.value}${SEMICOLON_MARK}`;\r\n  }\r\n}\r\n\r\nclass NestingRule<P extends object = {}> extends Token {\r\n  name = NESTING_MARK;\r\n  children: Children = [];\r\n\r\n  override generate(...args: Array<unknown>): string {\r\n    const className = args[0] as string | null;\r\n    const props = args[1] as P;\r\n    const fns = args[2] as Array<Function>;\r\n    let styles = `${this.value.replaceAll(SELF_MARK, `${DOT_MARK}${className}`)}${OPENING_CURLY_BRACE_MARK}`;\r\n    let keyframes = '';\r\n\r\n    for (const token of this.children) {\r\n      const [$styles, _, __, ___, $keyframes] = generate({ token, className, props, fns });\r\n\r\n      styles += $styles;\r\n      keyframes += $keyframes;\r\n    }\r\n\r\n    styles += `${CLOSING_CURLY_BRACE_MARK}${keyframes}`;\r\n\r\n    return styles;\r\n  }\r\n}\r\n\r\nclass MediaQueryRule<P extends object = {}> extends Token {\r\n  name = MEDIA_QUERY_MARK;\r\n  children: Children = [];\r\n\r\n  override generate(...args: Array<unknown>): string {\r\n    const className = args[0] as string | null;\r\n    const props = args[1] as P;\r\n    const fns = args[2] as Array<Function>;\r\n    let styles = className\r\n      ? `${this.value}${OPENING_CURLY_BRACE_MARK}${DOT_MARK}${className}${OPENING_CURLY_BRACE_MARK}`\r\n      : `${this.value}${OPENING_CURLY_BRACE_MARK}`;\r\n    let nesting = '';\r\n\r\n    for (const token of this.children) {\r\n      const [$styles, $nesting] = generate({ token, className, props, fns });\r\n\r\n      styles += $styles;\r\n      nesting += $nesting;\r\n    }\r\n\r\n    if (className) {\r\n      styles += `${CLOSING_CURLY_BRACE_MARK}${nesting}${CLOSING_CURLY_BRACE_MARK}`;\r\n    } else {\r\n      styles += `${nesting}${CLOSING_CURLY_BRACE_MARK}`;\r\n    }\r\n\r\n    return styles;\r\n  }\r\n}\r\n\r\nclass ContainerQueryRule<P extends object = {}> extends Token {\r\n  name = CONTAINER_QUERY_MARK;\r\n  children: Children = [];\r\n\r\n  override generate(...args: Array<unknown>): string {\r\n    const className = args[0] as string | null;\r\n    const props = args[1] as P;\r\n    const fns = args[2] as Array<Function>;\r\n    let styles = className\r\n      ? `${this.value}${OPENING_CURLY_BRACE_MARK}${DOT_MARK}${className}${OPENING_CURLY_BRACE_MARK}`\r\n      : `${this.value}${OPENING_CURLY_BRACE_MARK}`;\r\n    let nesting = '';\r\n\r\n    for (const token of this.children) {\r\n      const [$styles, $nesting] = generate({ token, className, props, fns });\r\n\r\n      styles += $styles;\r\n      nesting += $nesting;\r\n    }\r\n\r\n    if (className) {\r\n      styles += `${CLOSING_CURLY_BRACE_MARK}${nesting}${CLOSING_CURLY_BRACE_MARK}`;\r\n    } else {\r\n      styles += `${nesting}${CLOSING_CURLY_BRACE_MARK}`;\r\n    }\r\n\r\n    return styles;\r\n  }\r\n}\r\n\r\nclass KeyframesRule<P extends object = {}> extends Token {\r\n  name = KEYFRAMES_MARK;\r\n  children: Children = [];\r\n\r\n  override generate(...args: Array<unknown>): string {\r\n    const props = args[0] as P;\r\n    const fns = args[1] as Array<Function>;\r\n    let keyframes = `${this.value}${OPENING_CURLY_BRACE_MARK}`;\r\n\r\n    for (const token of this.children) {\r\n      const [$styles, $nesting] = generate({ token, props, fns });\r\n\r\n      keyframes += $styles;\r\n      keyframes += $nesting;\r\n    }\r\n\r\n    keyframes += `${CLOSING_CURLY_BRACE_MARK}`;\r\n\r\n    return keyframes;\r\n  }\r\n}\r\n\r\nclass FunctionRule<P extends object = {}> extends Token {\r\n  name = FUNCTION_MARK;\r\n  args: Array<number> = [];\r\n  style: StyleRule = null;\r\n  private end = '';\r\n  private isSealed = false;\r\n\r\n  add(idx: number) {\r\n    this.args.push(idx);\r\n  }\r\n\r\n  seal(end: string) {\r\n    this.isSealed = true;\r\n    this.end = end;\r\n  }\r\n\r\n  getIsSealed() {\r\n    return this.isSealed;\r\n  }\r\n\r\n  getEnd() {\r\n    return this.end;\r\n  }\r\n\r\n  generate(...args: Array<unknown>): Tuple {\r\n    const className = args[0] as string | null;\r\n    const props = args[1] as P;\r\n    const fns = args[2] as Array<Function>;\r\n    const styleExp = this.style;\r\n    const [idx, ...rest] = this.args;\r\n    const value = fns[idx](props);\r\n    let styles = '';\r\n    let nesting = '';\r\n    let media = '';\r\n    let container = '';\r\n    let keyframes = '';\r\n\r\n    if (detectIsStyleSheet(value)) {\r\n      for (const token of value.children) {\r\n        const [$styles, $nesting, $media, $container, $keyframes] = generate({ token, className, props, fns });\r\n\r\n        styles += $styles;\r\n        nesting += $nesting;\r\n        media += $media;\r\n        container += $container;\r\n        keyframes += $keyframes;\r\n      }\r\n    } else if (styleExp) {\r\n      const end = rest.reduce((acc, x) => (acc += BLANK_SPACE + fns[x](props)), '') + this.end;\r\n\r\n      if (detectIsKeyframes(value)) {\r\n        styleExp.value = replace(this.name, value.getName()) + end;\r\n        styles += styleExp.generate();\r\n        keyframes += value.getToken().generate(props, fns);\r\n      } else {\r\n        styleExp.value = replace(this.name, value) + end;\r\n        styles += styleExp.generate();\r\n      }\r\n    }\r\n\r\n    return [styles, nesting, media, container, keyframes];\r\n  }\r\n}\r\n\r\ntype GenerateOptions<P extends object> = {\r\n  className?: string;\r\n  props?: P;\r\n  fns?: Array<Function>;\r\n};\r\n\r\nclass StyleSheet<P extends object = {}> {\r\n  children: Children = [];\r\n\r\n  generate(options: GenerateOptions<P> = {}) {\r\n    const { className = null, props, fns } = options;\r\n    let styles = className ? `${DOT_MARK}${className}${OPENING_CURLY_BRACE_MARK}` : '';\r\n    let nesting = '';\r\n    let media = '';\r\n    let container = '';\r\n    let keyframes = '';\r\n\r\n    for (const token of this.children) {\r\n      const [$styles, $nesting, $media, $container, $keyframes] = generate({ token, className, props, fns });\r\n\r\n      styles += $styles;\r\n      nesting += $nesting;\r\n      media += $media;\r\n      container += $container;\r\n      keyframes += $keyframes;\r\n    }\r\n\r\n    if (className) {\r\n      styles += `${CLOSING_CURLY_BRACE_MARK}${nesting}${media}${container}${keyframes}`;\r\n    } else {\r\n      styles += `${nesting}${media}${container}${keyframes}`;\r\n    }\r\n\r\n    return styles;\r\n  }\r\n}\r\n\r\ntype GenerateProps<P extends object> = {\r\n  token: Token;\r\n  className?: string | null;\r\n  props?: P;\r\n  fns?: Array<Function>;\r\n};\r\n\r\nfunction generate<P extends object = {}>(options: GenerateProps<P>): Tuple {\r\n  const { token, className = null, props, fns } = options;\r\n  let styles = '';\r\n  let nesting = '';\r\n  let media = '';\r\n  let container = '';\r\n  let keyframes = '';\r\n\r\n  if (detectIsStyleRule(token)) {\r\n    styles += token.generate();\r\n  } else if (detectIsNestingRule(token)) {\r\n    nesting += token.generate(className, props, fns);\r\n  } else if (detectIsMediaQueryRule(token)) {\r\n    media += token.generate(className, props, fns);\r\n  } else if (detectIsContainerQueryRule(token)) {\r\n    container += token.generate(className, props, fns);\r\n  } else if (detectIsKeyframesRule(token)) {\r\n    keyframes += token.generate(props, fns);\r\n  } else if (detectIsFunctionRule(token)) {\r\n    const [$styles, $nesting, $media, $container, $keyframes] = token.generate(className, props, fns);\r\n\r\n    styles += $styles;\r\n    nesting += $nesting;\r\n    media += $media;\r\n    container += $container;\r\n    keyframes += $keyframes;\r\n  }\r\n\r\n  return [styles, nesting, media, container, keyframes];\r\n}\r\n\r\ntype Tuple = [string, string, string, string, string];\r\n\r\nexport type Parent = StyleSheet | Token;\r\n\r\nexport type Children = Array<Token>;\r\n\r\nconst detectIsToken = (x: unknown): x is Token => x instanceof Token;\r\n\r\nconst detectIsStyleRule = (x: unknown): x is StyleRule => x instanceof StyleRule;\r\n\r\nconst detectIsMediaQueryRule = (x: unknown): x is MediaQueryRule => x instanceof MediaQueryRule;\r\n\r\nconst detectIsContainerQueryRule = (x: unknown): x is ContainerQueryRule => x instanceof ContainerQueryRule;\r\n\r\nconst detectIsKeyframesRule = (x: unknown): x is KeyframesRule => x instanceof KeyframesRule;\r\n\r\nconst detectIsNestingRule = (x: unknown): x is NestingRule => x instanceof NestingRule;\r\n\r\nconst detectIsFunctionRule = (x: unknown): x is FunctionRule => x instanceof FunctionRule;\r\n\r\nconst detectIsStyleSheet = (x: unknown): x is StyleSheet => x instanceof StyleSheet;\r\n\r\nconst replace = (target: string, x: string) => target.replace(FUNCTION_MARK, x);\r\n\r\nexport {\r\n  StyleSheet,\r\n  StyleRule,\r\n  MediaQueryRule,\r\n  ContainerQueryRule,\r\n  KeyframesRule,\r\n  NestingRule,\r\n  FunctionRule,\r\n  detectIsStyleSheet,\r\n  detectIsStyleRule,\r\n  detectIsMediaQueryRule,\r\n  detectIsContainerQueryRule,\r\n  detectIsKeyframesRule,\r\n  detectIsNestingRule,\r\n  detectIsFunctionRule,\r\n};\r\n","import { type DarkElement, createContext, useContext, component } from '@dark-engine/core';\r\n\r\nimport { type DefaultTheme } from '../';\r\n\r\n// // styled.d.ts\r\n// type Theme = {\r\n//   color1: string;\r\n//   color2: string;\r\n//   color3: string;\r\n// };\r\n// declare module '@dark-engine/styled' {\r\n//   export interface DefaultTheme extends Theme {}\r\n// }\r\n\r\nexport type ThemeProps = { theme: DefaultTheme };\r\n\r\nexport type ThemeContextValue = DefaultTheme;\r\n\r\nconst ThemeContext = createContext<ThemeContextValue>(null, { displayName: 'Theme' });\r\n\r\nconst useTheme = () => useContext(ThemeContext);\r\n\r\ntype ThemeProviderProps = {\r\n  theme: DefaultTheme;\r\n  slot: DarkElement;\r\n};\r\n\r\nconst ThemeProvider = component<ThemeProviderProps>(({ theme, slot }) => {\r\n  return ThemeContext.Provider({ value: theme, slot });\r\n});\r\n\r\nexport { ThemeProvider, useTheme };\r\n","import { type DarkElement, type Callback, createContext, useContext, component } from '@dark-engine/core';\r\n\r\nexport enum STYLE_LEVEL {\r\n  GLOBAL,\r\n  COMPONENT,\r\n}\r\n\r\nclass Manager {\r\n  private styles = createStyles();\r\n  private resets = new Set<Callback>();\r\n\r\n  collectGlobalStyle(css: string) {\r\n    this.styles[STYLE_LEVEL.GLOBAL].add(css);\r\n  }\r\n\r\n  collectComponentStyle(css: string) {\r\n    this.styles[STYLE_LEVEL.COMPONENT].add(css);\r\n  }\r\n\r\n  getStyles() {\r\n    return this.styles;\r\n  }\r\n\r\n  reset(fn: Callback) {\r\n    this.resets.add(fn);\r\n  }\r\n\r\n  seal() {\r\n    this.styles = createStyles();\r\n    this.resets.forEach(x => x());\r\n    this.resets = new Set();\r\n  }\r\n}\r\n\r\nconst createStyles = () => ({\r\n  [STYLE_LEVEL.GLOBAL]: new Set<string>(),\r\n  [STYLE_LEVEL.COMPONENT]: new Set<string>(),\r\n});\r\n\r\nconst ManagerContext = createContext<Manager>(null, { displayName: 'Manager' });\r\n\r\nfunction useManager() {\r\n  return useContext(ManagerContext);\r\n}\r\n\r\ntype ThemeProviderProps = {\r\n  manager: Manager;\r\n  slot: DarkElement;\r\n};\r\n\r\nconst ManagerProvider = component<ThemeProviderProps>(({ manager, slot }) => {\r\n  return ManagerContext.Provider({ value: manager, slot });\r\n});\r\n\r\nexport { Manager, useManager, ManagerProvider };\r\n","import {\r\n  OPENING_CURLY_BRACE_MARK,\r\n  CLOSING_CURLY_BRACE_MARK,\r\n  COLON_MARK,\r\n  SEMICOLON_MARK,\r\n  MEDIA_QUERY_MARK,\r\n  CONTAINER_QUERY_MARK,\r\n  KEYFRAMES_MARK,\r\n  FUNCTION_MARK,\r\n  SINGLE_LINE_COMMENT_START_MARK,\r\n  SINGLE_LINE_COMMENT_END_MARK,\r\n  MULTI_LINE_COMMENT_START_MARK,\r\n  MULTI_LINE_COMMENT_END_MARK,\r\n  OPENING_PARENTHESIS_MARK,\r\n  CLOSING_PARENTHESIS_MARK,\r\n  URL_FN_MARK,\r\n} from '../constants';\r\nimport {\r\n  type Children,\r\n  StyleSheet,\r\n  StyleRule,\r\n  MediaQueryRule,\r\n  ContainerQueryRule,\r\n  KeyframesRule,\r\n  NestingRule,\r\n  FunctionRule,\r\n  detectIsStyleSheet,\r\n  detectIsStyleRule,\r\n  detectIsMediaQueryRule,\r\n  detectIsContainerQueryRule,\r\n  detectIsKeyframesRule,\r\n  detectIsNestingRule,\r\n  detectIsFunctionRule,\r\n} from '../tokens';\r\n\r\nfunction parse<P extends object>(css: string) {\r\n  const stylesheet = new StyleSheet<P>();\r\n  const stack: Array<NestingRule | MediaQueryRule> = [];\r\n  let buffer = '';\r\n  let end = '';\r\n  let fnIdx = -1;\r\n  let isSingleLineComment = false;\r\n  let isMultiLineComment = false;\r\n  let isPropValue = false;\r\n  let isUrl = false;\r\n\r\n  for (let i = 0; i < css.length; i++) {\r\n    const char = css[i];\r\n    const parent = stack[stack.length - 1] || stylesheet;\r\n    const last = parent.children[parent.children.length - 1];\r\n\r\n    buffer += char;\r\n\r\n    if (!isSingleLineComment && detectHasSingleLineCommentStartMark(buffer)) {\r\n      isSingleLineComment = !isUrl;\r\n    } else if (isSingleLineComment && detectHasSingleLineCommentEndMark(buffer)) {\r\n      isSingleLineComment = false;\r\n      buffer = '';\r\n    }\r\n\r\n    if (!isMultiLineComment && detectHasMultiLineCommentStartMark(buffer)) {\r\n      isMultiLineComment = true;\r\n      end = detectIsStyleRule(last) ? createEnd(buffer) : '';\r\n    } else if (isMultiLineComment && detectHasMultiLineCommentEndMark(buffer)) {\r\n      isMultiLineComment = false;\r\n      buffer = '';\r\n    }\r\n\r\n    if (isSingleLineComment || isMultiLineComment) continue;\r\n\r\n    if (detectHasFunctionMark(buffer)) {\r\n      const token = new FunctionRule();\r\n\r\n      if (detectIsFunctionRule(last) && !last.getIsSealed() && last.style) {\r\n        last.add(++fnIdx);\r\n        buffer = '';\r\n        continue;\r\n      }\r\n\r\n      token.add(++fnIdx);\r\n      token.parent = parent;\r\n      token.markAsDynamic();\r\n\r\n      if (detectIsStyleRule(last) && !last.value) {\r\n        token.style = last;\r\n        token.name = buffer.trim();\r\n        last.normalize();\r\n        last.isDynamic = true;\r\n        parent.children[parent.children.length - 1] = token;\r\n      } else {\r\n        parent.children.push(token);\r\n      }\r\n\r\n      buffer = '';\r\n      continue;\r\n    }\r\n\r\n    switch (char) {\r\n      case OPENING_CURLY_BRACE_MARK:\r\n        {\r\n          const token = detectHasMediaQueryMark(buffer)\r\n            ? new MediaQueryRule()\r\n            : detectHasContainerQueryMark(buffer)\r\n            ? new ContainerQueryRule()\r\n            : detectHasKeyframesMark(buffer)\r\n            ? new KeyframesRule()\r\n            : new NestingRule();\r\n          const canNest =\r\n            detectIsMediaQueryRule(token) || detectIsContainerQueryRule(token) || detectIsKeyframesRule(token)\r\n              ? detectIsStyleSheet(parent)\r\n              : detectIsNestingRule(token)\r\n              ? detectIsStyleSheet(parent) ||\r\n                detectIsMediaQueryRule(parent) ||\r\n                detectIsContainerQueryRule(parent) ||\r\n                detectIsKeyframesRule(parent)\r\n              : false;\r\n\r\n          if (!canNest) {\r\n            throw new Error('Illegal style nesting!');\r\n          }\r\n\r\n          token.value = sub(buffer);\r\n          token.normalize();\r\n          token.parent = parent;\r\n\r\n          if (!token.value) {\r\n            throw new Error('Empty style nesting!');\r\n          }\r\n\r\n          parent.children.push(token);\r\n          stack.push(token);\r\n          buffer = '';\r\n        }\r\n        break;\r\n      case CLOSING_CURLY_BRACE_MARK:\r\n        stack.pop();\r\n        buffer = '';\r\n        break;\r\n      case COLON_MARK:\r\n        {\r\n          if (!detectIsPropName(buffer, i, css, parent.children)) continue;\r\n          const token = new StyleRule();\r\n\r\n          token.name = sub(buffer);\r\n          token.parent = parent;\r\n          parent.children.push(token);\r\n        }\r\n        buffer = '';\r\n        isPropValue = true;\r\n        break;\r\n      case SEMICOLON_MARK:\r\n        if (!last) {\r\n          throw new Error('Incorrect style!');\r\n        }\r\n\r\n        if (detectIsFunctionRule(last)) {\r\n          last.seal(sub(buffer));\r\n          buffer = '';\r\n          continue;\r\n        }\r\n\r\n        last.value = end || sub(buffer);\r\n        last.normalize();\r\n\r\n        buffer = '';\r\n        end = '';\r\n        isPropValue = false;\r\n        break;\r\n      case OPENING_PARENTHESIS_MARK:\r\n        if (isPropValue && detectHasUrlFnMark(buffer)) {\r\n          isUrl = true;\r\n        }\r\n        break;\r\n      case CLOSING_PARENTHESIS_MARK:\r\n        isUrl = false;\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n\r\n  return stylesheet;\r\n}\r\n\r\nfunction detectIsPropName(name: string, idx: number, css: string, children: Children) {\r\n  const last = children[children.length - 1];\r\n  if (detectHasMediaQueryMark(name) || detectHasContainerQueryMark(name)) return false;\r\n  if (detectIsStyleRule(last) && !last.value) return false;\r\n\r\n  for (let i = idx; i < css.length; i++) {\r\n    const char = css[i];\r\n\r\n    if (char === OPENING_CURLY_BRACE_MARK) return false;\r\n    if (char === SEMICOLON_MARK) return true;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nconst detectHasSingleLineCommentStartMark = (x: string) => x.endsWith(SINGLE_LINE_COMMENT_START_MARK);\r\n\r\nconst detectHasSingleLineCommentEndMark = (x: string) => x.endsWith(SINGLE_LINE_COMMENT_END_MARK);\r\n\r\nconst detectHasMultiLineCommentStartMark = (x: string) => x.endsWith(MULTI_LINE_COMMENT_START_MARK);\r\n\r\nconst detectHasMultiLineCommentEndMark = (x: string) => x.endsWith(MULTI_LINE_COMMENT_END_MARK);\r\n\r\nconst detectHasFunctionMark = (x: string) => x.endsWith(FUNCTION_MARK);\r\n\r\nconst detectHasUrlFnMark = (x: string) => x.endsWith(URL_FN_MARK + OPENING_PARENTHESIS_MARK);\r\n\r\nconst detectHasMediaQueryMark = (x: string) => x.trim().startsWith(MEDIA_QUERY_MARK);\r\n\r\nconst detectHasContainerQueryMark = (x: string) => x.trim().startsWith(CONTAINER_QUERY_MARK);\r\n\r\nconst detectHasKeyframesMark = (x: string) => x.trim().startsWith(KEYFRAMES_MARK);\r\n\r\nconst sub = (x: string) => x.substring(0, x.length - 1);\r\n\r\nconst createEnd = (x: string) => x.replace(MULTI_LINE_COMMENT_START_MARK, '').trim();\r\n\r\nexport { parse };\r\n","const SEED = 5381;\r\nconst SIZE = 6;\r\nconst map = { 0: 'a', 1: 'b', 2: 'c', 3: 'd', 4: 'e', 5: 'f', 6: 'g', 7: 'h', 8: 'i', 9: 'j' };\r\n\r\nfunction phash(h: number, x: string) {\r\n  let i = x.length;\r\n\r\n  while (i) {\r\n    h = (h * 33) ^ x.charCodeAt(--i);\r\n  }\r\n\r\n  return h;\r\n}\r\n\r\nfunction hash(x: string) {\r\n  const source = phash(SEED, x);\r\n  const hash = String(Math.abs(source))\r\n    .slice(0, SIZE)\r\n    .split('')\r\n    .map(x => map[x])\r\n    .join('');\r\n\r\n  return hash;\r\n}\r\n\r\nexport { hash };\r\n","import {\r\n  type ComponentFactory,\r\n  type TagVirtualNodeFactory,\r\n  type StandardComponentProps,\r\n  type TextBased,\r\n  type DarkElement,\r\n  View,\r\n  component,\r\n  forwardRef,\r\n  useMemo,\r\n  detectIsString,\r\n  detectIsFunction,\r\n  detectIsTextBased,\r\n  detectIsServer,\r\n  useInsertionEffect,\r\n  mapRecord,\r\n} from '@dark-engine/core';\r\nimport { type DarkJSX } from '@dark-engine/platform-browser';\r\n\r\nimport {\r\n  CLASS_NAME_PREFIX,\r\n  FUNCTION_MARK,\r\n  DOT_MARK,\r\n  STYLED_ATTR,\r\n  COMPONENTS_ATTR_VALUE,\r\n  INTERLEAVE_COMPONENTS_ATTR_VALUE,\r\n  BLANK_SPACE,\r\n} from '../constants';\r\nimport {\r\n  detectIsBrowser,\r\n  mergeClassNames,\r\n  getElement,\r\n  getElements,\r\n  createStyleElement,\r\n  setAttr,\r\n  append,\r\n  mergeTemplates,\r\n} from '../utils';\r\nimport { type KeyframesRule, StyleSheet, detectIsStyleSheet, detectIsKeyframesRule } from '../tokens';\r\nimport { type Keyframes, detectIsKeyframes } from '../keyframes';\r\nimport { type ThemeProps, useTheme } from '../theme';\r\nimport { useManager } from '../server/manager';\r\nimport { parse } from '../parse';\r\nimport { hash } from '../hash';\r\n\r\nlet cache: Map<string, [string, string]> = null;\r\nlet injections: Set<string> = null;\r\nlet tag: HTMLStyleElement = null;\r\nlet isLoaded = false;\r\nconst $$styled = Symbol('styled');\r\n\r\nsetupGlobal();\r\nfunction styled<P extends object, T extends object = {}>(tagName: string | ComponentFactory<P>) {\r\n  const factory = detectIsString(tagName) ? (props: P) => View({ as: tagName, ...props }) : tagName;\r\n\r\n  if (!isLoaded && detectIsBrowser()) {\r\n    reuse(getInterleavedElements(), createTag);\r\n    isLoaded = true;\r\n  }\r\n\r\n  return createStyledComponent<P & T>(factory as Factory<P & T>);\r\n}\r\n\r\nfunction createStyledComponent<P extends StyledProps>(factory: Factory<P>) {\r\n  let transform: TransformFn<P> = x => x;\r\n  const isExtending = detectIsStyled(factory);\r\n  const config = isExtending ? getExtendingConfig(factory as StyledComponentFactory<P>) : null;\r\n  const fn = <T extends P>(source: TemplateStringsArray, ...args: Args<T & ThemeProps>) => {\r\n    const $source = isExtending ? mergeTemplates(config.source, source) : source;\r\n    const $args = isExtending ? [...config.args, ...args] : args;\r\n    const $transform = isExtending ? (p: T) => transform(config.transform(p)) : transform;\r\n    const fns = filterArgs<T>($args);\r\n    const [sheet, sheets] = slice<T>(css($source, ...$args));\r\n    const [baseName, baseStyle, baseKeyframes] = generate({ sheet, cache });\r\n    const styled = forwardRef<T, unknown>(\r\n      component((props, ref) => {\r\n        const { as: component, ...rest } = props;\r\n        const theme = useTheme();\r\n        const isSwap = detectIsFunction(component);\r\n        const $props = (isSwap ? rest : props) as unknown as T;\r\n        const $factory = isSwap ? component : isExtending ? config.factory : factory;\r\n        const [className, styles, keyframes] = useMemo(() => {\r\n          const [names, styles, keyframes] = sheets.reduce(\r\n            (acc, sheet) => {\r\n              const [className, style, keyframes] = generate({ sheet, cache, props: { ...props, theme }, fns });\r\n              const [names, styles, keyframesList] = acc;\r\n\r\n              names.push(className);\r\n              styles.push(style);\r\n              keyframesList.push(keyframes);\r\n\r\n              return acc;\r\n            },\r\n            [[], [baseStyle], [baseKeyframes]] as [Array<string>, Array<string>, Array<string>],\r\n          );\r\n          const className = mergeClassNames([...getClassNamesFrom(props), baseName, ...names]);\r\n\r\n          return [className, filter(styles, injections), filter(keyframes, injections)] as [\r\n            string,\r\n            Array<string>,\r\n            Array<string>,\r\n          ];\r\n        }, [...mapRecord(props), theme]);\r\n\r\n        useInsertionEffect(() => {\r\n          if (!tag) {\r\n            const $tag = getTag();\r\n\r\n            if ($tag) {\r\n              tag = $tag; // after hydration\r\n              return;\r\n            } else {\r\n              tag = createTag();\r\n            }\r\n          }\r\n\r\n          styles.forEach(css => inject(css, tag));\r\n          keyframes.forEach(css => inject(css, tag));\r\n        }, [...styles, ...keyframes]);\r\n\r\n        if (detectIsServer()) {\r\n          const manager = useManager(); // special case of hook using, should be last in order\r\n\r\n          styles.forEach(css => manager.collectComponentStyle(css));\r\n          keyframes.forEach(css => manager.collectComponentStyle(css));\r\n          manager.reset(setupGlobal);\r\n        }\r\n\r\n        if (detectIsFunction($props.slot)) {\r\n          $props.slot = $props.slot((x: string) => `${className}_${x}`);\r\n        }\r\n\r\n        return $factory({ ...$transform($props), ref, className });\r\n      }),\r\n    ) as StyledComponentFactory<T>;\r\n\r\n    styled[$$styled] = {\r\n      className: baseName,\r\n      source: $source,\r\n      args: $args,\r\n      factory: (config?.factory || factory) as Factory<T>,\r\n      transform: config ? p => transform(config.transform(p)) : transform,\r\n    };\r\n\r\n    return styled;\r\n  };\r\n\r\n  fn.attrs = (t: TransformFn<P>) => {\r\n    transform = detectIsFunction(t) ? t : transform;\r\n\r\n    return fn;\r\n  };\r\n\r\n  return fn;\r\n}\r\n\r\nfunction filter(styles: Array<string>, injections: Set<string>) {\r\n  const $styles: Array<string> = [];\r\n\r\n  for (const style of styles) {\r\n    if (style && !injections.has(style)) {\r\n      $styles.push(style);\r\n      injections.add(style);\r\n    }\r\n  }\r\n\r\n  return $styles;\r\n}\r\n\r\nfunction setupGlobal() {\r\n  cache = new Map();\r\n  injections = new Set();\r\n  tag = null;\r\n  isLoaded = false;\r\n}\r\n\r\nfunction getExtendingConfig<P extends object>(factory: StyledComponentFactory<P>) {\r\n  const { className, ...rest } = factory[$$styled];\r\n  const config: ExtendingConfig<P> = rest;\r\n\r\n  return config;\r\n}\r\n\r\ntype GenerateOptions<P extends object> = {\r\n  sheet: StyleSheet<P>;\r\n  cache: Map<string, [string, string]>;\r\n  props?: P;\r\n  fns?: Array<Function>;\r\n};\r\n\r\nfunction generate<P extends object>(options: GenerateOptions<P>): [string, string, string] {\r\n  const { sheet: $sheet, cache, props, fns } = options;\r\n  const [sheet, rules] = split($sheet);\r\n  const key = sheet.generate({ className: FUNCTION_MARK, props, fns });\r\n  const item = cache.get(key);\r\n  const className = item ? item[0] : genClassName(key);\r\n  const css = item ? item[1] : key.replaceAll(FUNCTION_MARK, className);\r\n  let style = '';\r\n  let keyframes = '';\r\n\r\n  style += css;\r\n  cache.set(key, [className, css]);\r\n\r\n  for (const rule of rules) {\r\n    keyframes += rule.generate();\r\n  }\r\n\r\n  return [className, style, keyframes];\r\n}\r\n\r\nfunction split<P extends object>(source: StyleSheet<P>): [StyleSheet<P>, Array<KeyframesRule<P>>] {\r\n  const sheet = new StyleSheet<P>();\r\n  const rules: Array<KeyframesRule<P>> = [];\r\n\r\n  for (const token of source.children) {\r\n    if (detectIsKeyframesRule(token)) {\r\n      rules.push(token);\r\n    } else {\r\n      sheet.children.push(token);\r\n    }\r\n  }\r\n\r\n  return [sheet, rules];\r\n}\r\n\r\nfunction slice<P extends object>(source: StyleSheet<P>): [StyleSheet<P>, Array<StyleSheet<P>>] {\r\n  const sheet = new StyleSheet<P>();\r\n  const sheets: Array<StyleSheet> = [];\r\n\r\n  for (const token of source.children) {\r\n    if (token.isDynamic) {\r\n      const style = new StyleSheet<P>();\r\n\r\n      style.children.push(token);\r\n      sheets.push(style);\r\n    } else {\r\n      sheet.children.push(token);\r\n    }\r\n  }\r\n\r\n  return [sheet, sheets];\r\n}\r\n\r\nfunction join<P>(strings: TemplateStringsArray, args: Args<P>) {\r\n  let joined = '';\r\n  let keyframes = '';\r\n\r\n  for (let i = 0; i < strings.length; i++) {\r\n    const arg = args[i];\r\n\r\n    joined += strings[i];\r\n\r\n    if (detectIsStyled(arg)) {\r\n      joined += `${DOT_MARK}${arg[$$styled].className}`;\r\n    } else if (detectIsStyleSheet(arg)) {\r\n      joined += arg.generate();\r\n    } else if (detectIsKeyframes(arg)) {\r\n      joined += arg.getName();\r\n      keyframes += arg.getToken().generate();\r\n    } else if (detectIsFunction(arg)) {\r\n      joined += FUNCTION_MARK;\r\n    } else if (detectIsTextBased(arg)) {\r\n      joined += arg;\r\n    }\r\n  }\r\n\r\n  joined += keyframes;\r\n\r\n  return joined;\r\n}\r\n\r\nfunction createTag() {\r\n  const tag = createStyleElement();\r\n\r\n  setAttr(tag, STYLED_ATTR, COMPONENTS_ATTR_VALUE);\r\n  append(document.head, tag);\r\n\r\n  return tag;\r\n}\r\n\r\nfunction inject(css: string, tag: HTMLStyleElement) {\r\n  tag.textContent = `${tag.textContent}${css}`;\r\n}\r\n\r\nfunction reuse(elements: Array<HTMLStyleElement>, createTag: () => HTMLStyleElement, isComponentStyle = true) {\r\n  if (elements.length === 0) return;\r\n  const tag = createTag();\r\n  let content = '';\r\n\r\n  for (const element of elements) {\r\n    const style = element.textContent;\r\n\r\n    isComponentStyle && filter([style], injections);\r\n    content += style;\r\n    element.remove();\r\n  }\r\n\r\n  tag.textContent = content;\r\n}\r\n\r\nfunction getInterleavedElements() {\r\n  return getElements(`[${STYLED_ATTR}=\"${INTERLEAVE_COMPONENTS_ATTR_VALUE}\"]`) as Array<HTMLStyleElement>;\r\n}\r\n\r\nconst getTag = () => getElement(`[${STYLED_ATTR}=\"${COMPONENTS_ATTR_VALUE}\"]`) as HTMLStyleElement;\r\n\r\nconst css = <P extends object>(strings: TemplateStringsArray, ...args: Args<P>) => parse<P>(join(strings, args));\r\n\r\nconst getClassNamesFrom = (props: StyledProps) => (props.class || props.className || '').split(BLANK_SPACE);\r\n\r\nconst genClassName = (key: string) => `${CLASS_NAME_PREFIX}-${hash(key)}`;\r\n\r\nconst detectIsStyled = (x: unknown): x is StyledComponentFactory => detectIsFunction(x) && Boolean(x[$$styled]);\r\n\r\nconst filterArgs = <P>(args: Args<unknown>) =>\r\n  args.filter(x => detectIsFunction(x) && !detectIsStyled(x)) as DynamicArgs<P>;\r\n\r\ntype Factory<P extends object> = ComponentFactory<P> | ((props: P) => TagVirtualNodeFactory);\r\n\r\ntype ClassNameFn = (className: string) => string;\r\n\r\ntype StyledProps = {\r\n  as?: string | ComponentFactory;\r\n  class?: string;\r\n  className?: string;\r\n  style?: string | Record<string, string>;\r\n  slot?: ((fn: ClassNameFn) => DarkElement) | DarkElement;\r\n};\r\n\r\ntype ExtendingConfig<P extends object = {}> = {\r\n  source: TemplateStringsArray;\r\n  args: Args<P>;\r\n  factory: Factory<P>;\r\n  transform: (x: P) => P;\r\n};\r\n\r\ntype TransformFn<P> = (p: P) => any;\r\n\r\ntype DynamicArgs<P> = Array<ArgFn<P>>;\r\n\r\ntype ArgFn<P> = Function | ((p: P) => TextBased | false);\r\n\r\nexport type Args<P> = Array<TextBased | ArgFn<P> | StyleSheet | Keyframes>;\r\n\r\nexport type StyledComponentFactory<P extends object = {}> = {\r\n  [$$styled]: {\r\n    className: string;\r\n  } & ExtendingConfig<P>;\r\n} & ComponentFactory<P & StandardComponentProps & StyledProps>;\r\n\r\ntype FactoryFn<P extends object> = {\r\n  <T extends P>(source: TemplateStringsArray, ...args: Args<T & ThemeProps>): StyledComponentFactory<T>;\r\n  attrs: (t: TransformFn<P>) => FactoryFn<P>;\r\n};\r\n\r\nstyled.a = styled('a') as FactoryFn<DarkJSX.Elements['a']>;\r\nstyled.abbr = styled('abbr') as FactoryFn<DarkJSX.Elements['abbr']>;\r\nstyled.address = styled('address') as FactoryFn<DarkJSX.Elements['address']>;\r\nstyled.area = styled('area') as FactoryFn<DarkJSX.Elements['area']>;\r\nstyled.article = styled('article') as FactoryFn<DarkJSX.Elements['article']>;\r\nstyled.aside = styled('aside') as FactoryFn<DarkJSX.Elements['aside']>;\r\nstyled.audio = styled('audio') as FactoryFn<DarkJSX.Elements['audio']>;\r\nstyled.b = styled('b') as FactoryFn<DarkJSX.Elements['b']>;\r\nstyled.base = styled('base') as FactoryFn<DarkJSX.Elements['base']>;\r\nstyled.bdi = styled('bdi') as FactoryFn<DarkJSX.Elements['bdi']>;\r\nstyled.bdo = styled('bdo') as FactoryFn<DarkJSX.Elements['bdo']>;\r\nstyled.blockquote = styled('blockquote') as FactoryFn<DarkJSX.Elements['blockquote']>;\r\nstyled.body = styled('body') as FactoryFn<DarkJSX.Elements['body']>;\r\nstyled.br = styled('br') as FactoryFn<DarkJSX.Elements['br']>;\r\nstyled.button = styled('button') as FactoryFn<DarkJSX.Elements['button']>;\r\nstyled.canvas = styled('canvas') as FactoryFn<DarkJSX.Elements['canvas']>;\r\nstyled.caption = styled('caption') as FactoryFn<DarkJSX.Elements['caption']>;\r\nstyled.cite = styled('cite') as FactoryFn<DarkJSX.Elements['cite']>;\r\nstyled.code = styled('code') as FactoryFn<DarkJSX.Elements['code']>;\r\nstyled.col = styled('col') as FactoryFn<DarkJSX.Elements['col']>;\r\nstyled.colgroup = styled('colgroup') as FactoryFn<DarkJSX.Elements['colgroup']>;\r\nstyled.data = styled('data') as FactoryFn<DarkJSX.Elements['data']>;\r\nstyled.datalist = styled('datalist') as FactoryFn<DarkJSX.Elements['datalist']>;\r\nstyled.dd = styled('dd') as FactoryFn<DarkJSX.Elements['dd']>;\r\nstyled.del = styled('del') as FactoryFn<DarkJSX.Elements['del']>;\r\nstyled.details = styled('details') as FactoryFn<DarkJSX.Elements['details']>;\r\nstyled.dfn = styled('dfn') as FactoryFn<DarkJSX.Elements['dfn']>;\r\nstyled.dialog = styled('dialog') as FactoryFn<DarkJSX.Elements['dialog']>;\r\nstyled.div = styled('div') as FactoryFn<DarkJSX.Elements['div']>;\r\nstyled.dl = styled('dl') as FactoryFn<DarkJSX.Elements['dl']>;\r\nstyled.dt = styled('dt') as FactoryFn<DarkJSX.Elements['dt']>;\r\nstyled.em = styled('em') as FactoryFn<DarkJSX.Elements['em']>;\r\nstyled.embed = styled('embed') as FactoryFn<DarkJSX.Elements['embed']>;\r\nstyled.fieldset = styled('fieldset') as FactoryFn<DarkJSX.Elements['fieldset']>;\r\nstyled.figcaption = styled('figcaption') as FactoryFn<DarkJSX.Elements['figcaption']>;\r\nstyled.figure = styled('figure') as FactoryFn<DarkJSX.Elements['figure']>;\r\nstyled.footer = styled('footer') as FactoryFn<DarkJSX.Elements['footer']>;\r\nstyled.form = styled('form') as FactoryFn<DarkJSX.Elements['form']>;\r\nstyled.h1 = styled('h1') as FactoryFn<DarkJSX.Elements['h1']>;\r\nstyled.h2 = styled('h2') as FactoryFn<DarkJSX.Elements['h2']>;\r\nstyled.h3 = styled('h3') as FactoryFn<DarkJSX.Elements['h3']>;\r\nstyled.h4 = styled('h4') as FactoryFn<DarkJSX.Elements['h4']>;\r\nstyled.h5 = styled('h5') as FactoryFn<DarkJSX.Elements['h5']>;\r\nstyled.h6 = styled('h6') as FactoryFn<DarkJSX.Elements['h6']>;\r\nstyled.head = styled('head') as FactoryFn<DarkJSX.Elements['head']>;\r\nstyled.header = styled('header') as FactoryFn<DarkJSX.Elements['header']>;\r\nstyled.hgroup = styled('hgroup') as FactoryFn<DarkJSX.Elements['hgroup']>;\r\nstyled.hr = styled('hr') as FactoryFn<DarkJSX.Elements['hr']>;\r\nstyled.html = styled('html') as FactoryFn<DarkJSX.Elements['html']>;\r\nstyled.i = styled('i') as FactoryFn<DarkJSX.Elements['i']>;\r\nstyled.iframe = styled('iframe') as FactoryFn<DarkJSX.Elements['iframe']>;\r\nstyled.img = styled('img') as FactoryFn<DarkJSX.Elements['img']>;\r\nstyled.input = styled('input') as FactoryFn<DarkJSX.Elements['input']>;\r\nstyled.ins = styled('ins') as FactoryFn<DarkJSX.Elements['ins']>;\r\nstyled.kbd = styled('kbd') as FactoryFn<DarkJSX.Elements['kbd']>;\r\nstyled.label = styled('label') as FactoryFn<DarkJSX.Elements['label']>;\r\nstyled.legend = styled('legend') as FactoryFn<DarkJSX.Elements['legend']>;\r\nstyled.li = styled('li') as FactoryFn<DarkJSX.Elements['li']>;\r\nstyled.link = styled('link') as FactoryFn<DarkJSX.Elements['link']>;\r\nstyled.main = styled('main') as FactoryFn<DarkJSX.Elements['main']>;\r\nstyled.map = styled('map') as FactoryFn<DarkJSX.Elements['map']>;\r\nstyled.mark = styled('mark') as FactoryFn<DarkJSX.Elements['mark']>;\r\nstyled.menu = styled('menu') as FactoryFn<DarkJSX.Elements['menu']>;\r\nstyled.meta = styled('meta') as FactoryFn<DarkJSX.Elements['meta']>;\r\nstyled.meter = styled('meter') as FactoryFn<DarkJSX.Elements['meter']>;\r\nstyled.nav = styled('nav') as FactoryFn<DarkJSX.Elements['nav']>;\r\nstyled.noscript = styled('noscript') as FactoryFn<DarkJSX.Elements['noscript']>;\r\nstyled.object = styled('object') as FactoryFn<DarkJSX.Elements['object']>;\r\nstyled.ol = styled('ol') as FactoryFn<DarkJSX.Elements['ol']>;\r\nstyled.optgroup = styled('optgroup') as FactoryFn<DarkJSX.Elements['optgroup']>;\r\nstyled.option = styled('option') as FactoryFn<DarkJSX.Elements['option']>;\r\nstyled.output = styled('output') as FactoryFn<DarkJSX.Elements['output']>;\r\nstyled.p = styled('p') as FactoryFn<DarkJSX.Elements['p']>;\r\nstyled.param = styled('param') as FactoryFn<DarkJSX.Elements['param']>;\r\nstyled.picture = styled('picture') as FactoryFn<DarkJSX.Elements['picture']>;\r\nstyled.pre = styled('pre') as FactoryFn<DarkJSX.Elements['pre']>;\r\nstyled.progress = styled('progress') as FactoryFn<DarkJSX.Elements['progress']>;\r\nstyled.q = styled('q') as FactoryFn<DarkJSX.Elements['q']>;\r\nstyled.rp = styled('rp') as FactoryFn<DarkJSX.Elements['rp']>;\r\nstyled.rt = styled('rt') as FactoryFn<DarkJSX.Elements['rt']>;\r\nstyled.ruby = styled('ruby') as FactoryFn<DarkJSX.Elements['ruby']>;\r\nstyled.s = styled('s') as FactoryFn<DarkJSX.Elements['s']>;\r\nstyled.samp = styled('samp') as FactoryFn<DarkJSX.Elements['samp']>;\r\nstyled.script = styled('script') as FactoryFn<DarkJSX.Elements['script']>;\r\nstyled.section = styled('section') as FactoryFn<DarkJSX.Elements['section']>;\r\nstyled.select = styled('select') as FactoryFn<DarkJSX.Elements['select']>;\r\nstyled.small = styled('small') as FactoryFn<DarkJSX.Elements['small']>;\r\nstyled.source = styled('source') as FactoryFn<DarkJSX.Elements['source']>;\r\nstyled.span = styled('span') as FactoryFn<DarkJSX.Elements['span']>;\r\nstyled.strong = styled('strong') as FactoryFn<DarkJSX.Elements['strong']>;\r\nstyled.style = styled('style') as FactoryFn<DarkJSX.Elements['style']>;\r\nstyled.sub = styled('sub') as FactoryFn<DarkJSX.Elements['sub']>;\r\nstyled.summary = styled('summary') as FactoryFn<DarkJSX.Elements['summary']>;\r\nstyled.sup = styled('sup') as FactoryFn<DarkJSX.Elements['sup']>;\r\nstyled.table = styled('table') as FactoryFn<DarkJSX.Elements['table']>;\r\nstyled.tbody = styled('tbody') as FactoryFn<DarkJSX.Elements['tbody']>;\r\nstyled.td = styled('td') as FactoryFn<DarkJSX.Elements['td']>;\r\nstyled.template = styled('template') as FactoryFn<DarkJSX.Elements['template']>;\r\nstyled.textarea = styled('textarea') as FactoryFn<DarkJSX.Elements['textarea']>;\r\nstyled.tfoot = styled('tfoot') as FactoryFn<DarkJSX.Elements['tfoot']>;\r\nstyled.th = styled('th') as FactoryFn<DarkJSX.Elements['th']>;\r\nstyled.thead = styled('thead') as FactoryFn<DarkJSX.Elements['thead']>;\r\nstyled.time = styled('time') as FactoryFn<DarkJSX.Elements['time']>;\r\nstyled.title = styled('title') as FactoryFn<DarkJSX.Elements['title']>;\r\nstyled.tr = styled('tr') as FactoryFn<DarkJSX.Elements['tr']>;\r\nstyled.track = styled('track') as FactoryFn<DarkJSX.Elements['track']>;\r\nstyled.u = styled('u') as FactoryFn<DarkJSX.Elements['u']>;\r\nstyled.ul = styled('ul') as FactoryFn<DarkJSX.Elements['ul']>;\r\nstyled.var = styled('var') as FactoryFn<DarkJSX.Elements['var']>;\r\nstyled.video = styled('video') as FactoryFn<DarkJSX.Elements['video']>;\r\nstyled.wbr = styled('wbr') as FactoryFn<DarkJSX.Elements['wbr']>;\r\nstyled.circle = styled('circle') as FactoryFn<DarkJSX.Elements['circle']>;\r\nstyled.clipPath = styled('clipPath') as FactoryFn<DarkJSX.Elements['clipPath']>;\r\nstyled.defs = styled('defs') as FactoryFn<DarkJSX.Elements['defs']>;\r\nstyled.desc = styled('desc') as FactoryFn<DarkJSX.Elements['desc']>;\r\nstyled.ellipse = styled('ellipse') as FactoryFn<DarkJSX.Elements['ellipse']>;\r\nstyled.feBlend = styled('feBlend') as FactoryFn<DarkJSX.Elements['feBlend']>;\r\nstyled.feColorMatrix = styled('feColorMatrix') as FactoryFn<DarkJSX.Elements['feColorMatrix']>;\r\nstyled.feComponentTransfer = styled('feComponentTransfer') as FactoryFn<DarkJSX.Elements['feComponentTransfer']>;\r\nstyled.feComposite = styled('feComposite') as FactoryFn<DarkJSX.Elements['feComposite']>;\r\nstyled.feConvolveMatrix = styled('feConvolveMatrix') as FactoryFn<DarkJSX.Elements['feConvolveMatrix']>;\r\nstyled.feDiffuseLighting = styled('feDiffuseLighting') as FactoryFn<DarkJSX.Elements['feDiffuseLighting']>;\r\nstyled.feDisplacementMap = styled('feDisplacementMap') as FactoryFn<DarkJSX.Elements['feDisplacementMap']>;\r\nstyled.feDistantLight = styled('feDistantLight') as FactoryFn<DarkJSX.Elements['feDistantLight']>;\r\nstyled.feFlood = styled('feFlood') as FactoryFn<DarkJSX.Elements['feFlood']>;\r\nstyled.feFuncA = styled('feFuncA') as FactoryFn<DarkJSX.Elements['feFuncA']>;\r\nstyled.feFuncB = styled('feFuncB') as FactoryFn<DarkJSX.Elements['feFuncB']>;\r\nstyled.feFuncG = styled('feFuncG') as FactoryFn<DarkJSX.Elements['feFuncG']>;\r\nstyled.feFuncR = styled('feFuncR') as FactoryFn<DarkJSX.Elements['feFuncR']>;\r\nstyled.feGaussianBlur = styled('feGaussianBlur') as FactoryFn<DarkJSX.Elements['feGaussianBlur']>;\r\nstyled.feImage = styled('feImage') as FactoryFn<DarkJSX.Elements['feImage']>;\r\nstyled.feMerge = styled('feMerge') as FactoryFn<DarkJSX.Elements['feMerge']>;\r\nstyled.feMergeNode = styled('feMergeNode') as FactoryFn<DarkJSX.Elements['feMergeNode']>;\r\nstyled.feMorphology = styled('feMorphology') as FactoryFn<DarkJSX.Elements['feMorphology']>;\r\nstyled.feOffset = styled('feOffset') as FactoryFn<DarkJSX.Elements['feOffset']>;\r\nstyled.fePointLight = styled('fePointLight') as FactoryFn<DarkJSX.Elements['fePointLight']>;\r\nstyled.feSpecularLighting = styled('feSpecularLighting') as FactoryFn<DarkJSX.Elements['feSpecularLighting']>;\r\nstyled.feSpotLight = styled('feSpotLight') as FactoryFn<DarkJSX.Elements['feSpotLight']>;\r\nstyled.feTile = styled('feTile') as FactoryFn<DarkJSX.Elements['feTile']>;\r\nstyled.feTurbulence = styled('feTurbulence') as FactoryFn<DarkJSX.Elements['feTurbulence']>;\r\nstyled.filter = styled('filter') as FactoryFn<DarkJSX.Elements['filter']>;\r\nstyled.g = styled('g') as FactoryFn<DarkJSX.Elements['g']>;\r\nstyled.image = styled('image') as FactoryFn<DarkJSX.Elements['image']>;\r\nstyled.line = styled('line') as FactoryFn<DarkJSX.Elements['line']>;\r\nstyled.linearGradient = styled('linearGradient') as FactoryFn<DarkJSX.Elements['linearGradient']>;\r\nstyled.marker = styled('marker') as FactoryFn<DarkJSX.Elements['marker']>;\r\nstyled.mask = styled('mask') as FactoryFn<DarkJSX.Elements['mask']>;\r\nstyled.path = styled('path') as FactoryFn<DarkJSX.Elements['path']>;\r\nstyled.pattern = styled('pattern') as FactoryFn<DarkJSX.Elements['pattern']>;\r\nstyled.polygon = styled('polygon') as FactoryFn<DarkJSX.Elements['polygon']>;\r\nstyled.polyline = styled('polyline') as FactoryFn<DarkJSX.Elements['polyline']>;\r\nstyled.radialGradient = styled('radialGradient') as FactoryFn<DarkJSX.Elements['radialGradient']>;\r\nstyled.rect = styled('rect') as FactoryFn<DarkJSX.Elements['rect']>;\r\nstyled.stop = styled('stop') as FactoryFn<DarkJSX.Elements['stop']>;\r\nstyled.svg = styled('svg') as FactoryFn<DarkJSX.Elements['svg']>;\r\nstyled.switch = styled('switch') as FactoryFn<DarkJSX.Elements['switch']>;\r\nstyled.symbol = styled('symbol') as FactoryFn<DarkJSX.Elements['symbol']>;\r\nstyled.text = styled('text') as FactoryFn<DarkJSX.Elements['text']>;\r\nstyled.textPath = styled('textPath') as FactoryFn<DarkJSX.Elements['textPath']>;\r\nstyled.tspan = styled('tspan') as FactoryFn<DarkJSX.Elements['tspan']>;\r\nstyled.use = styled('use') as FactoryFn<DarkJSX.Elements['use']>;\r\nstyled.view = styled('view') as FactoryFn<DarkJSX.Elements['view']>;\r\n\r\nexport { setupGlobal, styled, css, inject, reuse, getTag, filterArgs, detectIsStyled };\r\n","import {\r\n  component,\r\n  forwardRef,\r\n  useInsertionEffect,\r\n  useMemo,\r\n  useId,\r\n  detectIsServer,\r\n  mapRecord,\r\n} from '@dark-engine/core';\r\n\r\nimport { detectIsBrowser, getElement, insertBefore, getElements, createStyleElement, setAttr, append } from '../utils';\r\nimport { STYLED_ATTR, GLOBAL_ATTR_VALUE, INTERLEAVE_GLOBAL_ATTR_VALUE } from '../constants';\r\nimport { css, inject, reuse, getTag as getStyleTag, filterArgs } from '../styled';\r\nimport { type ThemeProps, useTheme } from '../theme';\r\nimport { useManager } from '../server/manager';\r\nimport { type Args } from '../styled';\r\n\r\nlet cache: Map<string, string> = null;\r\nlet tag: HTMLStyleElement = null;\r\nlet isLoaded = false;\r\n\r\nsetupGlobal();\r\n\r\nfunction createGlobalStyle<P extends object = {}>(source: TemplateStringsArray, ...args: Args<P & ThemeProps>) {\r\n  if (!isLoaded && detectIsBrowser()) {\r\n    reuse(getInterleavedElements(), createTag, false);\r\n    isLoaded = true;\r\n  }\r\n\r\n  const fns = filterArgs<P>(args);\r\n  const sheet = css<P>(source, ...args);\r\n  const factory = forwardRef<P, unknown>(\r\n    component(props => {\r\n      const theme = useTheme();\r\n      const id = useId();\r\n      const css = useMemo(() => sheet.generate({ props: { ...props, theme }, fns }), [...mapRecord(props), theme]);\r\n\r\n      useInsertionEffect(() => {\r\n        if (!tag) {\r\n          tag = getTag() || createTag(); // after hydration\r\n        }\r\n\r\n        cache.set(id, css);\r\n        reinject(tag, cache);\r\n      }, [css]);\r\n\r\n      useInsertionEffect(() => {\r\n        return () => {\r\n          cache.delete(id);\r\n          reinject(tag, cache);\r\n        };\r\n      }, []);\r\n\r\n      if (detectIsServer()) {\r\n        const manager = useManager(); // special case of hook using, should be last in order\r\n\r\n        manager.collectGlobalStyle(css);\r\n        manager.reset(setupGlobal);\r\n      }\r\n\r\n      return null;\r\n    }),\r\n  );\r\n\r\n  return factory;\r\n}\r\n\r\nfunction setupGlobal() {\r\n  cache = new Map();\r\n  tag = null;\r\n  isLoaded = false;\r\n}\r\n\r\nfunction createTag() {\r\n  const tag1 = createStyleElement();\r\n  const tag2 = getStyleTag();\r\n\r\n  setAttr(tag1, STYLED_ATTR, GLOBAL_ATTR_VALUE);\r\n\r\n  if (tag2) {\r\n    insertBefore(document.head, tag1, tag2);\r\n  } else {\r\n    append(document.head, tag1);\r\n  }\r\n\r\n  return tag1;\r\n}\r\n\r\nfunction getInterleavedElements() {\r\n  return getElements(`[${STYLED_ATTR}=\"${INTERLEAVE_GLOBAL_ATTR_VALUE}\"]`) as Array<HTMLStyleElement>;\r\n}\r\n\r\nconst getTag = () => getElement(`[${STYLED_ATTR}=\"${GLOBAL_ATTR_VALUE}\"]`) as HTMLStyleElement;\r\n\r\nconst reinject = (tag: HTMLStyleElement, stylesMap: Map<string, string>) => {\r\n  tag.textContent = '';\r\n  stylesMap.forEach(css => inject(css, tag));\r\n};\r\n\r\nexport { setupGlobal, createGlobalStyle };\r\n","import { type ElementKey, type TimerId, detectIsEmpty } from '@dark-engine/core';\r\n\r\nimport { type Controller, type StartFn } from '../controller';\r\nimport { type SpringValue } from '../shared';\r\n\r\nclass SharedState<T extends string = string> {\r\n  private ctrls: Array<Controller<T>> = [];\r\n  private stack = new Set<ElementKey>();\r\n  private flow = Flow.RIGHT;\r\n  private isTrail = false;\r\n  private isPaused = false;\r\n  private isCanceled = false;\r\n  private timeout = 0;\r\n  private timerId: TimerId = null;\r\n  private events = new Map<AnimationEventName, Set<AnimationEventHandler<T>>>();\r\n\r\n  getCtrls() {\r\n    return this.ctrls;\r\n  }\r\n\r\n  setCtrls(ctrls: Array<Controller<T>>) {\r\n    this.ctrls = ctrls;\r\n  }\r\n\r\n  setIsTrail(x: boolean) {\r\n    this.isTrail = x;\r\n  }\r\n\r\n  getIsTrail() {\r\n    return this.isTrail;\r\n  }\r\n\r\n  setFlow(x: Flow) {\r\n    this.flow = x;\r\n  }\r\n\r\n  getIsPaused() {\r\n    return this.isPaused;\r\n  }\r\n\r\n  getIsCanceled() {\r\n    return this.isCanceled;\r\n  }\r\n\r\n  detectIsRightFlow() {\r\n    return this.flow === Flow.RIGHT;\r\n  }\r\n\r\n  setIsPlaying(x: boolean, key: ElementKey) {\r\n    if (x) {\r\n      this.stack.add(key);\r\n    } else {\r\n      this.stack.delete(key);\r\n    }\r\n  }\r\n\r\n  detectIsPlaying(key?: ElementKey) {\r\n    return detectIsEmpty(key) ? this.stack.size > 0 : this.stack.has(key);\r\n  }\r\n\r\n  start(fn?: StartFn<T>) {\r\n    this.defer(() => {\r\n      if (this.ctrls.length === 0) return;\r\n      this.event('series-start');\r\n\r\n      if (this.isTrail) {\r\n        const ctrl = this.flow === Flow.RIGHT ? this.ctrls[0] : this.ctrls[this.ctrls.length - 1];\r\n\r\n        ctrl.start(fn);\r\n      } else {\r\n        this.ctrls.forEach(x => x.start(fn));\r\n      }\r\n    });\r\n  }\r\n\r\n  pause() {\r\n    this.isPaused = true;\r\n  }\r\n\r\n  resume() {\r\n    this.isPaused = false;\r\n  }\r\n\r\n  delay(timeout: number) {\r\n    this.timeout = timeout;\r\n  }\r\n\r\n  reset() {\r\n    this.ctrls.forEach(x => x.reset());\r\n  }\r\n\r\n  cancel() {\r\n    this.ctrls.forEach(x => x.cancel());\r\n    this.resetTimer();\r\n    this.isCanceled = true;\r\n  }\r\n\r\n  on(event: AnimationEventName, handler: AnimationEventHandler<T>) {\r\n    if (!this.events.has(event)) {\r\n      this.events.set(event, new Set());\r\n    }\r\n\r\n    const subs = this.events.get(event);\r\n\r\n    subs.add(handler);\r\n\r\n    return () => subs.delete(handler);\r\n  }\r\n\r\n  event(name: AnimationEventName, value: AnimationEventValue<T> = null) {\r\n    this.events.has(name) && this.events.get(name).forEach(x => x(value));\r\n  }\r\n\r\n  completeSeries() {\r\n    const isCompleted = !this.detectIsPlaying();\r\n\r\n    isCompleted && this.event('series-end');\r\n  }\r\n\r\n  defer(fn: () => void) {\r\n    this.resetTimer();\r\n\r\n    if (this.timeout > 0) {\r\n      this.timerId = setTimeout(() => {\r\n        this.timerId = null;\r\n        fn();\r\n      }, this.timeout);\r\n    } else {\r\n      fn();\r\n    }\r\n  }\r\n\r\n  private resetTimer() {\r\n    this.timerId && clearTimeout(this.timerId);\r\n    this.timerId = null;\r\n  }\r\n}\r\n\r\nexport enum Flow {\r\n  RIGHT = 'RIGHT',\r\n  LEFT = 'LEFT',\r\n}\r\n\r\nlet sharedState: SharedState = null;\r\n\r\nfunction setSharedState(state: SharedState) {\r\n  sharedState = state;\r\n}\r\n\r\nfunction getSharedState() {\r\n  const state = sharedState;\r\n\r\n  sharedState = null;\r\n\r\n  return state;\r\n}\r\n\r\nexport type AnimationEventName = 'series-start' | 'item-start' | 'item-change' | 'item-end' | 'series-end';\r\n\r\nexport type AnimationEventValue<T extends string = string> = {\r\n  value: SpringValue<T>;\r\n  idx: number;\r\n  key: ElementKey;\r\n};\r\n\r\nexport type AnimationEventHandler<T extends string = string> = (value?: AnimationEventValue<T>) => void;\r\n\r\nexport { SharedState, setSharedState, getSharedState };\r\n","import { preset } from '../preset';\r\n\r\nexport type SpringValue<T extends string = string> = Record<T, number>;\r\n\r\nexport type SpringConfig = {\r\n  mass: number;\r\n  tension: number;\r\n  friction: number;\r\n  precision: number;\r\n  fix: number;\r\n};\r\n\r\nconst defaultSpringConfig: SpringConfig = {\r\n  ...preset('no-wobble'),\r\n  mass: 1,\r\n  precision: 3,\r\n  fix: 4,\r\n};\r\n\r\nexport { defaultSpringConfig };\r\n","import { type SpringConfig } from '../shared';\r\n\r\ntype Preset = Pick<SpringConfig, 'tension' | 'friction'>;\r\ntype PresetName = 'no-wobble' | 'gentle' | 'wobbly' | 'stiff';\r\n\r\nconst presets: Record<PresetName, Preset> = {\r\n  'no-wobble': { tension: 170, friction: 26 },\r\n  gentle: { tension: 120, friction: 14 },\r\n  wobbly: { tension: 180, friction: 12 },\r\n  stiff: { tension: 210, friction: 20 },\r\n};\r\n\r\nfunction preset(name: PresetName): Preset {\r\n  return presets[name] || ({} as Preset);\r\n}\r\n\r\nexport { preset };\r\n","import { detectIsFunction, detectIsEmpty, detectAreDepsDifferent, trueFn, error } from '../utils';\r\nimport { useLayoutEffect } from '../use-layout-effect';\r\nimport { type SubscriberWithValue } from '../shared';\r\nimport { ATOM_HOST_MASK } from '../constants';\r\nimport { $$scope, getRootId } from '../scope';\r\nimport { createUpdate, useUpdate } from '../use-update';\r\nimport { createTools } from '../use-state';\r\nimport { EventEmitter } from '../emitter';\r\nimport { useMemo } from '../use-memo';\r\nimport { type Hook } from '../fiber';\r\nimport { batch } from '../batch';\r\n\r\nclass Atom<T = unknown> {\r\n  private value: T;\r\n  private connections1: Map<Hook, Tuple<T>>;\r\n  private connections2: Map<T, Tuple<T>>;\r\n  private subjects: Set<ReadableAtom>;\r\n  private emitter: EventEmitter<'data', EmitterValue<T>>;\r\n\r\n  constructor(value: T) {\r\n    this.value = value;\r\n  }\r\n\r\n  val(fn?: ShouldUpdate<T>, key?: T) {\r\n    try {\r\n      this.__connect(fn, key);\r\n    } catch (err) {\r\n      if (process.env.NODE_ENV !== 'production') {\r\n        error('[Dark]: illegal invocation atom.val() outside render process!');\r\n      }\r\n    }\r\n\r\n    return this.value;\r\n  }\r\n\r\n  get() {\r\n    return this.value;\r\n  }\r\n\r\n  on(fn: SubscriberWithValue<EmitterValue<T>>) {\r\n    !this.emitter && (this.emitter = new EventEmitter());\r\n\r\n    return this.emitter.on('data', fn);\r\n  }\r\n\r\n  kill() {\r\n    if (this.connections1) {\r\n      for (const [hook, [_, __, ___, key]] of this.connections1) {\r\n        this.off(hook, key);\r\n      }\r\n    }\r\n\r\n    if (this.connections2) {\r\n      for (const [key, [_, hook]] of this.connections2) {\r\n        this.off(hook, key);\r\n      }\r\n    }\r\n\r\n    this.connections1 = null;\r\n    this.connections2 = null;\r\n    this.emitter = null;\r\n    this.subjects = null;\r\n  }\r\n\r\n  toString() {\r\n    return String(this.value);\r\n  }\r\n\r\n  toJSON() {\r\n    return this.value;\r\n  }\r\n\r\n  valueOf() {\r\n    return this.value;\r\n  }\r\n\r\n  __connect(fn: ShouldUpdate<T>, key: T) {\r\n    const rootId = getRootId();\r\n    const fiber = $$scope().getCursorFiber();\r\n    const { hook } = fiber;\r\n    const disconnect = () => this.off(hook, key);\r\n\r\n    !fiber.atoms && (fiber.atoms = new Map());\r\n    fiber.atoms.set(this, disconnect);\r\n    fiber.markHost(ATOM_HOST_MASK);\r\n\r\n    if (detectIsEmpty(key)) {\r\n      !this.connections1 && (this.connections1 = new Map());\r\n      this.connections1.set(hook, [rootId, hook, fn, key]);\r\n    } else {\r\n      !this.connections2 && (this.connections2 = new Map());\r\n      this.connections2.set(key, [rootId, hook, fn, key]);\r\n    }\r\n\r\n    return disconnect;\r\n  }\r\n\r\n  __addSubject(atom$: ReadableAtom) {\r\n    !this.subjects && (this.subjects = new Set());\r\n    this.subjects.add(atom$);\r\n  }\r\n\r\n  __removeSubject(atom$: ReadableAtom) {\r\n    return this.subjects && this.subjects.delete(atom$);\r\n  }\r\n\r\n  __getSize() {\r\n    const size1 = this.connections1 ? this.connections1.size : 0;\r\n    const size2 = this.connections2 ? this.connections2.size : 0;\r\n    const size3 = this.subjects ? this.subjects.size : 0;\r\n    const size4 = this.emitter ? this.emitter.__getSize() : 0;\r\n\r\n    return size1 + size2 + size3 + size4;\r\n  }\r\n\r\n  protected setValue(value: T | ((prevValue: T) => T)) {\r\n    const prev = this.value;\r\n    const next = detectIsFunction(value) ? value(this.value) : value;\r\n    const data: EmitterValue<T> = { prev, next };\r\n    const make = (tuple: Tuple<T>, prev: T, next: T) => {\r\n      const [rootId, hook, shouldUpdate, key] = tuple;\r\n      const fn = shouldUpdate || trueFn;\r\n\r\n      if (fn(prev, next, key)) {\r\n        const update = createUpdate(rootId, hook);\r\n\r\n        if (this.__getSize() === 1) {\r\n          const tools = createTools({\r\n            next,\r\n            get: () => prev,\r\n            set: () => (this.value = next),\r\n            reset: () => (this.value = prev),\r\n          });\r\n\r\n          update(tools);\r\n        } else {\r\n          update();\r\n        }\r\n      }\r\n    };\r\n\r\n    this.value = next;\r\n\r\n    if (this.connections1) {\r\n      for (const [_, tuple] of this.connections1) {\r\n        make(tuple, prev, next);\r\n      }\r\n    }\r\n\r\n    if (this.connections2) {\r\n      if (this.connections2.has(next)) {\r\n        make(this.connections2.get(next), prev, next);\r\n        this.connections2.has(prev) && make(this.connections2.get(prev), prev, next);\r\n      }\r\n    }\r\n\r\n    this.emitter && this.emitter.emit('data', data);\r\n    this.subjects && this.subjects.forEach(x => x.__notify());\r\n  }\r\n\r\n  private off(hook: Hook, key: T) {\r\n    hook.owner.atoms.delete(this);\r\n    this.connections1 && this.connections1.delete(hook);\r\n    this.connections2 && this.connections2.delete(key);\r\n  }\r\n}\r\n\r\nclass WritableAtom<T = unknown> extends Atom<T> {\r\n  set(value: T | ((prevValue: T) => T)) {\r\n    super.setValue(value);\r\n  }\r\n}\r\n\r\nclass ReadableAtom<T = unknown> extends Atom<T> {\r\n  private deps$: Array<Atom> = [];\r\n  private fn: ComputedFn<T> = null;\r\n  private values: Array<unknown> = [];\r\n\r\n  constructor(deps$: Array<Atom>, fn: ComputedFn<T>) {\r\n    const values = ReadableAtom.values(deps$);\r\n\r\n    super(ReadableAtom.compute(fn, values));\r\n    this.deps$ = deps$;\r\n    this.fn = fn;\r\n    this.values = values;\r\n    deps$.forEach(x => x.__addSubject(this));\r\n  }\r\n\r\n  __notify() {\r\n    const values = ReadableAtom.values(this.deps$);\r\n\r\n    if (detectAreDepsDifferent(this.values, values)) {\r\n      super.setValue(ReadableAtom.compute(this.fn, values));\r\n    }\r\n\r\n    this.values = values;\r\n  }\r\n\r\n  override kill() {\r\n    super.kill();\r\n    this.deps$.forEach(x => x.__removeSubject(this));\r\n    this.deps$ = [];\r\n    this.fn = null;\r\n  }\r\n\r\n  private static compute(fn: Function, values: Array<unknown>) {\r\n    return fn(...values);\r\n  }\r\n\r\n  private static values(deps$: Array<Atom>) {\r\n    return deps$.map(x => x.get());\r\n  }\r\n}\r\n\r\nconst detectIsAtom = (x: unknown): x is Atom => x instanceof Atom;\r\n\r\nconst detectIsWritableAtom = (x: unknown): x is WritableAtom => x instanceof WritableAtom;\r\n\r\nconst detectIsReadableAtom = (x: unknown): x is ReadableAtom => x instanceof ReadableAtom;\r\n\r\nconst atom = <T>(value?: T) => new WritableAtom(value);\r\n\r\nconst computed = <T, A, B, C, D, E, F, G, H, I, J, K, L, M, N>(\r\n  deps$: [\r\n    Atom<A>,\r\n    Atom<B>?,\r\n    Atom<C>?,\r\n    Atom<D>?,\r\n    Atom<E>?,\r\n    Atom<F>?,\r\n    Atom<G>?,\r\n    Atom<H>?,\r\n    Atom<I>?,\r\n    Atom<J>?,\r\n    Atom<K>?,\r\n    Atom<L>?,\r\n    Atom<M>?,\r\n    Atom<N>?,\r\n  ],\r\n  fn: ComputedFn<T, A, B, C, D, E, F, G, H, I, J, K, L, M, N>,\r\n) => new ReadableAtom(deps$, fn) as ReadableAtom<ReturnType<typeof fn>>;\r\n\r\nfunction useAtom<T>(value?: T): WritableAtom<T> {\r\n  const atom$ = useMemo(() => atom<T>(value), []);\r\n\r\n  useLayoutEffect(() => () => atom$.kill(), []);\r\n\r\n  return atom$;\r\n}\r\n\r\nfunction useComputed<T, A, B, C, D, E, F, G, H, I, J, K, L, M, N>(\r\n  deps$: [\r\n    Atom<A>,\r\n    Atom<B>?,\r\n    Atom<C>?,\r\n    Atom<D>?,\r\n    Atom<E>?,\r\n    Atom<F>?,\r\n    Atom<G>?,\r\n    Atom<H>?,\r\n    Atom<I>?,\r\n    Atom<J>?,\r\n    Atom<K>?,\r\n    Atom<L>?,\r\n    Atom<M>?,\r\n    Atom<N>?,\r\n  ],\r\n  fn: ComputedFn<T, A, B, C, D, E, F, G, H, I, J, K, L, M, N>,\r\n) {\r\n  const atom$ = useMemo(() => computed(deps$, fn), []);\r\n\r\n  useLayoutEffect(() => () => atom$.kill(), []);\r\n\r\n  return atom$;\r\n}\r\n\r\nfunction useStore<A, B, C, D, E, F, G, H, I, J, K, L, M, N>(\r\n  atoms$: [\r\n    Atom<A>,\r\n    Atom<B>?,\r\n    Atom<C>?,\r\n    Atom<D>?,\r\n    Atom<E>?,\r\n    Atom<F>?,\r\n    Atom<G>?,\r\n    Atom<H>?,\r\n    Atom<I>?,\r\n    Atom<J>?,\r\n    Atom<K>?,\r\n    Atom<L>?,\r\n    Atom<M>?,\r\n    Atom<N>?,\r\n  ],\r\n) {\r\n  const forceUpdate = useUpdate();\r\n  const update = () => batch(forceUpdate);\r\n\r\n  useLayoutEffect(() => {\r\n    const offs = atoms$.map(x => x.on(update));\r\n\r\n    return () => offs.forEach(x => x());\r\n  }, [...atoms$]);\r\n\r\n  return atoms$.map(x => x.get()) as [A, B, C, D, E, F, G, H, I, J, K, L, M, N];\r\n}\r\n\r\ntype ShouldUpdate<T> = (p: T, n: T, key?: T) => boolean;\r\ntype EmitterValue<T> = { prev: T; next: T };\r\ntype Tuple<T> = [number, Hook, ShouldUpdate<T>, T];\r\ntype ComputedFn<\r\n  T,\r\n  A = unknown,\r\n  B = unknown,\r\n  C = unknown,\r\n  D = unknown,\r\n  E = unknown,\r\n  F = unknown,\r\n  G = unknown,\r\n  H = unknown,\r\n  I = unknown,\r\n  J = unknown,\r\n  K = unknown,\r\n  L = unknown,\r\n  M = unknown,\r\n  N = unknown,\r\n> = (a: A, b?: B, c?: C, d?: D, e?: E, f?: F, g?: G, h?: H, i?: I, j?: J, k?: K, l?: L, m?: M, n?: N) => T;\r\n\r\nexport {\r\n  type Atom,\r\n  WritableAtom,\r\n  ReadableAtom,\r\n  detectIsAtom,\r\n  detectIsWritableAtom,\r\n  detectIsReadableAtom,\r\n  atom,\r\n  computed,\r\n  useAtom,\r\n  useComputed,\r\n  useStore,\r\n};\r\n","import { type WritableAtom, type SubscriberWithValue, atom } from '@dark-engine/core';\r\n\r\nimport { type SpringValue } from '../shared';\r\n\r\nclass Spring<T extends string = string> {\r\n  private props: Record<T, WritableAtom<number>> = {} as Record<T, WritableAtom<number>>;\r\n  private subscribers = new Set<SubscriberWithValue<SpringValue<T>>>();\r\n\r\n  prop(key: T) {\r\n    return this.props[key] ? this.props[key].get() : null;\r\n  }\r\n\r\n  prop$(key: T) {\r\n    return this.props[key] || null;\r\n  }\r\n\r\n  setProp(key: T, value: number) {\r\n    !this.props[key] && (this.props[key] = atom(value));\r\n    this.props[key].set(value);\r\n  }\r\n\r\n  value(): SpringValue<T> {\r\n    const value = Object.keys(this.props).reduce((acc, x) => ((acc[x] = this.props[x].get()), acc), {});\r\n\r\n    return value as SpringValue<T>;\r\n  }\r\n\r\n  on(fn: SubscriberWithValue<SpringValue<T>>) {\r\n    this.subscribers.add(fn);\r\n\r\n    return () => this.subscribers.delete(fn);\r\n  }\r\n\r\n  notify() {\r\n    this.subscribers.forEach(x => x(this.value()));\r\n  }\r\n}\r\n\r\nexport { Spring };\r\n","const fix = (x: number, precision = 4) => Number(x.toFixed(precision));\r\n\r\nconst illegal = (value: string) => {\r\n  throw new Error(value);\r\n};\r\n\r\nconst range = (x: number) =>\r\n  Array(x)\r\n    .fill(null)\r\n    .map((_, idx) => idx);\r\n\r\nconst uniq = <T>(items: Array<T>, selector: (x: T) => unknown) => {\r\n  const arr: Array<T> = [];\r\n  const set = new Set();\r\n\r\n  for (const item of items) {\r\n    const key = selector(item);\r\n\r\n    !set.has(key) && arr.push(item);\r\n    set.add(key);\r\n  }\r\n\r\n  return arr;\r\n};\r\n\r\nexport { fix, illegal, range, uniq };\r\n","import { type SpringConfig } from '../shared';\r\n\r\nfunction stepper(pos: number, vel: number, dest: number, step: number, config: Omit<SpringConfig, 'fix'>) {\r\n  const { tension, friction, mass, precision } = config;\r\n  const [nPos, nVel] = spring(pos, vel, dest, step, tension, friction, mass);\r\n\r\n  if (Math.abs(nPos - dest) < 10 ** (-1 * precision)) return [dest, 0];\r\n\r\n  return [nPos, nVel];\r\n}\r\n\r\nfunction spring(pos: number, vel: number, dest: number, step: number, tension: number, friction: number, mass: number) {\r\n  const disp = pos - dest;\r\n  const sf = -1 * tension * disp;\r\n  const df = -1 * friction * vel;\r\n  const a = (sf + df) / mass;\r\n  const nVel = vel + a * step;\r\n  const nPos = pos + nVel * step;\r\n\r\n  return [nPos, nVel];\r\n}\r\n\r\nexport { stepper };\r\n","import { type ElementKey, platform, falseFn, detectIsUndefined, getTime } from '@dark-engine/core';\r\n\r\nimport { type SpringValue, type SpringConfig, defaultSpringConfig } from '../shared';\r\nimport { type AnimationEventName, SharedState } from '../state';\r\nimport { Spring } from '../spring';\r\nimport { fix } from '../utils';\r\nimport { stepper } from '../stepper';\r\n\r\nconst BASE_FRAME_TIME_IN_MS = 1000 / 60;\r\nconst MAX_SKIPPED_FRAMES = 10;\r\nconst MAX_DELTA_TIME_IN_SEC = MAX_SKIPPED_FRAMES * (BASE_FRAME_TIME_IN_MS / 1000);\r\nconst MIN_STEP = 0.01;\r\n\r\nclass Controller<T extends string, I = unknown> {\r\n  private key: ElementKey;\r\n  private idx: number;\r\n  private from: SpringValue<T>;\r\n  private to: SpringValue<T>;\r\n  private value: SpringValue<T>;\r\n  private dest: SpringValue<T>;\r\n  private state: SharedState = null;\r\n  private frameTime: number;\r\n  private frameId: number;\r\n  private results: Record<string, [number, number]> = {};\r\n  private completed: Record<string, boolean> = {};\r\n  private queue: Array<SpringValue<T>> = [];\r\n  private left: Controller<T> = null;\r\n  private right: Controller<T> = null;\r\n  private springConfigFn: SpringConfigFn<T>;\r\n  private configurator: ConfiguratorFn<T>;\r\n  private immediate: ImmediateFn<T> = falseFn;\r\n  private immediates: Array<() => void> = [];\r\n  private primaryKey: ElementKey;\r\n  private isReplaced = false;\r\n  private item: I = null;\r\n  private spring = new Spring<T>();\r\n\r\n  constructor(state: SharedState) {\r\n    this.state = state;\r\n    this.key = String(++Controller.key);\r\n  }\r\n\r\n  getKey() {\r\n    return this.key;\r\n  }\r\n\r\n  setKey(x: ElementKey) {\r\n    this.key = x;\r\n  }\r\n\r\n  getIdx() {\r\n    return this.idx;\r\n  }\r\n\r\n  setIdx(x: number) {\r\n    this.idx = x;\r\n  }\r\n\r\n  setFrom(x: SpringValue<T>) {\r\n    this.from = x;\r\n    this.value = this.value || { ...x };\r\n  }\r\n\r\n  setTo(x: SpringValue<T>) {\r\n    this.to = x || { ...this.from };\r\n    this.dest = this.dest || { ...(x || this.from) };\r\n  }\r\n\r\n  setSpringConfigFn(fn?: PatialConfigFn<T>) {\r\n    this.springConfigFn = fn ? (key: T) => ({ ...defaultSpringConfig, ...fn(key) }) : () => defaultSpringConfig;\r\n  }\r\n\r\n  setLeft(x: Controller<T>) {\r\n    this.left = x;\r\n  }\r\n\r\n  setRight(x: Controller<T>) {\r\n    this.right = x;\r\n  }\r\n\r\n  notify() {\r\n    this.sync();\r\n    this.event('item-change');\r\n  }\r\n\r\n  setConfigurator(fn: ConfiguratorFn<T>) {\r\n    this.configurator = fn;\r\n  }\r\n\r\n  setImmediate(fn: ImmediateFn<T>) {\r\n    this.immediate = fn || this.immediate;\r\n  }\r\n\r\n  replaceValue(x: SpringValue<T>) {\r\n    this.value = x;\r\n    this.sync();\r\n  }\r\n\r\n  markAsFake(x: ElementKey) {\r\n    this.primaryKey = x;\r\n\r\n    return Controller.generateFakeKey(x);\r\n  }\r\n\r\n  detectIsFake() {\r\n    return !detectIsUndefined(this.primaryKey);\r\n  }\r\n\r\n  getIsReplaced() {\r\n    return this.isReplaced;\r\n  }\r\n\r\n  setIsReplaced(x: boolean) {\r\n    this.isReplaced = x;\r\n  }\r\n\r\n  getItem() {\r\n    return this.item;\r\n  }\r\n\r\n  setItem(x: I) {\r\n    this.item = x;\r\n  }\r\n\r\n  getState() {\r\n    return this.state;\r\n  }\r\n\r\n  getSpring() {\r\n    this.sync();\r\n\r\n    return this.spring;\r\n  }\r\n\r\n  start(fn?: StartFn<T>) {\r\n    if (this.state.getIsCanceled()) return; // !\r\n    const config1 = this.configurator(this.idx);\r\n    const config2 = fn ? fn(this.idx) : this.configurator(this.idx);\r\n    const from = { ...config1.from, ...config2.from };\r\n    const to = { ...config1.to, ...config2.to };\r\n    const config = config2.config || config1.config;\r\n    const immediate = config2.immediate || config1.immediate;\r\n\r\n    this.setFrom(config1.from || from);\r\n    this.setTo(config1.to || to);\r\n    this.setSpringConfigFn(config);\r\n    this.setImmediate(immediate);\r\n    Object.assign(this.dest, to);\r\n\r\n    this.play(this.dest);\r\n  }\r\n\r\n  reset() {\r\n    this.value = { ...this.from };\r\n    this.dest = { ...(this.to || this.from) };\r\n    this.sync();\r\n  }\r\n\r\n  cancel() {\r\n    this.frameId && platform.caf(this.frameId);\r\n    this.frameId = null;\r\n  }\r\n\r\n  setIsPlaying(x: boolean) {\r\n    this.state.setIsPlaying(x, this.key);\r\n  }\r\n\r\n  private play(to: SpringValue<T>) {\r\n    this.queue.push(to);\r\n    if (this.frameId) return false;\r\n    this.setIsPlaying(true);\r\n    this.event('item-start');\r\n    this.motion(to);\r\n  }\r\n\r\n  private motion(to: SpringValue<T>) {\r\n    const { value, results, completed, springConfigFn } = this;\r\n    const keys = Object.keys(value) as Array<T>;\r\n    const make = () => this.motion(to);\r\n\r\n    this.frameTime = getTime();\r\n    this.frameId = platform.raf(() => {\r\n      if (this.state.getIsPaused()) return make();\r\n      let step = (getTime() - this.frameTime) / 1000;\r\n\r\n      if (step > MAX_DELTA_TIME_IN_SEC) {\r\n        step = MIN_STEP;\r\n      }\r\n\r\n      if (this.queue.length === 0) {\r\n        this.queue.push(this.dest);\r\n      }\r\n\r\n      for (const key of keys) {\r\n        if (this.immediate(key)) {\r\n          completed[key] = true;\r\n\r\n          const complete = () => {\r\n            value[key] = to[key];\r\n            results[key] = [to[key], 0];\r\n          };\r\n\r\n          if (to[key] === this.from[key]) {\r\n            this.immediates.push(complete);\r\n          } else {\r\n            complete();\r\n          }\r\n        } else {\r\n          if (!results[key]) {\r\n            results[key] = [value[key], 0];\r\n          }\r\n\r\n          const config = springConfigFn(key);\r\n          let pos = results[key][0];\r\n          let vel = results[key][1];\r\n\r\n          for (const update of this.queue) {\r\n            const dest = update[key] as number;\r\n\r\n            [pos, vel] = stepper(pos, vel, dest, step, config);\r\n            results[key] = [pos, vel];\r\n            completed[key] = pos === dest;\r\n          }\r\n\r\n          value[key] = pos;\r\n        }\r\n      }\r\n\r\n      this.queue = [];\r\n      this.change();\r\n\r\n      if (this.checkCompleted(keys)) {\r\n        this.complete();\r\n      } else {\r\n        make();\r\n      }\r\n    });\r\n  }\r\n\r\n  private event(name: AnimationEventName) {\r\n    this.state.event(name, { value: this.value, idx: this.idx, key: this.key });\r\n  }\r\n\r\n  private change() {\r\n    this.notify();\r\n\r\n    if (this.state.getIsTrail()) {\r\n      if (this.state.detectIsRightFlow()) {\r\n        this.right && this.right.start(() => ({ to: this.value }));\r\n      } else {\r\n        this.left && this.left.start(() => ({ to: this.value }));\r\n      }\r\n    }\r\n  }\r\n\r\n  private complete() {\r\n    this.setIsPlaying(false);\r\n    this.frameTime = null;\r\n    this.frameId = null;\r\n    this.results = {};\r\n    this.completed = {};\r\n    this.immediates.forEach(x => x());\r\n    this.immediates.length > 0 && this.notify();\r\n    this.immediates = [];\r\n    this.event('item-end');\r\n    this.state.completeSeries();\r\n  }\r\n\r\n  private checkCompleted(keys: Array<string>) {\r\n    for (const key of keys) {\r\n      if (!this.completed[key]) return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  private sync() {\r\n    const keys = Object.keys(this.value) as Array<T>;\r\n\r\n    for (const key of keys) {\r\n      const config = this.springConfigFn(key);\r\n      const value = fix(this.value[key], config.fix);\r\n\r\n      this.spring.setProp(key, value);\r\n    }\r\n\r\n    this.spring.notify();\r\n  }\r\n\r\n  private static generateFakeKey(x: ElementKey) {\r\n    return `__${x}:${++Controller.fakeKey}__`;\r\n  }\r\n\r\n  private static key = -1;\r\n  private static fakeKey = -1;\r\n}\r\n\r\nexport type BaseItemConfig<T extends string> = {\r\n  from: SpringValue<T>;\r\n  to?: SpringValue<T>;\r\n  config?: PatialConfigFn<T>;\r\n  immediate?: ImmediateFn<T>;\r\n};\r\n\r\nexport type StartFnConfig<T extends string> = {\r\n  from?: SpringValue<T>;\r\n  to: Partial<SpringValue<T>>;\r\n} & Omit<BaseItemConfig<T>, 'from' | 'to'>;\r\n\r\nexport type ConfiguratorFn<T extends string> = (idx: number) => BaseItemConfig<T>;\r\n\r\nexport type StartFn<T extends string> = (idx: number) => StartFnConfig<T>;\r\n\r\nexport type SpringConfigFn<T extends string> = (key: T) => SpringConfig;\r\n\r\nexport type PatialConfigFn<T extends string> = (key: T) => Partial<SpringConfig>;\r\n\r\nexport type ImmediateFn<T extends string> = (key: T) => boolean;\r\n\r\nexport type NotifierFn<T extends string> = (x: SpringValue<T>) => void;\r\n\r\nexport { Controller };\r\n","import {\r\n  type Component,\r\n  type TagVirtualNodeFactory,\r\n  type Callback,\r\n  type ElementKey,\r\n  Fragment,\r\n  batch,\r\n  useMemo,\r\n  useUpdate,\r\n  useEffect,\r\n  useLayoutEffect,\r\n  detectIsArray,\r\n  detectIsNumber,\r\n} from '@dark-engine/core';\r\n\r\nimport { type SpringValue } from '../shared';\r\nimport { type AnimationEventValue, SharedState } from '../state';\r\nimport { type BaseItemConfig, type ConfiguratorFn, Controller } from '../controller';\r\nimport { type SpringApi } from '../use-springs';\r\nimport { type Spring } from '../spring';\r\nimport { uniq } from '../utils';\r\n\r\nexport type TransitionItemConfig<T extends string> = {\r\n  from: SpringValue<T>;\r\n  enter: SpringValue<T>;\r\n  leave?: SpringValue<T>;\r\n  update?: SpringValue<T>;\r\n  trail?: number;\r\n} & Pick<BaseItemConfig<T>, 'config' | 'immediate'>;\r\n\r\nfunction useTransition<T extends string, I = unknown>(\r\n  items: Array<I>,\r\n  getKey: KeyExtractor<I>,\r\n  configurator: TransitionConfiguratorFn<T, I>,\r\n): [TransitionFn<T, I>, TransitionApi<T>] {\r\n  const forceUpdate = useUpdate();\r\n  const update = () => batch(forceUpdate);\r\n  const state = useMemo(() => new SharedState<T>(), []);\r\n  const scope = useMemo<Scope<T, I>>(\r\n    () => ({\r\n      ctrlsMap: new Map(),\r\n      itemsMap: new Map(),\r\n      fakesMap: new Map(),\r\n      items: [],\r\n      queue: [],\r\n      hasReplaces: false,\r\n      fromApi: false,\r\n      inChain: false,\r\n      pending: null,\r\n      configurator,\r\n    }),\r\n    [],\r\n  );\r\n\r\n  scope.configurator = configurator;\r\n\r\n  useMemo(() => setup({ items, getKey, configurator, state, ctrlsMap: scope.ctrlsMap }), []);\r\n\r\n  const transition = useMemo<TransitionFn<T, I>>(\r\n    () => (render: TransitionRenderFn<T, I>) => {\r\n      const { ctrlsMap } = scope;\r\n      const elements: Array<TransitionElement> = [];\r\n\r\n      for (const [key, ctrl] of ctrlsMap) {\r\n        const idx = ctrl.getIdx();\r\n        const item = ctrl.getItem();\r\n        const spring = ctrl.getSpring();\r\n        const element = Fragment({ key, slot: render({ spring, item, idx }) });\r\n\r\n        if (elements[idx]) {\r\n          const sibling = elements[idx];\r\n\r\n          if (detectIsArray(sibling)) {\r\n            sibling.push(element);\r\n          } else {\r\n            elements[idx] = [sibling, element] as unknown as TransitionElement;\r\n          }\r\n        } else {\r\n          elements[idx] = element;\r\n        }\r\n      }\r\n\r\n      return Fragment({ slot: elements });\r\n    },\r\n    [],\r\n  );\r\n\r\n  const api = useMemo<TransitionApi<T>>(() => {\r\n    return {\r\n      start: fn => {\r\n        scope.fromApi = true;\r\n\r\n        if (scope.inChain) {\r\n          scope.pending && scope.pending();\r\n          scope.pending = null;\r\n        } else {\r\n          state.start(fn);\r\n        }\r\n      },\r\n      chain: (value: boolean) => (scope.inChain = value),\r\n      delay: state.delay.bind(state),\r\n      cancel: state.cancel.bind(state),\r\n      pause: state.pause.bind(state),\r\n      resume: state.resume.bind(state),\r\n      on: state.on.bind(state),\r\n      isCanceled: state.getIsCanceled.bind(state),\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const { inChain } = scope;\r\n    const nextItems = uniq(items, getKey);\r\n    const start = (items: Array<I>) => {\r\n      const { ctrlsMap, fakesMap, items: $items } = scope;\r\n      const configurator: TransitionConfiguratorFn<T, I> = (idx, item) => scope.configurator(idx, item);\r\n      const { ctrls, itemsMap } = setup({ items, getKey, configurator, state, ctrlsMap });\r\n      const { hasChanges, insMap, remMap, movMap, stabMap, replaced } = diff($items, items, getKey);\r\n\r\n      scope.hasReplaces = replaced.size > 0;\r\n      state.setCtrls(ctrls);\r\n      replaced.forEach(key => ctrlsMap.get(key).setIsReplaced(true));\r\n\r\n      state.event('series-start');\r\n      animate({ action: Action.LEAVE, space: fakesMap, state, scope }); // !\r\n      animate({ action: Action.ENTER, space: insMap, state, scope });\r\n      animate({ action: Action.LEAVE, space: remMap, state, scope });\r\n      animate({ action: Action.UPDATE, space: movMap, state, scope });\r\n      animate({ action: Action.UPDATE, space: stabMap, state, scope });\r\n\r\n      scope.items = items; // !\r\n      scope.itemsMap = itemsMap;\r\n      scope.fromApi = false;\r\n      hasChanges && forceUpdate(); // !\r\n    };\r\n\r\n    if (inChain) {\r\n      scope.pending = () => state.defer(() => start(nextItems));\r\n    } else {\r\n      start(nextItems);\r\n    }\r\n  }, [items]);\r\n\r\n  useLayoutEffect(() => {\r\n    const offs: Array<Callback> = [];\r\n\r\n    offs.push(\r\n      api.on('item-end', e => handleItemEnd(e, scope)),\r\n      api.on('series-end', () => handleSeriesEnd(update, state, scope)),\r\n    );\r\n\r\n    return () => offs.forEach(x => x());\r\n  }, []);\r\n\r\n  useLayoutEffect(() => () => api.cancel(), []);\r\n\r\n  return [transition, api];\r\n}\r\n\r\ntype SetupOptions<T extends string, I = unknown> = {\r\n  items: Array<I>;\r\n  getKey: KeyExtractor<I>;\r\n  state: SharedState<T>;\r\n} & Pick<Scope<T, I>, 'configurator' | 'ctrlsMap'>;\r\n\r\nfunction setup<T extends string, I = unknown>(options: SetupOptions<T, I>) {\r\n  const { items, getKey, configurator, state, ctrlsMap } = options;\r\n  const itemsMap = new Map<ElementKey, I>();\r\n  const ctrls = items.map((item, idx) => {\r\n    const key = getKey(item);\r\n\r\n    itemsMap.set(key, item);\r\n\r\n    return getController<T, I>({ idx, item, getKey, configurator, state, ctrlsMap });\r\n  });\r\n\r\n  return { ctrls, itemsMap };\r\n}\r\n\r\ntype GetControllerOptions<T extends string, I = unknown> = {\r\n  idx: number;\r\n  item: I;\r\n} & Pick<SetupOptions<T, I>, 'getKey' | 'configurator' | 'state' | 'ctrlsMap'>;\r\n\r\nfunction getController<T extends string, I = unknown>(options: GetControllerOptions<T, I>) {\r\n  const { idx, item, getKey, configurator, state, ctrlsMap } = options;\r\n  const key = getKey(item);\r\n  const ctrl = ctrlsMap.get(key) || new Controller<T, I>(state);\r\n\r\n  prepare({ ctrl, key, idx, item, configurator });\r\n  ctrlsMap.set(key, ctrl);\r\n\r\n  return ctrl;\r\n}\r\n\r\nfunction extractKeys<I = unknown>(prevItems: Array<I>, nextItems: Array<I>, getKey: KeyExtractor<I>) {\r\n  const prevKeys: Array<ElementKey> = [];\r\n  const nextKeys: Array<ElementKey> = [];\r\n  const prevKeysMap: Record<ElementKey, boolean> = {};\r\n  const nextKeysMap: Record<ElementKey, boolean> = {};\r\n  const max = Math.max(prevItems.length, nextItems.length);\r\n\r\n  for (let i = 0; i < max; i++) {\r\n    const prevItem = prevItems[i];\r\n    const nextItem = nextItems[i];\r\n\r\n    if (prevItem) {\r\n      const prevKey = getKey(prevItem);\r\n\r\n      if (!prevKeysMap[prevKey]) {\r\n        prevKeysMap[prevKey] = true;\r\n        prevKeys.push(prevKey);\r\n      }\r\n    }\r\n\r\n    if (nextItem) {\r\n      const nextKey = getKey(nextItem);\r\n\r\n      if (!nextKeysMap[nextKey]) {\r\n        nextKeysMap[nextKey] = true;\r\n        nextKeys.push(nextKey);\r\n      }\r\n    }\r\n  }\r\n\r\n  return {\r\n    prevKeys,\r\n    nextKeys,\r\n    prevKeysMap,\r\n    nextKeysMap,\r\n  };\r\n}\r\n\r\nfunction diff<I = unknown>(prevItems: Array<I>, nextItems: Array<I>, getKey: KeyExtractor<I>) {\r\n  const { prevKeys, nextKeys, prevKeysMap, nextKeysMap } = extractKeys(prevItems, nextItems, getKey);\r\n  let size = Math.max(prevKeys.length, nextKeys.length);\r\n  let p = 0;\r\n  let n = 0;\r\n  let hasChanges = false;\r\n  const insMap = new Map<ElementKey, number>();\r\n  const remMap = new Map<ElementKey, number>();\r\n  const movMap = new Map<ElementKey, number>();\r\n  const stabMap = new Map<ElementKey, number>();\r\n  const replaced = new Set<ElementKey>();\r\n\r\n  for (let i = 0; i < size; i++) {\r\n    const nextKey = nextKeys[i - n] ?? null;\r\n    const prevKey = prevKeys[i - p] ?? null;\r\n\r\n    if (nextKey !== prevKey) {\r\n      if (nextKey !== null && !prevKeysMap[nextKey]) {\r\n        if (prevKey !== null && !nextKeysMap[prevKey]) {\r\n          insMap.set(nextKey, i);\r\n          remMap.set(prevKey, i);\r\n          replaced.add(prevKey);\r\n          hasChanges = true;\r\n        } else {\r\n          insMap.set(nextKey, i);\r\n          hasChanges = true;\r\n          p++;\r\n          size++;\r\n        }\r\n      } else if (!nextKeysMap[prevKey]) {\r\n        remMap.set(prevKey, i);\r\n        hasChanges = true;\r\n        n++;\r\n        size++;\r\n      } else if (nextKeysMap[prevKey] && nextKeysMap[nextKey]) {\r\n        movMap.set(nextKey, i);\r\n        hasChanges = true;\r\n      }\r\n    } else if (nextKey !== null) {\r\n      stabMap.set(nextKey, i);\r\n    }\r\n  }\r\n\r\n  return {\r\n    hasChanges,\r\n    insMap,\r\n    remMap,\r\n    movMap,\r\n    stabMap,\r\n    replaced,\r\n  };\r\n}\r\n\r\ntype AnimateOptions<T extends string, I = unknown> = {\r\n  action: Action;\r\n  space: Map<ElementKey, number>;\r\n  state: SharedState<T>;\r\n  scope: Scope<T, I>;\r\n};\r\n\r\nfunction animate<T extends string, I = unknown>(options: AnimateOptions<T, I>) {\r\n  const { space, action, state, scope } = options;\r\n  const { configurator, ctrlsMap, fakesMap } = scope;\r\n  const ctrls = state.getCtrls();\r\n  const isEnter = action === Action.ENTER;\r\n  const isLeave = action === Action.LEAVE;\r\n  let $idx = 0;\r\n\r\n  for (const [key, idx] of space) {\r\n    const ctrl = ctrlsMap.get(key);\r\n    const item = ctrl.getItem();\r\n    const config = configurator(idx, item);\r\n    const { trail } = config;\r\n    const to = isLeave && !config[action] ? config.from : config[action];\r\n    let $ctrl = ctrl;\r\n\r\n    if (isEnter) {\r\n      const isReplaced = ctrl.getIsReplaced();\r\n      const isPlaying = state.detectIsPlaying(key);\r\n\r\n      if (isReplaced) {\r\n        if (isPlaying) {\r\n          const fake = new Controller<T, I>(state);\r\n          const fakeKey = fake.markAsFake(key);\r\n\r\n          $ctrl = fake;\r\n          prepare({ ctrl: fake, key: fakeKey, idx, item, configurator });\r\n          ctrlsMap.set(fakeKey, fake);\r\n          fakesMap.set(fakeKey, idx);\r\n          ctrls.push(fake);\r\n        } else {\r\n          ctrl.setIsReplaced(false);\r\n        }\r\n      }\r\n    }\r\n\r\n    to && withTrail(() => $ctrl.start(() => ({ to })), $idx, trail);\r\n    $idx++;\r\n  }\r\n}\r\n\r\nfunction withTrail(fn: () => void, idx: number, trail?: number) {\r\n  if (detectIsNumber(trail)) {\r\n    setTimeout(fn, idx * trail);\r\n  } else {\r\n    fn();\r\n  }\r\n}\r\n\r\ntype PrepareOptions<T extends string, I = unknown> = {\r\n  ctrl: Controller<T, I>;\r\n  idx: number;\r\n  key: ElementKey;\r\n  item: I;\r\n  configurator: TransitionConfiguratorFn<T, I>;\r\n};\r\n\r\nfunction prepare<T extends string, I = unknown>(options: PrepareOptions<T, I>) {\r\n  const { ctrl, key, idx, item, configurator } = options;\r\n  const { from, enter, config } = configurator(idx, item);\r\n  const $configurator: ConfiguratorFn<T> = (idx: number) => {\r\n    const { enter, leave, update, trail, ...rest } = configurator(idx, item);\r\n\r\n    return { ...rest };\r\n  };\r\n\r\n  ctrl.setKey(key);\r\n  ctrl.setIdx(idx);\r\n  ctrl.setItem(item);\r\n  ctrl.setFrom(from);\r\n  ctrl.setTo(enter);\r\n  ctrl.setSpringConfigFn(config);\r\n  ctrl.setConfigurator($configurator);\r\n}\r\n\r\nfunction handleItemEnd<T extends string, I = unknown>({ key }: AnimationEventValue<T>, scope: Scope<T, I>) {\r\n  const { ctrlsMap, fakesMap, itemsMap, hasReplaces, queue, fromApi } = scope;\r\n\r\n  if (ctrlsMap.has(key) && ctrlsMap.get(key).detectIsFake()) {\r\n    ctrlsMap.delete(key);\r\n    fakesMap.delete(key);\r\n  }\r\n\r\n  if (fromApi || hasReplaces) {\r\n    !itemsMap.has(key) && ctrlsMap.delete(key);\r\n  } else {\r\n    queue.push(() => !scope.itemsMap.has(key) && ctrlsMap.delete(key));\r\n  }\r\n}\r\n\r\nfunction handleSeriesEnd<T extends string, I = unknown>(update: () => void, state: SharedState<T>, scope: Scope<T, I>) {\r\n  const { ctrlsMap, configurator, fromApi } = scope;\r\n  const ctrls: Array<Controller<T, I>> = [];\r\n\r\n  if (fromApi) return;\r\n  scope.queue.forEach(x => x());\r\n  scope.queue = [];\r\n\r\n  for (const [_, ctrl] of ctrlsMap) {\r\n    const { enter } = configurator(ctrl.getIdx(), ctrl.getItem());\r\n\r\n    ctrl.replaceValue({ ...enter });\r\n    ctrl.notify();\r\n    ctrls.push(ctrl);\r\n  }\r\n\r\n  state.setCtrls(ctrls);\r\n  update();\r\n}\r\n\r\ntype Scope<T extends string, I = unknown> = {\r\n  items: Array<I>;\r\n  configurator: TransitionConfiguratorFn<T, I>;\r\n  ctrlsMap: Map<ElementKey, Controller<T, I>>;\r\n  itemsMap: Map<ElementKey, I>;\r\n  fakesMap: Map<ElementKey, number>;\r\n  queue: Array<Callback>;\r\n  hasReplaces: boolean;\r\n  fromApi: boolean;\r\n  inChain: boolean;\r\n  pending: Callback;\r\n};\r\n\r\nenum Action {\r\n  ENTER = 'enter',\r\n  LEAVE = 'leave',\r\n  UPDATE = 'update',\r\n}\r\n\r\ntype KeyExtractor<I> = (x: I) => ElementKey;\r\n\r\ntype TransitionElement = Component | TagVirtualNodeFactory;\r\n\r\ntype TransitionConfiguratorFn<T extends string = string, I = unknown> = (\r\n  idx: number,\r\n  item: I,\r\n) => TransitionItemConfig<T>;\r\n\r\nexport type TransitionApi<T extends string = string> = Omit<SpringApi<T>, 'reset'>;\r\n\r\nexport type TransitionRenderFn<T extends string = string, I = unknown> = (options: {\r\n  spring: Spring<T>;\r\n  item: I;\r\n  idx: number;\r\n}) => TransitionElement;\r\n\r\nexport type TransitionFn<T extends string = string, I = unknown> = (render: TransitionRenderFn<T, I>) => Component;\r\n\r\nexport { useTransition };\r\n","import {\r\n  type Component,\r\n  type TagVirtualNodeFactory,\r\n  type Callback,\r\n  component,\r\n  useMemo,\r\n  useInsertionEffect,\r\n  $$scope,\r\n  walk,\r\n  nextTick,\r\n} from '@dark-engine/core';\r\n\r\nimport { type SpringValue } from '../shared';\r\nimport { type Spring } from '../spring';\r\n\r\ntype AnimatedProps<E = unknown, T extends string = string> = {\r\n  spring: Spring<T>;\r\n  fn: StyleFn<E, T>;\r\n  slot: Component | TagVirtualNodeFactory;\r\n};\r\n\r\nconst Animated = component<AnimatedProps>(({ spring, fn, slot }) => {\r\n  const cursor = $$scope().getCursorFiber();\r\n  const scope = useMemo<Scope>(() => ({ element: null, notify: null }), []);\r\n  const notify = () => scope.element && fn(scope.element, spring.value());\r\n\r\n  scope.notify = notify;\r\n\r\n  useInsertionEffect(() => {\r\n    const make = () => {\r\n      const fiber = cursor.hook.owner;\r\n\r\n      walk(fiber.child, (fiber, _, stop) => {\r\n        if (fiber.element) {\r\n          scope.element = fiber.element;\r\n          return stop();\r\n        }\r\n      });\r\n\r\n      notify();\r\n    };\r\n\r\n    if ($$scope().getIsHydrateZone()) {\r\n      nextTick(make);\r\n    } else {\r\n      make();\r\n    }\r\n\r\n    return spring.on(() => scope.notify());\r\n  }, [spring]);\r\n\r\n  notify();\r\n\r\n  return slot;\r\n});\r\n\r\ntype Scope = { element: unknown; notify: Callback };\r\ntype StyleFn<E = unknown, T extends string = string> = (element: E, value: SpringValue<T>) => void;\r\n\r\nexport { Animated };\r\n","import { type DarkElement, component, useMemo, useRef, useLayoutEffect } from '@dark-engine/core';\r\nimport { useLocation } from '@dark-engine/web-router';\r\nimport { styled } from '@dark-engine/styled';\r\nimport { type SpringValue, Animated, useTransition } from '@dark-engine/animations';\r\n\r\ntype PageTransitionProps = {\r\n  slot: DarkElement;\r\n};\r\n\r\nconst PageTransition = component<PageTransitionProps>(({ slot }) => {\r\n  const { pathname } = useLocation();\r\n  const scope = useMemo(() => ({ pathname, slots: {} }), []);\r\n  const items = useMemo(() => [pathname], [pathname]);\r\n  const rootRef = useRef<HTMLDivElement>();\r\n  const [transition, api] = useTransition(\r\n    items,\r\n    x => x,\r\n    () => ({\r\n      from: { y: 100, opacity: 0, scale: 1 },\r\n      enter: { y: 0, opacity: 0, scale: 1 },\r\n      leave: { y: 0, opacity: 0.4, scale: 0.8 },\r\n      config: () => ({ tension: 45, friction: 28, mass: 5 }),\r\n    }),\r\n  );\r\n\r\n  scope.pathname = pathname;\r\n  scope.slots[pathname] = slot;\r\n\r\n  useLayoutEffect(() => {\r\n    const node = rootRef.current;\r\n    const fns = [\r\n      api.on('series-start', () => node.style.setProperty('pointer-events', 'none')),\r\n      api.on('item-change', x => {\r\n        if (scope.pathname === x.key && x.value.y < 5) {\r\n          node.removeAttribute('style');\r\n        }\r\n      }),\r\n    ];\r\n\r\n    return () => fns.forEach(x => x());\r\n  }, []);\r\n\r\n  return (\r\n    <div ref={rootRef}>\r\n      {transition(({ spring, item }) => {\r\n        return (\r\n          <Animated spring={spring} fn={styleFn}>\r\n            <Item>{scope.slots[item]}</Item>\r\n          </Animated>\r\n        );\r\n      })}\r\n    </div>\r\n  );\r\n});\r\n\r\nconst styleFn = (element: HTMLDivElement, value: SpringValue<'y' | 'opacity' | 'scale'>) => {\r\n  element.style.setProperty('transform', `translate3d(0, ${value.y}vh, 0) scale(${value.scale})`);\r\n  element.style.setProperty('--opacity', `${value.opacity}`);\r\n};\r\n\r\nconst Item = styled.div`\r\n  position: absolute;\r\n  width: 100%;\r\n  min-height: 100vh;\r\n  background-color: #fff;\r\n\r\n  &::after {\r\n    content: '';\r\n    position: absolute;\r\n    inset: 0;\r\n    width: 100%;\r\n    height: 100%;\r\n    background-color: rgba(0, 0, 0, var(--opacity));\r\n    pointer-events: none;\r\n  }\r\n`;\r\n\r\nexport { PageTransition };\r\n","import { component, lazy, Suspense, type DarkElement } from '@dark-engine/core';\r\nimport { createRoot } from '@dark-engine/platform-browser';\r\nimport { type Routes, Router, NavLink } from '@dark-engine/web-router';\r\nimport { createGlobalStyle } from '@dark-engine/styled';\r\n\r\nimport { PageTransition } from './page-transition';\r\n\r\nconst Home = lazy(() => import('./home'));\r\nconst About = lazy(() => import('./about'));\r\nconst Contacts = lazy(() => import('./contacts'));\r\nconst routes: Routes = [\r\n  {\r\n    path: 'home',\r\n    component: Home,\r\n  },\r\n  {\r\n    path: 'about',\r\n    component: About,\r\n  },\r\n  {\r\n    path: 'contacts',\r\n    component: Contacts,\r\n  },\r\n  {\r\n    path: '**',\r\n    redirectTo: 'home',\r\n  },\r\n];\r\n\r\ntype ShellProps = {\r\n  slot: DarkElement;\r\n};\r\n\r\nconst Shell = component<ShellProps>(({ slot }) => {\r\n  return (\r\n    <PageTransition>\r\n      <header>\r\n        <NavLink to='/home'>Home</NavLink>\r\n        <NavLink to='/about'>About</NavLink>\r\n        <NavLink to='/contacts'>Contacts</NavLink>\r\n      </header>\r\n      <Suspense fallback={<Spinner />}>\r\n        <main>{slot}</main>\r\n      </Suspense>\r\n    </PageTransition>\r\n  );\r\n});\r\n\r\nconst App = component(() => {\r\n  return (\r\n    <>\r\n      <GlobalStyle />\r\n      <Router routes={routes} baseURL='/dark/next/spring-routes/'>{slot => <Shell>{slot}</Shell>}</Router>\r\n    </>\r\n  );\r\n});\r\n\r\nconst Spinner = component(() => <div>Loading...</div>);\r\n\r\nconst GlobalStyle = createGlobalStyle`\r\n  * {\r\n      box-sizing: border-box;\r\n    }\r\n\r\n  html {\r\n    font-size: 14px;\r\n  }\r\n\r\n  html, body {\r\n    width: 100%;\r\n    height: 100%;\r\n    margin: 0;\r\n    padding: 0;\r\n  }\r\n\r\n  body {\r\n    font-family: 'Roboto';\r\n    background-color: #3949AB;\r\n    overflow-y: scroll;\r\n    overflow-x: hidden;\r\n  }\r\n\r\n  header {\r\n    width: 100%;\r\n    background-color: #03a9f4;\r\n    padding: 6px;\r\n    color: #fff;\r\n    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);\r\n    display: flex;\r\n    align-items: center;\r\n  }\r\n\r\n  header a {\r\n    color: #fff;\r\n    text-transform: uppercase;\r\n    font-size: 0.9rem;\r\n  }\r\n\r\n  header a:hover {\r\n    color: #fff59d;\r\n  }\r\n  \r\n  main {\r\n    width: 100%;\r\n    padding: 16px;\r\n    display: flex;\r\n  }\r\n\r\n  a {\r\n    margin: 4px;\r\n    text-decoration: none;\r\n    transition: color 0.2s ease-in-out;\r\n  }\r\n\r\n  h1 {\r\n    margin: 0;\r\n    margin-bottom: 16px;\r\n  }\r\n\r\n  img {\r\n    width: 600px;\r\n    min-height: 300px;\r\n    max-width: 100%;\r\n    margin: 20px auto;\r\n    background-color: #eeeeee;\r\n    object-fit: cover;\r\n  }\r\n\r\n  article {\r\n    margin: 0 auto;\r\n    max-width: 1024px;\r\n    display: flex;\r\n    flex-flow: column nowrap;\r\n  }\r\n\r\n  #root {\r\n    width: 100%;\r\n    height: 100%;\r\n    display: grid;\r\n    grid-template-rows: 48px 1fr;\r\n  }\r\n\r\n  .active-link {\r\n    color: #ffeb3b;\r\n    text-decoration: underline;\r\n  }\r\n\r\n  .active-link:hover {\r\n    color: #ffeb3b;\r\n  }\r\n\r\n  p {\r\n    line-height: 2;\r\n  }\r\n`;\r\n\r\ncreateRoot(document.getElementById('root')).render(<App />);\r\n","import { type DarkElement, unmountRoot } from '@dark-engine/core';\r\n\r\nimport { render, roots } from '../render';\r\nimport type { TagNativeElement } from '../native-element';\r\n\r\nfunction createRoot(container: TagNativeElement) {\r\n  return {\r\n    render: (element: DarkElement) => render(element, container),\r\n    unmount: () => unmount(container),\r\n  };\r\n}\r\n\r\nfunction unmount(container: TagNativeElement) {\r\n  const rootId = roots.get(container);\r\n\r\n  unmountRoot(rootId, () => {\r\n    roots.delete(container);\r\n    container.innerHTML = '';\r\n  });\r\n}\r\n\r\nexport { createRoot, unmount };\r\n"],"names":["inProgress","dataWebpackPrefix","$$inject","Symbol","Component","type","props","ref","token","displayName","shouldUpdate","children","constructor","this","component","options","$token","factory","defaultInject","detectIsComponent","x","getComponentKey","hasComponentFlag","inst","flag","Boolean","ROOT","REPLACER","INDEX_KEY","KEY_ATTR","REF_ATTR","CREATE_EFFECT_TAG","UPDATE_EFFECT_TAG","DELETE_EFFECT_TAG","SKIP_EFFECT_TAG","INSERTION_EFFECT_HOST_MASK","LAYOUT_EFFECT_HOST_MASK","ASYNC_EFFECT_HOST_MASK","ATOM_HOST_MASK","PORTAL_HOST_MASK","SHADOW_MASK","FLUSH_MASK","MOVE_MASK","HOOK_DELIMETER","YIELD_INTERVAL","TaskPriority","Flag","ATTR_BLACK_LIST","SKIP_SCAN_OPT","MEMO_SLOT_OPT","STATIC_SLOT_OPT","jsx","element","key","$props","slot","as","length","detectIsFunction","o","detectIsUndefined","detectIsNumber","detectIsString","detectIsTextBased","detectIsObject","detectIsBoolean","detectIsArray","Array","isArray","detectIsNull","detectIsEmpty","detectIsFalsy","detectIsPromise","Promise","getTime","Date","now","dummyFn","trueFn","falseFn","sameFn","error","args","console","flatten","source","transform","list","stack","idx","pop","i","push","keyBy","fn","value","reduce","acc","detectAreDepsDifferent","prevDeps","nextDeps","max","Math","Object","is","nextTick","callback","resolve","then","createIndexKey","mapRecord","record","keys","map","$$vNode","ATTR_TYPE","VirtualNode","TagVirtualNode","name","attrs","super","NodeType","TAG","TextVirtualNode","TEXT","String","CommentVirtualNode","text","COMMENT","View","_void","Text","from","detectIsTextVirtualNode","detectIsVirtualNode","vNode","detectIsTagVirtualNode","detectIsCommentVirtualNode","detectIsVirtualNodeFactory","getTagVirtualNodeKey","hasTagVirtualNodeFlag","getVirtualNodeFactoryKey","hasVirtualNodeFactoryFlag","detectIsPlainVirtualNode","createReplacer","detectIsReplacer","getElementKey","hasElementFlag","getElementType","hasChildrenProp","detectAreSameInstanceTypes","prevInst","nextInst","isComponentFactories","nc","detectAreSameComponentTypesWithSameKeys","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","m","d","definition","defineProperty","enumerable","get","f","e","chunkId","all","promises","u","g","globalThis","Function","window","obj","prop","prototype","hasOwnProperty","call","l","url","done","script","needAttach","scripts","document","getElementsByTagName","s","getAttribute","createElement","charset","timeout","setAttribute","src","onScriptComplete","prev","event","onerror","onload","clearTimeout","doneFns","parentNode","removeChild","forEach","setTimeout","bind","target","head","appendChild","r","toStringTag","scriptUrl","importScripts","location","currentScript","Error","replace","p","installedChunks","j","installedChunkData","promise","reject","errorType","realSrc","message","request","webpackJsonpCallback","parentChunkLoadingFunction","data","chunkIds","moreModules","runtime","some","id","chunkLoadingGlobal","self","$$fragment","Fragment","detectIsFragment","instance","defaultRealisation","platform","insertElement","raf","caf","spawn","commit","finishCommit","detectIsDynamic","detectIsPortal","unmountPortal","chunk","detectIsServer","EventEmitter","subscribers","Map","on","has","set","Set","add","delete","emit","kill","__getSize","size","Scope","root","wip","cursor","unit","mountDeep","mountLevel","mountNav","events","unsubs","actions","candidates","deletions","cancels","asyncEffects","layoutEffects","insertionEffects","resourceId","resources","defers","setPendingStatus","isLayoutEffectsZone","isInsertionEffectsZone","isUpdateZone","isBatchZone","isHydrateZone","isStreamZone","isTransitionZone","isEventZone","isHot","isDynamic","isServer","emitter","resetActions","getActionsById","addActionMap","insert","remove","move","stable","addReplaceAction","nextKey","addInsertAction","addRemoveAction","prevKey","addMoveAction","addStableAction","copy","scope","getRoot","setRoot","fiber","keepRoot","getWorkInProgress","setWorkInProgress","getNextUnitOfWork","setNextUnitOfWork","getCursorFiber","setCursorFiber","navToChild","navToSibling","navToParent","navToPrev","getMountIndex","setMountDeep","getMountDeep","resetMount","getEvents","addEventUnsubscriber","unsubscribeEvents","getCandidates","addCandidate","resetCandidates","getDeletions","hasDeletion","nextFiber","parent","addDeletion","resetDeletions","addAsyncEffect","resetAsyncEffects","runAsyncEffects","effects","addLayoutEffect","resetLayoutEffects","runLayoutEffects","setIsLayoutEffectsZone","addInsertionEffect","resetInsertionEffects","runInsertionEffects","setIsInsertionEffectsZone","addCancel","applyCancels","resetCancels","getIsLayoutEffectsZone","getIsInsertionEffectsZone","getIsUpdateZone","setIsUpdateZone","getIsBatchZone","setIsBatchZone","getIsHydrateZone","setIsHydrateZone","getIsStreamZone","setIsStreamZone","getIsTransitionZone","setIsTransitionZone","getIsEventZone","setIsEventZone","getIsHot","setIsHot","getPendingStatusSetter","setPendingStatusSetter","flush","getEmitter","defer","getDefers","resetDefers","getResource","setResource","res","getResources","getResourceId","setResourceId","getNextResourceId","runAfterCommit","rootId","scopes","getRootId","setRootId","replaceScope","assign","$$scope","Fiber","cc","cec","eidx","mask","tag","child","next","alt","hook","provider","atoms","marker","batch","catch","nextId","mutate","markHost","increment","count","force","$scope","wipFiber","stop","setError","err","setNextId","static","Hook","values","owner","$$memo","defaultShouldUpdate","nextProps","detectIsMemo","walk","onWalk","shouldDeep","shouldStop","skip","collectElements","elements","getFiberWithElement","$fiber","detectIsFiberAlive","buildChildNodes","onNode","getKey","buildChildNode","altMap","startEidx","prevIdx","nextIdx","left","right","isFirst","isLast","notifyParents","Memo","memo","getValue","n","deps","state","$value","detectIsElement","$$useEffect","createEffect","useEffect","effect","cleanup","isInsertionEffect","EffectType","INSERTION","isLayoutEffect","LAYOUT","isAsyncEffect","ASYNC","runEffect","dropEffects","$$useInsertionEffect","useInsertionEffect","dropInsertionEffects","$$useLayoutEffect","dropLayoutEffects","combinedMask","shouldUnmountFiber","unmountFiber","_","workLoop","isAsync","shouldYield","hasMoreWork","performUnitOfWork","scheduler","hasPrimaryTask","fork","unmounts","diff","parentFiber","isRight","sync","isDeepWalking","isStream","hasChildren","$inst","createFiber","getAlternate","share","mountChild","mountSibling","shouldMount","pc","mount","hasSameCount","prevKeys","nextKeys","prevKeysMap","nextKeysMap","keyedFibersMap","usedKeysMap","extractKeys","prevKeyFiber","tryOptStaticSlot","hasMove","hasRemove","hasInsert","hasReplace","detectIsStableMemoTree","tryOptMov","tryOptRem","tryOptMemoSlot","reconcile","isUpdate","setup","getHook","isChild","parentId","isMove","isStable","isComponent","result","supportConditional","cancel","$fork","cancelTask","setValue","resetValue","$tools","MessageChannel","port1","port2","MessagePort","channel","offs","off","postMessage","unref","Task","priority","forceAsync","isTransition","isPending","isUnnecessary","taskRestorer","locationCreator","pendingSetter","nextTaskId","getPriority","getForceAsync","setIsTransition","getIsTransition","run","pending","markAsPending","canPending","markAsUnnecessary","getIsUnnecessary","setTaskRestorer","setLocationCreator","createLocation","setPendingSetter","detectHasRelatedUpdate","loc","tasks","deep","$loc","split","$$loc","indexOf","createRootLocation","queue","deadline","task","scheduledCallback","isMessageLoopRunning","port","performWorkUntilDeadline","reset","schedule","put","execute","high","normal","low","getQueues","hasPrimary","hasLow","complete","filter","splice","pick","shift","requestCallbackAsync","requestCallback","finally","unshift","createUpdate","tools","hasTools","isBatch","isEvent","restore","fromRestore","createCallback","callbackOptions","createHookLocation","change","timer","changes","addBatch","createContext","defaultValue","context","Provider","Consumer","providerValue","subscribe","subscriber","createProvider","createConsumer","getProvider","update","hasProvider","unsubscribe","useCallback","createTools","$shouldUpdate","prevValue","newValue","useState","initialValue","setState","forwardRef","rest","applyRef","current","mutableRef","detectIsMutableRef","$$shadow","Shadow","isInserted","isEnabled","fibers","SuspenseContext","isLoaded","fallback","register","unregister","useSuspense","Suspense","suspense","setIsLoaded","store","content","CONTENT","FALLBACK","useId","getNextId","toString","$$lazy","factories","lazy","$update","make","async","default","load","svgTagNames","voidTagNames","SyntheticEvent","sourceEvent","propagation","stopPropagation","preventDefault","getPropagation","delegateEvent","eventName","handler","eventsMap","handlersMap","$handler","slice","rootHandler","$event","parentElement","dispatchEvent","WeakMap","addEventListener","removeEventListener","detectIsEvent","attrName","startsWith","getEventName","toLowerCase","$$portal","container","innerHTML","getPortalContainer","INPUT_TAG","TEXTAREA_TAG","CLASS_NAME_ATTR","CLASS_ATTR","STYLE_ATTR","VALUE_ATTR","AS_ATTR","EXCLUDE_ATTR_MARK","DANGER_HTML_CONTENT","moves","patches","createNativeElementMap","detectIsSvgElement","createElementNS","createTextNode","createComment","createNativeElement","node","performAttribute","tagElement","nextAttrValue","prevAttrValue","style","setProperty","setObjectStyle","removeAttribute","ATTR_TRANSFORM_MAP","readonly","patchProperties","tagName","attrValue","specialCasesMap","$attrName","getPrototypeOf","descriptor","getOwnPropertyDescriptor","canSetProperty","includes","checked","innerText","commitMap","childNodes","nativeElement","DocumentType","nextSibling","splitText","nodeName","appendNativeElement","insertNativeElement","attrNames","attribute","addAttributes","commitCreation","sourceNodes","sourceFragment","DocumentFragment","elementIdx","removeNativeElement","replaceNativeElement","prevInstance","nextInstance","textContent","prevNode","nextNode","prevAttrs","nextAttrs","getAttributeNames","updateAttributes","commitUpdate","canRemoveNativeElement","sibling","insertBefore","insertNativeElementByIndex","candidate","replaceChild","isBrowser","roots","requestAnimationFrame","cancelAnimationFrame","isInjected","SLASH_MARK","WILDCARD_MARK","PROTOCOL_MARK","SEARCH_MARK","HASH_MARK","ROOT_MARK","ActiveRouteContext","useActiveRouteContext","RouterHistoryContext","CurrentPathContext","checkContextValue","Link","to","class","cn1","className","cn2","onClick","history","useHistory","handleClick","useEvent","href","useLocation","active","pipe","fns","fn1","fn2","parseURL","body","protocol","host","pathname","hash","search","arr","splitted","findIndex","idx1","join","createSearch","createHash","detectIsParam","splitBySlash","startSlash","normalizePath","reduceSlashes","replaceAll","RegExp","NavLink","isMatch","$to","$hash","detectIsMatch","trim","cm","Route","path","pathMatch","level","redirectTo","prefix","rootPath","createRootPath","prefixedPath","createPrefixedPath","createRoutes","route","getRoute","getPath","render","nextRoute","routes","$routes","$route","redirect","find","canRender","createMatcher","space","a","b","segment","isWildcard","isParam","$prefix","resolveRoute","$match","matcher","match","$wildcard","detectIsMatchAsWildcard","selector","compare","sort","wildcard","params","getParamsMap","merge","h","parts","param","$path","mergePaths","detectIsWildcard","RouterLocation","charCodeAt","freeze","createRouterLocation","RouterHistory","fromHistory","dispose","$url","getState","replaceState","createStateBox","handleEvent","mapSubscribers","clear","STATE_KEY","syncHistory","action","box","HistoryAction","PUSH","pushState","REPLACE","forward","go","back","delta","$delta","Router","fullURL","baseURL","sourceRoutes","sourceURL","setLocation","createRouterHistory","$slot","historyContext","routerContext","candidateURL","url1","search1","hash1","url2","search2","hash2","prevURL","nextURL","isDifferent","createHandle","navigateTo","useImperativeHandle","STYLED_ATTR","COMPONENTS_ATTR_VALUE","DOT_MARK","MEDIA_QUERY_MARK","CONTAINER_QUERY_MARK","getElement","querySelector","getElements","querySelectorAll","createStyleElement","setAttr","append","Keyframes","getName","getToken","detectIsKeyframes","Token","normalize","markAsDynamic","detectIsToken","StyleRule","generate","NestingRule","styles","keyframes","$styles","__","___","$keyframes","MediaQueryRule","nesting","$nesting","ContainerQueryRule","KeyframesRule","FunctionRule","end","isSealed","seal","getIsSealed","getEnd","styleExp","media","detectIsStyleSheet","$media","$container","StyleSheet","detectIsStyleRule","detectIsNestingRule","detectIsMediaQueryRule","detectIsContainerQueryRule","detectIsKeyframesRule","detectIsFunctionRule","ThemeContext","useTheme","STYLE_LEVEL","theme","ManagerContext","useManager","detectIsPropName","css","last","detectHasMediaQueryMark","detectHasContainerQueryMark","char","manager","detectHasSingleLineCommentEndMark","endsWith","detectHasMultiLineCommentStartMark","detectHasMultiLineCommentEndMark","detectHasFunctionMark","detectHasUrlFnMark","URL_FN_MARK","detectHasKeyframesMark","sub","substring","createEnd","cache","injections","$$styled","styled","reuse","createTag","isExtending","detectIsStyled","config","getExtendingConfig","$source","t1","t2","first","$t1","$t2","raw","mergeTemplates","$args","$transform","filterArgs","sheet","sheets","baseName","baseStyle","baseKeyframes","isSwap","$factory","names","keyframesList","classNames","getClassNamesFrom","items","item","uniq","$tag","getTag","collectComponentStyle","setupGlobal","t","createStyledComponent","$sheet","rules","genClassName","rule","isComponentStyle","strings","stylesheet","buffer","fnIdx","isSingleLineComment","isMultiLineComment","isPropValue","isUrl","joined","arg","phash","abs","abbr","address","area","article","aside","audio","base","bdi","bdo","blockquote","br","button","canvas","caption","cite","code","col","colgroup","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","iframe","img","input","ins","kbd","label","legend","li","link","main","mark","menu","meta","meter","nav","noscript","object","ol","optgroup","option","output","picture","pre","progress","q","rp","rt","ruby","samp","section","select","small","span","strong","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","ul","var","video","wbr","circle","clipPath","defs","desc","ellipse","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","image","line","linearGradient","pattern","polygon","polyline","radialGradient","rect","svg","switch","symbol","textPath","tspan","use","view","tag1","tag2","reinject","stylesMap","SharedState","ctrls","flow","Flow","RIGHT","isTrail","isPaused","isCanceled","timerId","getCtrls","setCtrls","setIsTrail","getIsTrail","setFlow","getIsPaused","getIsCanceled","detectIsRightFlow","setIsPlaying","detectIsPlaying","start","pause","resume","delay","resetTimer","subs","completeSeries","defaultSpringConfig","tension","friction","mass","precision","fix","Atom","connections1","connections2","subjects","val","__connect","toJSON","valueOf","disconnect","__addSubject","atom$","__removeSubject","tuple","__notify","WritableAtom","Spring","prop$","setProp","atom","notify","Number","toFixed","stepper","pos","vel","dest","step","nPos","nVel","spring","Controller","frameTime","frameId","results","completed","springConfigFn","configurator","immediate","immediates","primaryKey","isReplaced","setKey","getIdx","setIdx","setFrom","setTo","setSpringConfigFn","setLeft","setRight","setConfigurator","setImmediate","replaceValue","markAsFake","generateFakeKey","detectIsFake","getIsReplaced","setIsReplaced","getItem","setItem","getSpring","config1","config2","play","motion","MAX_SKIPPED_FRAMES","checkCompleted","fakeKey","ctrlsMap","itemsMap","ctrl","prepare","getController","animate","fakesMap","isEnter","Action","ENTER","isLeave","LEAVE","$idx","trail","$ctrl","isPlaying","fake","withTrail","enter","leave","Animated","PageTransition","slots","rootRef","useRef","transition","api","forceUpdate","hasReplaces","fromApi","inChain","chain","nextItems","$items","hasChanges","insMap","remMap","movMap","stabMap","replaced","prevItems","prevItem","nextItem","UPDATE","handleItemEnd","handleSeriesEnd","useTransition","y","opacity","scale","styleFn","Item","Shell","Spinner","App","GlobalStyle","collectGlobalStyle","getElementById","hydrate","isMounted","isHydrate","rootFiber","unmount","onCompleted","unmountRoot"],"sourceRoot":""}