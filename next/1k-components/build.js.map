{"version":3,"file":"build.js","mappings":"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","sources":["webpack://dark-1k-components-app/./node_modules/d3-scale-chromatic/src/colors.js","webpack://dark-1k-components-app/./node_modules/d3-scale-chromatic/src/sequential-multi/viridis.js","webpack://dark-1k-components-app/../../packages/core/src/constants.ts","webpack://dark-1k-components-app/../../packages/core/src/component/component.ts","webpack://dark-1k-components-app/../../packages/core/src/utils/utils.ts","webpack://dark-1k-components-app/../../packages/core/src/platform/platform.ts","webpack://dark-1k-components-app/../../packages/core/src/emitter/emitter.ts","webpack://dark-1k-components-app/../../packages/core/src/scope/scope.ts","webpack://dark-1k-components-app/../../packages/core/src/view/view.ts","webpack://dark-1k-components-app/../../packages/core/src/fiber/fiber.ts","webpack://dark-1k-components-app/../../packages/core/src/memo/memo.ts","webpack://dark-1k-components-app/../../packages/core/src/walk/walk.ts","webpack://dark-1k-components-app/../../packages/core/src/fragment/fragment.ts","webpack://dark-1k-components-app/../../packages/core/src/use-memo/use-memo.ts","webpack://dark-1k-components-app/../../packages/core/src/use-effect/use-effect.ts","webpack://dark-1k-components-app/../../packages/core/src/use-layout-effect/use-layout-effect.ts","webpack://dark-1k-components-app/../../packages/core/src/use-insertion-effect/use-insertion-effect.ts","webpack://dark-1k-components-app/../../packages/core/src/unmount/unmount.ts","webpack://dark-1k-components-app/../../packages/core/src/workloop/workloop.ts","webpack://dark-1k-components-app/../../packages/core/src/scheduler/scheduler.ts","webpack://dark-1k-components-app/../../packages/core/src/use-update/use-update.ts","webpack://dark-1k-components-app/../../packages/core/src/batch/batch.ts","webpack://dark-1k-components-app/../../packages/core/src/element/element.ts","webpack://dark-1k-components-app/../../packages/core/src/ref/ref.ts","webpack://dark-1k-components-app/../../packages/platform-browser/src/portal/portal.ts","webpack://dark-1k-components-app/../../packages/platform-browser/src/events/events.ts","webpack://dark-1k-components-app/../../packages/platform-browser/src/constants.ts","webpack://dark-1k-components-app/../../packages/platform-browser/src/dom/dom.ts","webpack://dark-1k-components-app/../../packages/platform-browser/src/render/render.ts","webpack://dark-1k-components-app/./index.tsx","webpack://dark-1k-components-app/../../packages/core/src/use-state/use-state.ts","webpack://dark-1k-components-app/../../packages/core/src/use-callback/use-callback.ts","webpack://dark-1k-components-app/../../packages/platform-browser/src/create-root/create-root.tsx"],"sourcesContent":["export default function(specifier) {\n  var n = specifier.length / 6 | 0, colors = new Array(n), i = 0;\n  while (i < n) colors[i] = \"#\" + specifier.slice(i * 6, ++i * 6);\n  return colors;\n}\n","import colors from \"../colors.js\";\n\nfunction ramp(range) {\n  var n = range.length;\n  return function(t) {\n    return range[Math.max(0, Math.min(n - 1, Math.floor(t * n)))];\n  };\n}\n\nexport default ramp(colors(\"44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725\"));\n\nexport var magma = ramp(colors(\"00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf\"));\n\nexport var inferno = ramp(colors(\"00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4\"));\n\nexport var plasma = ramp(colors(\"0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921\"));\n","export const VERSION = '0.25.1';\r\nexport const ROOT = 'dark:root';\r\nexport const REPLACER = 'dark:matter';\r\nexport const INDEX_KEY = 'dark:idx';\r\nexport const KEY_ATTR = 'key';\r\nexport const REF_ATTR = 'ref';\r\nexport const CREATE_EFFECT_TAG = 'C';\r\nexport const UPDATE_EFFECT_TAG = 'U';\r\nexport const DELETE_EFFECT_TAG = 'D';\r\nexport const SKIP_EFFECT_TAG = 'S';\r\nexport const INSERTION_EFFECT_HOST_MASK = 1;\r\nexport const LAYOUT_EFFECT_HOST_MASK = 2;\r\nexport const ASYNC_EFFECT_HOST_MASK = 4;\r\nexport const ATOM_HOST_MASK = 8;\r\nexport const PORTAL_HOST_MASK = 16;\r\nexport const SHADOW_MASK = 32;\r\nexport const FLUSH_MASK = 64;\r\nexport const MOVE_MASK = 128;\r\nexport const HOOK_DELIMETER = ':';\r\nexport const YIELD_INTERVAL = 6;\r\nexport const APP_STATE_ATTR = 'dark-app-state';\r\n\r\nexport enum TaskPriority {\r\n  LOW = 0,\r\n  NORMAL = 1,\r\n  HIGH = 2,\r\n}\r\n\r\nexport enum Flag {\r\n  SKIP_SCAN_OPT = '__skipScanOpt',\r\n  MEMO_SLOT_OPT = '__memoSlotOpt',\r\n  STATIC_SLOT_OPT = '__staticSlotOpt',\r\n}\r\n\r\nexport const FLAGS = {\r\n  __skipScanOpt: true,\r\n  __memoSlotOpt: true,\r\n  __staticSlotOpt: true,\r\n};\r\n\r\nexport const ATTR_BLACK_LIST = {\r\n  [KEY_ATTR]: true,\r\n  [REF_ATTR]: true,\r\n  [Flag.SKIP_SCAN_OPT]: true,\r\n  [Flag.MEMO_SLOT_OPT]: true,\r\n  [Flag.STATIC_SLOT_OPT]: true,\r\n};\r\n","import type { ElementKey, Instance, DarkElement, RefProps, KeyProps, FlagProps } from '../shared';\r\nimport { KEY_ATTR } from '../constants';\r\nimport { error } from '../utils';\r\nimport { type Ref } from '../ref';\r\n\r\nconst $$inject = Symbol('inject');\r\nclass Component<P extends StandardComponentProps = any, R = any> {\r\n  public type: CreateElement<P>;\r\n  public props: P;\r\n  public ref?: Ref<R>;\r\n  public token?: Symbol;\r\n  public displayName?: string;\r\n  public shouldUpdate?: ShouldUpdate<P>;\r\n  public children: Array<Instance> = [];\r\n\r\n  constructor(\r\n    type: CreateElement<P>,\r\n    token: Symbol,\r\n    props: P,\r\n    ref: Ref<R>,\r\n    shouldUpdate: ShouldUpdate<P>,\r\n    displayName: string,\r\n  ) {\r\n    this.type = type;\r\n    this.props = props;\r\n    ref && (this.ref = ref);\r\n    token && (this.token = token);\r\n    shouldUpdate && (this.shouldUpdate = shouldUpdate);\r\n    displayName && (this.displayName = displayName);\r\n  }\r\n}\r\n\r\nfunction component<P extends object, R = unknown>(type: CreateElement<P, R>, options: ComponentOptions = {}) {\r\n  const { token: $token, displayName } = options;\r\n  type Props = P & StandardComponentProps;\r\n  const factory: ComponentFactoryWithPossiblyInject<Props, R> = (props = {} as Props, ref?: Ref<R>) => {\r\n    const { token = $token, shouldUpdate } = factory[$$inject] || defaultInject;\r\n\r\n    if (props.ref) {\r\n      delete props.ref;\r\n\r\n      if (process.env.NODE_ENV !== 'production') {\r\n        process.env.NODE_ENV === 'development' &&\r\n          error(`[Dark]: To use ref you need to wrap the component with forwardRef!`);\r\n      }\r\n    }\r\n\r\n    return new Component(type, token, props, ref, shouldUpdate, displayName);\r\n  };\r\n\r\n  return factory as ComponentFactory<Props, R>;\r\n}\r\n\r\nconst defaultInject: ComponentInject = {};\r\n\r\nconst detectIsComponent = (x: unknown): x is Component => x instanceof Component;\r\n\r\nconst getComponentKey = (x: Component): ElementKey => x.props[KEY_ATTR] ?? null;\r\n\r\nconst hasComponentFlag = (inst: Component, flag: string) => Boolean(inst.props[flag]);\r\n\r\ntype ComponentOptions = Readonly<{\r\n  displayName?: string;\r\n  token?: Symbol;\r\n}>;\r\n\r\ntype ComponentFactoryWithPossiblyInject<P extends object = {}, R = unknown> = {\r\n  (props?: P, ref?: Ref<R>): Component<P, R>;\r\n  [$$inject]?: ComponentInject<P>;\r\n};\r\n\r\ntype CreateElement<P extends StandardComponentProps, R = unknown> = (props: P, ref?: Ref<R>) => DarkElement;\r\n\r\nexport type ComponentInject<P extends object = {}> = Readonly<{\r\n  token?: Symbol;\r\n  shouldUpdate?: ShouldUpdate<P>;\r\n}>;\r\n\r\nexport type ShouldUpdate<P> = (prevProps: P, nextProps: P) => boolean;\r\n\r\nexport type StandardComponentProps = KeyProps & RefProps & FlagProps;\r\n\r\nexport type ComponentFactory<P extends object = {}, R = unknown> = (props?: P, ref?: Ref<R>) => Component<P, R>;\r\n\r\nexport { Component, component, $$inject, detectIsComponent, getComponentKey, hasComponentFlag };\r\n","import type { NestedArray } from '../shared';\r\nimport { INDEX_KEY } from '../constants';\r\n\r\nconst detectIsFunction = (o: any): o is Function => typeof o === 'function';\r\n\r\nconst detectIsUndefined = (o: any): o is undefined => typeof o === 'undefined';\r\n\r\nconst detectIsNumber = (o: any): o is number => typeof o === 'number';\r\n\r\nconst detectIsString = (o: any): o is string => typeof o === 'string';\r\n\r\nconst detectIsTextBased = (o: any): o is string | number => typeof o === 'string' || typeof o === 'number';\r\n\r\nconst detectIsObject = (o: any): o is object => typeof o === 'object';\r\n\r\nconst detectIsBoolean = (o: any): o is boolean => typeof o === 'boolean';\r\n\r\nconst detectIsArray = (o: any): o is Array<any> => Array.isArray(o);\r\n\r\nconst detectIsNull = (o: any): o is null => o === null;\r\n\r\nconst detectIsEmpty = (o: any) => detectIsNull(o) || detectIsUndefined(o);\r\n\r\nconst detectIsFalsy = (o: any) => detectIsEmpty(o) || o === false;\r\n\r\nconst getTime = () => Date.now();\r\n\r\nconst dummyFn = () => {};\r\n\r\nconst trueFn = () => true;\r\n\r\nconst falseFn = () => false;\r\n\r\nconst sameFn = <T = any>(x: T) => x;\r\n\r\nconst error = (...args: Array<any>) => !detectIsUndefined(console) && console.error(...args);\r\n\r\nfunction flatten<T = any>(source: Array<NestedArray<T>>, transform: (x: T) => any = sameFn): Array<T> {\r\n  if (detectIsArray(source)) {\r\n    if (source.length === 0) return [];\r\n  } else {\r\n    return [transform(source)];\r\n  }\r\n  const list: Array<T> = [];\r\n  const stack = [source[0]];\r\n  let idx = 0;\r\n\r\n  while (stack.length > 0) {\r\n    const x = stack.pop();\r\n\r\n    if (detectIsArray(x)) {\r\n      for (let i = x.length - 1; i >= 0; i--) {\r\n        stack.push(x[i]);\r\n      }\r\n    } else {\r\n      list.push(transform(x));\r\n\r\n      if (stack.length === 0 && idx < source.length - 1) {\r\n        idx++;\r\n        stack.push(source[idx]);\r\n      }\r\n    }\r\n  }\r\n\r\n  return list;\r\n}\r\n\r\nfunction keyBy<T = any>(\r\n  list: Array<T>,\r\n  fn: (o: T) => string | number,\r\n  value = false,\r\n): Record<string | number, T | boolean> {\r\n  return list.reduce((acc, x) => ((acc[fn(x)] = value ? x : true), acc), {});\r\n}\r\n\r\nfunction detectAreDepsDifferent(prevDeps: Array<unknown>, nextDeps: Array<unknown>): boolean {\r\n  if (prevDeps === nextDeps) return false;\r\n  const max = Math.max(prevDeps.length, nextDeps.length);\r\n\r\n  for (let i = 0; i < max; i++) {\r\n    if (!Object.is(prevDeps[i], nextDeps[i])) return true;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nfunction nextTick(callback: () => void) {\r\n  Promise.resolve().then(callback);\r\n}\r\n\r\nconst createIndexKey = (idx: number) => `${INDEX_KEY}:${idx}`;\r\n\r\nexport {\r\n  detectIsFunction,\r\n  detectIsUndefined,\r\n  detectIsNumber,\r\n  detectIsString,\r\n  detectIsTextBased,\r\n  detectIsObject,\r\n  detectIsBoolean,\r\n  detectIsArray,\r\n  detectIsNull,\r\n  detectIsEmpty,\r\n  detectIsFalsy,\r\n  getTime,\r\n  dummyFn,\r\n  trueFn,\r\n  falseFn,\r\n  error,\r\n  flatten,\r\n  keyBy,\r\n  detectAreDepsDifferent,\r\n  nextTick,\r\n  createIndexKey,\r\n};\r\n","import { type Fiber } from '../fiber';\r\nimport { type VirtualNode } from '../view';\r\nimport { type Callback } from '../shared';\r\n\r\nexport type Platform = {\r\n  createElement: <N>(vNode: VirtualNode) => N;\r\n  insertElement: <N>(node: N, idx: number, parent: N) => void;\r\n  raf: typeof requestAnimationFrame;\r\n  caf: typeof cancelAnimationFrame;\r\n  spawn: (callback: Callback) => void;\r\n  commit: (fiber: Fiber) => void;\r\n  finishCommit: () => void;\r\n  detectIsDynamic: () => boolean;\r\n  detectIsPortal: (instance: unknown) => boolean;\r\n  unmountPortal: (fiber: Fiber) => void;\r\n  chunk: (fiber: Fiber) => void;\r\n};\r\n\r\nconst defaultRealisation = () => {\r\n  throw new Error('Function not installed by renderer!');\r\n};\r\n\r\nconst platform: Platform = {\r\n  createElement: defaultRealisation,\r\n  insertElement: defaultRealisation,\r\n  raf: defaultRealisation,\r\n  caf: defaultRealisation,\r\n  spawn: defaultRealisation,\r\n  commit: defaultRealisation,\r\n  finishCommit: defaultRealisation,\r\n  detectIsDynamic: defaultRealisation,\r\n  detectIsPortal: defaultRealisation,\r\n  unmountPortal: defaultRealisation,\r\n  chunk: defaultRealisation,\r\n};\r\n\r\nconst detectIsServer = () => !platform.detectIsDynamic();\r\n\r\nexport { platform, detectIsServer };\r\n","import { type SubscriberWithValue } from '../shared';\r\n\r\ntype EventName = 'finish' | 'chunk';\r\n\r\nclass EventEmitter<E extends string = EventName, T = unknown> {\r\n  private subscribers: Map<Partial<E>, Set<SubscriberWithValue<unknown>>> = new Map();\r\n\r\n  on<T>(e: E, fn: SubscriberWithValue<T>) {\r\n    !this.subscribers.has(e) && this.subscribers.set(e, new Set());\r\n    this.subscribers.get(e).add(fn);\r\n\r\n    return () => this.subscribers.has(e) && this.subscribers.get(e).delete(fn);\r\n  }\r\n\r\n  emit(e: E, data?: T) {\r\n    this.subscribers.has(e) && this.subscribers.get(e).forEach(x => x(data));\r\n  }\r\n\r\n  kill() {\r\n    this.subscribers = new Map();\r\n  }\r\n\r\n  __getSize() {\r\n    return this.subscribers.size;\r\n  }\r\n}\r\n\r\nexport { EventEmitter };\r\n","import type { Callback, ElementKey, AppResources, AppResource } from '../shared';\r\nimport { type SetPendingStatus } from '../start-transition';\r\nimport { platform, detectIsServer } from '../platform';\r\nimport { EventEmitter } from '../emitter';\r\nimport { type Fiber } from '../fiber';\r\n\r\nclass Scope {\r\n  private root: Fiber = null;\r\n  private wip: Fiber = null;\r\n  private cursor: Fiber = null;\r\n  private unit: Fiber = null;\r\n  private mountDeep = true;\r\n  private mountLevel = 0;\r\n  private mountNav: Record<number, number> = {};\r\n  private events: Map<string, WeakMap<object, Function>> = new Map();\r\n  private unsubs: Set<Callback> = new Set();\r\n  private actions: Actions = {};\r\n  private candidates: Set<Fiber> = new Set();\r\n  private deletions: Set<Fiber> = new Set();\r\n  private cancels: Array<Callback> = [];\r\n  private asyncEffects: Set<Callback> = new Set();\r\n  private layoutEffects: Set<Callback> = new Set();\r\n  private insertionEffects: Set<Callback> = new Set();\r\n  private resourceId = 0;\r\n  private resources: AppResources = new Map();\r\n  private defers: Array<() => Promise<unknown>> = [];\r\n  private setPendingStatus: SetPendingStatus = null;\r\n  private isLayoutEffectsZone = false;\r\n  private isInsertionEffectsZone = false;\r\n  private isUpdateZone = false;\r\n  private isBatchZone = false;\r\n  private isHydrateZone = false;\r\n  private isStreamZone = false;\r\n  private isTransitionZone = false;\r\n  private isEventZone = false;\r\n  private isHot = false;\r\n  private isDynamic = platform.detectIsDynamic();\r\n  private isServer = detectIsServer();\r\n  private emitter = new EventEmitter();\r\n\r\n  private resetActions() {\r\n    this.actions = {};\r\n  }\r\n\r\n  getActionsById(id: number) {\r\n    return this.actions[id];\r\n  }\r\n\r\n  addActionMap(id: number, map: Record<ElementKey, Fiber>) {\r\n    this.actions[id] = {\r\n      map,\r\n      replace: null,\r\n      insert: null,\r\n      remove: null,\r\n      move: null,\r\n      stable: null,\r\n    };\r\n  }\r\n\r\n  addReplaceAction(id: number, nextKey: ElementKey) {\r\n    !this.actions[id].replace && (this.actions[id].replace = {});\r\n    this.actions[id].replace[nextKey] = true;\r\n  }\r\n\r\n  addInsertAction(id: number, nextKey: ElementKey) {\r\n    !this.actions[id].insert && (this.actions[id].insert = {});\r\n    this.actions[id].insert[nextKey] = true;\r\n  }\r\n\r\n  addRemoveAction(id: number, prevKey: ElementKey) {\r\n    !this.actions[id].remove && (this.actions[id].remove = {});\r\n    this.actions[id].remove[prevKey] = true;\r\n  }\r\n\r\n  addMoveAction(id: number, nextKey: ElementKey) {\r\n    !this.actions[id].move && (this.actions[id].move = {});\r\n    this.actions[id].move[nextKey] = true;\r\n  }\r\n\r\n  addStableAction(id: number, nextKey: ElementKey) {\r\n    !this.actions[id].stable && (this.actions[id].stable = {});\r\n    this.actions[id].stable[nextKey] = true;\r\n  }\r\n\r\n  copy() {\r\n    const scope = new Scope();\r\n\r\n    scope.root = null;\r\n    scope.wip = null;\r\n    scope.cursor = null;\r\n    scope.unit = this.unit;\r\n    scope.mountDeep = this.mountDeep;\r\n    scope.mountLevel = this.mountLevel;\r\n    scope.mountNav = { ...this.mountNav };\r\n    scope.events = this.events;\r\n    scope.unsubs = this.unsubs;\r\n    scope.actions = { ...this.actions };\r\n    scope.candidates = new Set([...this.candidates]);\r\n    scope.deletions = new Set([...this.deletions]);\r\n    scope.asyncEffects = new Set([...this.asyncEffects]);\r\n    scope.layoutEffects = new Set([...this.layoutEffects]);\r\n    scope.insertionEffects = new Set([...this.insertionEffects]);\r\n    scope.isUpdateZone = this.isUpdateZone;\r\n    scope.emitter = this.emitter;\r\n\r\n    return scope;\r\n  }\r\n\r\n  getRoot() {\r\n    return this.root;\r\n  }\r\n\r\n  setRoot(fiber: Fiber) {\r\n    this.root = fiber;\r\n  }\r\n\r\n  getWorkInProgress() {\r\n    return this.wip;\r\n  }\r\n\r\n  setWorkInProgress(fiber: Fiber) {\r\n    this.wip = fiber;\r\n  }\r\n\r\n  getNextUnitOfWork() {\r\n    return this.unit;\r\n  }\r\n\r\n  setNextUnitOfWork(fiber: Fiber) {\r\n    this.unit = fiber;\r\n  }\r\n\r\n  getCursorFiber() {\r\n    return this.cursor;\r\n  }\r\n\r\n  setCursorFiber(fiber: Fiber) {\r\n    this.cursor = fiber;\r\n  }\r\n\r\n  navToChild() {\r\n    this.mountLevel = this.mountLevel + 1;\r\n    this.mountNav[this.mountLevel] = 0;\r\n  }\r\n\r\n  navToSibling() {\r\n    this.mountNav[this.mountLevel] = this.mountNav[this.mountLevel] + 1;\r\n  }\r\n\r\n  navToParent() {\r\n    this.mountLevel = this.mountLevel - 1;\r\n  }\r\n\r\n  navToPrev() {\r\n    const idx = this.getMountIndex();\r\n\r\n    if (idx === 0) {\r\n      this.navToParent();\r\n      this.setMountDeep(true);\r\n    } else {\r\n      this.mountNav[this.mountLevel] = this.mountNav[this.mountLevel] - 1;\r\n      this.setMountDeep(false);\r\n    }\r\n  }\r\n\r\n  getMountIndex() {\r\n    return this.mountNav[this.mountLevel];\r\n  }\r\n\r\n  getMountDeep() {\r\n    return this.mountDeep;\r\n  }\r\n\r\n  setMountDeep(value: boolean) {\r\n    this.mountDeep = value;\r\n  }\r\n\r\n  resetMount() {\r\n    this.mountLevel = 0;\r\n    this.mountNav = {};\r\n    this.mountDeep = true;\r\n  }\r\n\r\n  getEvents() {\r\n    return this.events;\r\n  }\r\n\r\n  addEventUnsubscriber(fn: Callback) {\r\n    this.unsubs.add(fn);\r\n  }\r\n\r\n  unsubscribeEvents() {\r\n    this.unsubs.forEach(x => x());\r\n    this.unsubs = new Set();\r\n  }\r\n\r\n  getCandidates() {\r\n    return this.candidates;\r\n  }\r\n\r\n  addCandidate(fiber: Fiber) {\r\n    this.candidates.add(fiber);\r\n  }\r\n\r\n  resetCandidates() {\r\n    this.candidates = new Set();\r\n  }\r\n\r\n  getDeletions() {\r\n    return this.deletions;\r\n  }\r\n\r\n  hasDeletion(fiber: Fiber) {\r\n    let nextFiber = fiber;\r\n\r\n    while (nextFiber) {\r\n      if (this.deletions.has(nextFiber)) return true;\r\n      nextFiber = nextFiber.parent;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  addDeletion(fiber: Fiber) {\r\n    !this.hasDeletion(fiber) && this.deletions.add(fiber);\r\n  }\r\n\r\n  resetDeletions() {\r\n    this.deletions = new Set();\r\n  }\r\n\r\n  addAsyncEffect(fn: Callback) {\r\n    this.asyncEffects.add(fn);\r\n  }\r\n\r\n  resetAsyncEffects() {\r\n    this.asyncEffects = new Set();\r\n  }\r\n\r\n  runAsyncEffects() {\r\n    if (!this.isDynamic) return;\r\n    const effects = this.asyncEffects;\r\n    effects.size > 0 && setTimeout(() => effects.forEach(fn => fn()));\r\n  }\r\n\r\n  addLayoutEffect(fn: Callback) {\r\n    this.layoutEffects.add(fn);\r\n  }\r\n\r\n  resetLayoutEffects() {\r\n    this.layoutEffects = new Set();\r\n  }\r\n\r\n  runLayoutEffects() {\r\n    if (!this.isDynamic) return;\r\n    this.setIsLayoutEffectsZone(true);\r\n    this.layoutEffects.forEach(fn => fn());\r\n    this.setIsLayoutEffectsZone(false);\r\n  }\r\n\r\n  addInsertionEffect(fn: Callback) {\r\n    this.insertionEffects.add(fn);\r\n  }\r\n\r\n  resetInsertionEffects() {\r\n    this.insertionEffects = new Set();\r\n  }\r\n\r\n  runInsertionEffects() {\r\n    if (!this.isDynamic) return;\r\n    this.setIsInsertionEffectsZone(true);\r\n    this.insertionEffects.forEach(fn => fn());\r\n    this.setIsInsertionEffectsZone(false);\r\n  }\r\n\r\n  addCancel(fn: Callback) {\r\n    this.cancels.push(fn);\r\n  }\r\n\r\n  applyCancels() {\r\n    for (let i = this.cancels.length - 1; i >= 0; i--) {\r\n      this.cancels[i]();\r\n    }\r\n  }\r\n\r\n  resetCancels() {\r\n    this.cancels = [];\r\n  }\r\n\r\n  getIsLayoutEffectsZone() {\r\n    return this.isLayoutEffectsZone;\r\n  }\r\n\r\n  setIsLayoutEffectsZone(value: boolean) {\r\n    this.isLayoutEffectsZone = value;\r\n  }\r\n\r\n  getIsInsertionEffectsZone() {\r\n    return this.isInsertionEffectsZone;\r\n  }\r\n\r\n  setIsInsertionEffectsZone(value: boolean) {\r\n    this.isInsertionEffectsZone = value;\r\n  }\r\n\r\n  getIsUpdateZone() {\r\n    return this.isUpdateZone;\r\n  }\r\n\r\n  setIsUpdateZone(value: boolean) {\r\n    this.isUpdateZone = value;\r\n  }\r\n\r\n  getIsBatchZone() {\r\n    return this.isBatchZone;\r\n  }\r\n\r\n  setIsBatchZone(value: boolean) {\r\n    this.isBatchZone = value;\r\n  }\r\n\r\n  getIsHydrateZone() {\r\n    return this.isHydrateZone;\r\n  }\r\n\r\n  setIsHydrateZone(value: boolean) {\r\n    this.isHydrateZone = value;\r\n  }\r\n\r\n  getIsStreamZone() {\r\n    return this.isStreamZone;\r\n  }\r\n\r\n  setIsStreamZone(value: boolean) {\r\n    this.isStreamZone = value;\r\n  }\r\n\r\n  getIsTransitionZone() {\r\n    return this.isTransitionZone;\r\n  }\r\n\r\n  setIsTransitionZone(value: boolean) {\r\n    this.isTransitionZone = value;\r\n  }\r\n\r\n  getIsEventZone() {\r\n    return this.isEventZone;\r\n  }\r\n\r\n  setIsEventZone(value: boolean) {\r\n    this.isEventZone = value;\r\n  }\r\n\r\n  getIsHot() {\r\n    return this.isHot;\r\n  }\r\n\r\n  setIsHot(value: boolean) {\r\n    this.isHot = value;\r\n  }\r\n\r\n  getPendingStatusSetter() {\r\n    return this.setPendingStatus;\r\n  }\r\n\r\n  setPendingStatusSetter(fn: SetPendingStatus) {\r\n    this.setPendingStatus = fn;\r\n  }\r\n\r\n  flush() {\r\n    !this.isUpdateZone && this.setRoot(this.wip); // !\r\n    this.setWorkInProgress(null);\r\n    this.setNextUnitOfWork(null);\r\n    this.setCursorFiber(null);\r\n    this.resetMount();\r\n    this.resetCandidates();\r\n    this.resetDeletions();\r\n    this.resetCancels();\r\n    this.resetInsertionEffects();\r\n    this.resetLayoutEffects();\r\n    this.resetAsyncEffects();\r\n    this.setIsHydrateZone(false);\r\n    this.setIsUpdateZone(false);\r\n    this.resetActions();\r\n  }\r\n\r\n  getEmitter() {\r\n    return this.emitter;\r\n  }\r\n\r\n  defer(fn: () => Promise<unknown>) {\r\n    this.defers.push(fn);\r\n  }\r\n\r\n  getDefers() {\r\n    return this.defers;\r\n  }\r\n\r\n  resetDefers() {\r\n    this.defers = [];\r\n  }\r\n\r\n  getResource(id: number) {\r\n    return this.resources.get(id);\r\n  }\r\n\r\n  setResource(id: number, res: AppResource) {\r\n    this.resources.set(id, res);\r\n  }\r\n\r\n  getResources() {\r\n    return this.resources;\r\n  }\r\n\r\n  getResourceId() {\r\n    return this.resourceId;\r\n  }\r\n\r\n  setResourceId(id: number) {\r\n    this.resourceId = id;\r\n  }\r\n\r\n  getNextResourceId() {\r\n    return ++this.resourceId;\r\n  }\r\n\r\n  runAfterCommit() {\r\n    this.resources = new Map();\r\n    this.isServer && (this.resourceId = 0);\r\n  }\r\n}\r\n\r\ntype Actions = Record<\r\n  number,\r\n  {\r\n    map: Record<ElementKey, Fiber>;\r\n    replace: Record<ElementKey, true>;\r\n    insert: Record<ElementKey, true>;\r\n    remove: Record<ElementKey, true>;\r\n    move: Record<ElementKey, true>;\r\n    stable: Record<ElementKey, true>;\r\n  }\r\n>;\r\n\r\nlet rootId: number = null;\r\nconst scopes = new Map<number, Scope>();\r\n\r\nconst getRootId = () => rootId;\r\n\r\nconst setRootId = (id: number) => {\r\n  rootId = id;\r\n  !scopes.has(rootId) && scopes.set(rootId, new Scope());\r\n};\r\n\r\nconst removeScope = (id: number) => scopes.delete(id);\r\n\r\nconst replaceScope = (scope: Scope, id: number = rootId) => {\r\n  Object.assign(scopes.get(id), scope);\r\n};\r\n\r\nconst $$scope = (id: number = rootId) => scopes.get(id);\r\n\r\nexport { type Scope, getRootId, setRootId, removeScope, replaceScope, $$scope };\r\n","import type { ElementKey, DarkElement, Instance, SlotProps, RefProps, KeyProps, FlagProps } from '../shared';\r\nimport { type Component, detectIsComponent, getComponentKey, hasComponentFlag } from '../component';\r\nimport { detectIsArray, detectIsFunction } from '../utils';\r\nimport { REPLACER, KEY_ATTR } from '../constants';\r\nimport { $$scope } from '../scope';\r\n\r\nconst $$vNode = Symbol('vNode');\r\nconst ATTR_TYPE = 'type';\r\n\r\nclass VirtualNode {\r\n  public type: NodeType = null;\r\n\r\n  constructor(type: NodeType) {\r\n    this.type = type;\r\n  }\r\n}\r\n\r\nclass TagVirtualNode extends VirtualNode {\r\n  public name: string;\r\n  public attrs: Record<string, any>;\r\n  public children: Array<TextVirtualNode | CommentVirtualNode | TagVirtualNode | VirtualNodeFactory | Component>;\r\n\r\n  constructor(name: string, attrs: TagVirtualNode['attrs'], children: TagVirtualNode['children']) {\r\n    super(NodeType.TAG);\r\n    this.name = name;\r\n    this.attrs = attrs;\r\n    this.children = children;\r\n  }\r\n}\r\n\r\nclass TextVirtualNode extends VirtualNode {\r\n  public value: string;\r\n\r\n  constructor(source: TextSource) {\r\n    super(NodeType.TEXT);\r\n    this.value = String(source);\r\n  }\r\n}\r\n\r\nclass CommentVirtualNode extends VirtualNode {\r\n  public value = '';\r\n\r\n  constructor(text: string) {\r\n    super(NodeType.COMMENT);\r\n    this.value = text;\r\n  }\r\n}\r\n\r\nfunction View(options: ViewOptions) {\r\n  const factory: TagVirtualNodeFactory = () => {\r\n    const { as: name, slot, _void = false, ...attrs } = options;\r\n    const children = (_void ? [] : detectIsArray(slot) ? slot : slot ? [slot] : []) as TagVirtualNode['children'];\r\n\r\n    return new TagVirtualNode(name, attrs, children);\r\n  };\r\n\r\n  factory[$$vNode] = true;\r\n  factory[ATTR_TYPE] = options.as;\r\n  factory[KEY_ATTR] = options.key;\r\n\r\n  return factory;\r\n}\r\n\r\nconst Text = (source: TextSource) => new TextVirtualNode(source);\r\n\r\nText.from = (source: DarkElement) => (detectIsTextVirtualNode(source) ? source.value : source + '');\r\n\r\nconst Comment = (text: string) => new CommentVirtualNode(text);\r\n\r\nconst detectIsVirtualNode = (vNode: unknown): vNode is VirtualNode => vNode instanceof VirtualNode;\r\n\r\nconst detectIsTagVirtualNode = (vNode: unknown): vNode is TagVirtualNode => vNode instanceof TagVirtualNode;\r\n\r\nconst detectIsCommentVirtualNode = (vNode: unknown): vNode is CommentVirtualNode => vNode instanceof CommentVirtualNode;\r\n\r\nconst detectIsTextVirtualNode = (vNode: unknown): vNode is TextVirtualNode => vNode instanceof TextVirtualNode;\r\n\r\nconst detectIsVirtualNodeFactory = (factory: unknown): factory is VirtualNodeFactory =>\r\n  detectIsFunction(factory) && factory[$$vNode] === true;\r\n\r\nconst getTagVirtualNodeKey = (vNode: TagVirtualNode): ElementKey | null =>\r\n  vNode.attrs ? vNode.attrs[KEY_ATTR] ?? null : null;\r\n\r\nconst hasTagVirtualNodeFlag = (vNode: TagVirtualNode, flag: string) => Boolean(vNode.attrs && vNode.attrs[flag]);\r\n\r\nconst getVirtualNodeFactoryKey = (factory: VirtualNodeFactory): ElementKey | null => factory[KEY_ATTR] ?? null;\r\n\r\nconst hasVirtualNodeFactoryFlag = (factory: VirtualNodeFactory, flag: string) => Boolean(factory[flag]);\r\n\r\nconst detectIsPlainVirtualNode = (vNode: unknown): vNode is PlainVirtualNode =>\r\n  detectIsTextVirtualNode(vNode) || detectIsCommentVirtualNode(vNode);\r\n\r\nconst createReplacer = () => new CommentVirtualNode(REPLACER);\r\n\r\nconst detectIsReplacer = (vNode: unknown) => detectIsCommentVirtualNode(vNode) && vNode.value === REPLACER;\r\n\r\nfunction getElementKey(inst: Instance): ElementKey | null {\r\n  return detectIsComponent(inst)\r\n    ? getComponentKey(inst)\r\n    : detectIsVirtualNodeFactory(inst)\r\n    ? getVirtualNodeFactoryKey(inst)\r\n    : detectIsTagVirtualNode(inst)\r\n    ? getTagVirtualNodeKey(inst)\r\n    : null;\r\n}\r\n\r\nfunction hasElementFlag(inst: Instance, flag: string) {\r\n  return detectIsComponent(inst)\r\n    ? hasComponentFlag(inst, flag)\r\n    : detectIsVirtualNodeFactory(inst)\r\n    ? hasVirtualNodeFactoryFlag(inst, flag)\r\n    : detectIsTagVirtualNode(inst)\r\n    ? hasTagVirtualNodeFlag(inst, flag)\r\n    : false;\r\n}\r\n\r\nfunction getElementType(inst: Instance): string | Function {\r\n  return detectIsComponent(inst)\r\n    ? inst.type\r\n    : detectIsVirtualNodeFactory(inst)\r\n    ? inst[ATTR_TYPE]\r\n    : detectIsTagVirtualNode(inst)\r\n    ? inst.name\r\n    : detectIsVirtualNode(inst)\r\n    ? inst.type\r\n    : null;\r\n}\r\n\r\nfunction hasChildrenProp(inst: Instance): inst is TagVirtualNode | Component {\r\n  return detectIsTagVirtualNode(inst) || detectIsComponent(inst);\r\n}\r\n\r\nfunction detectAreSameInstanceTypes(prevInst: Instance, nextInst: Instance, isComponentFactories = false) {\r\n  if (process.env.NODE_ENV !== 'production') {\r\n    if (process.env.NODE_ENV === 'development' && $$scope().getIsHot()) {\r\n      if (detectIsComponent(prevInst) && detectIsComponent(nextInst)) {\r\n        return prevInst.displayName === nextInst.displayName;\r\n      }\r\n    }\r\n  }\r\n\r\n  if (isComponentFactories) {\r\n    const pc = prevInst as Component;\r\n    const nc = nextInst as Component;\r\n\r\n    return pc.type === nc.type;\r\n  }\r\n\r\n  return getElementType(prevInst) === getElementType(nextInst);\r\n}\r\n\r\nfunction detectAreSameComponentTypesWithSameKeys(prevInst: Instance | null, nextInst: Instance | null) {\r\n  if (\r\n    prevInst &&\r\n    nextInst &&\r\n    detectIsComponent(prevInst) &&\r\n    detectIsComponent(nextInst) &&\r\n    detectAreSameInstanceTypes(prevInst, nextInst, true)\r\n  ) {\r\n    return getElementKey(prevInst) === getElementKey(nextInst);\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\ntype TextSource = string | number;\r\n\r\nexport type VirtualNodeFactory = () => VirtualNode;\r\n\r\nexport type TagVirtualNodeFactory = () => TagVirtualNode;\r\n\r\nexport type PlainVirtualNode = TextVirtualNode | CommentVirtualNode;\r\n\r\nexport type ViewOptions = {\r\n  as: string;\r\n  _void?: boolean;\r\n  [prop: string]: any;\r\n} & Partial<SlotProps> &\r\n  RefProps &\r\n  KeyProps &\r\n  FlagProps;\r\n\r\nexport enum NodeType {\r\n  TAG = 'TAG',\r\n  TEXT = 'TEXT',\r\n  COMMENT = 'COMMENT',\r\n}\r\n\r\nexport {\r\n  View,\r\n  Text,\r\n  Comment,\r\n  VirtualNode,\r\n  TagVirtualNode,\r\n  TextVirtualNode,\r\n  CommentVirtualNode,\r\n  createReplacer,\r\n  detectIsReplacer,\r\n  getElementKey,\r\n  hasElementFlag,\r\n  getElementType,\r\n  hasChildrenProp,\r\n  detectIsVirtualNode,\r\n  detectIsTagVirtualNode,\r\n  detectIsCommentVirtualNode,\r\n  detectIsTextVirtualNode,\r\n  detectIsPlainVirtualNode,\r\n  detectIsVirtualNodeFactory,\r\n  detectAreSameInstanceTypes,\r\n  detectAreSameComponentTypesWithSameKeys,\r\n};\r\n","import { detectIsTagVirtualNode, detectIsPlainVirtualNode, detectAreSameComponentTypesWithSameKeys } from '../view';\r\nimport { type Instance, type Callback, type TimerId } from '../shared';\r\nimport { type Context, type ContextProviderValue } from '../context';\r\nimport { detectIsComponent } from '../component';\r\nimport { detectIsFunction } from '../utils';\r\nimport { type Atom } from '../atom';\r\nimport { $$scope } from '../scope';\r\n\r\nclass Fiber<N = NativeElement> {\r\n  id = 0;\r\n  cc = 0; // child fibers count\r\n  cec = 0; // child native elements count\r\n  idx = 0; // idx of fiber in the parent fiber\r\n  eidx = 0; // native element idx\r\n  mask = 0; // bit mask\r\n  element: N = null; // native element\r\n  tag: string = null; // effect tag (CREATE, UPDATE, DELETE, SKIP)\r\n  parent: Fiber<N> = null; // parent fiber\r\n  child: Fiber<N> = null; // child fiber\r\n  next: Fiber<N> = null; // next sibling fiber\r\n  alt: Fiber<N> = null; // alternate fiber (previous)\r\n  inst: Instance = null; // instance of component or virtual node\r\n  hook: Hook | null = null; // hook\r\n  provider: Map<Context, ContextProviderValue> = null; // provider of context\r\n  atoms: Map<Atom, Callback> = null;\r\n  marker: string; // for dev\r\n  batch: Batch;\r\n  catch: (error: Error) => void;\r\n\r\n  constructor(hook: Hook = null, provider: Fiber['provider'] = null, idx = 0) {\r\n    this.id = ++Fiber.nextId;\r\n    this.idx = idx;\r\n    hook && (this.hook = hook);\r\n    provider && (this.provider = provider);\r\n  }\r\n\r\n  mutate(fiber: Partial<Fiber<N>>) {\r\n    const keys = Object.keys(fiber);\r\n\r\n    for (const key of keys) {\r\n      this[key] = fiber[key];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  markHost(mask: number) {\r\n    this.mask |= mask;\r\n    this.parent && !(this.parent.mask & mask) && this.parent.markHost(mask);\r\n  }\r\n\r\n  increment(count = 1, force = false) {\r\n    if (!this.parent) return;\r\n    const $scope = $$scope();\r\n    const isUpdateZone = $scope.getIsUpdateZone();\r\n    const wipFiber = $scope.getWorkInProgress();\r\n    const stop = isUpdateZone && wipFiber.parent === this.parent;\r\n\r\n    if (\r\n      detectIsPlainVirtualNode(this.inst) ||\r\n      (detectIsTagVirtualNode(this.inst) && this.inst.children?.length === 0)\r\n    ) {\r\n      this.cec = 1;\r\n    }\r\n\r\n    if (isUpdateZone && stop && !force) return;\r\n\r\n    this.parent.cec += count;\r\n\r\n    if (!this.parent.element) {\r\n      this.parent.increment(count);\r\n    }\r\n  }\r\n\r\n  setError(error: Error) {\r\n    if (detectIsFunction(this.catch)) {\r\n      this.catch(error);\r\n    } else if (this.parent) {\r\n      this.parent.setError(error);\r\n    }\r\n  }\r\n\r\n  static setNextId(id: number) {\r\n    Fiber.nextId = id;\r\n  }\r\n\r\n  private static nextId = 0;\r\n}\r\n\r\nclass Hook<T = any> {\r\n  id = 0;\r\n  idx = 0;\r\n  values: Array<T> = [];\r\n  owner: Fiber = null;\r\n  private static nextId = 0;\r\n\r\n  constructor() {\r\n    this.id = ++Hook.nextId;\r\n  }\r\n}\r\n\r\nfunction getHook(alt: Fiber, prevInst: Instance, nextInst: Instance): Hook | null {\r\n  if (alt && detectAreSameComponentTypesWithSameKeys(prevInst, nextInst)) return alt.hook;\r\n  if (detectIsComponent(nextInst)) return new Hook();\r\n\r\n  return null;\r\n}\r\n\r\ntype Batch = {\r\n  timer: TimerId;\r\n  changes: Array<Callback>;\r\n};\r\n\r\nexport type NativeElement = unknown;\r\nexport type HookValue<T = any> = { deps: Array<any>; value: T };\r\n\r\nexport { Fiber, Hook, getHook };\r\n","import {\r\n  type ComponentFactory,\r\n  type StandardComponentProps,\r\n  type ShouldUpdate,\r\n  type ComponentInject,\r\n  $$inject,\r\n  detectIsComponent,\r\n} from '../component';\r\nimport type { SlotProps, RefProps } from '../shared';\r\n\r\nconst $$memo = Symbol('memo');\r\n\r\nconst defaultShouldUpdate = (props: {}, nextProps: {}): boolean => {\r\n  const keys = Object.keys(nextProps);\r\n\r\n  for (const key of keys) {\r\n    if (key !== 'slot' && nextProps[key] !== props[key]) return true;\r\n  }\r\n\r\n  return false;\r\n};\r\n\r\nfunction memo<P extends object, R = unknown>(\r\n  factory: ComponentFactory<P, R>,\r\n  shouldUpdate: ShouldUpdate<P & SlotProps> = defaultShouldUpdate,\r\n) {\r\n  type P1 = P & Omit<StandardComponentProps, 'ref'> & RefProps<R>;\r\n\r\n  factory[$$inject] = {\r\n    token: $$memo,\r\n    shouldUpdate,\r\n  } as ComponentInject<P1>;\r\n\r\n  return factory as ComponentFactory<P1, R>;\r\n}\r\n\r\nconst detectIsMemo = (instance: unknown) => detectIsComponent(instance) && instance.token === $$memo;\r\n\r\nexport { memo, detectIsMemo };\r\n","import {\r\n  DELETE_EFFECT_TAG,\r\n  UPDATE_EFFECT_TAG,\r\n  SKIP_EFFECT_TAG,\r\n  INSERTION_EFFECT_HOST_MASK,\r\n  LAYOUT_EFFECT_HOST_MASK,\r\n  ASYNC_EFFECT_HOST_MASK,\r\n  ATOM_HOST_MASK,\r\n  PORTAL_HOST_MASK,\r\n  MOVE_MASK,\r\n  HOOK_DELIMETER,\r\n} from '../constants';\r\nimport { Fiber } from '../fiber';\r\nimport { platform } from '../platform';\r\nimport { type TagVirtualNode, getElementKey, hasChildrenProp } from '../view';\r\nimport { type Scope } from '../scope';\r\nimport { type Component } from '../component';\r\nimport { detectIsMemo } from '../memo';\r\nimport { type Instance, type ElementKey } from '../shared';\r\nimport { createIndexKey } from '../utils';\r\n\r\nfunction walk<T = unknown>(fiber: Fiber<T>, onWalk: (fiber: Fiber<T>, skip: () => void, stop: () => void) => void) {\r\n  let shouldDeep = true;\r\n  let shouldStop = false;\r\n  const skip = () => (shouldDeep = false);\r\n  const stop = () => (shouldStop = true);\r\n  const stack: Array<Fiber<T>> = [fiber];\r\n\r\n  while (stack.length !== 0) {\r\n    const unit = stack.pop();\r\n\r\n    onWalk(unit, skip, stop);\r\n    if (shouldStop) break;\r\n    unit !== fiber && unit.next && stack.push(unit.next);\r\n    shouldDeep && unit.child && stack.push(unit.child);\r\n    shouldDeep = true;\r\n  }\r\n}\r\n\r\nfunction collectElements<T, P = T>(fiber: Fiber<T>, transform: (fiber: Fiber<T>) => P): Array<P> {\r\n  const elements: Array<P> = [];\r\n\r\n  walk<T>(fiber, (fiber, skip) => {\r\n    if (fiber.element) {\r\n      !platform.detectIsPortal(fiber.inst) && elements.push(transform(fiber));\r\n      return skip();\r\n    }\r\n  });\r\n\r\n  return elements;\r\n}\r\n\r\nfunction getFiberWithElement<T1, T2 = T1>(fiber: Fiber<T1>): Fiber<T2> {\r\n  let $fiber = fiber as unknown as Fiber<T2>;\r\n\r\n  while ($fiber) {\r\n    if ($fiber.element) return $fiber;\r\n    $fiber = $fiber.parent;\r\n  }\r\n\r\n  return $fiber;\r\n}\r\n\r\nfunction detectIsFiberAlive(fiber: Fiber) {\r\n  let $fiber = fiber;\r\n\r\n  while ($fiber) {\r\n    if ($fiber.tag === DELETE_EFFECT_TAG) return false;\r\n    $fiber = $fiber.parent;\r\n  }\r\n\r\n  return Boolean(fiber);\r\n}\r\n\r\nfunction createHookLocation(rootId: number, idx: number, fiber: Fiber) {\r\n  let $fiber = fiber;\r\n  let loc = `${fiber.idx}${HOOK_DELIMETER}${idx}`;\r\n\r\n  while ($fiber) {\r\n    $fiber = $fiber.parent;\r\n    $fiber && (loc = `${$fiber.idx}.${loc}`);\r\n  }\r\n\r\n  loc = `[${rootId}]${loc}`;\r\n\r\n  return loc;\r\n}\r\n\r\nfunction detectIsStableMemoTree(fiber: Fiber, $scope: Scope) {\r\n  if (!hasChildrenProp(fiber.inst)) return;\r\n  const actions = $scope.getActionsById(fiber.id);\r\n  const children = fiber.inst.children;\r\n\r\n  for (let i = 0; i < children.length; i++) {\r\n    const inst = children[i];\r\n    const key = getElementKey(inst);\r\n    if (key === null) return false;\r\n    const alt = actions.map[key];\r\n    if (!alt) return false;\r\n    const pc = alt.inst as Component;\r\n    const nc = inst as Component;\r\n    const isStable =\r\n      detectIsMemo(nc) && detectIsMemo(pc) && nc.type === pc.type && !nc.shouldUpdate(pc.props, nc.props);\r\n\r\n    if (!isStable) return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nfunction tryOptStaticSlot(fiber: Fiber, alt: Fiber, $scope: Scope) {\r\n  const actions = $scope.getActionsById(fiber.id);\r\n  const inst = fiber.inst as Component | TagVirtualNode;\r\n\r\n  alt.element && (fiber.element = alt.element); //!\r\n\r\n  for (let i = 0; i < inst.children.length; i++) {\r\n    buildChildNode(inst.children, fiber, actions.map, i, fiber.eidx);\r\n  }\r\n\r\n  fiber.cc = inst.children.length;\r\n  $scope.setMountDeep(false);\r\n}\r\n\r\nfunction tryOptMemoSlot(fiber: Fiber, alt: Fiber, $scope: Scope) {\r\n  const actions = $scope.getActionsById(fiber.id);\r\n  const hasMove = Boolean(actions.move);\r\n  const hasRemove = Boolean(actions.remove);\r\n  const hasInsert = Boolean(actions.insert);\r\n  const hasReplace = Boolean(actions.insert);\r\n  const canOptimize = ((hasMove && !hasRemove) || (hasRemove && !hasMove)) && !hasInsert && !hasReplace;\r\n\r\n  if (!canOptimize || !detectIsStableMemoTree(fiber, $scope)) return;\r\n\r\n  hasMove && tryOptMov(fiber, alt, $scope);\r\n  hasRemove && tryOptRem(fiber, alt, $scope);\r\n}\r\n\r\nfunction tryOptMov(fiber: Fiber, alt: Fiber, $scope: Scope) {\r\n  const actions = $scope.getActionsById(fiber.id);\r\n\r\n  buildChildNodes(fiber, alt, $scope, (fiber, key) => {\r\n    if (!actions.move[key]) return;\r\n    fiber.alt = new Fiber().mutate(fiber);\r\n    fiber.tag = UPDATE_EFFECT_TAG;\r\n    fiber.mask |= MOVE_MASK;\r\n    $scope.addCandidate(fiber);\r\n  });\r\n}\r\n\r\nfunction tryOptRem(fiber: Fiber, alt: Fiber, $scope: Scope) {\r\n  buildChildNodes(fiber, alt, $scope);\r\n}\r\n\r\nfunction buildChildNodes(fiber: Fiber, alt: Fiber, $scope: Scope, onNode?: (fiber: Fiber, key: ElementKey) => void) {\r\n  const actions = $scope.getActionsById(fiber.id);\r\n  const inst = fiber.inst as Component | TagVirtualNode;\r\n  const children = inst.children;\r\n\r\n  alt.element && (fiber.element = alt.element); //!\r\n\r\n  for (let i = 0; i < children.length; i++) {\r\n    const key = getKey(children[i], i);\r\n    const $fiber = actions.map[key];\r\n\r\n    buildChildNode(children, fiber, actions.map, i, fiber.eidx);\r\n    onNode && onNode($fiber, key);\r\n  }\r\n\r\n  fiber.cc = children.length;\r\n  $scope.setMountDeep(false);\r\n}\r\n\r\nfunction buildChildNode(\r\n  children: Array<Instance>,\r\n  parent: Fiber,\r\n  altMap: Record<string, Fiber>,\r\n  idx: number,\r\n  startEidx: number,\r\n) {\r\n  const prevIdx = idx - 1;\r\n  const nextIdx = idx + 1;\r\n  const key = getKey(children[idx], idx);\r\n  const prevKey = getKey(children[prevIdx], prevIdx);\r\n  const nextKey = getKey(children[nextIdx], nextIdx);\r\n  const fiber = altMap[key];\r\n  const left = altMap[prevKey];\r\n  const right = altMap[nextKey];\r\n  const isFirst = idx === 0;\r\n  const isLast = idx === children.length - 1;\r\n\r\n  isFirst && (parent.child = fiber);\r\n  fiber.alt = null;\r\n  fiber.parent = parent;\r\n  fiber.tag = SKIP_EFFECT_TAG;\r\n  fiber.idx = idx;\r\n  left ? (fiber.eidx = left.eidx + (left.element ? 1 : left.cec)) : (fiber.eidx = startEidx);\r\n  right && (fiber.next = right);\r\n  isLast && (fiber.next = null);\r\n  notifyParents(fiber);\r\n}\r\n\r\nfunction getKey(inst: Instance, idx: number) {\r\n  const key = getElementKey(inst);\r\n  return key !== null ? key : createIndexKey(idx);\r\n}\r\n\r\nfunction notifyParents(fiber: Fiber, alt: Fiber = fiber) {\r\n  fiber.increment(alt.element ? 1 : alt.cec);\r\n  alt.mask & INSERTION_EFFECT_HOST_MASK && fiber.markHost(INSERTION_EFFECT_HOST_MASK);\r\n  alt.mask & LAYOUT_EFFECT_HOST_MASK && fiber.markHost(LAYOUT_EFFECT_HOST_MASK);\r\n  alt.mask & ASYNC_EFFECT_HOST_MASK && fiber.markHost(ASYNC_EFFECT_HOST_MASK);\r\n  alt.mask & ATOM_HOST_MASK && fiber.markHost(ATOM_HOST_MASK);\r\n  alt.mask & PORTAL_HOST_MASK && fiber.markHost(PORTAL_HOST_MASK);\r\n}\r\n\r\nexport {\r\n  walk,\r\n  collectElements,\r\n  getFiberWithElement,\r\n  detectIsFiberAlive,\r\n  createHookLocation,\r\n  tryOptStaticSlot,\r\n  tryOptMemoSlot,\r\n  notifyParents,\r\n};\r\n","import { component, detectIsComponent } from '../component';\r\nimport type { KeyProps, SlotProps } from '../shared';\r\n\r\ntype FragmentProps = Required<SlotProps> & KeyProps;\r\n\r\nconst $$fragment = Symbol('fragment');\r\n\r\nconst Fragment = component<FragmentProps>(({ slot }) => slot || null, { token: $$fragment });\r\n\r\nconst detectIsFragment = (instance: unknown) => detectIsComponent(instance) && instance.token === $$fragment;\r\n\r\nexport { Fragment, detectIsFragment };\r\n","import { type VirtualNodeFactory, detectIsVirtualNodeFactory } from '../view';\r\nimport { type Component, detectIsComponent, component } from '../component';\r\nimport { type Hook, type HookValue } from '../fiber';\r\nimport { detectAreDepsDifferent } from '../utils';\r\nimport { $$scope } from '../scope';\r\nimport { memo } from '../memo';\r\n\r\ntype GetMemoValue = () => Component | VirtualNodeFactory;\r\n\r\ntype MemoProps = {\r\n  deps: Array<any>;\r\n  getValue: GetMemoValue;\r\n};\r\n\r\nconst Memo = memo(\r\n  component<MemoProps>(({ getValue }) => getValue()),\r\n  (p, n) => detectAreDepsDifferent(p.deps, n.deps),\r\n);\r\n\r\nfunction detectIsElement<T>(value: T) {\r\n  return detectIsComponent(value) || detectIsVirtualNodeFactory(value);\r\n}\r\n\r\nfunction useMemo<T>(getValue: () => T, deps: Array<any>): T {\r\n  const fiber = $$scope().getCursorFiber();\r\n  const { hook } = fiber;\r\n  const { idx, values } = hook as Hook<HookValue<T>>;\r\n  const state =\r\n    values[idx] ||\r\n    (values[idx] = {\r\n      deps,\r\n      value: getValue(),\r\n    });\r\n  let value: T = null;\r\n  let $value: T = null;\r\n\r\n  if (detectIsElement(state.value)) {\r\n    value = state.value;\r\n    $value = Memo({ getValue: getValue as GetMemoValue, deps }) as unknown as T;\r\n  } else {\r\n    value = detectAreDepsDifferent(state.deps, deps) ? getValue() : state.value;\r\n    $value = value;\r\n  }\r\n\r\n  state.deps = deps;\r\n  state.value = value;\r\n  hook.idx++;\r\n\r\n  return $value;\r\n}\r\n\r\nexport { useMemo };\r\n","import { detectIsFunction } from '../utils';\r\nimport { INSERTION_EFFECT_HOST_MASK, LAYOUT_EFFECT_HOST_MASK, ASYNC_EFFECT_HOST_MASK } from '../constants';\r\nimport { $$scope } from '../scope';\r\nimport { useMemo } from '../use-memo';\r\nimport { type Hook, type HookValue } from '../fiber';\r\n\r\nconst $$useEffect = Symbol('use-effect');\r\n\r\ntype UseEffectValue = {\r\n  token: Symbol;\r\n  cleanup: DropEffect;\r\n};\r\n\r\nfunction createEffect(token: Symbol, type: EffectType) {\r\n  function useEffect(effect: Effect, deps: Array<any> = [{}]) {\r\n    const $scope = $$scope();\r\n    const fiber = $scope.getCursorFiber();\r\n    const scope = useMemo<UseEffectValue>(() => ({ token, cleanup: undefined }), []);\r\n    const isInsertionEffect = type === EffectType.INSERTION;\r\n    const isLayoutEffect = type === EffectType.LAYOUT;\r\n    const isAsyncEffect = type === EffectType.ASYNC;\r\n\r\n    isInsertionEffect && fiber.markHost(INSERTION_EFFECT_HOST_MASK);\r\n    isLayoutEffect && fiber.markHost(LAYOUT_EFFECT_HOST_MASK);\r\n    isAsyncEffect && fiber.markHost(ASYNC_EFFECT_HOST_MASK);\r\n\r\n    useMemo(() => {\r\n      const runEffect = () => (scope.cleanup = effect());\r\n\r\n      isInsertionEffect && $scope.addInsertionEffect(runEffect);\r\n      isLayoutEffect && $scope.addLayoutEffect(runEffect);\r\n      isAsyncEffect && $scope.addAsyncEffect(runEffect);\r\n\r\n      detectIsFunction(scope.cleanup) && scope.cleanup();\r\n\r\n      return null;\r\n    }, deps);\r\n  }\r\n\r\n  function dropEffects(hook: Hook<HookValue<UseEffectValue>>) {\r\n    for (const { value: effect } of hook.values) {\r\n      effect && effect.token === token && detectIsFunction(effect.cleanup) && effect.cleanup();\r\n    }\r\n  }\r\n\r\n  return {\r\n    useEffect,\r\n    dropEffects,\r\n  };\r\n}\r\n\r\nexport type DropEffect = void | (() => void);\r\n\r\nexport type Effect = () => DropEffect;\r\n\r\nexport enum EffectType {\r\n  ASYNC = 'ASYNC',\r\n  LAYOUT = 'LAYOUT',\r\n  INSERTION = 'INSERTION',\r\n}\r\n\r\nconst { useEffect, dropEffects } = createEffect($$useEffect, EffectType.ASYNC);\r\n\r\nexport { useEffect, dropEffects, createEffect };\r\n","import { createEffect, EffectType } from '../use-effect';\r\n\r\nconst $$useLayoutEffect = Symbol('use-layout-effect');\r\nconst { useEffect: useLayoutEffect, dropEffects: dropLayoutEffects } = createEffect(\r\n  $$useLayoutEffect,\r\n  EffectType.LAYOUT,\r\n);\r\n\r\nexport { useLayoutEffect, dropLayoutEffects };\r\n","import { createEffect, EffectType } from '../use-effect';\r\n\r\nconst $$useInsertionEffect = Symbol('use-insertion-effect');\r\nconst { useEffect: useInsertionEffect, dropEffects: dropInsertionEffects } = createEffect(\r\n  $$useInsertionEffect,\r\n  EffectType.INSERTION,\r\n);\r\n\r\nexport { useInsertionEffect, dropInsertionEffects };\r\n","import { type Fiber } from '../fiber';\r\nimport { platform } from '../platform';\r\nimport { dropEffects } from '../use-effect';\r\nimport { dropLayoutEffects } from '../use-layout-effect';\r\nimport { dropInsertionEffects } from '../use-insertion-effect';\r\nimport { walk } from '../walk';\r\nimport { detectIsUndefined } from '../utils';\r\nimport { removeScope, $$scope } from '../scope';\r\nimport {\r\n  INSERTION_EFFECT_HOST_MASK,\r\n  LAYOUT_EFFECT_HOST_MASK,\r\n  ASYNC_EFFECT_HOST_MASK,\r\n  ATOM_HOST_MASK,\r\n  PORTAL_HOST_MASK,\r\n} from '../constants';\r\n\r\nconst combinedMask =\r\n  INSERTION_EFFECT_HOST_MASK | LAYOUT_EFFECT_HOST_MASK | ASYNC_EFFECT_HOST_MASK | ATOM_HOST_MASK | PORTAL_HOST_MASK;\r\n\r\nconst shouldUnmountFiber = (fiber: Fiber) => fiber.mask & combinedMask;\r\n\r\nfunction unmountFiber(fiber: Fiber) {\r\n  if (!shouldUnmountFiber(fiber)) return;\r\n  walk(fiber, (fiber, skip) => {\r\n    if (!shouldUnmountFiber(fiber)) return skip();\r\n\r\n    if (fiber.hook && fiber.hook.values.length > 0) {\r\n      fiber.mask & INSERTION_EFFECT_HOST_MASK && dropInsertionEffects(fiber.hook);\r\n      fiber.mask & LAYOUT_EFFECT_HOST_MASK && dropLayoutEffects(fiber.hook);\r\n      fiber.mask & ASYNC_EFFECT_HOST_MASK && dropEffects(fiber.hook);\r\n    }\r\n\r\n    if (fiber.atoms) {\r\n      for (const [_, cleanup] of fiber.atoms) {\r\n        cleanup();\r\n      }\r\n      fiber.atoms = null;\r\n    }\r\n\r\n    fiber.mask & PORTAL_HOST_MASK && platform.unmountPortal(fiber);\r\n  });\r\n}\r\n\r\nfunction unmountRoot(rootId: number, onCompleted: () => void) {\r\n  if (detectIsUndefined(rootId)) return;\r\n  const $scope = $$scope(rootId);\r\n\r\n  unmountFiber($scope.getRoot());\r\n  $scope.unsubscribeEvents();\r\n  removeScope(rootId);\r\n  onCompleted();\r\n}\r\n\r\nexport { unmountFiber, unmountRoot };\r\n","import { platform } from '../platform';\r\nimport {\r\n  CREATE_EFFECT_TAG,\r\n  UPDATE_EFFECT_TAG,\r\n  DELETE_EFFECT_TAG,\r\n  SKIP_EFFECT_TAG,\r\n  INSERTION_EFFECT_HOST_MASK,\r\n  LAYOUT_EFFECT_HOST_MASK,\r\n  ASYNC_EFFECT_HOST_MASK,\r\n  ATOM_HOST_MASK,\r\n  PORTAL_HOST_MASK,\r\n  MOVE_MASK,\r\n  FLUSH_MASK,\r\n  SHADOW_MASK,\r\n  Flag,\r\n} from '../constants';\r\nimport {\r\n  flatten,\r\n  error,\r\n  detectIsEmpty,\r\n  detectIsFalsy,\r\n  detectIsArray,\r\n  detectIsFunction,\r\n  detectIsTextBased,\r\n  createIndexKey,\r\n  trueFn,\r\n} from '../utils';\r\nimport { type Scope, setRootId, $$scope, replaceScope } from '../scope';\r\nimport { type Component, detectIsComponent } from '../component';\r\nimport { type ElementKey, type Instance } from '../shared';\r\nimport { Fiber, getHook, Hook } from '../fiber';\r\nimport {\r\n  Text,\r\n  detectIsVirtualNode,\r\n  detectIsVirtualNodeFactory,\r\n  getElementKey,\r\n  hasElementFlag,\r\n  hasChildrenProp,\r\n  detectIsReplacer,\r\n  createReplacer,\r\n  detectAreSameInstanceTypes,\r\n} from '../view';\r\nimport { detectIsMemo } from '../memo';\r\nimport {\r\n  walk,\r\n  getFiberWithElement,\r\n  detectIsFiberAlive,\r\n  notifyParents,\r\n  tryOptStaticSlot,\r\n  tryOptMemoSlot,\r\n} from '../walk';\r\nimport { type RestoreOptions, scheduler } from '../scheduler';\r\nimport { Fragment, detectIsFragment } from '../fragment';\r\nimport { unmountFiber } from '../unmount';\r\n\r\nlet hasPendingPromise = false;\r\nlet hasRenderError = false;\r\n\r\nexport type WorkLoop = (isAsync: boolean) => boolean;\r\n\r\nfunction workLoop(isAsync: boolean): boolean | null {\r\n  if (hasPendingPromise) return null;\r\n  if (hasRenderError) return false;\r\n  const $scope = $$scope();\r\n  const wipFiber = $scope.getWorkInProgress();\r\n  let unit = $scope.getNextUnitOfWork();\r\n  let shouldYield = false;\r\n  let hasMoreWork = Boolean(unit);\r\n\r\n  try {\r\n    while (unit && !shouldYield) {\r\n      unit = performUnitOfWork(unit, $scope);\r\n      $scope.setNextUnitOfWork(unit);\r\n      hasMoreWork = Boolean(unit);\r\n      shouldYield = isAsync && scheduler.shouldYield();\r\n      if (shouldYield && scheduler.hasPrimaryTask()) return fork($scope);\r\n    }\r\n\r\n    if (!unit && wipFiber) {\r\n      commit($scope);\r\n    }\r\n  } catch (err) {\r\n    if (err instanceof Promise) {\r\n      hasPendingPromise = true;\r\n      err.finally(() => {\r\n        hasPendingPromise = false;\r\n        !isAsync && workLoop(false);\r\n      });\r\n    } else {\r\n      hasRenderError = true;\r\n      throw err;\r\n    }\r\n  }\r\n\r\n  return hasMoreWork;\r\n}\r\n\r\nfunction performUnitOfWork(fiber: Fiber, $scope: Scope): Fiber | null {\r\n  const wipFiber = $scope.getWorkInProgress();\r\n  const isDeepWalking = $scope.getMountDeep();\r\n  const isStream = $scope.getIsStreamZone();\r\n  const hasChildren = isDeepWalking && hasChildrenProp(fiber.inst) && fiber.inst.children.length > 0;\r\n\r\n  fiber.hook && (fiber.hook.idx = 0);\r\n\r\n  if (hasChildren) {\r\n    const child = mountChild(fiber, $scope);\r\n\r\n    isStream && platform.chunk(child);\r\n\r\n    return child;\r\n  } else {\r\n    while (fiber.parent && fiber !== wipFiber) {\r\n      const next = mountSibling(fiber, $scope);\r\n\r\n      isStream && platform.chunk(fiber);\r\n\r\n      if (next) {\r\n        isStream && platform.chunk(next);\r\n        return next;\r\n      }\r\n\r\n      fiber = fiber.parent;\r\n    }\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\nfunction mountChild(parent: Fiber, $scope: Scope) {\r\n  $scope.navToChild();\r\n  const $inst = parent.inst;\r\n  const idx = 0;\r\n  const inst = hasChildrenProp($inst) ? $inst.children[idx] : null;\r\n  const alt = getAlternate(parent, inst, true, $scope);\r\n  const fiber = createFiber(alt, inst, idx);\r\n\r\n  fiber.parent = parent;\r\n  parent.child = fiber;\r\n  fiber.eidx = parent.element ? 0 : parent.eidx;\r\n\r\n  share(fiber, parent, inst, $scope);\r\n\r\n  return fiber;\r\n}\r\n\r\nfunction mountSibling(left: Fiber, $scope: Scope) {\r\n  $scope.navToSibling();\r\n  const $inst = left.parent.inst;\r\n  const idx = $scope.getMountIndex();\r\n  const inst = hasChildrenProp($inst) && $inst.children ? $inst.children[idx] : null;\r\n  const hasSibling = Boolean(inst);\r\n\r\n  if (!hasSibling) {\r\n    $scope.navToParent();\r\n    $scope.setMountDeep(false);\r\n\r\n    return null;\r\n  }\r\n\r\n  $scope.setMountDeep(true);\r\n  const alt = getAlternate(left, inst, false, $scope);\r\n  const fiber = createFiber(alt, inst, idx);\r\n\r\n  fiber.parent = left.parent;\r\n  left.next = fiber;\r\n  fiber.eidx = left.eidx + (left.element ? 1 : left.cec);\r\n\r\n  share(fiber, left, inst, $scope);\r\n\r\n  return fiber;\r\n}\r\n\r\nfunction share(fiber: Fiber, prev: Fiber, inst: Instance, $scope: Scope) {\r\n  const { alt } = fiber;\r\n  const shouldMount = alt && detectIsMemo(inst) ? shouldUpdate(fiber, inst, $scope) : true;\r\n\r\n  $scope.setCursorFiber(fiber);\r\n  fiber.inst = inst;\r\n\r\n  if (alt && alt.mask & MOVE_MASK) {\r\n    fiber.mask |= MOVE_MASK;\r\n    alt.mask &= ~MOVE_MASK;\r\n  }\r\n\r\n  fiber.hook && (fiber.hook.owner = fiber); // !\r\n\r\n  if (shouldMount) {\r\n    fiber.inst = mount(fiber, prev, $scope);\r\n    alt && reconcile(fiber, alt, $scope);\r\n    setup(fiber, alt);\r\n  } else if (fiber.mask & MOVE_MASK) {\r\n    fiber.tag = UPDATE_EFFECT_TAG;\r\n  }\r\n\r\n  $scope.addCandidate(fiber); // !\r\n}\r\n\r\nfunction createFiber(alt: Fiber, inst: Instance, idx: number) {\r\n  const fiber = new Fiber(getHook(alt, alt ? alt.inst : null, inst), alt ? alt.provider : null, idx);\r\n\r\n  fiber.alt = alt || null;\r\n\r\n  return fiber;\r\n}\r\n\r\nfunction getAlternate(fiber: Fiber, inst: Instance, fromChild: boolean, $scope: Scope) {\r\n  const key = getElementKey(inst);\r\n\r\n  if (key !== null) {\r\n    const parentId = fromChild ? fiber.id : fiber.parent.id;\r\n    const actions = $scope.getActionsById(parentId);\r\n\r\n    if (actions) {\r\n      const isMove = actions.move && Boolean(actions.move[key]);\r\n      const isStable = actions.stable && Boolean(actions.stable[key]);\r\n\r\n      if (isMove || isStable) {\r\n        const alt = actions.map[key];\r\n\r\n        isMove && (alt.mask |= MOVE_MASK);\r\n\r\n        return alt;\r\n      }\r\n\r\n      return null;\r\n    }\r\n  }\r\n\r\n  const alt = fiber.alt ? (fromChild ? fiber.alt.child || null : fiber.alt.next || null) : null;\r\n\r\n  return alt;\r\n}\r\n\r\nfunction reconcile(fiber: Fiber, alt: Fiber, $scope: Scope) {\r\n  const { id, inst } = fiber;\r\n  const areSameTypes = detectAreSameInstanceTypes(alt.inst, inst);\r\n\r\n  if (!areSameTypes) {\r\n    $scope.addDeletion(alt);\r\n  } else if (hasChildrenProp(alt.inst) && hasChildrenProp(inst) && alt.cc !== 0) {\r\n    const hasSameCount = alt.cc === inst.children.length;\r\n    const check = hasElementFlag(inst, Flag.SKIP_SCAN_OPT) ? !hasSameCount : true;\r\n\r\n    if (check) {\r\n      const { prevKeys, nextKeys, prevKeysMap, nextKeysMap, keyedFibersMap } = extractKeys(alt.child, inst.children);\r\n      const flush = nextKeys.length === 0;\r\n      let size = Math.max(prevKeys.length, nextKeys.length);\r\n      let p = 0;\r\n      let n = 0;\r\n\r\n      $scope.addActionMap(id, keyedFibersMap);\r\n\r\n      for (let i = 0; i < size; i++) {\r\n        const nextKey = nextKeys[i - n] ?? null;\r\n        const prevKey = prevKeys[i - p] ?? null;\r\n        const prevKeyFiber = keyedFibersMap[prevKey] || null;\r\n\r\n        if (nextKey !== prevKey) {\r\n          if (nextKey !== null && !prevKeysMap[nextKey]) {\r\n            if (prevKey !== null && !nextKeysMap[prevKey]) {\r\n              $scope.addReplaceAction(id, nextKey);\r\n              $scope.addDeletion(prevKeyFiber);\r\n            } else {\r\n              $scope.addInsertAction(id, nextKey);\r\n              p++;\r\n              size++;\r\n            }\r\n          } else if (!nextKeysMap[prevKey]) {\r\n            $scope.addRemoveAction(id, prevKey);\r\n            $scope.addDeletion(prevKeyFiber);\r\n            flush && (prevKeyFiber.mask |= FLUSH_MASK);\r\n            n++;\r\n            size++;\r\n          } else if (nextKeysMap[prevKey] && nextKeysMap[nextKey]) {\r\n            $scope.addMoveAction(id, nextKey);\r\n          }\r\n        } else if (nextKey !== null) {\r\n          $scope.addStableAction(id, nextKey);\r\n        }\r\n      }\r\n\r\n      hasElementFlag(inst, Flag.STATIC_SLOT_OPT) && tryOptStaticSlot(fiber, alt, $scope);\r\n      hasElementFlag(inst, Flag.MEMO_SLOT_OPT) && tryOptMemoSlot(fiber, alt, $scope);\r\n    }\r\n  }\r\n}\r\n\r\nfunction setup(fiber: Fiber, alt: Fiber) {\r\n  const inst = fiber.inst;\r\n  let isUpdate = false;\r\n\r\n  fiber.parent.tag === CREATE_EFFECT_TAG && (fiber.tag = fiber.parent.tag);\r\n  fiber.parent.mask & SHADOW_MASK && !fiber.parent.element && !detectIsReplacer(inst) && (fiber.mask |= SHADOW_MASK);\r\n  isUpdate =\r\n    alt &&\r\n    fiber.tag !== CREATE_EFFECT_TAG &&\r\n    detectAreSameInstanceTypes(alt.inst, inst) &&\r\n    getElementKey(alt.inst) === getElementKey(inst);\r\n  isUpdate && !fiber.element && alt.element && (fiber.element = alt.element);\r\n  fiber.tag = isUpdate ? UPDATE_EFFECT_TAG : CREATE_EFFECT_TAG;\r\n  hasChildrenProp(fiber.inst) && (fiber.cc = fiber.inst.children.length);\r\n  !fiber.element && detectIsVirtualNode(fiber.inst) && (fiber.element = platform.createElement(fiber.inst));\r\n  fiber.element && fiber.increment();\r\n}\r\n\r\nfunction shouldUpdate(fiber: Fiber, inst: Instance, $scope: Scope) {\r\n  if (process.env.NODE_ENV !== 'production') {\r\n    if ($scope.getIsHot()) return true;\r\n  }\r\n\r\n  const alt = fiber.alt;\r\n  const pc = alt.inst as Component;\r\n  const nc = inst as Component;\r\n\r\n  if (nc.type !== pc.type || nc.shouldUpdate(pc.props, nc.props)) return true;\r\n\r\n  $scope.setMountDeep(false);\r\n  fiber.tag = SKIP_EFFECT_TAG;\r\n  fiber.child = alt.child;\r\n  fiber.child.parent = fiber;\r\n  fiber.hook = alt.hook;\r\n  fiber.cc = alt.cc;\r\n  fiber.cec = alt.cec;\r\n  alt.element && (fiber.element = alt.element);\r\n  alt.provider && (fiber.provider = alt.provider);\r\n  alt.catch && (fiber.catch = alt.catch);\r\n  alt.atoms && (fiber.atoms = alt.atoms);\r\n\r\n  const diff = fiber.eidx - alt.eidx;\r\n  const deep = diff !== 0;\r\n\r\n  if (deep) {\r\n    walk(fiber.child, ($fiber, skip) => {\r\n      $fiber.eidx += diff;\r\n      if ($fiber.element) return skip();\r\n    });\r\n  }\r\n\r\n  notifyParents(fiber, alt);\r\n\r\n  return false;\r\n}\r\n\r\nfunction mount(fiber: Fiber, prev: Fiber, $scope: Scope) {\r\n  let inst = fiber.inst;\r\n  const isComponent = detectIsComponent(inst);\r\n  const component = inst as Component;\r\n\r\n  if (isComponent) {\r\n    try {\r\n      const id = $scope.getResourceId();\r\n      let result = component.type(component.props, component.ref);\r\n      const defers = $scope.getDefers();\r\n\r\n      if (defers.length > 0) {\r\n        const promise = Promise.all(defers.map(x => x()));\r\n\r\n        $scope.setResourceId(id);\r\n        $scope.resetDefers();\r\n        $scope.navToPrev();\r\n        $scope.setNextUnitOfWork(prev);\r\n        Fiber.setNextId(prev.id);\r\n\r\n        throw promise;\r\n      }\r\n\r\n      if (detectIsArray(result)) {\r\n        !detectIsFragment(component) && (result = Fragment({ slot: result }));\r\n      } else if (detectIsTextBased(result)) {\r\n        result = Text(result);\r\n      }\r\n\r\n      component.children = result as Array<Instance>;\r\n      platform.detectIsPortal(inst) && fiber.markHost(PORTAL_HOST_MASK);\r\n    } catch (err) {\r\n      if (err instanceof Promise) throw err;\r\n      component.children = [];\r\n      fiber.setError(err);\r\n      error(err);\r\n    }\r\n  } else if (detectIsVirtualNodeFactory(inst)) {\r\n    inst = inst();\r\n  }\r\n\r\n  if (hasChildrenProp(inst)) {\r\n    inst.children = flatten(inst.children, x => (detectIsTextBased(x) ? Text(x) : x || supportConditional(x)));\r\n    isComponent && component.children.length === 0 && component.children.push(createReplacer());\r\n  }\r\n\r\n  return inst;\r\n}\r\n\r\nfunction extractKeys(alt: Fiber, children: Array<Instance>) {\r\n  let nextFiber = alt;\r\n  let idx = 0;\r\n  const prevKeys: Array<ElementKey> = [];\r\n  const nextKeys: Array<ElementKey> = [];\r\n  const prevKeysMap: Record<ElementKey, boolean> = {};\r\n  const nextKeysMap: Record<ElementKey, boolean> = {};\r\n  const keyedFibersMap: Record<ElementKey, Fiber> = {};\r\n  const usedKeysMap: Record<ElementKey, boolean> = {};\r\n\r\n  while (nextFiber || idx < children.length) {\r\n    if (nextFiber) {\r\n      const key = getElementKey(nextFiber.inst);\r\n      const prevKey = detectIsEmpty(key) ? createIndexKey(idx) : key;\r\n\r\n      if (!prevKeysMap[prevKey]) {\r\n        prevKeysMap[prevKey] = true; // !\r\n        prevKeys.push(prevKey);\r\n      }\r\n\r\n      keyedFibersMap[prevKey] = nextFiber;\r\n    }\r\n\r\n    if (children[idx]) {\r\n      const inst = children[idx];\r\n      const key = getElementKey(inst);\r\n      const nextKey = detectIsEmpty(key) ? createIndexKey(idx) : key;\r\n\r\n      if (process.env.NODE_ENV !== 'production') {\r\n        if (usedKeysMap[nextKey]) {\r\n          error(`[Dark]: The key of node [${nextKey}] already has been used!`, [inst]);\r\n        }\r\n      }\r\n\r\n      if (!nextKeysMap[nextKey]) {\r\n        nextKeysMap[nextKey] = true; // !\r\n        nextKeys.push(nextKey);\r\n      }\r\n\r\n      usedKeysMap[nextKey] = true;\r\n    }\r\n\r\n    nextFiber = nextFiber ? nextFiber.next : null;\r\n    idx++;\r\n  }\r\n\r\n  return {\r\n    prevKeys,\r\n    nextKeys,\r\n    prevKeysMap,\r\n    nextKeysMap,\r\n    keyedFibersMap,\r\n  };\r\n}\r\n\r\nfunction supportConditional(inst: Instance) {\r\n  return detectIsFalsy(inst) ? createReplacer() : inst;\r\n}\r\n\r\nfunction commit($scope: Scope) {\r\n  if (process.env.NODE_ENV !== 'production') {\r\n    process.env.NODE_ENV === 'development' && $scope.setIsHot(false);\r\n  }\r\n\r\n  const wipFiber = $scope.getWorkInProgress();\r\n  const deletions = $scope.getDeletions();\r\n  const candidates = $scope.getCandidates();\r\n  const isUpdateZone = $scope.getIsUpdateZone();\r\n  const unmounts: Array<Fiber> = [];\r\n  const combinedMask = INSERTION_EFFECT_HOST_MASK | LAYOUT_EFFECT_HOST_MASK | ASYNC_EFFECT_HOST_MASK | PORTAL_HOST_MASK;\r\n\r\n  // !\r\n  for (const fiber of deletions) {\r\n    const withNextTick = fiber.mask & ATOM_HOST_MASK && !(fiber.mask & combinedMask);\r\n\r\n    withNextTick ? unmounts.push(fiber) : unmountFiber(fiber);\r\n    fiber.tag = DELETE_EFFECT_TAG;\r\n    platform.commit(fiber);\r\n  }\r\n\r\n  isUpdateZone && sync(wipFiber);\r\n  $scope.runInsertionEffects();\r\n\r\n  for (const fiber of candidates) {\r\n    fiber.tag !== SKIP_EFFECT_TAG && platform.commit(fiber);\r\n    fiber.alt = null;\r\n    hasChildrenProp(fiber.inst) && (fiber.inst.children = null);\r\n  }\r\n\r\n  wipFiber.alt = null;\r\n  platform.finishCommit(); // !\r\n  $scope.runLayoutEffects();\r\n  $scope.runAsyncEffects();\r\n  unmounts.length > 0 && setTimeout(() => unmounts.forEach(x => unmountFiber(x)));\r\n  flush($scope);\r\n}\r\n\r\nfunction flush($scope: Scope, cancel = false) {\r\n  $scope.flush();\r\n  !cancel && $scope.getEmitter().emit('finish');\r\n  $scope.runAfterCommit(); // !\r\n}\r\n\r\nfunction sync(fiber: Fiber) {\r\n  const diff = fiber.cec - fiber.alt.cec;\r\n  if (diff === 0) return;\r\n  const parentFiber = getFiberWithElement(fiber.parent);\r\n  let isRight = false;\r\n\r\n  fiber.increment(diff, true);\r\n\r\n  walk(parentFiber.child, ($fiber, skip) => {\r\n    if ($fiber === fiber) {\r\n      isRight = true;\r\n      return skip();\r\n    }\r\n\r\n    $fiber.element && skip();\r\n    isRight && ($fiber.eidx += diff);\r\n  });\r\n}\r\n\r\nfunction fork($scope: Scope): false {\r\n  const $$scope$ = $scope.copy();\r\n  const wipFiber = $scope.getWorkInProgress();\r\n  const child = wipFiber.child;\r\n  child && (child.parent = null);\r\n  const restore = (options: RestoreOptions) => {\r\n    const { fiber: wipFiber, setValue, resetValue } = options;\r\n    const $scope = $$scope();\r\n\r\n    detectIsFunction(setValue) && setValue();\r\n    detectIsFunction(resetValue) && $$scope$.addCancel(resetValue);\r\n\r\n    wipFiber.alt = new Fiber().mutate(wipFiber);\r\n    wipFiber.tag = UPDATE_EFFECT_TAG;\r\n    wipFiber.child = child;\r\n    child && (child.parent = wipFiber);\r\n\r\n    if (process.env.NODE_ENV !== 'production') {\r\n      wipFiber.marker = '';\r\n    }\r\n\r\n    $$scope$.setRoot($scope.getRoot());\r\n    $$scope$.setWorkInProgress(wipFiber);\r\n    replaceScope($$scope$);\r\n  };\r\n\r\n  wipFiber.child = wipFiber.alt.child;\r\n  wipFiber.alt = null;\r\n  $scope.applyCancels();\r\n  flush($scope, true);\r\n  scheduler.cancelTask(restore);\r\n\r\n  return false;\r\n}\r\n\r\nexport type CreateUpdateOptions = {\r\n  rootId: number;\r\n  isTransition?: boolean;\r\n  hook: Hook;\r\n  createChanger?: () => UpdateChanger;\r\n};\r\n\r\nexport type UpdateChanger = {\r\n  shouldUpdate: () => boolean;\r\n} & Pick<RestoreOptions, 'setValue' | 'resetValue'>;\r\n\r\nfunction createUpdate(options: CreateUpdateOptions) {\r\n  const { rootId, hook, isTransition, createChanger = $createChanger } = options;\r\n  const callback = (restore?: (options: RestoreOptions) => void) => {\r\n    setRootId(rootId); // !\r\n    const fromRestore = detectIsFunction(restore);\r\n    const { shouldUpdate, setValue, resetValue } = createChanger();\r\n    const $scope = $$scope();\r\n    const owner = hook.owner;\r\n    const fiber = owner.alt || owner;\r\n\r\n    if (!shouldUpdate() || !detectIsFiberAlive(fiber) || fromRestore) {\r\n      fromRestore && restore({ fiber, setValue, resetValue });\r\n      return;\r\n    }\r\n\r\n    detectIsFunction(setValue) && setValue();\r\n    detectIsFunction(resetValue) && isTransition && $scope.addCancel(resetValue);\r\n\r\n    fiber.alt = new Fiber().mutate(fiber);\r\n    fiber.tag = UPDATE_EFFECT_TAG;\r\n    fiber.cc = 0;\r\n    fiber.cec = 0;\r\n    fiber.child = null;\r\n\r\n    if (process.env.NODE_ENV !== 'production') {\r\n      fiber.marker = '';\r\n    }\r\n\r\n    $scope.setIsUpdateZone(true);\r\n    $scope.resetMount();\r\n    $scope.setWorkInProgress(fiber);\r\n    $scope.setCursorFiber(fiber);\r\n    fiber.inst = mount(fiber, null, $scope);\r\n    $scope.setNextUnitOfWork(fiber);\r\n  };\r\n\r\n  return callback;\r\n}\r\n\r\nconst $createChanger = (): UpdateChanger => ({\r\n  shouldUpdate: trueFn,\r\n  setValue: null,\r\n  resetValue: null,\r\n});\r\n\r\nconst detectIsBusy = () => Boolean($$scope()?.getWorkInProgress());\r\n\r\nexport { Fiber, workLoop, createUpdate, detectIsBusy };\r\n","import { type WorkLoop, workLoop, detectIsBusy } from '../workloop';\r\nimport { type SetPendingStatus } from '../start-transition';\r\nimport { type Callback } from '../shared';\r\nimport { type Fiber } from '../fiber';\r\nimport { ROOT, HOOK_DELIMETER, YIELD_INTERVAL, TaskPriority } from '../constants';\r\nimport { getTime, detectIsFunction, nextTick } from '../utils';\r\nimport { EventEmitter } from '../emitter';\r\nimport { platform } from '../platform';\r\n\r\nclass MessageChannel extends EventEmitter<PortEvent> {\r\n  port1: MessagePort = null;\r\n  port2: MessagePort = null;\r\n\r\n  constructor() {\r\n    super();\r\n    this.port1 = new MessagePort(this);\r\n    this.port2 = new MessagePort(this);\r\n  }\r\n}\r\n\r\nclass MessagePort {\r\n  channel: MessageChannel;\r\n  offs: Array<Callback> = [];\r\n\r\n  constructor(channel: MessageChannel) {\r\n    this.channel = channel;\r\n  }\r\n\r\n  on(event: PortEvent, callback: PortListener) {\r\n    const off = this.channel.on(event, callback);\r\n\r\n    this.offs.push(off);\r\n  }\r\n\r\n  postMessage(value: unknown) {\r\n    platform.spawn(() => {\r\n      this.channel.emit('message', value);\r\n    });\r\n  }\r\n\r\n  unref() {\r\n    this.offs.forEach(x => x());\r\n  }\r\n}\r\n\r\nclass Scheduler {\r\n  private queue: Record<TaskPriority, Array<Task>> = {\r\n    [TaskPriority.HIGH]: [],\r\n    [TaskPriority.NORMAL]: [],\r\n    [TaskPriority.LOW]: [],\r\n  };\r\n  private deadline = 0;\r\n  private task: Task = null;\r\n  private scheduledCallback: WorkLoop = null;\r\n  private isMessageLoopRunning = false;\r\n  private channel: MessageChannel = null;\r\n  private port: MessagePort = null;\r\n\r\n  constructor() {\r\n    this.channel = new MessageChannel();\r\n    this.port = this.channel.port2;\r\n    this.channel.port1.on('message', this.performWorkUntilDeadline.bind(this));\r\n  }\r\n\r\n  reset() {\r\n    this.deadline = 0;\r\n    this.task = null;\r\n    this.scheduledCallback = null;\r\n    this.isMessageLoopRunning = false;\r\n  }\r\n\r\n  shouldYield() {\r\n    return getTime() >= this.deadline;\r\n  }\r\n\r\n  schedule(callback: Callback, options?: ScheduleCallbackOptions) {\r\n    const {\r\n      priority = TaskPriority.NORMAL,\r\n      forceAsync = false,\r\n      isTransition = false,\r\n      createLocation,\r\n      setPendingStatus,\r\n    } = options || {};\r\n    const task = new Task(callback, priority, forceAsync);\r\n\r\n    task.setIsTransition(isTransition);\r\n    task.setPendingSetter(setPendingStatus);\r\n    task.setLocationCreator(createLocation || createRootLocation);\r\n    this.put(task);\r\n    this.execute();\r\n  }\r\n\r\n  hasPrimaryTask() {\r\n    if (!this.task.getIsTransition()) return false;\r\n    const { high, normal, low } = this.getQueues();\r\n    const hasPrimary = high.length > 0 || normal.length > 0;\r\n    const hasLow = low.length > 0;\r\n\r\n    if (hasPrimary || hasLow) {\r\n      const loc = this.task.createLocation();\r\n\r\n      if (hasPrimary) {\r\n        const has = Task.detectHasRelatedUpdate(loc, high, true) || Task.detectHasRelatedUpdate(loc, normal, true);\r\n\r\n        if (has) {\r\n          this.task.markAsUnnecessary();\r\n        }\r\n\r\n        return true;\r\n      }\r\n\r\n      if (hasLow) {\r\n        const has = Task.detectHasRelatedUpdate(loc, low);\r\n\r\n        if (has) {\r\n          this.task.markAsUnnecessary();\r\n\r\n          return true;\r\n        }\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  cancelTask(fn: TaskRestorer) {\r\n    if (this.task.getIsUnnecessary()) return this.complete(this.task);\r\n    this.task.setTaskRestorer(fn);\r\n    this.defer(this.task);\r\n  }\r\n\r\n  private complete(task: Task) {\r\n    task.pending(false);\r\n  }\r\n\r\n  private put(task: Task) {\r\n    const queue = this.queue[task.getPriority()];\r\n\r\n    if (task.getIsTransition()) {\r\n      const loc = task.createLocation();\r\n      const tasks = queue.filter(x => x.createLocation() !== loc);\r\n\r\n      queue.splice(0, queue.length, ...tasks);\r\n    }\r\n\r\n    queue.push(task);\r\n  }\r\n\r\n  private pick(queue: Array<Task>) {\r\n    if (queue.length === 0) return false;\r\n    this.task = queue.shift();\r\n\r\n    if (this.task.getIsTransition() && this.task.canPending()) {\r\n      const task = this.task;\r\n\r\n      task.markAsPending();\r\n      this.defer(this.task);\r\n      this.task = null;\r\n\r\n      nextTick(() => task.pending(true));\r\n\r\n      return true;\r\n    }\r\n\r\n    this.task.run();\r\n    this.task.getForceAsync() ? this.requestCallbackAsync(workLoop) : this.requestCallback(workLoop);\r\n\r\n    return true;\r\n  }\r\n\r\n  private execute() {\r\n    const isBusy = detectIsBusy();\r\n    const { high, normal, low } = this.getQueues();\r\n\r\n    if (!isBusy && !this.isMessageLoopRunning) {\r\n      this.pick(high) || this.pick(normal) || this.pick(low);\r\n    }\r\n  }\r\n\r\n  private requestCallbackAsync(callback: WorkLoop) {\r\n    this.scheduledCallback = callback;\r\n\r\n    if (!this.isMessageLoopRunning) {\r\n      this.isMessageLoopRunning = true;\r\n      this.port.postMessage(null);\r\n    }\r\n  }\r\n\r\n  private requestCallback(callback: WorkLoop) {\r\n    callback(false);\r\n    this.task = null;\r\n    this.execute();\r\n  }\r\n\r\n  private performWorkUntilDeadline() {\r\n    if (this.scheduledCallback) {\r\n      this.deadline = getTime() + YIELD_INTERVAL;\r\n      const hasMoreWork = this.scheduledCallback(true);\r\n\r\n      if (hasMoreWork) {\r\n        this.port.postMessage(null);\r\n      } else {\r\n        if (hasMoreWork === null) {\r\n          setTimeout(() => this.port.postMessage(null)); // has promise\r\n        } else {\r\n          this.complete(this.task);\r\n          this.reset();\r\n          this.execute();\r\n        }\r\n      }\r\n    } else {\r\n      this.isMessageLoopRunning = false;\r\n    }\r\n  }\r\n\r\n  private defer(task: Task) {\r\n    const { low } = this.getQueues();\r\n\r\n    low.unshift(task);\r\n  }\r\n\r\n  private getQueues() {\r\n    const high = this.queue[TaskPriority.HIGH];\r\n    const normal = this.queue[TaskPriority.NORMAL];\r\n    const low = this.queue[TaskPriority.LOW];\r\n\r\n    return {\r\n      high,\r\n      normal,\r\n      low,\r\n    };\r\n  }\r\n}\r\n\r\ntype TaskCallback = (fn: TaskRestorer) => void;\r\ntype TaskRestorer = (options: RestoreOptions) => void;\r\ntype LocationCreator = () => string;\r\n\r\nclass Task {\r\n  private id: number;\r\n  private priority: TaskPriority;\r\n  private forceAsync: boolean;\r\n  private isTransition: boolean;\r\n  private isPending: boolean;\r\n  private isUnnecessary: boolean;\r\n  private callback: TaskCallback;\r\n  private taskRestorer?: TaskRestorer = null;\r\n  private locationCreator?: LocationCreator;\r\n  private pendingSetter?: SetPendingStatus = null;\r\n  private static nextTaskId = 0;\r\n\r\n  constructor(callback: TaskCallback, priority: TaskPriority, forceAsync: boolean) {\r\n    this.id = ++Task.nextTaskId;\r\n    this.callback = callback;\r\n    this.priority = priority;\r\n    this.forceAsync = forceAsync;\r\n  }\r\n\r\n  getPriority() {\r\n    return this.priority;\r\n  }\r\n\r\n  getForceAsync() {\r\n    return this.forceAsync;\r\n  }\r\n\r\n  setIsTransition(value: boolean) {\r\n    this.isTransition = value;\r\n  }\r\n\r\n  getIsTransition() {\r\n    return this.isTransition;\r\n  }\r\n\r\n  run() {\r\n    this.callback(this.taskRestorer);\r\n    this.taskRestorer = null;\r\n  }\r\n\r\n  pending(value: boolean) {\r\n    this.isTransition && this.pendingSetter && this.pendingSetter(value);\r\n  }\r\n\r\n  markAsPending() {\r\n    this.isPending = true;\r\n  }\r\n\r\n  canPending() {\r\n    return !this.isPending && detectIsFunction(this.pendingSetter);\r\n  }\r\n\r\n  markAsUnnecessary() {\r\n    this.isUnnecessary = true;\r\n  }\r\n\r\n  getIsUnnecessary() {\r\n    return this.isUnnecessary;\r\n  }\r\n\r\n  setTaskRestorer(fn: TaskRestorer) {\r\n    this.taskRestorer = fn;\r\n  }\r\n\r\n  setLocationCreator(fn: LocationCreator) {\r\n    this.locationCreator = fn;\r\n  }\r\n\r\n  createLocation() {\r\n    return this.locationCreator();\r\n  }\r\n\r\n  setPendingSetter(fn: SetPendingStatus) {\r\n    this.pendingSetter = fn;\r\n  }\r\n\r\n  static detectHasRelatedUpdate(loc: string, tasks: Array<Task>, deep = false) {\r\n    const [$loc] = loc.split(HOOK_DELIMETER);\r\n\r\n    return tasks.some(x => {\r\n      const $$loc = x.createLocation();\r\n      const has = $$loc === loc || (deep && $$loc.length > loc.length && $$loc.indexOf($loc) !== -1);\r\n\r\n      return has;\r\n    });\r\n  }\r\n}\r\n\r\nconst createRootLocation: LocationCreator = () => ROOT;\r\n\r\ntype PortEvent = 'message';\r\ntype PortListener = (value: unknown) => void;\r\n\r\nexport type RestoreOptions = {\r\n  fiber: Fiber;\r\n  setValue?: () => void;\r\n  resetValue?: () => void;\r\n};\r\n\r\nexport type ScheduleCallbackOptions = {\r\n  priority?: TaskPriority;\r\n  forceAsync?: boolean;\r\n  isTransition?: boolean;\r\n  createLocation?: () => string;\r\n  setPendingStatus?: SetPendingStatus;\r\n  onCompleted?: () => void;\r\n};\r\n\r\nconst scheduler = new Scheduler();\r\n\r\nexport { scheduler };\r\n","import { type ScheduleCallbackOptions, scheduler } from '../scheduler';\r\nimport { type UpdateChanger, createUpdate } from '../workloop';\r\nimport { getRootId, $$scope } from '../scope';\r\nimport { TaskPriority } from '../constants';\r\nimport { addBatch } from '../batch';\r\nimport { detectIsFunction } from '../utils';\r\nimport { createHookLocation } from '../walk';\r\n\r\nexport type UpdateOptions = UpdateChanger;\r\n\r\nfunction useUpdate() {\r\n  const rootId = getRootId();\r\n  const fiber = $$scope().getCursorFiber();\r\n  const hook = fiber.hook; // !\r\n  const { idx } = hook;\r\n  const update = (createChanger?: () => UpdateChanger) => {\r\n    const $scope = $$scope();\r\n    if ($scope.getIsInsertionEffectsZone()) return;\r\n    const { owner } = hook;\r\n    const hasChanger = detectIsFunction(createChanger);\r\n    const isTransition = $scope.getIsTransitionZone();\r\n    const isBatch = $scope.getIsBatchZone();\r\n    const isEvent = $scope.getIsEventZone();\r\n    const priority = isTransition ? TaskPriority.LOW : isEvent ? TaskPriority.HIGH : TaskPriority.NORMAL; // !\r\n    const forceAsync = isTransition;\r\n    const setPendingStatus = $scope.getPendingStatusSetter();\r\n    const callback = createUpdate({\r\n      rootId,\r\n      hook,\r\n      isTransition,\r\n      createChanger: hasChanger ? createChanger : undefined,\r\n    });\r\n    const createLocation = () => createHookLocation(rootId, idx, owner);\r\n    const callbackOptions: ScheduleCallbackOptions = {\r\n      priority,\r\n      forceAsync,\r\n      isTransition,\r\n      createLocation,\r\n      setPendingStatus,\r\n    };\r\n\r\n    if (isBatch) {\r\n      addBatch(\r\n        owner,\r\n        () => scheduler.schedule(callback, callbackOptions),\r\n        () => hasChanger && createChanger().setValue(),\r\n      );\r\n    } else {\r\n      scheduler.schedule(callback, callbackOptions);\r\n    }\r\n  };\r\n\r\n  return update;\r\n}\r\n\r\nexport { useUpdate };\r\n","import { $$scope } from '../scope';\r\nimport { type Fiber } from '../fiber';\r\nimport { type Callback } from '../shared';\r\n\r\nfunction batch(callback: () => void) {\r\n  const $scope = $$scope();\r\n\r\n  $scope.setIsBatchZone(true);\r\n  callback();\r\n  $scope.setIsBatchZone(false);\r\n}\r\n\r\nfunction addBatch(fiber: Fiber, callback: Callback, change: Callback) {\r\n  const $scope = $$scope();\r\n\r\n  if ($scope.getIsTransitionZone()) {\r\n    callback();\r\n  } else {\r\n    const batch = fiber.batch || { timer: null, changes: [] };\r\n\r\n    fiber.batch = batch;\r\n    batch.changes.push(change);\r\n    batch.timer && clearTimeout(batch.timer);\r\n    batch.timer = setTimeout(() => {\r\n      batch.changes.splice(-1);\r\n      batch.changes.forEach(x => x());\r\n      fiber.batch = null;\r\n      callback();\r\n    });\r\n  }\r\n}\r\n\r\nexport { batch, addBatch };\r\n","import { detectIsString, detectIsFunction } from '../utils';\r\nimport { type TagVirtualNodeFactory, type ViewOptions, View } from '../view';\r\nimport { type ComponentFactory } from '../component';\r\n\r\nfunction createElement(\r\n  element: string | Function,\r\n  props: object,\r\n  ...slot: Array<any>\r\n): ComponentFactory | TagVirtualNodeFactory | null {\r\n  if (detectIsString(element)) {\r\n    const options = (props || {}) as ViewOptions;\r\n\r\n    options.as = element;\r\n    options.slot = slot;\r\n\r\n    return View(options);\r\n  }\r\n\r\n  if (detectIsFunction(element)) {\r\n    const options = (props || {}) as { slot: unknown };\r\n\r\n    options.slot = slot.length === 1 ? slot[0] : slot;\r\n\r\n    return element(options);\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\nexport { createElement, createElement as h };\r\n","import { detectIsObject, detectIsNull, detectIsFunction } from '../utils';\r\nimport type { Component, ComponentFactory } from '../component';\r\nimport type { RefProps, KeyProps, FlagProps } from '../shared';\r\nimport { useMemo } from '../use-memo';\r\n\r\nfunction forwardRef<P extends object, R>(\r\n  component: ComponentFactory<P, R>,\r\n): ComponentFactory<P & RefProps<R> & KeyProps & FlagProps, R> {\r\n  type Props = P & RefProps<R>;\r\n\r\n  return (props: Props) => {\r\n    const { ref, ...rest } = (props || {}) as Props;\r\n\r\n    return component(rest as P, ref) as Component<P, R>;\r\n  };\r\n}\r\n\r\nfunction detectIsMutableRef(ref: unknown): ref is MutableRef {\r\n  if (!detectIsObject(ref) || detectIsNull(ref)) return false;\r\n  const mutableRef = ref as MutableRef;\r\n\r\n  for (const key in mutableRef) {\r\n    if (key === 'current' && mutableRef.hasOwnProperty(key)) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nfunction applyRef<T>(ref: Ref<T>, current: T) {\r\n  if (detectIsFunction(ref)) {\r\n    ref(current);\r\n  } else if (detectIsMutableRef(ref)) {\r\n    ref.current = current;\r\n  }\r\n}\r\n\r\nfunction useRef<T>(initialValue: T = null): MutableRef<T> {\r\n  const ref = useMemo(() => ({ current: initialValue }), []) as MutableRef<T>;\r\n\r\n  return ref;\r\n}\r\n\r\nexport type MutableRef<T = unknown> = {\r\n  current: T;\r\n};\r\n\r\nexport type FunctionRef<T = unknown> = (ref: T) => void;\r\n\r\nexport type Ref<T = unknown> = MutableRef<T> | FunctionRef<T>;\r\n\r\nexport { forwardRef, detectIsMutableRef, applyRef, useRef };\r\n","import { type DarkElement, type Fiber, component, useMemo, $$scope, detectIsComponent } from '@dark-engine/core';\r\n\r\nimport type { TagNativeElement } from '../native-element';\r\n\r\nconst $$portal = Symbol('portal');\r\n\r\nfunction createPortal(slot: DarkElement, container: TagNativeElement) {\r\n  if (process.env.NODE_ENV !== 'production') {\r\n    if (!(container instanceof Element)) {\r\n      throw new Error(`[Dark]: createPortal receives only Element as container!`);\r\n    }\r\n  }\r\n\r\n  return Portal({ container, slot });\r\n}\r\n\r\ntype PortalProps = {\r\n  container: TagNativeElement;\r\n  slot: DarkElement;\r\n};\r\n\r\nconst Portal = component<PortalProps>(\r\n  props => {\r\n    const element = props.container;\r\n    const fiber = $$scope().getCursorFiber();\r\n\r\n    useMemo(() => (element.innerHTML = ''), []);\r\n\r\n    fiber.element = element;\r\n    props.container = null;\r\n\r\n    return props.slot;\r\n  },\r\n  { token: $$portal },\r\n);\r\n\r\nconst detectIsPortal = (instance: unknown) => detectIsComponent(instance) && instance.token === $$portal;\r\n\r\nconst getPortalContainer = (fiber: Fiber<TagNativeElement>): TagNativeElement | null =>\r\n  detectIsPortal(fiber.inst) ? fiber.element : null;\r\n\r\nfunction unmountPortal(fiber: Fiber<TagNativeElement>) {\r\n  const element = getPortalContainer(fiber);\r\n\r\n  element && (element.innerHTML = '');\r\n}\r\n\r\nexport { createPortal, unmountPortal, detectIsPortal };\r\n","import { detectIsFunction, $$scope, detectIsArray } from '@dark-engine/core';\r\n\r\nimport type { TagNativeElement } from '../native-element';\r\n\r\ntype BrowserEventConstructor = (type: string, event: Event) => void;\r\n\r\nclass SyntheticEvent<E extends Event, T = TagNativeElement> {\r\n  public type = '';\r\n  public sourceEvent: E = null;\r\n  public target: T = null;\r\n  private propagation = true;\r\n\r\n  constructor(options: Pick<SyntheticEvent<E, T>, 'sourceEvent' | 'target'>) {\r\n    this.type = options.sourceEvent.type;\r\n    this.sourceEvent = options.sourceEvent;\r\n    this.target = options.target;\r\n  }\r\n\r\n  public stopPropagation() {\r\n    this.propagation = false;\r\n    this.sourceEvent.stopPropagation();\r\n  }\r\n\r\n  public preventDefault() {\r\n    this.sourceEvent.preventDefault();\r\n  }\r\n\r\n  public getPropagation() {\r\n    return this.propagation;\r\n  }\r\n}\r\n\r\nfunction delegateEvent(\r\n  target: Element,\r\n  eventName: string,\r\n  handler: (e: Event) => void | [fn: () => void, ...args: Array<any>],\r\n) {\r\n  const $scope = $$scope();\r\n  const eventsMap = $scope.getEvents();\r\n  const handlersMap = eventsMap.get(eventName);\r\n  const $handler = detectIsArray(handler) ? (e: Event) => handler[0](...handler.slice(1), e) : handler;\r\n\r\n  if (!handlersMap) {\r\n    const rootHandler = (event: Event) => {\r\n      const handler = eventsMap.get(eventName).get(event.target);\r\n      const target = event.target as TagNativeElement;\r\n      let $event: SyntheticEvent<Event> = null;\r\n\r\n      if (detectIsFunction(handler)) {\r\n        $event = new SyntheticEvent({ sourceEvent: event, target });\r\n\r\n        $scope.setIsEventZone(true);\r\n        handler($event);\r\n        $scope.setIsEventZone(false);\r\n      }\r\n\r\n      if (target.parentElement) {\r\n        const shouldPropagate = $event ? $event.getPropagation() : true;\r\n\r\n        if (shouldPropagate) {\r\n          const constructor = event.constructor as BrowserEventConstructor;\r\n\r\n          target.parentElement.dispatchEvent(new constructor(event.type, event));\r\n        }\r\n      }\r\n    };\r\n\r\n    eventsMap.set(eventName, new WeakMap([[target, $handler]]));\r\n    document.addEventListener(eventName, rootHandler, true);\r\n    $scope.addEventUnsubscriber(() => document.removeEventListener(eventName, rootHandler, true));\r\n  } else {\r\n    handlersMap.set(target, $handler);\r\n  }\r\n}\r\n\r\nconst detectIsEvent = (attrName: string) => attrName.startsWith('on');\r\n\r\nconst getEventName = (attrName: string) => attrName.slice(2, attrName.length).toLowerCase();\r\n\r\nexport { SyntheticEvent, delegateEvent, detectIsEvent, getEventName };\r\n","export const VERSION = '0.25.1';\r\nexport const STYLE_ATTR = 'style';\r\nexport const CLASS_ATTR = 'class';\r\nexport const CLASS_NAME_ATTR = 'className';\r\nexport const EXCLUDE_ATTR_MARK = '$';\r\n","import {\r\n  type Fiber,\r\n  type VirtualNode,\r\n  type TagVirtualNode,\r\n  type TextVirtualNode,\r\n  type CommentVirtualNode,\r\n  type PlainVirtualNode,\r\n  type Callback,\r\n  REF_ATTR,\r\n  ATTR_BLACK_LIST,\r\n  CREATE_EFFECT_TAG,\r\n  UPDATE_EFFECT_TAG,\r\n  DELETE_EFFECT_TAG,\r\n  SKIP_EFFECT_TAG,\r\n  MOVE_MASK,\r\n  FLUSH_MASK,\r\n  SHADOW_MASK,\r\n  detectIsUndefined,\r\n  detectIsBoolean,\r\n  detectIsObject,\r\n  NodeType,\r\n  detectIsTagVirtualNode,\r\n  detectIsTextVirtualNode,\r\n  detectIsPlainVirtualNode,\r\n  getFiberWithElement,\r\n  collectElements,\r\n  walk,\r\n  dummyFn,\r\n  $$scope,\r\n  applyRef,\r\n} from '@dark-engine/core';\r\n\r\nimport { detectIsPortal } from '../portal';\r\nimport { delegateEvent, detectIsEvent, getEventName } from '../events';\r\nimport { STYLE_ATTR, CLASS_ATTR, CLASS_NAME_ATTR, EXCLUDE_ATTR_MARK } from '../constants';\r\nimport type {\r\n  NativeElement,\r\n  TagNativeElement,\r\n  TextNativeElement,\r\n  CommentNativeElement,\r\n  NativeNode,\r\n  AttributeValue,\r\n} from '../native-element';\r\n\r\nlet moves: Array<Callback> = [];\r\nlet patches: Array<Callback> = [];\r\nlet trackUpdate: (nativeElement: NativeElement) => void = null;\r\nconst svgTagNames = new Set([\r\n  'svg',\r\n  'animate',\r\n  'animateMotion',\r\n  'animateTransform',\r\n  'circle',\r\n  'clipPath',\r\n  'defs',\r\n  'desc',\r\n  'ellipse',\r\n  'feBlend',\r\n  'feColorMatrix',\r\n  'feComponentTransfer',\r\n  'feComposite',\r\n  'feConvolveMatrix',\r\n  'feDiffuseLighting',\r\n  'feDisplacementMap',\r\n  'feDistantLight',\r\n  'feDropShadow',\r\n  'feFlood',\r\n  'feFuncA',\r\n  'feFuncB',\r\n  'feFuncG',\r\n  'feFuncR',\r\n  'feGaussianBlur',\r\n  'feImage',\r\n  'feMerge',\r\n  'feMergeNode',\r\n  'feMorphology',\r\n  'feOffset',\r\n  'fePointLight',\r\n  'feSpecularLighting',\r\n  'feSpotLight',\r\n  'feTile',\r\n  'feTurbulence',\r\n  'filter',\r\n  'foreignObject',\r\n  'g',\r\n  'image',\r\n  'line',\r\n  'linearGradient',\r\n  'marker',\r\n  'mask',\r\n  'metadata',\r\n  'mpath',\r\n  'path',\r\n  'pattern',\r\n  'polygon',\r\n  'polyline',\r\n  'radialGradient',\r\n  'rect',\r\n  'stop',\r\n  'switch',\r\n  'symbol',\r\n  'text',\r\n  'textPath',\r\n  'tspan',\r\n  'use',\r\n  'view',\r\n]);\r\nconst voidTagNames = new Set([\r\n  'area',\r\n  'base',\r\n  'br',\r\n  'col',\r\n  'embed',\r\n  'hr',\r\n  'img',\r\n  'input',\r\n  'link',\r\n  'meta',\r\n  'param',\r\n  'source',\r\n  'track',\r\n  'wbr',\r\n]);\r\n\r\nconst createNativeElementMap = {\r\n  [NodeType.TAG]: (vNode: VirtualNode): TagNativeElement => {\r\n    const tagNode = vNode as TagVirtualNode;\r\n    const name = tagNode.name;\r\n\r\n    return detectIsSvgElement(name)\r\n      ? document.createElementNS('http://www.w3.org/2000/svg', name)\r\n      : document.createElement(name);\r\n  },\r\n  [NodeType.TEXT]: (vNode: VirtualNode): TextNativeElement => {\r\n    return document.createTextNode((vNode as TextVirtualNode).value);\r\n  },\r\n  [NodeType.COMMENT]: (vNode: VirtualNode): CommentNativeElement => {\r\n    return document.createComment((vNode as CommentVirtualNode).value);\r\n  },\r\n};\r\n\r\nfunction createNativeElement(node: VirtualNode): NativeElement {\r\n  return createNativeElementMap[node.type](node);\r\n}\r\n\r\nfunction detectIsSvgElement(name: string) {\r\n  return svgTagNames.has(name);\r\n}\r\n\r\nfunction detectIsVoidElement(name: string) {\r\n  return voidTagNames.has(name);\r\n}\r\n\r\nfunction setObjectStyle(element: TagNativeElement, style: object) {\r\n  const keys = Object.keys(style);\r\n\r\n  for (const key of keys) {\r\n    element.style.setProperty(key, String(style[key]));\r\n  }\r\n}\r\n\r\nfunction addAttributes(element: NativeElement, node: TagVirtualNode, isHydrateZone: boolean) {\r\n  const attrNames = Object.keys(node.attrs);\r\n  const tagElement = element as TagNativeElement;\r\n\r\n  for (const attrName of attrNames) {\r\n    const attrValue = node.attrs[attrName];\r\n\r\n    if (attrName[0] === EXCLUDE_ATTR_MARK) continue;\r\n\r\n    if (attrName === REF_ATTR) {\r\n      applyRef(attrValue, element);\r\n      continue;\r\n    }\r\n\r\n    if (attrName === CLASS_ATTR || attrName === CLASS_NAME_ATTR) {\r\n      toggleAttribute(tagElement, CLASS_ATTR, attrValue);\r\n      continue;\r\n    }\r\n\r\n    if (attrName === STYLE_ATTR && attrValue && detectIsObject(attrValue)) {\r\n      setObjectStyle(tagElement, attrValue);\r\n      continue;\r\n    }\r\n\r\n    if (detectIsEvent(attrName)) {\r\n      delegateEvent(tagElement, getEventName(attrName), attrValue);\r\n    } else if (!isHydrateZone && !detectIsUndefined(attrValue) && !ATTR_BLACK_LIST[attrName]) {\r\n      const stop = patchProperties({\r\n        tagName: node.name,\r\n        element: tagElement,\r\n        attrValue,\r\n        attrName,\r\n      });\r\n\r\n      !stop && tagElement.setAttribute(attrName, attrValue);\r\n    }\r\n  }\r\n}\r\n\r\nfunction updateAttributes(element: NativeElement, prevNode: TagVirtualNode, nextNode: TagVirtualNode) {\r\n  const attrNames = getAttributeNames(prevNode, nextNode);\r\n  const tagElement = element as TagNativeElement;\r\n\r\n  for (const attrName of attrNames) {\r\n    const prevAttrValue = prevNode.attrs[attrName];\r\n    const nextAttrValue = nextNode.attrs[attrName];\r\n\r\n    if (attrName[0] === EXCLUDE_ATTR_MARK) continue;\r\n\r\n    if (attrName === REF_ATTR) {\r\n      applyRef(prevAttrValue, element);\r\n      continue;\r\n    }\r\n\r\n    if ((attrName === CLASS_ATTR || attrName === CLASS_NAME_ATTR) && prevAttrValue !== nextAttrValue) {\r\n      toggleAttribute(tagElement, CLASS_ATTR, nextAttrValue);\r\n      continue;\r\n    }\r\n\r\n    if (attrName === STYLE_ATTR && nextAttrValue && prevAttrValue !== nextAttrValue && detectIsObject(nextAttrValue)) {\r\n      setObjectStyle(tagElement, nextAttrValue);\r\n      continue;\r\n    }\r\n\r\n    if (!detectIsUndefined(nextAttrValue)) {\r\n      if (detectIsEvent(attrName)) {\r\n        prevAttrValue !== nextAttrValue && delegateEvent(tagElement, getEventName(attrName), nextAttrValue);\r\n      } else if (!ATTR_BLACK_LIST[attrName] && prevAttrValue !== nextAttrValue) {\r\n        const stop = patchProperties({\r\n          tagName: nextNode.name,\r\n          element: tagElement,\r\n          attrValue: nextAttrValue,\r\n          attrName,\r\n        });\r\n\r\n        !stop && tagElement.setAttribute(attrName, nextAttrValue);\r\n      }\r\n    } else {\r\n      tagElement.removeAttribute(attrName);\r\n    }\r\n  }\r\n}\r\n\r\nfunction toggleAttribute(element: TagNativeElement, name: string, value: string) {\r\n  value ? element.setAttribute(name, value) : element.removeAttribute(name);\r\n}\r\n\r\nfunction getAttributeNames(prevNode: TagVirtualNode, nextNode: TagVirtualNode) {\r\n  const attrNames = new Set<string>();\r\n  const prevAttrs = Object.keys(prevNode.attrs);\r\n  const nextAttrs = Object.keys(nextNode.attrs);\r\n  const size = Math.max(prevAttrs.length, nextAttrs.length);\r\n\r\n  for (let i = 0; i < size; i++) {\r\n    attrNames.add(prevAttrs[i] || nextAttrs[i]);\r\n  }\r\n\r\n  return attrNames;\r\n}\r\n\r\ntype PatchPropertiesOptions = {\r\n  tagName: string;\r\n  element: TagNativeElement;\r\n  attrName: string;\r\n  attrValue: AttributeValue;\r\n};\r\n\r\nfunction patchProperties(options: PatchPropertiesOptions): boolean {\r\n  const { tagName, element, attrName, attrValue } = options;\r\n  const fn = patchPropertiesSpecialCasesMap[tagName];\r\n  let stop = fn ? fn(element, attrName, attrValue) : false;\r\n\r\n  if (canSetProperty(element, attrName)) {\r\n    element[attrName] = attrValue;\r\n  }\r\n\r\n  if (!stop && detectIsBoolean(attrValue)) {\r\n    stop = !attrName.includes('-');\r\n  }\r\n\r\n  return stop;\r\n}\r\n\r\nfunction canSetProperty(element: TagNativeElement, key: string) {\r\n  const prototype = Object.getPrototypeOf(element);\r\n  const descriptor = Object.getOwnPropertyDescriptor(prototype, key);\r\n\r\n  return Boolean(descriptor?.set);\r\n}\r\n\r\nconst patchPropertiesSpecialCasesMap: Record<\r\n  string,\r\n  (element: NativeElement, attrName: string, attrValue: AttributeValue) => boolean\r\n> = {\r\n  input: (element: HTMLInputElement, attrName: string, attrValue: AttributeValue) => {\r\n    if (attrName === 'value') {\r\n      patches.push(() => {\r\n        detectIsBoolean(attrValue) ? (element.checked = attrValue) : (element.value = String(attrValue));\r\n      });\r\n    } else if (attrName === 'autoFocus') {\r\n      patches.push(() => {\r\n        element.autofocus = Boolean(attrValue);\r\n        element.autofocus && element.focus();\r\n      });\r\n    }\r\n\r\n    return false;\r\n  },\r\n  textarea: (element: HTMLTextAreaElement, attrName: string, attrValue: AttributeValue) => {\r\n    if (attrName === 'value') {\r\n      element.innerText = String(attrValue);\r\n\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  },\r\n};\r\n\r\nfunction commitCreation(fiber: Fiber<NativeElement>) {\r\n  const parentFiber = getFiberWithElement<NativeElement, TagNativeElement>(fiber.parent);\r\n  const parentElement = parentFiber.element;\r\n  const childNodes = parentElement.childNodes;\r\n  const isHydrateZone = $$scope().getIsHydrateZone();\r\n\r\n  if (isHydrateZone) {\r\n    const nativeElement = childNodes[fiber.eidx] as NativeElement;\r\n\r\n    if (\r\n      detectIsTextVirtualNode(fiber.inst) &&\r\n      nativeElement instanceof Text &&\r\n      fiber.inst.value.length !== nativeElement.length\r\n    ) {\r\n      nativeElement.splitText(fiber.inst.value.length);\r\n    }\r\n\r\n    fiber.element = nativeElement;\r\n  } else {\r\n    if (!(fiber.mask & SHADOW_MASK)) {\r\n      if (childNodes.length === 0 || fiber.eidx > childNodes.length - 1) {\r\n        !detectIsVoidElement((parentFiber.inst as TagVirtualNode).name) &&\r\n          appendNativeElement(fiber.element, parentElement);\r\n      } else {\r\n        insertNativeElement(fiber.element, parentElement.childNodes[fiber.eidx], parentElement);\r\n      }\r\n    }\r\n  }\r\n\r\n  detectIsTagVirtualNode(fiber.inst) && addAttributes(fiber.element, fiber.inst, isHydrateZone);\r\n}\r\n\r\nfunction commitUpdate(fiber: Fiber<NativeElement>) {\r\n  const element = fiber.element;\r\n  const prevInstance = fiber.alt.inst as VirtualNode;\r\n  const nextInstance = fiber.inst as VirtualNode;\r\n\r\n  detectIsPlainVirtualNode(nextInstance)\r\n    ? (prevInstance as PlainVirtualNode).value !== nextInstance.value && (element.textContent = nextInstance.value)\r\n    : updateAttributes(element, prevInstance as TagVirtualNode, nextInstance as TagVirtualNode);\r\n}\r\n\r\nfunction commitDeletion(fiber: Fiber<NativeElement>) {\r\n  const parentFiber = getFiberWithElement<NativeElement, TagNativeElement>(fiber.parent);\r\n\r\n  if (fiber.mask & FLUSH_MASK) {\r\n    parentFiber.element.innerHTML && (parentFiber.element.innerHTML = '');\r\n    return;\r\n  }\r\n\r\n  walk<NativeElement>(fiber, (fiber, skip) => {\r\n    if (fiber.element) {\r\n      !detectIsPortal(fiber.inst) &&\r\n        canRemoveNativeElement(fiber.element, parentFiber.element) &&\r\n        removeNativeElement(fiber.element, parentFiber.element);\r\n      return skip();\r\n    }\r\n  });\r\n}\r\n\r\nfunction move(fiber: Fiber<NativeElement>) {\r\n  const sourceNodes = collectElements(fiber, x => x.element);\r\n  const sourceNode = sourceNodes[0];\r\n  const parentElement = sourceNode.parentElement;\r\n  const sourceFragment = new DocumentFragment();\r\n  const elementIdx = fiber.eidx;\r\n  let idx = 0;\r\n  const move = () => {\r\n    for (let i = 1; i < sourceNodes.length; i++) {\r\n      removeNativeElement(parentElement.childNodes[elementIdx + 1], parentElement);\r\n    }\r\n\r\n    replaceNativeElement(sourceFragment, parentElement.childNodes[elementIdx], parentElement);\r\n  };\r\n\r\n  for (const node of sourceNodes) {\r\n    insertNativeElement(document.createComment(`${elementIdx}:${idx}`), node, parentElement);\r\n    appendNativeElement(node, sourceFragment);\r\n    idx++;\r\n  }\r\n\r\n  moves.push(move);\r\n}\r\n\r\nconst commitMap: Record<string, (fiber: Fiber<NativeElement>) => void> = {\r\n  [CREATE_EFFECT_TAG]: (fiber: Fiber<NativeElement>) => {\r\n    if (!fiber.element || detectIsPortal(fiber.inst)) return;\r\n    trackUpdate && trackUpdate(fiber.element);\r\n    commitCreation(fiber);\r\n  },\r\n  [UPDATE_EFFECT_TAG]: (fiber: Fiber<NativeElement>) => {\r\n    fiber.mask & MOVE_MASK && (move(fiber), (fiber.mask &= ~MOVE_MASK));\r\n    if (!fiber.element || detectIsPortal(fiber.inst)) return;\r\n    trackUpdate && trackUpdate(fiber.element);\r\n    commitUpdate(fiber);\r\n  },\r\n  [DELETE_EFFECT_TAG]: commitDeletion,\r\n  [SKIP_EFFECT_TAG]: dummyFn,\r\n};\r\n\r\nfunction finishCommit() {\r\n  moves.forEach(x => x());\r\n  patches.forEach(x => x());\r\n  moves = [];\r\n  patches = [];\r\n}\r\n\r\nconst commit = (fiber: Fiber<NativeElement>) => commitMap[fiber.tag](fiber);\r\n\r\nconst setTrackUpdate = (fn: typeof trackUpdate) => (trackUpdate = fn);\r\n\r\nconst appendNativeElement = (element: NativeNode, parent: NativeNode) => parent.appendChild(element);\r\n\r\nconst insertNativeElement = (element: NativeNode, sibling: NativeNode, parent: TagNativeElement) =>\r\n  parent.insertBefore(element, sibling);\r\n\r\nconst insertNativeElementByIndex = (element: NativeNode, idx: number, parent: TagNativeElement) =>\r\n  parent.insertBefore(element, parent.childNodes[idx]);\r\n\r\nconst replaceNativeElement = (element: NativeNode, candidate: NativeNode, parent: TagNativeElement) =>\r\n  parent.replaceChild(element, candidate);\r\n\r\nconst canRemoveNativeElement = (element: NativeNode, parent: NativeNode) => element.parentElement === parent;\r\n\r\nconst removeNativeElement = (element: NativeNode, parent: TagNativeElement) => parent.removeChild(element);\r\n\r\nexport { createNativeElement, commit, finishCommit, setTrackUpdate, insertNativeElementByIndex };\r\n","import {\r\n  type DarkElement,\r\n  type Callback,\r\n  ROOT,\r\n  Fiber,\r\n  CREATE_EFFECT_TAG,\r\n  UPDATE_EFFECT_TAG,\r\n  platform,\r\n  flatten,\r\n  detectIsUndefined,\r\n  detectIsFunction,\r\n  trueFn,\r\n  TagVirtualNode,\r\n  TaskPriority,\r\n  createReplacer,\r\n  setRootId,\r\n  $$scope,\r\n  dummyFn,\r\n  scheduler,\r\n} from '@dark-engine/core';\r\n\r\nimport { createNativeElement, insertNativeElementByIndex, commit, finishCommit } from '../dom';\r\nimport { detectIsPortal, unmountPortal } from '../portal';\r\nimport type { TagNativeElement } from '../native-element';\r\n\r\nconst roots = new Map<Element, number>();\r\nconst raf = requestAnimationFrame.bind(window);\r\nconst caf = cancelAnimationFrame.bind(window);\r\nconst spawn = raf;\r\nlet isInjected = false;\r\n\r\nfunction inject() {\r\n  platform.createElement = createNativeElement as typeof platform.createElement;\r\n  platform.insertElement = insertNativeElementByIndex as typeof platform.insertElement;\r\n  platform.raf = raf;\r\n  platform.caf = caf;\r\n  platform.spawn = spawn;\r\n  platform.commit = commit;\r\n  platform.finishCommit = finishCommit;\r\n  platform.detectIsDynamic = trueFn;\r\n  platform.detectIsPortal = detectIsPortal;\r\n  platform.unmountPortal = unmountPortal;\r\n  platform.chunk = dummyFn;\r\n  isInjected = true;\r\n}\r\n\r\nfunction render(element: DarkElement, container: TagNativeElement, hydrate?: Callback) {\r\n  !isInjected && inject();\r\n  if (process.env.NODE_ENV !== 'production') {\r\n    if (!(container instanceof Element)) {\r\n      throw new Error(`[Dark]: render receives only Element as container!`);\r\n    }\r\n  }\r\n\r\n  const isMounted = !detectIsUndefined(roots.get(container));\r\n  const isHydrate = detectIsFunction(hydrate);\r\n  let rootId: number = null;\r\n\r\n  if (!isMounted) {\r\n    rootId = roots.size;\r\n    roots.set(container, rootId);\r\n    !isHydrate && (container.innerHTML = '');\r\n  } else {\r\n    rootId = roots.get(container);\r\n  }\r\n\r\n  const $scope = $$scope(rootId);\r\n\r\n  // insertion effect can't schedule renders\r\n  if ($scope?.getIsInsertionEffectsZone()) return;\r\n\r\n  const callback = () => {\r\n    setRootId(rootId); // !\r\n    const $scope = $$scope();\r\n    const rootFiber = $scope.getRoot();\r\n    const isUpdate = Boolean(rootFiber);\r\n    const fiber = new Fiber().mutate({\r\n      element: container,\r\n      inst: new TagVirtualNode(ROOT, {}, flatten([element || createReplacer()]) as TagVirtualNode['children']),\r\n      alt: rootFiber,\r\n      tag: isUpdate ? UPDATE_EFFECT_TAG : CREATE_EFFECT_TAG,\r\n    });\r\n\r\n    $scope.resetMount();\r\n    $scope.setWorkInProgress(fiber);\r\n    $scope.setIsHydrateZone(isHydrate);\r\n    $scope.setNextUnitOfWork(fiber);\r\n    isHydrate && hydrate();\r\n  };\r\n\r\n  scheduler.schedule(callback, { priority: TaskPriority.NORMAL });\r\n}\r\n\r\nexport { render, roots, inject };\r\n","import { interpolateViridis } from 'd3-scale-chromatic';\r\n\r\nimport { h, component, useState, useEffect, useMemo, useUpdate, Flag, TagVirtualNode } from '@dark-engine/core';\r\nimport { createRoot } from '@dark-engine/platform-browser';\r\n\r\nconst Demo = component(() => {\r\n  const [numPoints, setNumPoints] = useState(1000);\r\n\r\n  const updateCount = e => {\r\n    setNumPoints(Number(e.target.value));\r\n  };\r\n\r\n  return (\r\n    <div class='app-wrapper'>\r\n      <VizDemo count={numPoints} />\r\n      <div class='controls'>\r\n        # Points\r\n        <input type='range' min={10} max={10000} value={numPoints} onInput={updateCount} />\r\n        {numPoints}\r\n      </div>\r\n      <div class='about'>\r\n        Dark 1k Components Demo based on the{' '}\r\n        <a href='https://infernojs.github.io/inferno/1kcomponents/' target='_blank'>\r\n          {' '}\r\n          Inferno demo\r\n        </a>\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\nconst Layout = {\r\n  PHYLLOTAXIS: 0,\r\n  GRID: 1,\r\n  WAVE: 2,\r\n  SPIRAL: 3,\r\n};\r\n\r\nconst LAYOUT_ORDER = [Layout.PHYLLOTAXIS, Layout.SPIRAL, Layout.PHYLLOTAXIS, Layout.GRID, Layout.WAVE];\r\n\r\nconst flagProps = { [Flag.SKIP_SCAN_OPT]: true };\r\n\r\ntype VizDemoProps = {\r\n  count: number;\r\n};\r\n\r\nconst VizDemo = component<VizDemoProps>(({ count }) => {\r\n  const update = useUpdate();\r\n  const scope = useMemo(\r\n    () => ({\r\n      layout: 0,\r\n      phyllotaxis: genPhyllotaxis(100),\r\n      grid: genGrid(100),\r\n      wave: genWave(100),\r\n      spiral: genSpiral(100),\r\n      points: [] as Array<Point>,\r\n      step: 0,\r\n      numSteps: 60 * 2,\r\n    }),\r\n    [],\r\n  );\r\n\r\n  useEffect(() => {\r\n    if (count === 0) return;\r\n\r\n    scope.phyllotaxis = genPhyllotaxis(count);\r\n    scope.grid = genGrid(count);\r\n    scope.wave = genWave(count);\r\n    scope.spiral = genSpiral(count);\r\n    scope.points = makePoints(count, scope);\r\n  }, [count]);\r\n\r\n  useEffect(() => {\r\n    next();\r\n  }, []);\r\n\r\n  const next = () => {\r\n    scope.step = (scope.step + 1) % scope.numSteps;\r\n\r\n    if (scope.step === 0) {\r\n      scope.layout = (scope.layout + 1) % LAYOUT_ORDER.length;\r\n    }\r\n\r\n    // Clamp the linear interpolation at 80% for a pause at each finished layout state\r\n    const pct = Math.min(1, scope.step / (scope.numSteps * 0.8));\r\n\r\n    const currentLayout = LAYOUT_ORDER[scope.layout];\r\n    const nextLayout = LAYOUT_ORDER[(scope.layout + 1) % LAYOUT_ORDER.length];\r\n\r\n    // Keep these redundant computations out of the loop\r\n    const pxProp = xForLayout(currentLayout);\r\n    const nxProp = xForLayout(nextLayout);\r\n    const pyProp = yForLayout(currentLayout);\r\n    const nyProp = yForLayout(nextLayout);\r\n\r\n    for (const point of scope.points) {\r\n      point.x = lerp(point, pct, pxProp, nxProp);\r\n      point.y = lerp(point, pct, pyProp, nyProp);\r\n    }\r\n\r\n    update();\r\n\r\n    requestAnimationFrame(() => {\r\n      next();\r\n    });\r\n  };\r\n\r\n  return (\r\n    <svg class='demo' {...flagProps}>\r\n      <g {...flagProps}>{map(scope.points, renderPoint)}</g>\r\n    </svg>\r\n  );\r\n});\r\n\r\nconst setAnchors = (arr: Array<Point>, scope: any) => {\r\n  arr.map((p, index) => {\r\n    const [gx, gy] = project(scope.grid(index));\r\n    const [wx, wy] = project(scope.wave(index));\r\n    const [sx, sy] = project(scope.spiral(index));\r\n    const [px, py] = project(scope.phyllotaxis(index));\r\n\r\n    Object.assign(p, { gx, gy, wx, wy, sx, sy, px, py });\r\n  });\r\n\r\n  return arr;\r\n};\r\n\r\nconst makePoints = (count: number, scope: any) => {\r\n  const newPoints: Array<Point> = [];\r\n\r\n  for (let i = 0; i < count; i++) {\r\n    newPoints.push({\r\n      x: 0,\r\n      y: 0,\r\n      color: interpolateViridis(i / count),\r\n    });\r\n  }\r\n\r\n  return setAnchors(newPoints, scope);\r\n};\r\n\r\nconst renderPoint = (point: Point, idx: number) => {\r\n  return new TagVirtualNode(\r\n    'rect',\r\n    {\r\n      key: idx,\r\n      class: 'point',\r\n      transform: `translate(${Math.floor(point.x)}, ${Math.floor(point.y)})`,\r\n      fill: point.color,\r\n    },\r\n    null,\r\n  );\r\n};\r\n\r\nconst map = (items: Array<Point>, cb: (x: any, idx: number) => any) => {\r\n  const points = [];\r\n\r\n  for (let i = 0; i < items.length; i++) {\r\n    points.push(cb(items[i], i));\r\n  }\r\n\r\n  return points;\r\n};\r\n\r\ntype Point = {\r\n  x: number;\r\n  y: number;\r\n  color: string;\r\n};\r\n\r\nconst theta = Math.PI * (3 - Math.sqrt(5));\r\n\r\nfunction xForLayout(layout) {\r\n  switch (layout) {\r\n    case Layout.PHYLLOTAXIS:\r\n      return 'px';\r\n    case Layout.GRID:\r\n      return 'gx';\r\n    case Layout.WAVE:\r\n      return 'wx';\r\n    case Layout.SPIRAL:\r\n      return 'sx';\r\n  }\r\n}\r\n\r\nfunction yForLayout(layout) {\r\n  switch (layout) {\r\n    case Layout.PHYLLOTAXIS:\r\n      return 'py';\r\n    case Layout.GRID:\r\n      return 'gy';\r\n    case Layout.WAVE:\r\n      return 'wy';\r\n    case Layout.SPIRAL:\r\n      return 'sy';\r\n  }\r\n}\r\n\r\nfunction lerp(obj, percent, startProp, endProp) {\r\n  const px = obj[startProp];\r\n\r\n  return px + (obj[endProp] - px) * percent;\r\n}\r\n\r\nfunction genPhyllotaxis(n) {\r\n  return i => {\r\n    const r = Math.sqrt(i / n);\r\n    const th = i * theta;\r\n\r\n    return [r * Math.cos(th), r * Math.sin(th)];\r\n  };\r\n}\r\n\r\nfunction genGrid(n) {\r\n  const rowLength = Math.round(Math.sqrt(n));\r\n\r\n  return i => [-0.8 + (1.6 / rowLength) * (i % rowLength), -0.8 + (1.6 / rowLength) * Math.floor(i / rowLength)];\r\n}\r\n\r\nfunction genWave(n) {\r\n  const xScale = 2 / (n - 1);\r\n  return i => {\r\n    const x = -1 + i * xScale;\r\n\r\n    return [x, Math.sin(x * Math.PI * 3) * 0.3];\r\n  };\r\n}\r\n\r\nfunction genSpiral(n) {\r\n  return i => {\r\n    const t = Math.sqrt(i / (n - 1));\r\n    const phi = t * Math.PI * 10;\r\n\r\n    return [t * Math.cos(phi), t * Math.sin(phi)];\r\n  };\r\n}\r\n\r\nfunction scale(magnitude, vector) {\r\n  return vector.map(p => p * magnitude);\r\n}\r\n\r\nfunction translate(translation, vector) {\r\n  return vector.map((p, i) => p + translation[i]);\r\n}\r\n\r\nfunction project(vector) {\r\n  const wh = window.innerHeight / 2;\r\n  const ww = window.innerWidth / 2;\r\n\r\n  return translate([ww, wh], scale(Math.min(wh, ww), vector));\r\n}\r\n\r\ncreateRoot(document.getElementById('root')).render(<Demo />);\r\n","import { detectIsFunction } from '../utils';\r\nimport { type UpdateOptions, useUpdate } from '../use-update';\r\nimport { useMemo } from '../use-memo';\r\nimport { $$scope } from '../scope';\r\nimport { useCallback } from '../use-callback';\r\n\r\ntype Value<T> = T | ((prevValue: T) => T);\r\n\r\nfunction useState<T = unknown>(initialValue: T | (() => T)): [T, (value: Value<T>) => void] {\r\n  const update = useUpdate();\r\n  const scope = useMemo(\r\n    () => ({\r\n      value: detectIsFunction(initialValue) ? initialValue() : initialValue,\r\n    }),\r\n    [],\r\n  );\r\n  const setState = useCallback((sourceValue: Value<T>) => {\r\n    const $scope = $$scope();\r\n    const isBatch = $scope.getIsBatchZone();\r\n    const create = (): UpdateOptions => {\r\n      const prevValue = scope.value;\r\n      const newValue = detectIsFunction(sourceValue) ? sourceValue(prevValue) : sourceValue;\r\n      const shouldUpdate = () => isBatch || !Object.is(prevValue, newValue);\r\n      const setValue = () => (scope.value = newValue);\r\n      const resetValue = () => (scope.value = prevValue);\r\n\r\n      return { shouldUpdate, setValue, resetValue };\r\n    };\r\n\r\n    update(create);\r\n  }, []);\r\n\r\n  return [scope.value, setState];\r\n}\r\n\r\nexport { useState };\r\n","import { useMemo } from '../use-memo';\r\n\r\nfunction useCallback<T = Function>(callback: T, deps: Array<any>): T {\r\n  const value = useMemo(() => callback, deps);\r\n\r\n  return value;\r\n}\r\n\r\nexport { useCallback };\r\n","import { type DarkElement, unmountRoot } from '@dark-engine/core';\r\n\r\nimport { render, roots } from '../render';\r\nimport type { TagNativeElement } from '../native-element';\r\n\r\nfunction createRoot(container: TagNativeElement) {\r\n  return {\r\n    render: (element: DarkElement) => render(element, container),\r\n    unmount: () => unmount(container),\r\n  };\r\n}\r\n\r\nfunction unmount(container: TagNativeElement) {\r\n  const rootId = roots.get(container);\r\n\r\n  unmountRoot(rootId, () => {\r\n    roots.delete(container);\r\n    container.innerHTML = '';\r\n  });\r\n}\r\n\r\nexport { createRoot, unmount };\r\n"],"names":["specifier","n","length","colors","Array","i","slice","ramp","range","t","Math","max","min","floor","ROOT","REPLACER","KEY_ATTR","REF_ATTR","CREATE_EFFECT_TAG","UPDATE_EFFECT_TAG","SKIP_EFFECT_TAG","MOVE_MASK","TaskPriority","Flag","ATTR_BLACK_LIST","SKIP_SCAN_OPT","MEMO_SLOT_OPT","STATIC_SLOT_OPT","$$inject","Symbol","Component","constructor","type","token","props","ref","shouldUpdate","displayName","children","this","component","options","$token","factory","defaultInject","detectIsComponent","x","detectIsFunction","o","detectIsUndefined","detectIsTextBased","detectIsObject","detectIsBoolean","detectIsArray","isArray","detectIsNull","detectIsEmpty","getTime","Date","now","dummyFn","trueFn","sameFn","flatten","source","transform","list","stack","idx","pop","push","detectAreDepsDifferent","prevDeps","nextDeps","Object","is","createIndexKey","defaultRealisation","Error","platform","createElement","insertElement","raf","caf","spawn","commit","finishCommit","detectIsDynamic","detectIsPortal","unmountPortal","chunk","EventEmitter","subscribers","Map","on","e","fn","has","set","Set","get","add","delete","emit","data","forEach","kill","__getSize","size","Scope","root","wip","cursor","unit","mountDeep","mountLevel","mountNav","events","unsubs","actions","candidates","deletions","cancels","asyncEffects","layoutEffects","insertionEffects","resourceId","resources","defers","setPendingStatus","isLayoutEffectsZone","isInsertionEffectsZone","isUpdateZone","isBatchZone","isHydrateZone","isStreamZone","isTransitionZone","isEventZone","isHot","isDynamic","isServer","emitter","resetActions","getActionsById","id","addActionMap","map","replace","insert","remove","move","stable","addReplaceAction","nextKey","addInsertAction","addRemoveAction","prevKey","addMoveAction","addStableAction","copy","scope","getRoot","setRoot","fiber","getWorkInProgress","setWorkInProgress","getNextUnitOfWork","setNextUnitOfWork","getCursorFiber","setCursorFiber","navToChild","navToSibling","navToParent","navToPrev","getMountIndex","setMountDeep","getMountDeep","value","resetMount","getEvents","addEventUnsubscriber","unsubscribeEvents","getCandidates","addCandidate","resetCandidates","getDeletions","hasDeletion","nextFiber","parent","addDeletion","resetDeletions","addAsyncEffect","resetAsyncEffects","runAsyncEffects","effects","setTimeout","addLayoutEffect","resetLayoutEffects","runLayoutEffects","setIsLayoutEffectsZone","addInsertionEffect","resetInsertionEffects","runInsertionEffects","setIsInsertionEffectsZone","addCancel","applyCancels","resetCancels","getIsLayoutEffectsZone","getIsInsertionEffectsZone","getIsUpdateZone","setIsUpdateZone","getIsBatchZone","setIsBatchZone","getIsHydrateZone","setIsHydrateZone","getIsStreamZone","setIsStreamZone","getIsTransitionZone","setIsTransitionZone","getIsEventZone","setIsEventZone","getIsHot","setIsHot","getPendingStatusSetter","setPendingStatusSetter","flush","getEmitter","defer","getDefers","resetDefers","getResource","setResource","res","getResources","getResourceId","setResourceId","getNextResourceId","runAfterCommit","rootId","scopes","getRootId","setRootId","$$vNode","ATTR_TYPE","VirtualNode","TagVirtualNode","name","attrs","super","NodeType","TAG","TextVirtualNode","TEXT","String","CommentVirtualNode","text","COMMENT","from","detectIsTextVirtualNode","detectIsVirtualNode","vNode","detectIsTagVirtualNode","detectIsCommentVirtualNode","detectIsVirtualNodeFactory","detectIsPlainVirtualNode","createReplacer","getElementKey","inst","hasElementFlag","flag","Boolean","hasComponentFlag","hasVirtualNodeFactoryFlag","hasTagVirtualNodeFlag","getElementType","hasChildrenProp","detectAreSameInstanceTypes","prevInst","nextInst","isComponentFactories","nc","Fiber","hook","provider","cc","cec","eidx","mask","element","tag","child","next","alt","atoms","nextId","mutate","keys","key","markHost","increment","count","force","$scope","wipFiber","stop","setError","error","catch","static","Hook","values","owner","$$memo","defaultShouldUpdate","nextProps","detectIsMemo","instance","walk","onWalk","shouldDeep","shouldStop","skip","getFiberWithElement","$fiber","buildChildNodes","onNode","getKey","buildChildNode","altMap","startEidx","prevIdx","nextIdx","left","right","isFirst","isLast","notifyParents","$$fragment","Fragment","slot","Memo","memo","getValue","p","deps","state","$value","detectIsElement","$$useEffect","createEffect","useEffect","effect","cleanup","undefined","isInsertionEffect","EffectType","INSERTION","isLayoutEffect","LAYOUT","isAsyncEffect","ASYNC","runEffect","dropEffects","$$useLayoutEffect","useLayoutEffect","dropLayoutEffects","$$useInsertionEffect","useInsertionEffect","dropInsertionEffects","shouldUnmountFiber","INSERTION_EFFECT_HOST_MASK","unmountFiber","_","hasPendingPromise","hasRenderError","workLoop","isAsync","shouldYield","hasMoreWork","performUnitOfWork","scheduler","hasPrimaryTask","fork","unmounts","diff","parentFiber","isRight","sync","err","Promise","finally","isDeepWalking","isStream","hasChildren","$inst","createFiber","getAlternate","share","mountChild","mountSibling","prev","shouldMount","pc","mount","hasSameCount","prevKeys","nextKeys","prevKeysMap","nextKeysMap","keyedFibersMap","usedKeysMap","extractKeys","prevKeyFiber","tryOptStaticSlot","hasMove","hasRemove","hasInsert","hasReplace","detectIsStableMemoTree","tryOptMov","tryOptRem","tryOptMemoSlot","reconcile","isUpdate","setup","detectAreSameComponentTypesWithSameKeys","getHook","fromChild","parentId","isMove","isStable","isComponent","result","promise","all","setNextId","args","console","supportConditional","cancel","$$scope$","cancelTask","setValue","resetValue","assign","replaceScope","$createChanger","MessageChannel","port1","port2","MessagePort","channel","offs","event","callback","off","postMessage","unref","Task","priority","forceAsync","taskRestorer","pendingSetter","nextTaskId","getPriority","getForceAsync","setIsTransition","isTransition","getIsTransition","run","pending","markAsPending","isPending","canPending","markAsUnnecessary","isUnnecessary","getIsUnnecessary","setTaskRestorer","setLocationCreator","locationCreator","createLocation","setPendingSetter","loc","tasks","deep","$loc","split","some","$$loc","indexOf","createRootLocation","queue","HIGH","NORMAL","LOW","deadline","task","scheduledCallback","isMessageLoopRunning","port","performWorkUntilDeadline","bind","reset","schedule","put","execute","high","normal","low","getQueues","hasPrimary","hasLow","detectHasRelatedUpdate","complete","filter","splice","pick","shift","resolve","then","requestCallbackAsync","requestCallback","isBusy","unshift","useUpdate","createChanger","hasChanger","isBatch","isEvent","restore","fromRestore","detectIsFiberAlive","createUpdate","callbackOptions","createHookLocation","change","batch","timer","changes","clearTimeout","addBatch","as","_void","View","applyRef","current","mutableRef","hasOwnProperty","detectIsMutableRef","$$portal","container","innerHTML","getPortalContainer","SyntheticEvent","sourceEvent","target","propagation","stopPropagation","preventDefault","getPropagation","delegateEvent","eventName","handler","eventsMap","handlersMap","$handler","rootHandler","$event","parentElement","dispatchEvent","WeakMap","document","addEventListener","removeEventListener","detectIsEvent","attrName","startsWith","getEventName","toLowerCase","STYLE_ATTR","CLASS_ATTR","CLASS_NAME_ATTR","moves","patches","svgTagNames","voidTagNames","createNativeElementMap","detectIsSvgElement","createElementNS","createTextNode","createComment","createNativeElement","node","setObjectStyle","style","setProperty","toggleAttribute","setAttribute","removeAttribute","patchProperties","tagName","attrValue","patchPropertiesSpecialCasesMap","prototype","getPrototypeOf","descriptor","getOwnPropertyDescriptor","canSetProperty","includes","input","checked","autofocus","focus","textarea","innerText","commitMap","childNodes","nativeElement","Text","splitText","appendNativeElement","insertNativeElement","attrNames","tagElement","addAttributes","commitCreation","sourceNodes","elements","collectElements","sourceFragment","DocumentFragment","elementIdx","removeNativeElement","replaceNativeElement","prevInstance","nextInstance","textContent","prevNode","nextNode","prevAttrs","nextAttrs","getAttributeNames","prevAttrValue","nextAttrValue","updateAttributes","commitUpdate","canRemoveNativeElement","appendChild","sibling","insertBefore","insertNativeElementByIndex","candidate","replaceChild","removeChild","roots","requestAnimationFrame","window","cancelAnimationFrame","isInjected","Demo","numPoints","setNumPoints","initialValue","update","setState","sourceValue","prevValue","newValue","useState","class","VizDemo","onInput","Number","href","LAYOUT_ORDER","flagProps","layout","phyllotaxis","genPhyllotaxis","grid","genGrid","wave","genWave","spiral","genSpiral","points","step","numSteps","makePoints","pct","currentLayout","nextLayout","pxProp","xForLayout","nxProp","pyProp","yForLayout","nyProp","point","lerp","y","renderPoint","newPoints","color","arr","index","gx","gy","project","wx","wy","sx","sy","px","py","setAnchors","fill","items","cb","theta","PI","sqrt","obj","percent","startProp","endProp","r","th","cos","sin","rowLength","round","xScale","phi","vector","wh","innerHeight","ww","innerWidth","translation","translate","magnitude","scale","getElementById","render","hydrate","isMounted","isHydrate","rootFiber","unmount","onCompleted","unmountRoot"],"sourceRoot":""}