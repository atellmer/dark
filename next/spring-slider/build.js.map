{"version":3,"file":"build.js","mappings":"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","sources":["webpack://dark-spring-slider/../../packages/core/src/constants.ts","webpack://dark-spring-slider/../../packages/core/src/component/component.ts","webpack://dark-spring-slider/../../packages/core/src/utils/utils.ts","webpack://dark-spring-slider/../../packages/core/src/platform/platform.ts","webpack://dark-spring-slider/../../packages/core/src/emitter/emitter.ts","webpack://dark-spring-slider/../../packages/core/src/scope/scope.ts","webpack://dark-spring-slider/../../packages/core/src/view/view.ts","webpack://dark-spring-slider/../../packages/core/src/fiber/fiber.ts","webpack://dark-spring-slider/../../packages/core/src/memo/memo.ts","webpack://dark-spring-slider/../../packages/core/src/walk/walk.ts","webpack://dark-spring-slider/../../packages/core/src/fragment/fragment.ts","webpack://dark-spring-slider/../../packages/core/src/use-memo/use-memo.ts","webpack://dark-spring-slider/../../packages/core/src/use-effect/use-effect.ts","webpack://dark-spring-slider/../../packages/core/src/use-layout-effect/use-layout-effect.ts","webpack://dark-spring-slider/../../packages/core/src/use-insertion-effect/use-insertion-effect.ts","webpack://dark-spring-slider/../../packages/core/src/unmount/unmount.ts","webpack://dark-spring-slider/../../packages/core/src/workloop/workloop.ts","webpack://dark-spring-slider/../../packages/core/src/scheduler/scheduler.ts","webpack://dark-spring-slider/../../packages/core/src/use-update/use-update.ts","webpack://dark-spring-slider/../../packages/core/src/batch/batch.ts","webpack://dark-spring-slider/../../packages/core/src/element/element.ts","webpack://dark-spring-slider/../../packages/core/src/ref/ref.ts","webpack://dark-spring-slider/../../packages/platform-browser/src/portal/portal.ts","webpack://dark-spring-slider/../../packages/platform-browser/src/events/events.ts","webpack://dark-spring-slider/../../packages/platform-browser/src/constants.ts","webpack://dark-spring-slider/../../packages/platform-browser/src/dom/dom.ts","webpack://dark-spring-slider/../../packages/platform-browser/src/render/render.ts","webpack://dark-spring-slider/../../packages/styled/src/constants.ts","webpack://dark-spring-slider/../../packages/styled/src/utils/utils.ts","webpack://dark-spring-slider/../../packages/styled/src/keyframes/keyframes.ts","webpack://dark-spring-slider/../../packages/styled/src/tokens/tokens.ts","webpack://dark-spring-slider/../../packages/core/src/context/context.ts","webpack://dark-spring-slider/../../packages/styled/src/theme/theme.ts","webpack://dark-spring-slider/../../packages/styled/src/server/manager.ts","webpack://dark-spring-slider/../../packages/styled/src/parse/parse.ts","webpack://dark-spring-slider/../../packages/styled/src/hash/hash.ts","webpack://dark-spring-slider/../../packages/styled/src/styled/styled.ts","webpack://dark-spring-slider/../../packages/animations/src/state/state.ts","webpack://dark-spring-slider/../../packages/animations/src/shared/shared.ts","webpack://dark-spring-slider/../../packages/animations/src/preset/preset.ts","webpack://dark-spring-slider/../../packages/core/src/atom/atom.ts","webpack://dark-spring-slider/../../packages/animations/src/spring/spring.ts","webpack://dark-spring-slider/../../packages/animations/src/utils/utils.ts","webpack://dark-spring-slider/../../packages/animations/src/stepper/stepper.ts","webpack://dark-spring-slider/../../packages/animations/src/controller/controller.ts","webpack://dark-spring-slider/../../packages/animations/src/use-transition/use-transition.ts","webpack://dark-spring-slider/../../packages/animations/src/animated/animated.ts","webpack://dark-spring-slider/./index.tsx","webpack://dark-spring-slider/../../packages/core/src/use-state/use-state.ts","webpack://dark-spring-slider/../../packages/core/src/use-callback/use-callback.ts","webpack://dark-spring-slider/../../packages/platform-browser/src/create-root/create-root.tsx"],"sourcesContent":["export const VERSION = '0.25.1';\r\nexport const ROOT = 'dark:root';\r\nexport const REPLACER = 'dark:matter';\r\nexport const INDEX_KEY = 'dark:idx';\r\nexport const KEY_ATTR = 'key';\r\nexport const REF_ATTR = 'ref';\r\nexport const CREATE_EFFECT_TAG = 'C';\r\nexport const UPDATE_EFFECT_TAG = 'U';\r\nexport const DELETE_EFFECT_TAG = 'D';\r\nexport const SKIP_EFFECT_TAG = 'S';\r\nexport const INSERTION_EFFECT_HOST_MASK = 1;\r\nexport const LAYOUT_EFFECT_HOST_MASK = 2;\r\nexport const ASYNC_EFFECT_HOST_MASK = 4;\r\nexport const ATOM_HOST_MASK = 8;\r\nexport const PORTAL_HOST_MASK = 16;\r\nexport const SHADOW_MASK = 32;\r\nexport const FLUSH_MASK = 64;\r\nexport const MOVE_MASK = 128;\r\nexport const HOOK_DELIMETER = ':';\r\nexport const YIELD_INTERVAL = 6;\r\nexport const APP_STATE_ATTR = 'dark-app-state';\r\n\r\nexport enum TaskPriority {\r\n  LOW = 0,\r\n  NORMAL = 1,\r\n  HIGH = 2,\r\n}\r\n\r\nexport enum Flag {\r\n  SKIP_SCAN_OPT = '__skipScanOpt',\r\n  MEMO_SLOT_OPT = '__memoSlotOpt',\r\n  STATIC_SLOT_OPT = '__staticSlotOpt',\r\n}\r\n\r\nexport const FLAGS = {\r\n  __skipScanOpt: true,\r\n  __memoSlotOpt: true,\r\n  __staticSlotOpt: true,\r\n};\r\n\r\nexport const ATTR_BLACK_LIST = {\r\n  [KEY_ATTR]: true,\r\n  [REF_ATTR]: true,\r\n  [Flag.SKIP_SCAN_OPT]: true,\r\n  [Flag.MEMO_SLOT_OPT]: true,\r\n  [Flag.STATIC_SLOT_OPT]: true,\r\n};\r\n","import type { ElementKey, Instance, DarkElement, RefProps, KeyProps, FlagProps } from '../shared';\r\nimport { KEY_ATTR } from '../constants';\r\nimport { error } from '../utils';\r\nimport { type Ref } from '../ref';\r\n\r\nconst $$inject = Symbol('inject');\r\nclass Component<P extends StandardComponentProps = any, R = any> {\r\n  public type: CreateElement<P>;\r\n  public props: P;\r\n  public ref?: Ref<R>;\r\n  public token?: Symbol;\r\n  public displayName?: string;\r\n  public shouldUpdate?: ShouldUpdate<P>;\r\n  public children: Array<Instance> = [];\r\n\r\n  constructor(\r\n    type: CreateElement<P>,\r\n    token: Symbol,\r\n    props: P,\r\n    ref: Ref<R>,\r\n    shouldUpdate: ShouldUpdate<P>,\r\n    displayName: string,\r\n  ) {\r\n    this.type = type;\r\n    this.props = props;\r\n    ref && (this.ref = ref);\r\n    token && (this.token = token);\r\n    shouldUpdate && (this.shouldUpdate = shouldUpdate);\r\n    displayName && (this.displayName = displayName);\r\n  }\r\n}\r\n\r\nfunction component<P extends object, R = unknown>(type: CreateElement<P, R>, options: ComponentOptions = {}) {\r\n  const { token: $token, displayName } = options;\r\n  type Props = P & StandardComponentProps;\r\n  const factory: ComponentFactoryWithPossiblyInject<Props, R> = (props = {} as Props, ref?: Ref<R>) => {\r\n    const { token = $token, shouldUpdate } = factory[$$inject] || defaultInject;\r\n\r\n    if (props.ref) {\r\n      delete props.ref;\r\n\r\n      if (process.env.NODE_ENV !== 'production') {\r\n        process.env.NODE_ENV === 'development' &&\r\n          error(`[Dark]: To use ref you need to wrap the component with forwardRef!`);\r\n      }\r\n    }\r\n\r\n    return new Component(type, token, props, ref, shouldUpdate, displayName);\r\n  };\r\n\r\n  return factory as ComponentFactory<Props, R>;\r\n}\r\n\r\nconst defaultInject: ComponentInject = {};\r\n\r\nconst detectIsComponent = (x: unknown): x is Component => x instanceof Component;\r\n\r\nconst getComponentKey = (x: Component): ElementKey => x.props[KEY_ATTR] ?? null;\r\n\r\nconst hasComponentFlag = (inst: Component, flag: string) => Boolean(inst.props[flag]);\r\n\r\ntype ComponentOptions = Readonly<{\r\n  displayName?: string;\r\n  token?: Symbol;\r\n}>;\r\n\r\ntype ComponentFactoryWithPossiblyInject<P extends object = {}, R = unknown> = {\r\n  (props?: P, ref?: Ref<R>): Component<P, R>;\r\n  [$$inject]?: ComponentInject<P>;\r\n};\r\n\r\ntype CreateElement<P extends StandardComponentProps, R = unknown> = (props: P, ref?: Ref<R>) => DarkElement;\r\n\r\nexport type ComponentInject<P extends object = {}> = Readonly<{\r\n  token?: Symbol;\r\n  shouldUpdate?: ShouldUpdate<P>;\r\n}>;\r\n\r\nexport type ShouldUpdate<P> = (prevProps: P, nextProps: P) => boolean;\r\n\r\nexport type StandardComponentProps = KeyProps & RefProps & FlagProps;\r\n\r\nexport type ComponentFactory<P extends object = {}, R = unknown> = (props?: P, ref?: Ref<R>) => Component<P, R>;\r\n\r\nexport { Component, component, $$inject, detectIsComponent, getComponentKey, hasComponentFlag };\r\n","import type { NestedArray } from '../shared';\r\nimport { INDEX_KEY } from '../constants';\r\n\r\nconst detectIsFunction = (o: any): o is Function => typeof o === 'function';\r\n\r\nconst detectIsUndefined = (o: any): o is undefined => typeof o === 'undefined';\r\n\r\nconst detectIsNumber = (o: any): o is number => typeof o === 'number';\r\n\r\nconst detectIsString = (o: any): o is string => typeof o === 'string';\r\n\r\nconst detectIsTextBased = (o: any): o is string | number => typeof o === 'string' || typeof o === 'number';\r\n\r\nconst detectIsObject = (o: any): o is object => typeof o === 'object';\r\n\r\nconst detectIsBoolean = (o: any): o is boolean => typeof o === 'boolean';\r\n\r\nconst detectIsArray = (o: any): o is Array<any> => Array.isArray(o);\r\n\r\nconst detectIsNull = (o: any): o is null => o === null;\r\n\r\nconst detectIsEmpty = (o: any) => detectIsNull(o) || detectIsUndefined(o);\r\n\r\nconst detectIsFalsy = (o: any) => detectIsEmpty(o) || o === false;\r\n\r\nconst getTime = () => Date.now();\r\n\r\nconst dummyFn = () => {};\r\n\r\nconst trueFn = () => true;\r\n\r\nconst falseFn = () => false;\r\n\r\nconst sameFn = <T = any>(x: T) => x;\r\n\r\nconst error = (...args: Array<any>) => !detectIsUndefined(console) && console.error(...args);\r\n\r\nfunction flatten<T = any>(source: Array<NestedArray<T>>, transform: (x: T) => any = sameFn): Array<T> {\r\n  if (detectIsArray(source)) {\r\n    if (source.length === 0) return [];\r\n  } else {\r\n    return [transform(source)];\r\n  }\r\n  const list: Array<T> = [];\r\n  const stack = [source[0]];\r\n  let idx = 0;\r\n\r\n  while (stack.length > 0) {\r\n    const x = stack.pop();\r\n\r\n    if (detectIsArray(x)) {\r\n      for (let i = x.length - 1; i >= 0; i--) {\r\n        stack.push(x[i]);\r\n      }\r\n    } else {\r\n      list.push(transform(x));\r\n\r\n      if (stack.length === 0 && idx < source.length - 1) {\r\n        idx++;\r\n        stack.push(source[idx]);\r\n      }\r\n    }\r\n  }\r\n\r\n  return list;\r\n}\r\n\r\nfunction keyBy<T = any>(\r\n  list: Array<T>,\r\n  fn: (o: T) => string | number,\r\n  value = false,\r\n): Record<string | number, T | boolean> {\r\n  return list.reduce((acc, x) => ((acc[fn(x)] = value ? x : true), acc), {});\r\n}\r\n\r\nfunction detectAreDepsDifferent(prevDeps: Array<unknown>, nextDeps: Array<unknown>): boolean {\r\n  if (prevDeps === nextDeps) return false;\r\n  const max = Math.max(prevDeps.length, nextDeps.length);\r\n\r\n  for (let i = 0; i < max; i++) {\r\n    if (!Object.is(prevDeps[i], nextDeps[i])) return true;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nfunction nextTick(callback: () => void) {\r\n  Promise.resolve().then(callback);\r\n}\r\n\r\nconst createIndexKey = (idx: number) => `${INDEX_KEY}:${idx}`;\r\n\r\nexport {\r\n  detectIsFunction,\r\n  detectIsUndefined,\r\n  detectIsNumber,\r\n  detectIsString,\r\n  detectIsTextBased,\r\n  detectIsObject,\r\n  detectIsBoolean,\r\n  detectIsArray,\r\n  detectIsNull,\r\n  detectIsEmpty,\r\n  detectIsFalsy,\r\n  getTime,\r\n  dummyFn,\r\n  trueFn,\r\n  falseFn,\r\n  error,\r\n  flatten,\r\n  keyBy,\r\n  detectAreDepsDifferent,\r\n  nextTick,\r\n  createIndexKey,\r\n};\r\n","import { type Fiber } from '../fiber';\r\nimport { type VirtualNode } from '../view';\r\nimport { type Callback } from '../shared';\r\n\r\nexport type Platform = {\r\n  createElement: <N>(vNode: VirtualNode) => N;\r\n  insertElement: <N>(node: N, idx: number, parent: N) => void;\r\n  raf: typeof requestAnimationFrame;\r\n  caf: typeof cancelAnimationFrame;\r\n  spawn: (callback: Callback) => void;\r\n  commit: (fiber: Fiber) => void;\r\n  finishCommit: () => void;\r\n  detectIsDynamic: () => boolean;\r\n  detectIsPortal: (instance: unknown) => boolean;\r\n  unmountPortal: (fiber: Fiber) => void;\r\n  chunk: (fiber: Fiber) => void;\r\n};\r\n\r\nconst defaultRealisation = () => {\r\n  throw new Error('Function not installed by renderer!');\r\n};\r\n\r\nconst platform: Platform = {\r\n  createElement: defaultRealisation,\r\n  insertElement: defaultRealisation,\r\n  raf: defaultRealisation,\r\n  caf: defaultRealisation,\r\n  spawn: defaultRealisation,\r\n  commit: defaultRealisation,\r\n  finishCommit: defaultRealisation,\r\n  detectIsDynamic: defaultRealisation,\r\n  detectIsPortal: defaultRealisation,\r\n  unmountPortal: defaultRealisation,\r\n  chunk: defaultRealisation,\r\n};\r\n\r\nconst detectIsServer = () => !platform.detectIsDynamic();\r\n\r\nexport { platform, detectIsServer };\r\n","import { type SubscriberWithValue } from '../shared';\r\n\r\ntype EventName = 'finish' | 'chunk';\r\n\r\nclass EventEmitter<E extends string = EventName, T = unknown> {\r\n  private subscribers: Map<Partial<E>, Set<SubscriberWithValue<unknown>>> = new Map();\r\n\r\n  on<T>(e: E, fn: SubscriberWithValue<T>) {\r\n    !this.subscribers.has(e) && this.subscribers.set(e, new Set());\r\n    this.subscribers.get(e).add(fn);\r\n\r\n    return () => this.subscribers.has(e) && this.subscribers.get(e).delete(fn);\r\n  }\r\n\r\n  emit(e: E, data?: T) {\r\n    this.subscribers.has(e) && this.subscribers.get(e).forEach(x => x(data));\r\n  }\r\n\r\n  kill() {\r\n    this.subscribers = new Map();\r\n  }\r\n\r\n  __getSize() {\r\n    return this.subscribers.size;\r\n  }\r\n}\r\n\r\nexport { EventEmitter };\r\n","import type { Callback, ElementKey, AppResources, AppResource } from '../shared';\r\nimport { type SetPendingStatus } from '../start-transition';\r\nimport { platform, detectIsServer } from '../platform';\r\nimport { EventEmitter } from '../emitter';\r\nimport { type Fiber } from '../fiber';\r\n\r\nclass Scope {\r\n  private root: Fiber = null;\r\n  private wip: Fiber = null;\r\n  private cursor: Fiber = null;\r\n  private unit: Fiber = null;\r\n  private mountDeep = true;\r\n  private mountLevel = 0;\r\n  private mountNav: Record<number, number> = {};\r\n  private events: Map<string, WeakMap<object, Function>> = new Map();\r\n  private unsubs: Set<Callback> = new Set();\r\n  private actions: Actions = {};\r\n  private candidates: Set<Fiber> = new Set();\r\n  private deletions: Set<Fiber> = new Set();\r\n  private cancels: Array<Callback> = [];\r\n  private asyncEffects: Set<Callback> = new Set();\r\n  private layoutEffects: Set<Callback> = new Set();\r\n  private insertionEffects: Set<Callback> = new Set();\r\n  private resourceId = 0;\r\n  private resources: AppResources = new Map();\r\n  private defers: Array<() => Promise<unknown>> = [];\r\n  private setPendingStatus: SetPendingStatus = null;\r\n  private isLayoutEffectsZone = false;\r\n  private isInsertionEffectsZone = false;\r\n  private isUpdateZone = false;\r\n  private isBatchZone = false;\r\n  private isHydrateZone = false;\r\n  private isStreamZone = false;\r\n  private isTransitionZone = false;\r\n  private isEventZone = false;\r\n  private isHot = false;\r\n  private isDynamic = platform.detectIsDynamic();\r\n  private isServer = detectIsServer();\r\n  private emitter = new EventEmitter();\r\n\r\n  private resetActions() {\r\n    this.actions = {};\r\n  }\r\n\r\n  getActionsById(id: number) {\r\n    return this.actions[id];\r\n  }\r\n\r\n  addActionMap(id: number, map: Record<ElementKey, Fiber>) {\r\n    this.actions[id] = {\r\n      map,\r\n      replace: null,\r\n      insert: null,\r\n      remove: null,\r\n      move: null,\r\n      stable: null,\r\n    };\r\n  }\r\n\r\n  addReplaceAction(id: number, nextKey: ElementKey) {\r\n    !this.actions[id].replace && (this.actions[id].replace = {});\r\n    this.actions[id].replace[nextKey] = true;\r\n  }\r\n\r\n  addInsertAction(id: number, nextKey: ElementKey) {\r\n    !this.actions[id].insert && (this.actions[id].insert = {});\r\n    this.actions[id].insert[nextKey] = true;\r\n  }\r\n\r\n  addRemoveAction(id: number, prevKey: ElementKey) {\r\n    !this.actions[id].remove && (this.actions[id].remove = {});\r\n    this.actions[id].remove[prevKey] = true;\r\n  }\r\n\r\n  addMoveAction(id: number, nextKey: ElementKey) {\r\n    !this.actions[id].move && (this.actions[id].move = {});\r\n    this.actions[id].move[nextKey] = true;\r\n  }\r\n\r\n  addStableAction(id: number, nextKey: ElementKey) {\r\n    !this.actions[id].stable && (this.actions[id].stable = {});\r\n    this.actions[id].stable[nextKey] = true;\r\n  }\r\n\r\n  copy() {\r\n    const scope = new Scope();\r\n\r\n    scope.root = null;\r\n    scope.wip = null;\r\n    scope.cursor = null;\r\n    scope.unit = this.unit;\r\n    scope.mountDeep = this.mountDeep;\r\n    scope.mountLevel = this.mountLevel;\r\n    scope.mountNav = { ...this.mountNav };\r\n    scope.events = this.events;\r\n    scope.unsubs = this.unsubs;\r\n    scope.actions = { ...this.actions };\r\n    scope.candidates = new Set([...this.candidates]);\r\n    scope.deletions = new Set([...this.deletions]);\r\n    scope.asyncEffects = new Set([...this.asyncEffects]);\r\n    scope.layoutEffects = new Set([...this.layoutEffects]);\r\n    scope.insertionEffects = new Set([...this.insertionEffects]);\r\n    scope.isUpdateZone = this.isUpdateZone;\r\n    scope.emitter = this.emitter;\r\n\r\n    return scope;\r\n  }\r\n\r\n  getRoot() {\r\n    return this.root;\r\n  }\r\n\r\n  setRoot(fiber: Fiber) {\r\n    this.root = fiber;\r\n  }\r\n\r\n  getWorkInProgress() {\r\n    return this.wip;\r\n  }\r\n\r\n  setWorkInProgress(fiber: Fiber) {\r\n    this.wip = fiber;\r\n  }\r\n\r\n  getNextUnitOfWork() {\r\n    return this.unit;\r\n  }\r\n\r\n  setNextUnitOfWork(fiber: Fiber) {\r\n    this.unit = fiber;\r\n  }\r\n\r\n  getCursorFiber() {\r\n    return this.cursor;\r\n  }\r\n\r\n  setCursorFiber(fiber: Fiber) {\r\n    this.cursor = fiber;\r\n  }\r\n\r\n  navToChild() {\r\n    this.mountLevel = this.mountLevel + 1;\r\n    this.mountNav[this.mountLevel] = 0;\r\n  }\r\n\r\n  navToSibling() {\r\n    this.mountNav[this.mountLevel] = this.mountNav[this.mountLevel] + 1;\r\n  }\r\n\r\n  navToParent() {\r\n    this.mountLevel = this.mountLevel - 1;\r\n  }\r\n\r\n  navToPrev() {\r\n    const idx = this.getMountIndex();\r\n\r\n    if (idx === 0) {\r\n      this.navToParent();\r\n      this.setMountDeep(true);\r\n    } else {\r\n      this.mountNav[this.mountLevel] = this.mountNav[this.mountLevel] - 1;\r\n      this.setMountDeep(false);\r\n    }\r\n  }\r\n\r\n  getMountIndex() {\r\n    return this.mountNav[this.mountLevel];\r\n  }\r\n\r\n  getMountDeep() {\r\n    return this.mountDeep;\r\n  }\r\n\r\n  setMountDeep(value: boolean) {\r\n    this.mountDeep = value;\r\n  }\r\n\r\n  resetMount() {\r\n    this.mountLevel = 0;\r\n    this.mountNav = {};\r\n    this.mountDeep = true;\r\n  }\r\n\r\n  getEvents() {\r\n    return this.events;\r\n  }\r\n\r\n  addEventUnsubscriber(fn: Callback) {\r\n    this.unsubs.add(fn);\r\n  }\r\n\r\n  unsubscribeEvents() {\r\n    this.unsubs.forEach(x => x());\r\n    this.unsubs = new Set();\r\n  }\r\n\r\n  getCandidates() {\r\n    return this.candidates;\r\n  }\r\n\r\n  addCandidate(fiber: Fiber) {\r\n    this.candidates.add(fiber);\r\n  }\r\n\r\n  resetCandidates() {\r\n    this.candidates = new Set();\r\n  }\r\n\r\n  getDeletions() {\r\n    return this.deletions;\r\n  }\r\n\r\n  hasDeletion(fiber: Fiber) {\r\n    let nextFiber = fiber;\r\n\r\n    while (nextFiber) {\r\n      if (this.deletions.has(nextFiber)) return true;\r\n      nextFiber = nextFiber.parent;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  addDeletion(fiber: Fiber) {\r\n    !this.hasDeletion(fiber) && this.deletions.add(fiber);\r\n  }\r\n\r\n  resetDeletions() {\r\n    this.deletions = new Set();\r\n  }\r\n\r\n  addAsyncEffect(fn: Callback) {\r\n    this.asyncEffects.add(fn);\r\n  }\r\n\r\n  resetAsyncEffects() {\r\n    this.asyncEffects = new Set();\r\n  }\r\n\r\n  runAsyncEffects() {\r\n    if (!this.isDynamic) return;\r\n    const effects = this.asyncEffects;\r\n    effects.size > 0 && setTimeout(() => effects.forEach(fn => fn()));\r\n  }\r\n\r\n  addLayoutEffect(fn: Callback) {\r\n    this.layoutEffects.add(fn);\r\n  }\r\n\r\n  resetLayoutEffects() {\r\n    this.layoutEffects = new Set();\r\n  }\r\n\r\n  runLayoutEffects() {\r\n    if (!this.isDynamic) return;\r\n    this.setIsLayoutEffectsZone(true);\r\n    this.layoutEffects.forEach(fn => fn());\r\n    this.setIsLayoutEffectsZone(false);\r\n  }\r\n\r\n  addInsertionEffect(fn: Callback) {\r\n    this.insertionEffects.add(fn);\r\n  }\r\n\r\n  resetInsertionEffects() {\r\n    this.insertionEffects = new Set();\r\n  }\r\n\r\n  runInsertionEffects() {\r\n    if (!this.isDynamic) return;\r\n    this.setIsInsertionEffectsZone(true);\r\n    this.insertionEffects.forEach(fn => fn());\r\n    this.setIsInsertionEffectsZone(false);\r\n  }\r\n\r\n  addCancel(fn: Callback) {\r\n    this.cancels.push(fn);\r\n  }\r\n\r\n  applyCancels() {\r\n    for (let i = this.cancels.length - 1; i >= 0; i--) {\r\n      this.cancels[i]();\r\n    }\r\n  }\r\n\r\n  resetCancels() {\r\n    this.cancels = [];\r\n  }\r\n\r\n  getIsLayoutEffectsZone() {\r\n    return this.isLayoutEffectsZone;\r\n  }\r\n\r\n  setIsLayoutEffectsZone(value: boolean) {\r\n    this.isLayoutEffectsZone = value;\r\n  }\r\n\r\n  getIsInsertionEffectsZone() {\r\n    return this.isInsertionEffectsZone;\r\n  }\r\n\r\n  setIsInsertionEffectsZone(value: boolean) {\r\n    this.isInsertionEffectsZone = value;\r\n  }\r\n\r\n  getIsUpdateZone() {\r\n    return this.isUpdateZone;\r\n  }\r\n\r\n  setIsUpdateZone(value: boolean) {\r\n    this.isUpdateZone = value;\r\n  }\r\n\r\n  getIsBatchZone() {\r\n    return this.isBatchZone;\r\n  }\r\n\r\n  setIsBatchZone(value: boolean) {\r\n    this.isBatchZone = value;\r\n  }\r\n\r\n  getIsHydrateZone() {\r\n    return this.isHydrateZone;\r\n  }\r\n\r\n  setIsHydrateZone(value: boolean) {\r\n    this.isHydrateZone = value;\r\n  }\r\n\r\n  getIsStreamZone() {\r\n    return this.isStreamZone;\r\n  }\r\n\r\n  setIsStreamZone(value: boolean) {\r\n    this.isStreamZone = value;\r\n  }\r\n\r\n  getIsTransitionZone() {\r\n    return this.isTransitionZone;\r\n  }\r\n\r\n  setIsTransitionZone(value: boolean) {\r\n    this.isTransitionZone = value;\r\n  }\r\n\r\n  getIsEventZone() {\r\n    return this.isEventZone;\r\n  }\r\n\r\n  setIsEventZone(value: boolean) {\r\n    this.isEventZone = value;\r\n  }\r\n\r\n  getIsHot() {\r\n    return this.isHot;\r\n  }\r\n\r\n  setIsHot(value: boolean) {\r\n    this.isHot = value;\r\n  }\r\n\r\n  getPendingStatusSetter() {\r\n    return this.setPendingStatus;\r\n  }\r\n\r\n  setPendingStatusSetter(fn: SetPendingStatus) {\r\n    this.setPendingStatus = fn;\r\n  }\r\n\r\n  flush() {\r\n    !this.isUpdateZone && this.setRoot(this.wip); // !\r\n    this.setWorkInProgress(null);\r\n    this.setNextUnitOfWork(null);\r\n    this.setCursorFiber(null);\r\n    this.resetMount();\r\n    this.resetCandidates();\r\n    this.resetDeletions();\r\n    this.resetCancels();\r\n    this.resetInsertionEffects();\r\n    this.resetLayoutEffects();\r\n    this.resetAsyncEffects();\r\n    this.setIsHydrateZone(false);\r\n    this.setIsUpdateZone(false);\r\n    this.resetActions();\r\n  }\r\n\r\n  getEmitter() {\r\n    return this.emitter;\r\n  }\r\n\r\n  defer(fn: () => Promise<unknown>) {\r\n    this.defers.push(fn);\r\n  }\r\n\r\n  getDefers() {\r\n    return this.defers;\r\n  }\r\n\r\n  resetDefers() {\r\n    this.defers = [];\r\n  }\r\n\r\n  getResource(id: number) {\r\n    return this.resources.get(id);\r\n  }\r\n\r\n  setResource(id: number, res: AppResource) {\r\n    this.resources.set(id, res);\r\n  }\r\n\r\n  getResources() {\r\n    return this.resources;\r\n  }\r\n\r\n  getResourceId() {\r\n    return this.resourceId;\r\n  }\r\n\r\n  setResourceId(id: number) {\r\n    this.resourceId = id;\r\n  }\r\n\r\n  getNextResourceId() {\r\n    return ++this.resourceId;\r\n  }\r\n\r\n  runAfterCommit() {\r\n    this.resources = new Map();\r\n    this.isServer && (this.resourceId = 0);\r\n  }\r\n}\r\n\r\ntype Actions = Record<\r\n  number,\r\n  {\r\n    map: Record<ElementKey, Fiber>;\r\n    replace: Record<ElementKey, true>;\r\n    insert: Record<ElementKey, true>;\r\n    remove: Record<ElementKey, true>;\r\n    move: Record<ElementKey, true>;\r\n    stable: Record<ElementKey, true>;\r\n  }\r\n>;\r\n\r\nlet rootId: number = null;\r\nconst scopes = new Map<number, Scope>();\r\n\r\nconst getRootId = () => rootId;\r\n\r\nconst setRootId = (id: number) => {\r\n  rootId = id;\r\n  !scopes.has(rootId) && scopes.set(rootId, new Scope());\r\n};\r\n\r\nconst removeScope = (id: number) => scopes.delete(id);\r\n\r\nconst replaceScope = (scope: Scope, id: number = rootId) => {\r\n  Object.assign(scopes.get(id), scope);\r\n};\r\n\r\nconst $$scope = (id: number = rootId) => scopes.get(id);\r\n\r\nexport { type Scope, getRootId, setRootId, removeScope, replaceScope, $$scope };\r\n","import type { ElementKey, DarkElement, Instance, SlotProps, RefProps, KeyProps, FlagProps } from '../shared';\r\nimport { type Component, detectIsComponent, getComponentKey, hasComponentFlag } from '../component';\r\nimport { detectIsArray, detectIsFunction } from '../utils';\r\nimport { REPLACER, KEY_ATTR } from '../constants';\r\nimport { $$scope } from '../scope';\r\n\r\nconst $$vNode = Symbol('vNode');\r\nconst ATTR_TYPE = 'type';\r\n\r\nclass VirtualNode {\r\n  public type: NodeType = null;\r\n\r\n  constructor(type: NodeType) {\r\n    this.type = type;\r\n  }\r\n}\r\n\r\nclass TagVirtualNode extends VirtualNode {\r\n  public name: string;\r\n  public attrs: Record<string, any>;\r\n  public children: Array<TextVirtualNode | CommentVirtualNode | TagVirtualNode | VirtualNodeFactory | Component>;\r\n\r\n  constructor(name: string, attrs: TagVirtualNode['attrs'], children: TagVirtualNode['children']) {\r\n    super(NodeType.TAG);\r\n    this.name = name;\r\n    this.attrs = attrs;\r\n    this.children = children;\r\n  }\r\n}\r\n\r\nclass TextVirtualNode extends VirtualNode {\r\n  public value: string;\r\n\r\n  constructor(source: TextSource) {\r\n    super(NodeType.TEXT);\r\n    this.value = String(source);\r\n  }\r\n}\r\n\r\nclass CommentVirtualNode extends VirtualNode {\r\n  public value = '';\r\n\r\n  constructor(text: string) {\r\n    super(NodeType.COMMENT);\r\n    this.value = text;\r\n  }\r\n}\r\n\r\nfunction View(options: ViewOptions) {\r\n  const factory: TagVirtualNodeFactory = () => {\r\n    const { as: name, slot, _void = false, ...attrs } = options;\r\n    const children = (_void ? [] : detectIsArray(slot) ? slot : slot ? [slot] : []) as TagVirtualNode['children'];\r\n\r\n    return new TagVirtualNode(name, attrs, children);\r\n  };\r\n\r\n  factory[$$vNode] = true;\r\n  factory[ATTR_TYPE] = options.as;\r\n  factory[KEY_ATTR] = options.key;\r\n\r\n  return factory;\r\n}\r\n\r\nconst Text = (source: TextSource) => new TextVirtualNode(source);\r\n\r\nText.from = (source: DarkElement) => (detectIsTextVirtualNode(source) ? source.value : source + '');\r\n\r\nconst Comment = (text: string) => new CommentVirtualNode(text);\r\n\r\nconst detectIsVirtualNode = (vNode: unknown): vNode is VirtualNode => vNode instanceof VirtualNode;\r\n\r\nconst detectIsTagVirtualNode = (vNode: unknown): vNode is TagVirtualNode => vNode instanceof TagVirtualNode;\r\n\r\nconst detectIsCommentVirtualNode = (vNode: unknown): vNode is CommentVirtualNode => vNode instanceof CommentVirtualNode;\r\n\r\nconst detectIsTextVirtualNode = (vNode: unknown): vNode is TextVirtualNode => vNode instanceof TextVirtualNode;\r\n\r\nconst detectIsVirtualNodeFactory = (factory: unknown): factory is VirtualNodeFactory =>\r\n  detectIsFunction(factory) && factory[$$vNode] === true;\r\n\r\nconst getTagVirtualNodeKey = (vNode: TagVirtualNode): ElementKey | null =>\r\n  vNode.attrs ? vNode.attrs[KEY_ATTR] ?? null : null;\r\n\r\nconst hasTagVirtualNodeFlag = (vNode: TagVirtualNode, flag: string) => Boolean(vNode.attrs && vNode.attrs[flag]);\r\n\r\nconst getVirtualNodeFactoryKey = (factory: VirtualNodeFactory): ElementKey | null => factory[KEY_ATTR] ?? null;\r\n\r\nconst hasVirtualNodeFactoryFlag = (factory: VirtualNodeFactory, flag: string) => Boolean(factory[flag]);\r\n\r\nconst detectIsPlainVirtualNode = (vNode: unknown): vNode is PlainVirtualNode =>\r\n  detectIsTextVirtualNode(vNode) || detectIsCommentVirtualNode(vNode);\r\n\r\nconst createReplacer = () => new CommentVirtualNode(REPLACER);\r\n\r\nconst detectIsReplacer = (vNode: unknown) => detectIsCommentVirtualNode(vNode) && vNode.value === REPLACER;\r\n\r\nfunction getElementKey(inst: Instance): ElementKey | null {\r\n  return detectIsComponent(inst)\r\n    ? getComponentKey(inst)\r\n    : detectIsVirtualNodeFactory(inst)\r\n    ? getVirtualNodeFactoryKey(inst)\r\n    : detectIsTagVirtualNode(inst)\r\n    ? getTagVirtualNodeKey(inst)\r\n    : null;\r\n}\r\n\r\nfunction hasElementFlag(inst: Instance, flag: string) {\r\n  return detectIsComponent(inst)\r\n    ? hasComponentFlag(inst, flag)\r\n    : detectIsVirtualNodeFactory(inst)\r\n    ? hasVirtualNodeFactoryFlag(inst, flag)\r\n    : detectIsTagVirtualNode(inst)\r\n    ? hasTagVirtualNodeFlag(inst, flag)\r\n    : false;\r\n}\r\n\r\nfunction getElementType(inst: Instance): string | Function {\r\n  return detectIsComponent(inst)\r\n    ? inst.type\r\n    : detectIsVirtualNodeFactory(inst)\r\n    ? inst[ATTR_TYPE]\r\n    : detectIsTagVirtualNode(inst)\r\n    ? inst.name\r\n    : detectIsVirtualNode(inst)\r\n    ? inst.type\r\n    : null;\r\n}\r\n\r\nfunction hasChildrenProp(inst: Instance): inst is TagVirtualNode | Component {\r\n  return detectIsTagVirtualNode(inst) || detectIsComponent(inst);\r\n}\r\n\r\nfunction detectAreSameInstanceTypes(prevInst: Instance, nextInst: Instance, isComponentFactories = false) {\r\n  if (process.env.NODE_ENV !== 'production') {\r\n    if (process.env.NODE_ENV === 'development' && $$scope().getIsHot()) {\r\n      if (detectIsComponent(prevInst) && detectIsComponent(nextInst)) {\r\n        return prevInst.displayName === nextInst.displayName;\r\n      }\r\n    }\r\n  }\r\n\r\n  if (isComponentFactories) {\r\n    const pc = prevInst as Component;\r\n    const nc = nextInst as Component;\r\n\r\n    return pc.type === nc.type;\r\n  }\r\n\r\n  return getElementType(prevInst) === getElementType(nextInst);\r\n}\r\n\r\nfunction detectAreSameComponentTypesWithSameKeys(prevInst: Instance | null, nextInst: Instance | null) {\r\n  if (\r\n    prevInst &&\r\n    nextInst &&\r\n    detectIsComponent(prevInst) &&\r\n    detectIsComponent(nextInst) &&\r\n    detectAreSameInstanceTypes(prevInst, nextInst, true)\r\n  ) {\r\n    return getElementKey(prevInst) === getElementKey(nextInst);\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\ntype TextSource = string | number;\r\n\r\nexport type VirtualNodeFactory = () => VirtualNode;\r\n\r\nexport type TagVirtualNodeFactory = () => TagVirtualNode;\r\n\r\nexport type PlainVirtualNode = TextVirtualNode | CommentVirtualNode;\r\n\r\nexport type ViewOptions = {\r\n  as: string;\r\n  _void?: boolean;\r\n  [prop: string]: any;\r\n} & Partial<SlotProps> &\r\n  RefProps &\r\n  KeyProps &\r\n  FlagProps;\r\n\r\nexport enum NodeType {\r\n  TAG = 'TAG',\r\n  TEXT = 'TEXT',\r\n  COMMENT = 'COMMENT',\r\n}\r\n\r\nexport {\r\n  View,\r\n  Text,\r\n  Comment,\r\n  VirtualNode,\r\n  TagVirtualNode,\r\n  TextVirtualNode,\r\n  CommentVirtualNode,\r\n  createReplacer,\r\n  detectIsReplacer,\r\n  getElementKey,\r\n  hasElementFlag,\r\n  getElementType,\r\n  hasChildrenProp,\r\n  detectIsVirtualNode,\r\n  detectIsTagVirtualNode,\r\n  detectIsCommentVirtualNode,\r\n  detectIsTextVirtualNode,\r\n  detectIsPlainVirtualNode,\r\n  detectIsVirtualNodeFactory,\r\n  detectAreSameInstanceTypes,\r\n  detectAreSameComponentTypesWithSameKeys,\r\n};\r\n","import { detectIsTagVirtualNode, detectIsPlainVirtualNode, detectAreSameComponentTypesWithSameKeys } from '../view';\r\nimport { type Instance, type Callback, type TimerId } from '../shared';\r\nimport { type Context, type ContextProviderValue } from '../context';\r\nimport { detectIsComponent } from '../component';\r\nimport { detectIsFunction } from '../utils';\r\nimport { type Atom } from '../atom';\r\nimport { $$scope } from '../scope';\r\n\r\nclass Fiber<N = NativeElement> {\r\n  id = 0;\r\n  cc = 0; // child fibers count\r\n  cec = 0; // child native elements count\r\n  idx = 0; // idx of fiber in the parent fiber\r\n  eidx = 0; // native element idx\r\n  mask = 0; // bit mask\r\n  element: N = null; // native element\r\n  tag: string = null; // effect tag (CREATE, UPDATE, DELETE, SKIP)\r\n  parent: Fiber<N> = null; // parent fiber\r\n  child: Fiber<N> = null; // child fiber\r\n  next: Fiber<N> = null; // next sibling fiber\r\n  alt: Fiber<N> = null; // alternate fiber (previous)\r\n  inst: Instance = null; // instance of component or virtual node\r\n  hook: Hook | null = null; // hook\r\n  provider: Map<Context, ContextProviderValue> = null; // provider of context\r\n  atoms: Map<Atom, Callback> = null;\r\n  marker: string; // for dev\r\n  batch: Batch;\r\n  catch: (error: Error) => void;\r\n\r\n  constructor(hook: Hook = null, provider: Fiber['provider'] = null, idx = 0) {\r\n    this.id = ++Fiber.nextId;\r\n    this.idx = idx;\r\n    hook && (this.hook = hook);\r\n    provider && (this.provider = provider);\r\n  }\r\n\r\n  mutate(fiber: Partial<Fiber<N>>) {\r\n    const keys = Object.keys(fiber);\r\n\r\n    for (const key of keys) {\r\n      this[key] = fiber[key];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  markHost(mask: number) {\r\n    this.mask |= mask;\r\n    this.parent && !(this.parent.mask & mask) && this.parent.markHost(mask);\r\n  }\r\n\r\n  increment(count = 1, force = false) {\r\n    if (!this.parent) return;\r\n    const $scope = $$scope();\r\n    const isUpdateZone = $scope.getIsUpdateZone();\r\n    const wipFiber = $scope.getWorkInProgress();\r\n    const stop = isUpdateZone && wipFiber.parent === this.parent;\r\n\r\n    if (\r\n      detectIsPlainVirtualNode(this.inst) ||\r\n      (detectIsTagVirtualNode(this.inst) && this.inst.children?.length === 0)\r\n    ) {\r\n      this.cec = 1;\r\n    }\r\n\r\n    if (isUpdateZone && stop && !force) return;\r\n\r\n    this.parent.cec += count;\r\n\r\n    if (!this.parent.element) {\r\n      this.parent.increment(count);\r\n    }\r\n  }\r\n\r\n  setError(error: Error) {\r\n    if (detectIsFunction(this.catch)) {\r\n      this.catch(error);\r\n    } else if (this.parent) {\r\n      this.parent.setError(error);\r\n    }\r\n  }\r\n\r\n  static setNextId(id: number) {\r\n    Fiber.nextId = id;\r\n  }\r\n\r\n  private static nextId = 0;\r\n}\r\n\r\nclass Hook<T = any> {\r\n  id = 0;\r\n  idx = 0;\r\n  values: Array<T> = [];\r\n  owner: Fiber = null;\r\n  private static nextId = 0;\r\n\r\n  constructor() {\r\n    this.id = ++Hook.nextId;\r\n  }\r\n}\r\n\r\nfunction getHook(alt: Fiber, prevInst: Instance, nextInst: Instance): Hook | null {\r\n  if (alt && detectAreSameComponentTypesWithSameKeys(prevInst, nextInst)) return alt.hook;\r\n  if (detectIsComponent(nextInst)) return new Hook();\r\n\r\n  return null;\r\n}\r\n\r\ntype Batch = {\r\n  timer: TimerId;\r\n  changes: Array<Callback>;\r\n};\r\n\r\nexport type NativeElement = unknown;\r\nexport type HookValue<T = any> = { deps: Array<any>; value: T };\r\n\r\nexport { Fiber, Hook, getHook };\r\n","import {\r\n  type ComponentFactory,\r\n  type StandardComponentProps,\r\n  type ShouldUpdate,\r\n  type ComponentInject,\r\n  $$inject,\r\n  detectIsComponent,\r\n} from '../component';\r\nimport type { SlotProps, RefProps } from '../shared';\r\n\r\nconst $$memo = Symbol('memo');\r\n\r\nconst defaultShouldUpdate = (props: {}, nextProps: {}): boolean => {\r\n  const keys = Object.keys(nextProps);\r\n\r\n  for (const key of keys) {\r\n    if (key !== 'slot' && nextProps[key] !== props[key]) return true;\r\n  }\r\n\r\n  return false;\r\n};\r\n\r\nfunction memo<P extends object, R = unknown>(\r\n  factory: ComponentFactory<P, R>,\r\n  shouldUpdate: ShouldUpdate<P & SlotProps> = defaultShouldUpdate,\r\n) {\r\n  type P1 = P & Omit<StandardComponentProps, 'ref'> & RefProps<R>;\r\n\r\n  factory[$$inject] = {\r\n    token: $$memo,\r\n    shouldUpdate,\r\n  } as ComponentInject<P1>;\r\n\r\n  return factory as ComponentFactory<P1, R>;\r\n}\r\n\r\nconst detectIsMemo = (instance: unknown) => detectIsComponent(instance) && instance.token === $$memo;\r\n\r\nexport { memo, detectIsMemo };\r\n","import {\r\n  DELETE_EFFECT_TAG,\r\n  UPDATE_EFFECT_TAG,\r\n  SKIP_EFFECT_TAG,\r\n  INSERTION_EFFECT_HOST_MASK,\r\n  LAYOUT_EFFECT_HOST_MASK,\r\n  ASYNC_EFFECT_HOST_MASK,\r\n  ATOM_HOST_MASK,\r\n  PORTAL_HOST_MASK,\r\n  MOVE_MASK,\r\n  HOOK_DELIMETER,\r\n} from '../constants';\r\nimport { Fiber } from '../fiber';\r\nimport { platform } from '../platform';\r\nimport { type TagVirtualNode, getElementKey, hasChildrenProp } from '../view';\r\nimport { type Scope } from '../scope';\r\nimport { type Component } from '../component';\r\nimport { detectIsMemo } from '../memo';\r\nimport { type Instance, type ElementKey } from '../shared';\r\nimport { createIndexKey } from '../utils';\r\n\r\nfunction walk<T = unknown>(fiber: Fiber<T>, onWalk: (fiber: Fiber<T>, skip: () => void, stop: () => void) => void) {\r\n  let shouldDeep = true;\r\n  let shouldStop = false;\r\n  const skip = () => (shouldDeep = false);\r\n  const stop = () => (shouldStop = true);\r\n  const stack: Array<Fiber<T>> = [fiber];\r\n\r\n  while (stack.length !== 0) {\r\n    const unit = stack.pop();\r\n\r\n    onWalk(unit, skip, stop);\r\n    if (shouldStop) break;\r\n    unit !== fiber && unit.next && stack.push(unit.next);\r\n    shouldDeep && unit.child && stack.push(unit.child);\r\n    shouldDeep = true;\r\n  }\r\n}\r\n\r\nfunction collectElements<T, P = T>(fiber: Fiber<T>, transform: (fiber: Fiber<T>) => P): Array<P> {\r\n  const elements: Array<P> = [];\r\n\r\n  walk<T>(fiber, (fiber, skip) => {\r\n    if (fiber.element) {\r\n      !platform.detectIsPortal(fiber.inst) && elements.push(transform(fiber));\r\n      return skip();\r\n    }\r\n  });\r\n\r\n  return elements;\r\n}\r\n\r\nfunction getFiberWithElement<T1, T2 = T1>(fiber: Fiber<T1>): Fiber<T2> {\r\n  let $fiber = fiber as unknown as Fiber<T2>;\r\n\r\n  while ($fiber) {\r\n    if ($fiber.element) return $fiber;\r\n    $fiber = $fiber.parent;\r\n  }\r\n\r\n  return $fiber;\r\n}\r\n\r\nfunction detectIsFiberAlive(fiber: Fiber) {\r\n  let $fiber = fiber;\r\n\r\n  while ($fiber) {\r\n    if ($fiber.tag === DELETE_EFFECT_TAG) return false;\r\n    $fiber = $fiber.parent;\r\n  }\r\n\r\n  return Boolean(fiber);\r\n}\r\n\r\nfunction createHookLocation(rootId: number, idx: number, fiber: Fiber) {\r\n  let $fiber = fiber;\r\n  let loc = `${fiber.idx}${HOOK_DELIMETER}${idx}`;\r\n\r\n  while ($fiber) {\r\n    $fiber = $fiber.parent;\r\n    $fiber && (loc = `${$fiber.idx}.${loc}`);\r\n  }\r\n\r\n  loc = `[${rootId}]${loc}`;\r\n\r\n  return loc;\r\n}\r\n\r\nfunction detectIsStableMemoTree(fiber: Fiber, $scope: Scope) {\r\n  if (!hasChildrenProp(fiber.inst)) return;\r\n  const actions = $scope.getActionsById(fiber.id);\r\n  const children = fiber.inst.children;\r\n\r\n  for (let i = 0; i < children.length; i++) {\r\n    const inst = children[i];\r\n    const key = getElementKey(inst);\r\n    if (key === null) return false;\r\n    const alt = actions.map[key];\r\n    if (!alt) return false;\r\n    const pc = alt.inst as Component;\r\n    const nc = inst as Component;\r\n    const isStable =\r\n      detectIsMemo(nc) && detectIsMemo(pc) && nc.type === pc.type && !nc.shouldUpdate(pc.props, nc.props);\r\n\r\n    if (!isStable) return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nfunction tryOptStaticSlot(fiber: Fiber, alt: Fiber, $scope: Scope) {\r\n  const actions = $scope.getActionsById(fiber.id);\r\n  const inst = fiber.inst as Component | TagVirtualNode;\r\n\r\n  alt.element && (fiber.element = alt.element); //!\r\n\r\n  for (let i = 0; i < inst.children.length; i++) {\r\n    buildChildNode(inst.children, fiber, actions.map, i, fiber.eidx);\r\n  }\r\n\r\n  fiber.cc = inst.children.length;\r\n  $scope.setMountDeep(false);\r\n}\r\n\r\nfunction tryOptMemoSlot(fiber: Fiber, alt: Fiber, $scope: Scope) {\r\n  const actions = $scope.getActionsById(fiber.id);\r\n  const hasMove = Boolean(actions.move);\r\n  const hasRemove = Boolean(actions.remove);\r\n  const hasInsert = Boolean(actions.insert);\r\n  const hasReplace = Boolean(actions.insert);\r\n  const canOptimize = ((hasMove && !hasRemove) || (hasRemove && !hasMove)) && !hasInsert && !hasReplace;\r\n\r\n  if (!canOptimize || !detectIsStableMemoTree(fiber, $scope)) return;\r\n\r\n  hasMove && tryOptMov(fiber, alt, $scope);\r\n  hasRemove && tryOptRem(fiber, alt, $scope);\r\n}\r\n\r\nfunction tryOptMov(fiber: Fiber, alt: Fiber, $scope: Scope) {\r\n  const actions = $scope.getActionsById(fiber.id);\r\n\r\n  buildChildNodes(fiber, alt, $scope, (fiber, key) => {\r\n    if (!actions.move[key]) return;\r\n    fiber.alt = new Fiber().mutate(fiber);\r\n    fiber.tag = UPDATE_EFFECT_TAG;\r\n    fiber.mask |= MOVE_MASK;\r\n    $scope.addCandidate(fiber);\r\n  });\r\n}\r\n\r\nfunction tryOptRem(fiber: Fiber, alt: Fiber, $scope: Scope) {\r\n  buildChildNodes(fiber, alt, $scope);\r\n}\r\n\r\nfunction buildChildNodes(fiber: Fiber, alt: Fiber, $scope: Scope, onNode?: (fiber: Fiber, key: ElementKey) => void) {\r\n  const actions = $scope.getActionsById(fiber.id);\r\n  const inst = fiber.inst as Component | TagVirtualNode;\r\n  const children = inst.children;\r\n\r\n  alt.element && (fiber.element = alt.element); //!\r\n\r\n  for (let i = 0; i < children.length; i++) {\r\n    const key = getKey(children[i], i);\r\n    const $fiber = actions.map[key];\r\n\r\n    buildChildNode(children, fiber, actions.map, i, fiber.eidx);\r\n    onNode && onNode($fiber, key);\r\n  }\r\n\r\n  fiber.cc = children.length;\r\n  $scope.setMountDeep(false);\r\n}\r\n\r\nfunction buildChildNode(\r\n  children: Array<Instance>,\r\n  parent: Fiber,\r\n  altMap: Record<string, Fiber>,\r\n  idx: number,\r\n  startEidx: number,\r\n) {\r\n  const prevIdx = idx - 1;\r\n  const nextIdx = idx + 1;\r\n  const key = getKey(children[idx], idx);\r\n  const prevKey = getKey(children[prevIdx], prevIdx);\r\n  const nextKey = getKey(children[nextIdx], nextIdx);\r\n  const fiber = altMap[key];\r\n  const left = altMap[prevKey];\r\n  const right = altMap[nextKey];\r\n  const isFirst = idx === 0;\r\n  const isLast = idx === children.length - 1;\r\n\r\n  isFirst && (parent.child = fiber);\r\n  fiber.alt = null;\r\n  fiber.parent = parent;\r\n  fiber.tag = SKIP_EFFECT_TAG;\r\n  fiber.idx = idx;\r\n  left ? (fiber.eidx = left.eidx + (left.element ? 1 : left.cec)) : (fiber.eidx = startEidx);\r\n  right && (fiber.next = right);\r\n  isLast && (fiber.next = null);\r\n  notifyParents(fiber);\r\n}\r\n\r\nfunction getKey(inst: Instance, idx: number) {\r\n  const key = getElementKey(inst);\r\n  return key !== null ? key : createIndexKey(idx);\r\n}\r\n\r\nfunction notifyParents(fiber: Fiber, alt: Fiber = fiber) {\r\n  fiber.increment(alt.element ? 1 : alt.cec);\r\n  alt.mask & INSERTION_EFFECT_HOST_MASK && fiber.markHost(INSERTION_EFFECT_HOST_MASK);\r\n  alt.mask & LAYOUT_EFFECT_HOST_MASK && fiber.markHost(LAYOUT_EFFECT_HOST_MASK);\r\n  alt.mask & ASYNC_EFFECT_HOST_MASK && fiber.markHost(ASYNC_EFFECT_HOST_MASK);\r\n  alt.mask & ATOM_HOST_MASK && fiber.markHost(ATOM_HOST_MASK);\r\n  alt.mask & PORTAL_HOST_MASK && fiber.markHost(PORTAL_HOST_MASK);\r\n}\r\n\r\nexport {\r\n  walk,\r\n  collectElements,\r\n  getFiberWithElement,\r\n  detectIsFiberAlive,\r\n  createHookLocation,\r\n  tryOptStaticSlot,\r\n  tryOptMemoSlot,\r\n  notifyParents,\r\n};\r\n","import { component, detectIsComponent } from '../component';\r\nimport type { KeyProps, SlotProps } from '../shared';\r\n\r\ntype FragmentProps = Required<SlotProps> & KeyProps;\r\n\r\nconst $$fragment = Symbol('fragment');\r\n\r\nconst Fragment = component<FragmentProps>(({ slot }) => slot || null, { token: $$fragment });\r\n\r\nconst detectIsFragment = (instance: unknown) => detectIsComponent(instance) && instance.token === $$fragment;\r\n\r\nexport { Fragment, detectIsFragment };\r\n","import { type VirtualNodeFactory, detectIsVirtualNodeFactory } from '../view';\r\nimport { type Component, detectIsComponent, component } from '../component';\r\nimport { type Hook, type HookValue } from '../fiber';\r\nimport { detectAreDepsDifferent } from '../utils';\r\nimport { $$scope } from '../scope';\r\nimport { memo } from '../memo';\r\n\r\ntype GetMemoValue = () => Component | VirtualNodeFactory;\r\n\r\ntype MemoProps = {\r\n  deps: Array<any>;\r\n  getValue: GetMemoValue;\r\n};\r\n\r\nconst Memo = memo(\r\n  component<MemoProps>(({ getValue }) => getValue()),\r\n  (p, n) => detectAreDepsDifferent(p.deps, n.deps),\r\n);\r\n\r\nfunction detectIsElement<T>(value: T) {\r\n  return detectIsComponent(value) || detectIsVirtualNodeFactory(value);\r\n}\r\n\r\nfunction useMemo<T>(getValue: () => T, deps: Array<any>): T {\r\n  const fiber = $$scope().getCursorFiber();\r\n  const { hook } = fiber;\r\n  const { idx, values } = hook as Hook<HookValue<T>>;\r\n  const state =\r\n    values[idx] ||\r\n    (values[idx] = {\r\n      deps,\r\n      value: getValue(),\r\n    });\r\n  let value: T = null;\r\n  let $value: T = null;\r\n\r\n  if (detectIsElement(state.value)) {\r\n    value = state.value;\r\n    $value = Memo({ getValue: getValue as GetMemoValue, deps }) as unknown as T;\r\n  } else {\r\n    value = detectAreDepsDifferent(state.deps, deps) ? getValue() : state.value;\r\n    $value = value;\r\n  }\r\n\r\n  state.deps = deps;\r\n  state.value = value;\r\n  hook.idx++;\r\n\r\n  return $value;\r\n}\r\n\r\nexport { useMemo };\r\n","import { detectIsFunction } from '../utils';\r\nimport { INSERTION_EFFECT_HOST_MASK, LAYOUT_EFFECT_HOST_MASK, ASYNC_EFFECT_HOST_MASK } from '../constants';\r\nimport { $$scope } from '../scope';\r\nimport { useMemo } from '../use-memo';\r\nimport { type Hook, type HookValue } from '../fiber';\r\n\r\nconst $$useEffect = Symbol('use-effect');\r\n\r\ntype UseEffectValue = {\r\n  token: Symbol;\r\n  cleanup: DropEffect;\r\n};\r\n\r\nfunction createEffect(token: Symbol, type: EffectType) {\r\n  function useEffect(effect: Effect, deps: Array<any> = [{}]) {\r\n    const $scope = $$scope();\r\n    const fiber = $scope.getCursorFiber();\r\n    const scope = useMemo<UseEffectValue>(() => ({ token, cleanup: undefined }), []);\r\n    const isInsertionEffect = type === EffectType.INSERTION;\r\n    const isLayoutEffect = type === EffectType.LAYOUT;\r\n    const isAsyncEffect = type === EffectType.ASYNC;\r\n\r\n    isInsertionEffect && fiber.markHost(INSERTION_EFFECT_HOST_MASK);\r\n    isLayoutEffect && fiber.markHost(LAYOUT_EFFECT_HOST_MASK);\r\n    isAsyncEffect && fiber.markHost(ASYNC_EFFECT_HOST_MASK);\r\n\r\n    useMemo(() => {\r\n      const runEffect = () => (scope.cleanup = effect());\r\n\r\n      isInsertionEffect && $scope.addInsertionEffect(runEffect);\r\n      isLayoutEffect && $scope.addLayoutEffect(runEffect);\r\n      isAsyncEffect && $scope.addAsyncEffect(runEffect);\r\n\r\n      detectIsFunction(scope.cleanup) && scope.cleanup();\r\n\r\n      return null;\r\n    }, deps);\r\n  }\r\n\r\n  function dropEffects(hook: Hook<HookValue<UseEffectValue>>) {\r\n    for (const { value: effect } of hook.values) {\r\n      effect && effect.token === token && detectIsFunction(effect.cleanup) && effect.cleanup();\r\n    }\r\n  }\r\n\r\n  return {\r\n    useEffect,\r\n    dropEffects,\r\n  };\r\n}\r\n\r\nexport type DropEffect = void | (() => void);\r\n\r\nexport type Effect = () => DropEffect;\r\n\r\nexport enum EffectType {\r\n  ASYNC = 'ASYNC',\r\n  LAYOUT = 'LAYOUT',\r\n  INSERTION = 'INSERTION',\r\n}\r\n\r\nconst { useEffect, dropEffects } = createEffect($$useEffect, EffectType.ASYNC);\r\n\r\nexport { useEffect, dropEffects, createEffect };\r\n","import { createEffect, EffectType } from '../use-effect';\r\n\r\nconst $$useLayoutEffect = Symbol('use-layout-effect');\r\nconst { useEffect: useLayoutEffect, dropEffects: dropLayoutEffects } = createEffect(\r\n  $$useLayoutEffect,\r\n  EffectType.LAYOUT,\r\n);\r\n\r\nexport { useLayoutEffect, dropLayoutEffects };\r\n","import { createEffect, EffectType } from '../use-effect';\r\n\r\nconst $$useInsertionEffect = Symbol('use-insertion-effect');\r\nconst { useEffect: useInsertionEffect, dropEffects: dropInsertionEffects } = createEffect(\r\n  $$useInsertionEffect,\r\n  EffectType.INSERTION,\r\n);\r\n\r\nexport { useInsertionEffect, dropInsertionEffects };\r\n","import { type Fiber } from '../fiber';\r\nimport { platform } from '../platform';\r\nimport { dropEffects } from '../use-effect';\r\nimport { dropLayoutEffects } from '../use-layout-effect';\r\nimport { dropInsertionEffects } from '../use-insertion-effect';\r\nimport { walk } from '../walk';\r\nimport { detectIsUndefined } from '../utils';\r\nimport { removeScope, $$scope } from '../scope';\r\nimport {\r\n  INSERTION_EFFECT_HOST_MASK,\r\n  LAYOUT_EFFECT_HOST_MASK,\r\n  ASYNC_EFFECT_HOST_MASK,\r\n  ATOM_HOST_MASK,\r\n  PORTAL_HOST_MASK,\r\n} from '../constants';\r\n\r\nconst combinedMask =\r\n  INSERTION_EFFECT_HOST_MASK | LAYOUT_EFFECT_HOST_MASK | ASYNC_EFFECT_HOST_MASK | ATOM_HOST_MASK | PORTAL_HOST_MASK;\r\n\r\nconst shouldUnmountFiber = (fiber: Fiber) => fiber.mask & combinedMask;\r\n\r\nfunction unmountFiber(fiber: Fiber) {\r\n  if (!shouldUnmountFiber(fiber)) return;\r\n  walk(fiber, (fiber, skip) => {\r\n    if (!shouldUnmountFiber(fiber)) return skip();\r\n\r\n    if (fiber.hook && fiber.hook.values.length > 0) {\r\n      fiber.mask & INSERTION_EFFECT_HOST_MASK && dropInsertionEffects(fiber.hook);\r\n      fiber.mask & LAYOUT_EFFECT_HOST_MASK && dropLayoutEffects(fiber.hook);\r\n      fiber.mask & ASYNC_EFFECT_HOST_MASK && dropEffects(fiber.hook);\r\n    }\r\n\r\n    if (fiber.atoms) {\r\n      for (const [_, cleanup] of fiber.atoms) {\r\n        cleanup();\r\n      }\r\n      fiber.atoms = null;\r\n    }\r\n\r\n    fiber.mask & PORTAL_HOST_MASK && platform.unmountPortal(fiber);\r\n  });\r\n}\r\n\r\nfunction unmountRoot(rootId: number, onCompleted: () => void) {\r\n  if (detectIsUndefined(rootId)) return;\r\n  const $scope = $$scope(rootId);\r\n\r\n  unmountFiber($scope.getRoot());\r\n  $scope.unsubscribeEvents();\r\n  removeScope(rootId);\r\n  onCompleted();\r\n}\r\n\r\nexport { unmountFiber, unmountRoot };\r\n","import { platform } from '../platform';\r\nimport {\r\n  CREATE_EFFECT_TAG,\r\n  UPDATE_EFFECT_TAG,\r\n  DELETE_EFFECT_TAG,\r\n  SKIP_EFFECT_TAG,\r\n  INSERTION_EFFECT_HOST_MASK,\r\n  LAYOUT_EFFECT_HOST_MASK,\r\n  ASYNC_EFFECT_HOST_MASK,\r\n  ATOM_HOST_MASK,\r\n  PORTAL_HOST_MASK,\r\n  MOVE_MASK,\r\n  FLUSH_MASK,\r\n  SHADOW_MASK,\r\n  Flag,\r\n} from '../constants';\r\nimport {\r\n  flatten,\r\n  error,\r\n  detectIsEmpty,\r\n  detectIsFalsy,\r\n  detectIsArray,\r\n  detectIsFunction,\r\n  detectIsTextBased,\r\n  createIndexKey,\r\n  trueFn,\r\n} from '../utils';\r\nimport { type Scope, setRootId, $$scope, replaceScope } from '../scope';\r\nimport { type Component, detectIsComponent } from '../component';\r\nimport { type ElementKey, type Instance } from '../shared';\r\nimport { Fiber, getHook, Hook } from '../fiber';\r\nimport {\r\n  Text,\r\n  detectIsVirtualNode,\r\n  detectIsVirtualNodeFactory,\r\n  getElementKey,\r\n  hasElementFlag,\r\n  hasChildrenProp,\r\n  detectIsReplacer,\r\n  createReplacer,\r\n  detectAreSameInstanceTypes,\r\n} from '../view';\r\nimport { detectIsMemo } from '../memo';\r\nimport {\r\n  walk,\r\n  getFiberWithElement,\r\n  detectIsFiberAlive,\r\n  notifyParents,\r\n  tryOptStaticSlot,\r\n  tryOptMemoSlot,\r\n} from '../walk';\r\nimport { type RestoreOptions, scheduler } from '../scheduler';\r\nimport { Fragment, detectIsFragment } from '../fragment';\r\nimport { unmountFiber } from '../unmount';\r\n\r\nlet hasPendingPromise = false;\r\nlet hasRenderError = false;\r\n\r\nexport type WorkLoop = (isAsync: boolean) => boolean;\r\n\r\nfunction workLoop(isAsync: boolean): boolean | null {\r\n  if (hasPendingPromise) return null;\r\n  if (hasRenderError) return false;\r\n  const $scope = $$scope();\r\n  const wipFiber = $scope.getWorkInProgress();\r\n  let unit = $scope.getNextUnitOfWork();\r\n  let shouldYield = false;\r\n  let hasMoreWork = Boolean(unit);\r\n\r\n  try {\r\n    while (unit && !shouldYield) {\r\n      unit = performUnitOfWork(unit, $scope);\r\n      $scope.setNextUnitOfWork(unit);\r\n      hasMoreWork = Boolean(unit);\r\n      shouldYield = isAsync && scheduler.shouldYield();\r\n      if (shouldYield && scheduler.hasPrimaryTask()) return fork($scope);\r\n    }\r\n\r\n    if (!unit && wipFiber) {\r\n      commit($scope);\r\n    }\r\n  } catch (err) {\r\n    if (err instanceof Promise) {\r\n      hasPendingPromise = true;\r\n      err.finally(() => {\r\n        hasPendingPromise = false;\r\n        !isAsync && workLoop(false);\r\n      });\r\n    } else {\r\n      hasRenderError = true;\r\n      throw err;\r\n    }\r\n  }\r\n\r\n  return hasMoreWork;\r\n}\r\n\r\nfunction performUnitOfWork(fiber: Fiber, $scope: Scope): Fiber | null {\r\n  const wipFiber = $scope.getWorkInProgress();\r\n  const isDeepWalking = $scope.getMountDeep();\r\n  const isStream = $scope.getIsStreamZone();\r\n  const hasChildren = isDeepWalking && hasChildrenProp(fiber.inst) && fiber.inst.children.length > 0;\r\n\r\n  fiber.hook && (fiber.hook.idx = 0);\r\n\r\n  if (hasChildren) {\r\n    const child = mountChild(fiber, $scope);\r\n\r\n    isStream && platform.chunk(child);\r\n\r\n    return child;\r\n  } else {\r\n    while (fiber.parent && fiber !== wipFiber) {\r\n      const next = mountSibling(fiber, $scope);\r\n\r\n      isStream && platform.chunk(fiber);\r\n\r\n      if (next) {\r\n        isStream && platform.chunk(next);\r\n        return next;\r\n      }\r\n\r\n      fiber = fiber.parent;\r\n    }\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\nfunction mountChild(parent: Fiber, $scope: Scope) {\r\n  $scope.navToChild();\r\n  const $inst = parent.inst;\r\n  const idx = 0;\r\n  const inst = hasChildrenProp($inst) ? $inst.children[idx] : null;\r\n  const alt = getAlternate(parent, inst, true, $scope);\r\n  const fiber = createFiber(alt, inst, idx);\r\n\r\n  fiber.parent = parent;\r\n  parent.child = fiber;\r\n  fiber.eidx = parent.element ? 0 : parent.eidx;\r\n\r\n  share(fiber, parent, inst, $scope);\r\n\r\n  return fiber;\r\n}\r\n\r\nfunction mountSibling(left: Fiber, $scope: Scope) {\r\n  $scope.navToSibling();\r\n  const $inst = left.parent.inst;\r\n  const idx = $scope.getMountIndex();\r\n  const inst = hasChildrenProp($inst) && $inst.children ? $inst.children[idx] : null;\r\n  const hasSibling = Boolean(inst);\r\n\r\n  if (!hasSibling) {\r\n    $scope.navToParent();\r\n    $scope.setMountDeep(false);\r\n\r\n    return null;\r\n  }\r\n\r\n  $scope.setMountDeep(true);\r\n  const alt = getAlternate(left, inst, false, $scope);\r\n  const fiber = createFiber(alt, inst, idx);\r\n\r\n  fiber.parent = left.parent;\r\n  left.next = fiber;\r\n  fiber.eidx = left.eidx + (left.element ? 1 : left.cec);\r\n\r\n  share(fiber, left, inst, $scope);\r\n\r\n  return fiber;\r\n}\r\n\r\nfunction share(fiber: Fiber, prev: Fiber, inst: Instance, $scope: Scope) {\r\n  const { alt } = fiber;\r\n  const shouldMount = alt && detectIsMemo(inst) ? shouldUpdate(fiber, inst, $scope) : true;\r\n\r\n  $scope.setCursorFiber(fiber);\r\n  fiber.inst = inst;\r\n\r\n  if (alt && alt.mask & MOVE_MASK) {\r\n    fiber.mask |= MOVE_MASK;\r\n    alt.mask &= ~MOVE_MASK;\r\n  }\r\n\r\n  fiber.hook && (fiber.hook.owner = fiber); // !\r\n\r\n  if (shouldMount) {\r\n    fiber.inst = mount(fiber, prev, $scope);\r\n    alt && reconcile(fiber, alt, $scope);\r\n    setup(fiber, alt);\r\n  } else if (fiber.mask & MOVE_MASK) {\r\n    fiber.tag = UPDATE_EFFECT_TAG;\r\n  }\r\n\r\n  $scope.addCandidate(fiber); // !\r\n}\r\n\r\nfunction createFiber(alt: Fiber, inst: Instance, idx: number) {\r\n  const fiber = new Fiber(getHook(alt, alt ? alt.inst : null, inst), alt ? alt.provider : null, idx);\r\n\r\n  fiber.alt = alt || null;\r\n\r\n  return fiber;\r\n}\r\n\r\nfunction getAlternate(fiber: Fiber, inst: Instance, fromChild: boolean, $scope: Scope) {\r\n  const key = getElementKey(inst);\r\n\r\n  if (key !== null) {\r\n    const parentId = fromChild ? fiber.id : fiber.parent.id;\r\n    const actions = $scope.getActionsById(parentId);\r\n\r\n    if (actions) {\r\n      const isMove = actions.move && Boolean(actions.move[key]);\r\n      const isStable = actions.stable && Boolean(actions.stable[key]);\r\n\r\n      if (isMove || isStable) {\r\n        const alt = actions.map[key];\r\n\r\n        isMove && (alt.mask |= MOVE_MASK);\r\n\r\n        return alt;\r\n      }\r\n\r\n      return null;\r\n    }\r\n  }\r\n\r\n  const alt = fiber.alt ? (fromChild ? fiber.alt.child || null : fiber.alt.next || null) : null;\r\n\r\n  return alt;\r\n}\r\n\r\nfunction reconcile(fiber: Fiber, alt: Fiber, $scope: Scope) {\r\n  const { id, inst } = fiber;\r\n  const areSameTypes = detectAreSameInstanceTypes(alt.inst, inst);\r\n\r\n  if (!areSameTypes) {\r\n    $scope.addDeletion(alt);\r\n  } else if (hasChildrenProp(alt.inst) && hasChildrenProp(inst) && alt.cc !== 0) {\r\n    const hasSameCount = alt.cc === inst.children.length;\r\n    const check = hasElementFlag(inst, Flag.SKIP_SCAN_OPT) ? !hasSameCount : true;\r\n\r\n    if (check) {\r\n      const { prevKeys, nextKeys, prevKeysMap, nextKeysMap, keyedFibersMap } = extractKeys(alt.child, inst.children);\r\n      const flush = nextKeys.length === 0;\r\n      let size = Math.max(prevKeys.length, nextKeys.length);\r\n      let p = 0;\r\n      let n = 0;\r\n\r\n      $scope.addActionMap(id, keyedFibersMap);\r\n\r\n      for (let i = 0; i < size; i++) {\r\n        const nextKey = nextKeys[i - n] ?? null;\r\n        const prevKey = prevKeys[i - p] ?? null;\r\n        const prevKeyFiber = keyedFibersMap[prevKey] || null;\r\n\r\n        if (nextKey !== prevKey) {\r\n          if (nextKey !== null && !prevKeysMap[nextKey]) {\r\n            if (prevKey !== null && !nextKeysMap[prevKey]) {\r\n              $scope.addReplaceAction(id, nextKey);\r\n              $scope.addDeletion(prevKeyFiber);\r\n            } else {\r\n              $scope.addInsertAction(id, nextKey);\r\n              p++;\r\n              size++;\r\n            }\r\n          } else if (!nextKeysMap[prevKey]) {\r\n            $scope.addRemoveAction(id, prevKey);\r\n            $scope.addDeletion(prevKeyFiber);\r\n            flush && (prevKeyFiber.mask |= FLUSH_MASK);\r\n            n++;\r\n            size++;\r\n          } else if (nextKeysMap[prevKey] && nextKeysMap[nextKey]) {\r\n            $scope.addMoveAction(id, nextKey);\r\n          }\r\n        } else if (nextKey !== null) {\r\n          $scope.addStableAction(id, nextKey);\r\n        }\r\n      }\r\n\r\n      hasElementFlag(inst, Flag.STATIC_SLOT_OPT) && tryOptStaticSlot(fiber, alt, $scope);\r\n      hasElementFlag(inst, Flag.MEMO_SLOT_OPT) && tryOptMemoSlot(fiber, alt, $scope);\r\n    }\r\n  }\r\n}\r\n\r\nfunction setup(fiber: Fiber, alt: Fiber) {\r\n  const inst = fiber.inst;\r\n  let isUpdate = false;\r\n\r\n  fiber.parent.tag === CREATE_EFFECT_TAG && (fiber.tag = fiber.parent.tag);\r\n  fiber.parent.mask & SHADOW_MASK && !fiber.parent.element && !detectIsReplacer(inst) && (fiber.mask |= SHADOW_MASK);\r\n  isUpdate =\r\n    alt &&\r\n    fiber.tag !== CREATE_EFFECT_TAG &&\r\n    detectAreSameInstanceTypes(alt.inst, inst) &&\r\n    getElementKey(alt.inst) === getElementKey(inst);\r\n  isUpdate && !fiber.element && alt.element && (fiber.element = alt.element);\r\n  fiber.tag = isUpdate ? UPDATE_EFFECT_TAG : CREATE_EFFECT_TAG;\r\n  hasChildrenProp(fiber.inst) && (fiber.cc = fiber.inst.children.length);\r\n  !fiber.element && detectIsVirtualNode(fiber.inst) && (fiber.element = platform.createElement(fiber.inst));\r\n  fiber.element && fiber.increment();\r\n}\r\n\r\nfunction shouldUpdate(fiber: Fiber, inst: Instance, $scope: Scope) {\r\n  if (process.env.NODE_ENV !== 'production') {\r\n    if ($scope.getIsHot()) return true;\r\n  }\r\n\r\n  const alt = fiber.alt;\r\n  const pc = alt.inst as Component;\r\n  const nc = inst as Component;\r\n\r\n  if (nc.type !== pc.type || nc.shouldUpdate(pc.props, nc.props)) return true;\r\n\r\n  $scope.setMountDeep(false);\r\n  fiber.tag = SKIP_EFFECT_TAG;\r\n  fiber.child = alt.child;\r\n  fiber.child.parent = fiber;\r\n  fiber.hook = alt.hook;\r\n  fiber.cc = alt.cc;\r\n  fiber.cec = alt.cec;\r\n  alt.element && (fiber.element = alt.element);\r\n  alt.provider && (fiber.provider = alt.provider);\r\n  alt.catch && (fiber.catch = alt.catch);\r\n  alt.atoms && (fiber.atoms = alt.atoms);\r\n\r\n  const diff = fiber.eidx - alt.eidx;\r\n  const deep = diff !== 0;\r\n\r\n  if (deep) {\r\n    walk(fiber.child, ($fiber, skip) => {\r\n      $fiber.eidx += diff;\r\n      if ($fiber.element) return skip();\r\n    });\r\n  }\r\n\r\n  notifyParents(fiber, alt);\r\n\r\n  return false;\r\n}\r\n\r\nfunction mount(fiber: Fiber, prev: Fiber, $scope: Scope) {\r\n  let inst = fiber.inst;\r\n  const isComponent = detectIsComponent(inst);\r\n  const component = inst as Component;\r\n\r\n  if (isComponent) {\r\n    try {\r\n      const id = $scope.getResourceId();\r\n      let result = component.type(component.props, component.ref);\r\n      const defers = $scope.getDefers();\r\n\r\n      if (defers.length > 0) {\r\n        const promise = Promise.all(defers.map(x => x()));\r\n\r\n        $scope.setResourceId(id);\r\n        $scope.resetDefers();\r\n        $scope.navToPrev();\r\n        $scope.setNextUnitOfWork(prev);\r\n        Fiber.setNextId(prev.id);\r\n\r\n        throw promise;\r\n      }\r\n\r\n      if (detectIsArray(result)) {\r\n        !detectIsFragment(component) && (result = Fragment({ slot: result }));\r\n      } else if (detectIsTextBased(result)) {\r\n        result = Text(result);\r\n      }\r\n\r\n      component.children = result as Array<Instance>;\r\n      platform.detectIsPortal(inst) && fiber.markHost(PORTAL_HOST_MASK);\r\n    } catch (err) {\r\n      if (err instanceof Promise) throw err;\r\n      component.children = [];\r\n      fiber.setError(err);\r\n      error(err);\r\n    }\r\n  } else if (detectIsVirtualNodeFactory(inst)) {\r\n    inst = inst();\r\n  }\r\n\r\n  if (hasChildrenProp(inst)) {\r\n    inst.children = flatten(inst.children, x => (detectIsTextBased(x) ? Text(x) : x || supportConditional(x)));\r\n    isComponent && component.children.length === 0 && component.children.push(createReplacer());\r\n  }\r\n\r\n  return inst;\r\n}\r\n\r\nfunction extractKeys(alt: Fiber, children: Array<Instance>) {\r\n  let nextFiber = alt;\r\n  let idx = 0;\r\n  const prevKeys: Array<ElementKey> = [];\r\n  const nextKeys: Array<ElementKey> = [];\r\n  const prevKeysMap: Record<ElementKey, boolean> = {};\r\n  const nextKeysMap: Record<ElementKey, boolean> = {};\r\n  const keyedFibersMap: Record<ElementKey, Fiber> = {};\r\n  const usedKeysMap: Record<ElementKey, boolean> = {};\r\n\r\n  while (nextFiber || idx < children.length) {\r\n    if (nextFiber) {\r\n      const key = getElementKey(nextFiber.inst);\r\n      const prevKey = detectIsEmpty(key) ? createIndexKey(idx) : key;\r\n\r\n      if (!prevKeysMap[prevKey]) {\r\n        prevKeysMap[prevKey] = true; // !\r\n        prevKeys.push(prevKey);\r\n      }\r\n\r\n      keyedFibersMap[prevKey] = nextFiber;\r\n    }\r\n\r\n    if (children[idx]) {\r\n      const inst = children[idx];\r\n      const key = getElementKey(inst);\r\n      const nextKey = detectIsEmpty(key) ? createIndexKey(idx) : key;\r\n\r\n      if (process.env.NODE_ENV !== 'production') {\r\n        if (usedKeysMap[nextKey]) {\r\n          error(`[Dark]: The key of node [${nextKey}] already has been used!`, [inst]);\r\n        }\r\n      }\r\n\r\n      if (!nextKeysMap[nextKey]) {\r\n        nextKeysMap[nextKey] = true; // !\r\n        nextKeys.push(nextKey);\r\n      }\r\n\r\n      usedKeysMap[nextKey] = true;\r\n    }\r\n\r\n    nextFiber = nextFiber ? nextFiber.next : null;\r\n    idx++;\r\n  }\r\n\r\n  return {\r\n    prevKeys,\r\n    nextKeys,\r\n    prevKeysMap,\r\n    nextKeysMap,\r\n    keyedFibersMap,\r\n  };\r\n}\r\n\r\nfunction supportConditional(inst: Instance) {\r\n  return detectIsFalsy(inst) ? createReplacer() : inst;\r\n}\r\n\r\nfunction commit($scope: Scope) {\r\n  if (process.env.NODE_ENV !== 'production') {\r\n    process.env.NODE_ENV === 'development' && $scope.setIsHot(false);\r\n  }\r\n\r\n  const wipFiber = $scope.getWorkInProgress();\r\n  const deletions = $scope.getDeletions();\r\n  const candidates = $scope.getCandidates();\r\n  const isUpdateZone = $scope.getIsUpdateZone();\r\n  const unmounts: Array<Fiber> = [];\r\n  const combinedMask = INSERTION_EFFECT_HOST_MASK | LAYOUT_EFFECT_HOST_MASK | ASYNC_EFFECT_HOST_MASK | PORTAL_HOST_MASK;\r\n\r\n  // !\r\n  for (const fiber of deletions) {\r\n    const withNextTick = fiber.mask & ATOM_HOST_MASK && !(fiber.mask & combinedMask);\r\n\r\n    withNextTick ? unmounts.push(fiber) : unmountFiber(fiber);\r\n    fiber.tag = DELETE_EFFECT_TAG;\r\n    platform.commit(fiber);\r\n  }\r\n\r\n  isUpdateZone && sync(wipFiber);\r\n  $scope.runInsertionEffects();\r\n\r\n  for (const fiber of candidates) {\r\n    fiber.tag !== SKIP_EFFECT_TAG && platform.commit(fiber);\r\n    fiber.alt = null;\r\n    hasChildrenProp(fiber.inst) && (fiber.inst.children = null);\r\n  }\r\n\r\n  wipFiber.alt = null;\r\n  platform.finishCommit(); // !\r\n  $scope.runLayoutEffects();\r\n  $scope.runAsyncEffects();\r\n  unmounts.length > 0 && setTimeout(() => unmounts.forEach(x => unmountFiber(x)));\r\n  flush($scope);\r\n}\r\n\r\nfunction flush($scope: Scope, cancel = false) {\r\n  $scope.flush();\r\n  !cancel && $scope.getEmitter().emit('finish');\r\n  $scope.runAfterCommit(); // !\r\n}\r\n\r\nfunction sync(fiber: Fiber) {\r\n  const diff = fiber.cec - fiber.alt.cec;\r\n  if (diff === 0) return;\r\n  const parentFiber = getFiberWithElement(fiber.parent);\r\n  let isRight = false;\r\n\r\n  fiber.increment(diff, true);\r\n\r\n  walk(parentFiber.child, ($fiber, skip) => {\r\n    if ($fiber === fiber) {\r\n      isRight = true;\r\n      return skip();\r\n    }\r\n\r\n    $fiber.element && skip();\r\n    isRight && ($fiber.eidx += diff);\r\n  });\r\n}\r\n\r\nfunction fork($scope: Scope): false {\r\n  const $$scope$ = $scope.copy();\r\n  const wipFiber = $scope.getWorkInProgress();\r\n  const child = wipFiber.child;\r\n  child && (child.parent = null);\r\n  const restore = (options: RestoreOptions) => {\r\n    const { fiber: wipFiber, setValue, resetValue } = options;\r\n    const $scope = $$scope();\r\n\r\n    detectIsFunction(setValue) && setValue();\r\n    detectIsFunction(resetValue) && $$scope$.addCancel(resetValue);\r\n\r\n    wipFiber.alt = new Fiber().mutate(wipFiber);\r\n    wipFiber.tag = UPDATE_EFFECT_TAG;\r\n    wipFiber.child = child;\r\n    child && (child.parent = wipFiber);\r\n\r\n    if (process.env.NODE_ENV !== 'production') {\r\n      wipFiber.marker = '✌️';\r\n    }\r\n\r\n    $$scope$.setRoot($scope.getRoot());\r\n    $$scope$.setWorkInProgress(wipFiber);\r\n    replaceScope($$scope$);\r\n  };\r\n\r\n  wipFiber.child = wipFiber.alt.child;\r\n  wipFiber.alt = null;\r\n  $scope.applyCancels();\r\n  flush($scope, true);\r\n  scheduler.cancelTask(restore);\r\n\r\n  return false;\r\n}\r\n\r\nexport type CreateUpdateOptions = {\r\n  rootId: number;\r\n  isTransition?: boolean;\r\n  hook: Hook;\r\n  createChanger?: () => UpdateChanger;\r\n};\r\n\r\nexport type UpdateChanger = {\r\n  shouldUpdate: () => boolean;\r\n} & Pick<RestoreOptions, 'setValue' | 'resetValue'>;\r\n\r\nfunction createUpdate(options: CreateUpdateOptions) {\r\n  const { rootId, hook, isTransition, createChanger = $createChanger } = options;\r\n  const callback = (restore?: (options: RestoreOptions) => void) => {\r\n    setRootId(rootId); // !\r\n    const fromRestore = detectIsFunction(restore);\r\n    const { shouldUpdate, setValue, resetValue } = createChanger();\r\n    const $scope = $$scope();\r\n    const owner = hook.owner;\r\n    const fiber = owner.alt || owner;\r\n\r\n    if (!shouldUpdate() || !detectIsFiberAlive(fiber) || fromRestore) {\r\n      fromRestore && restore({ fiber, setValue, resetValue });\r\n      return;\r\n    }\r\n\r\n    detectIsFunction(setValue) && setValue();\r\n    detectIsFunction(resetValue) && isTransition && $scope.addCancel(resetValue);\r\n\r\n    fiber.alt = new Fiber().mutate(fiber);\r\n    fiber.tag = UPDATE_EFFECT_TAG;\r\n    fiber.cc = 0;\r\n    fiber.cec = 0;\r\n    fiber.child = null;\r\n\r\n    if (process.env.NODE_ENV !== 'production') {\r\n      fiber.marker = '🔥';\r\n    }\r\n\r\n    $scope.setIsUpdateZone(true);\r\n    $scope.resetMount();\r\n    $scope.setWorkInProgress(fiber);\r\n    $scope.setCursorFiber(fiber);\r\n    fiber.inst = mount(fiber, null, $scope);\r\n    $scope.setNextUnitOfWork(fiber);\r\n  };\r\n\r\n  return callback;\r\n}\r\n\r\nconst $createChanger = (): UpdateChanger => ({\r\n  shouldUpdate: trueFn,\r\n  setValue: null,\r\n  resetValue: null,\r\n});\r\n\r\nconst detectIsBusy = () => Boolean($$scope()?.getWorkInProgress());\r\n\r\nexport { Fiber, workLoop, createUpdate, detectIsBusy };\r\n","import { type WorkLoop, workLoop, detectIsBusy } from '../workloop';\r\nimport { type SetPendingStatus } from '../start-transition';\r\nimport { type Callback } from '../shared';\r\nimport { type Fiber } from '../fiber';\r\nimport { ROOT, HOOK_DELIMETER, YIELD_INTERVAL, TaskPriority } from '../constants';\r\nimport { getTime, detectIsFunction, nextTick } from '../utils';\r\nimport { EventEmitter } from '../emitter';\r\nimport { platform } from '../platform';\r\n\r\nclass MessageChannel extends EventEmitter<PortEvent> {\r\n  port1: MessagePort = null;\r\n  port2: MessagePort = null;\r\n\r\n  constructor() {\r\n    super();\r\n    this.port1 = new MessagePort(this);\r\n    this.port2 = new MessagePort(this);\r\n  }\r\n}\r\n\r\nclass MessagePort {\r\n  channel: MessageChannel;\r\n  offs: Array<Callback> = [];\r\n\r\n  constructor(channel: MessageChannel) {\r\n    this.channel = channel;\r\n  }\r\n\r\n  on(event: PortEvent, callback: PortListener) {\r\n    const off = this.channel.on(event, callback);\r\n\r\n    this.offs.push(off);\r\n  }\r\n\r\n  postMessage(value: unknown) {\r\n    platform.spawn(() => {\r\n      this.channel.emit('message', value);\r\n    });\r\n  }\r\n\r\n  unref() {\r\n    this.offs.forEach(x => x());\r\n  }\r\n}\r\n\r\nclass Scheduler {\r\n  private queue: Record<TaskPriority, Array<Task>> = {\r\n    [TaskPriority.HIGH]: [],\r\n    [TaskPriority.NORMAL]: [],\r\n    [TaskPriority.LOW]: [],\r\n  };\r\n  private deadline = 0;\r\n  private task: Task = null;\r\n  private scheduledCallback: WorkLoop = null;\r\n  private isMessageLoopRunning = false;\r\n  private channel: MessageChannel = null;\r\n  private port: MessagePort = null;\r\n\r\n  constructor() {\r\n    this.channel = new MessageChannel();\r\n    this.port = this.channel.port2;\r\n    this.channel.port1.on('message', this.performWorkUntilDeadline.bind(this));\r\n  }\r\n\r\n  reset() {\r\n    this.deadline = 0;\r\n    this.task = null;\r\n    this.scheduledCallback = null;\r\n    this.isMessageLoopRunning = false;\r\n  }\r\n\r\n  shouldYield() {\r\n    return getTime() >= this.deadline;\r\n  }\r\n\r\n  schedule(callback: Callback, options?: ScheduleCallbackOptions) {\r\n    const {\r\n      priority = TaskPriority.NORMAL,\r\n      forceAsync = false,\r\n      isTransition = false,\r\n      createLocation,\r\n      setPendingStatus,\r\n    } = options || {};\r\n    const task = new Task(callback, priority, forceAsync);\r\n\r\n    task.setIsTransition(isTransition);\r\n    task.setPendingSetter(setPendingStatus);\r\n    task.setLocationCreator(createLocation || createRootLocation);\r\n    this.put(task);\r\n    this.execute();\r\n  }\r\n\r\n  hasPrimaryTask() {\r\n    if (!this.task.getIsTransition()) return false;\r\n    const { high, normal, low } = this.getQueues();\r\n    const hasPrimary = high.length > 0 || normal.length > 0;\r\n    const hasLow = low.length > 0;\r\n\r\n    if (hasPrimary || hasLow) {\r\n      const loc = this.task.createLocation();\r\n\r\n      if (hasPrimary) {\r\n        const has = Task.detectHasRelatedUpdate(loc, high, true) || Task.detectHasRelatedUpdate(loc, normal, true);\r\n\r\n        if (has) {\r\n          this.task.markAsUnnecessary();\r\n        }\r\n\r\n        return true;\r\n      }\r\n\r\n      if (hasLow) {\r\n        const has = Task.detectHasRelatedUpdate(loc, low);\r\n\r\n        if (has) {\r\n          this.task.markAsUnnecessary();\r\n\r\n          return true;\r\n        }\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  cancelTask(fn: TaskRestorer) {\r\n    if (this.task.getIsUnnecessary()) return this.complete(this.task);\r\n    this.task.setTaskRestorer(fn);\r\n    this.defer(this.task);\r\n  }\r\n\r\n  private complete(task: Task) {\r\n    task.pending(false);\r\n  }\r\n\r\n  private put(task: Task) {\r\n    const queue = this.queue[task.getPriority()];\r\n\r\n    if (task.getIsTransition()) {\r\n      const loc = task.createLocation();\r\n      const tasks = queue.filter(x => x.createLocation() !== loc);\r\n\r\n      queue.splice(0, queue.length, ...tasks);\r\n    }\r\n\r\n    queue.push(task);\r\n  }\r\n\r\n  private pick(queue: Array<Task>) {\r\n    if (queue.length === 0) return false;\r\n    this.task = queue.shift();\r\n\r\n    if (this.task.getIsTransition() && this.task.canPending()) {\r\n      const task = this.task;\r\n\r\n      task.markAsPending();\r\n      this.defer(this.task);\r\n      this.task = null;\r\n\r\n      nextTick(() => task.pending(true));\r\n\r\n      return true;\r\n    }\r\n\r\n    this.task.run();\r\n    this.task.getForceAsync() ? this.requestCallbackAsync(workLoop) : this.requestCallback(workLoop);\r\n\r\n    return true;\r\n  }\r\n\r\n  private execute() {\r\n    const isBusy = detectIsBusy();\r\n    const { high, normal, low } = this.getQueues();\r\n\r\n    if (!isBusy && !this.isMessageLoopRunning) {\r\n      this.pick(high) || this.pick(normal) || this.pick(low);\r\n    }\r\n  }\r\n\r\n  private requestCallbackAsync(callback: WorkLoop) {\r\n    this.scheduledCallback = callback;\r\n\r\n    if (!this.isMessageLoopRunning) {\r\n      this.isMessageLoopRunning = true;\r\n      this.port.postMessage(null);\r\n    }\r\n  }\r\n\r\n  private requestCallback(callback: WorkLoop) {\r\n    callback(false);\r\n    this.task = null;\r\n    this.execute();\r\n  }\r\n\r\n  private performWorkUntilDeadline() {\r\n    if (this.scheduledCallback) {\r\n      this.deadline = getTime() + YIELD_INTERVAL;\r\n      const hasMoreWork = this.scheduledCallback(true);\r\n\r\n      if (hasMoreWork) {\r\n        this.port.postMessage(null);\r\n      } else {\r\n        if (hasMoreWork === null) {\r\n          setTimeout(() => this.port.postMessage(null)); // has promise\r\n        } else {\r\n          this.complete(this.task);\r\n          this.reset();\r\n          this.execute();\r\n        }\r\n      }\r\n    } else {\r\n      this.isMessageLoopRunning = false;\r\n    }\r\n  }\r\n\r\n  private defer(task: Task) {\r\n    const { low } = this.getQueues();\r\n\r\n    low.unshift(task);\r\n  }\r\n\r\n  private getQueues() {\r\n    const high = this.queue[TaskPriority.HIGH];\r\n    const normal = this.queue[TaskPriority.NORMAL];\r\n    const low = this.queue[TaskPriority.LOW];\r\n\r\n    return {\r\n      high,\r\n      normal,\r\n      low,\r\n    };\r\n  }\r\n}\r\n\r\ntype TaskCallback = (fn: TaskRestorer) => void;\r\ntype TaskRestorer = (options: RestoreOptions) => void;\r\ntype LocationCreator = () => string;\r\n\r\nclass Task {\r\n  private id: number;\r\n  private priority: TaskPriority;\r\n  private forceAsync: boolean;\r\n  private isTransition: boolean;\r\n  private isPending: boolean;\r\n  private isUnnecessary: boolean;\r\n  private callback: TaskCallback;\r\n  private taskRestorer?: TaskRestorer = null;\r\n  private locationCreator?: LocationCreator;\r\n  private pendingSetter?: SetPendingStatus = null;\r\n  private static nextTaskId = 0;\r\n\r\n  constructor(callback: TaskCallback, priority: TaskPriority, forceAsync: boolean) {\r\n    this.id = ++Task.nextTaskId;\r\n    this.callback = callback;\r\n    this.priority = priority;\r\n    this.forceAsync = forceAsync;\r\n  }\r\n\r\n  getPriority() {\r\n    return this.priority;\r\n  }\r\n\r\n  getForceAsync() {\r\n    return this.forceAsync;\r\n  }\r\n\r\n  setIsTransition(value: boolean) {\r\n    this.isTransition = value;\r\n  }\r\n\r\n  getIsTransition() {\r\n    return this.isTransition;\r\n  }\r\n\r\n  run() {\r\n    this.callback(this.taskRestorer);\r\n    this.taskRestorer = null;\r\n  }\r\n\r\n  pending(value: boolean) {\r\n    this.isTransition && this.pendingSetter && this.pendingSetter(value);\r\n  }\r\n\r\n  markAsPending() {\r\n    this.isPending = true;\r\n  }\r\n\r\n  canPending() {\r\n    return !this.isPending && detectIsFunction(this.pendingSetter);\r\n  }\r\n\r\n  markAsUnnecessary() {\r\n    this.isUnnecessary = true;\r\n  }\r\n\r\n  getIsUnnecessary() {\r\n    return this.isUnnecessary;\r\n  }\r\n\r\n  setTaskRestorer(fn: TaskRestorer) {\r\n    this.taskRestorer = fn;\r\n  }\r\n\r\n  setLocationCreator(fn: LocationCreator) {\r\n    this.locationCreator = fn;\r\n  }\r\n\r\n  createLocation() {\r\n    return this.locationCreator();\r\n  }\r\n\r\n  setPendingSetter(fn: SetPendingStatus) {\r\n    this.pendingSetter = fn;\r\n  }\r\n\r\n  static detectHasRelatedUpdate(loc: string, tasks: Array<Task>, deep = false) {\r\n    const [$loc] = loc.split(HOOK_DELIMETER);\r\n\r\n    return tasks.some(x => {\r\n      const $$loc = x.createLocation();\r\n      const has = $$loc === loc || (deep && $$loc.length > loc.length && $$loc.indexOf($loc) !== -1);\r\n\r\n      return has;\r\n    });\r\n  }\r\n}\r\n\r\nconst createRootLocation: LocationCreator = () => ROOT;\r\n\r\ntype PortEvent = 'message';\r\ntype PortListener = (value: unknown) => void;\r\n\r\nexport type RestoreOptions = {\r\n  fiber: Fiber;\r\n  setValue?: () => void;\r\n  resetValue?: () => void;\r\n};\r\n\r\nexport type ScheduleCallbackOptions = {\r\n  priority?: TaskPriority;\r\n  forceAsync?: boolean;\r\n  isTransition?: boolean;\r\n  createLocation?: () => string;\r\n  setPendingStatus?: SetPendingStatus;\r\n  onCompleted?: () => void;\r\n};\r\n\r\nconst scheduler = new Scheduler();\r\n\r\nexport { scheduler };\r\n","import { type ScheduleCallbackOptions, scheduler } from '../scheduler';\r\nimport { type UpdateChanger, createUpdate } from '../workloop';\r\nimport { getRootId, $$scope } from '../scope';\r\nimport { TaskPriority } from '../constants';\r\nimport { addBatch } from '../batch';\r\nimport { detectIsFunction } from '../utils';\r\nimport { createHookLocation } from '../walk';\r\n\r\nexport type UpdateOptions = UpdateChanger;\r\n\r\nfunction useUpdate() {\r\n  const rootId = getRootId();\r\n  const fiber = $$scope().getCursorFiber();\r\n  const hook = fiber.hook; // !\r\n  const { idx } = hook;\r\n  const update = (createChanger?: () => UpdateChanger) => {\r\n    const $scope = $$scope();\r\n    if ($scope.getIsInsertionEffectsZone()) return;\r\n    const { owner } = hook;\r\n    const hasChanger = detectIsFunction(createChanger);\r\n    const isTransition = $scope.getIsTransitionZone();\r\n    const isBatch = $scope.getIsBatchZone();\r\n    const isEvent = $scope.getIsEventZone();\r\n    const priority = isTransition ? TaskPriority.LOW : isEvent ? TaskPriority.HIGH : TaskPriority.NORMAL; // !\r\n    const forceAsync = isTransition;\r\n    const setPendingStatus = $scope.getPendingStatusSetter();\r\n    const callback = createUpdate({\r\n      rootId,\r\n      hook,\r\n      isTransition,\r\n      createChanger: hasChanger ? createChanger : undefined,\r\n    });\r\n    const createLocation = () => createHookLocation(rootId, idx, owner);\r\n    const callbackOptions: ScheduleCallbackOptions = {\r\n      priority,\r\n      forceAsync,\r\n      isTransition,\r\n      createLocation,\r\n      setPendingStatus,\r\n    };\r\n\r\n    if (isBatch) {\r\n      addBatch(\r\n        owner,\r\n        () => scheduler.schedule(callback, callbackOptions),\r\n        () => hasChanger && createChanger().setValue(),\r\n      );\r\n    } else {\r\n      scheduler.schedule(callback, callbackOptions);\r\n    }\r\n  };\r\n\r\n  return update;\r\n}\r\n\r\nexport { useUpdate };\r\n","import { $$scope } from '../scope';\r\nimport { type Fiber } from '../fiber';\r\nimport { type Callback } from '../shared';\r\n\r\nfunction batch(callback: () => void) {\r\n  const $scope = $$scope();\r\n\r\n  $scope.setIsBatchZone(true);\r\n  callback();\r\n  $scope.setIsBatchZone(false);\r\n}\r\n\r\nfunction addBatch(fiber: Fiber, callback: Callback, change: Callback) {\r\n  const $scope = $$scope();\r\n\r\n  if ($scope.getIsTransitionZone()) {\r\n    callback();\r\n  } else {\r\n    const batch = fiber.batch || { timer: null, changes: [] };\r\n\r\n    fiber.batch = batch;\r\n    batch.changes.push(change);\r\n    batch.timer && clearTimeout(batch.timer);\r\n    batch.timer = setTimeout(() => {\r\n      batch.changes.splice(-1);\r\n      batch.changes.forEach(x => x());\r\n      fiber.batch = null;\r\n      callback();\r\n    });\r\n  }\r\n}\r\n\r\nexport { batch, addBatch };\r\n","import { detectIsString, detectIsFunction } from '../utils';\r\nimport { type TagVirtualNodeFactory, type ViewOptions, View } from '../view';\r\nimport { type ComponentFactory } from '../component';\r\n\r\nfunction createElement(\r\n  element: string | Function,\r\n  props: object,\r\n  ...slot: Array<any>\r\n): ComponentFactory | TagVirtualNodeFactory | null {\r\n  if (detectIsString(element)) {\r\n    const options = (props || {}) as ViewOptions;\r\n\r\n    options.as = element;\r\n    options.slot = slot;\r\n\r\n    return View(options);\r\n  }\r\n\r\n  if (detectIsFunction(element)) {\r\n    const options = (props || {}) as { slot: unknown };\r\n\r\n    options.slot = slot.length === 1 ? slot[0] : slot;\r\n\r\n    return element(options);\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\nexport { createElement, createElement as h };\r\n","import { detectIsObject, detectIsNull, detectIsFunction } from '../utils';\r\nimport type { Component, ComponentFactory } from '../component';\r\nimport type { RefProps, KeyProps, FlagProps } from '../shared';\r\nimport { useMemo } from '../use-memo';\r\n\r\nfunction forwardRef<P extends object, R>(\r\n  component: ComponentFactory<P, R>,\r\n): ComponentFactory<P & RefProps<R> & KeyProps & FlagProps, R> {\r\n  type Props = P & RefProps<R>;\r\n\r\n  return (props: Props) => {\r\n    const { ref, ...rest } = (props || {}) as Props;\r\n\r\n    return component(rest as P, ref) as Component<P, R>;\r\n  };\r\n}\r\n\r\nfunction detectIsMutableRef(ref: unknown): ref is MutableRef {\r\n  if (!detectIsObject(ref) || detectIsNull(ref)) return false;\r\n  const mutableRef = ref as MutableRef;\r\n\r\n  for (const key in mutableRef) {\r\n    if (key === 'current' && mutableRef.hasOwnProperty(key)) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nfunction applyRef<T>(ref: Ref<T>, current: T) {\r\n  if (detectIsFunction(ref)) {\r\n    ref(current);\r\n  } else if (detectIsMutableRef(ref)) {\r\n    ref.current = current;\r\n  }\r\n}\r\n\r\nfunction useRef<T>(initialValue: T = null): MutableRef<T> {\r\n  const ref = useMemo(() => ({ current: initialValue }), []) as MutableRef<T>;\r\n\r\n  return ref;\r\n}\r\n\r\nexport type MutableRef<T = unknown> = {\r\n  current: T;\r\n};\r\n\r\nexport type FunctionRef<T = unknown> = (ref: T) => void;\r\n\r\nexport type Ref<T = unknown> = MutableRef<T> | FunctionRef<T>;\r\n\r\nexport { forwardRef, detectIsMutableRef, applyRef, useRef };\r\n","import { type DarkElement, type Fiber, component, useMemo, $$scope, detectIsComponent } from '@dark-engine/core';\r\n\r\nimport type { TagNativeElement } from '../native-element';\r\n\r\nconst $$portal = Symbol('portal');\r\n\r\nfunction createPortal(slot: DarkElement, container: TagNativeElement) {\r\n  if (process.env.NODE_ENV !== 'production') {\r\n    if (!(container instanceof Element)) {\r\n      throw new Error(`[Dark]: createPortal receives only Element as container!`);\r\n    }\r\n  }\r\n\r\n  return Portal({ container, slot });\r\n}\r\n\r\ntype PortalProps = {\r\n  container: TagNativeElement;\r\n  slot: DarkElement;\r\n};\r\n\r\nconst Portal = component<PortalProps>(\r\n  props => {\r\n    const element = props.container;\r\n    const fiber = $$scope().getCursorFiber();\r\n\r\n    useMemo(() => (element.innerHTML = ''), []);\r\n\r\n    fiber.element = element;\r\n    props.container = null;\r\n\r\n    return props.slot;\r\n  },\r\n  { token: $$portal },\r\n);\r\n\r\nconst detectIsPortal = (instance: unknown) => detectIsComponent(instance) && instance.token === $$portal;\r\n\r\nconst getPortalContainer = (fiber: Fiber<TagNativeElement>): TagNativeElement | null =>\r\n  detectIsPortal(fiber.inst) ? fiber.element : null;\r\n\r\nfunction unmountPortal(fiber: Fiber<TagNativeElement>) {\r\n  const element = getPortalContainer(fiber);\r\n\r\n  element && (element.innerHTML = '');\r\n}\r\n\r\nexport { createPortal, unmountPortal, detectIsPortal };\r\n","import { detectIsFunction, $$scope, detectIsArray } from '@dark-engine/core';\r\n\r\nimport type { TagNativeElement } from '../native-element';\r\n\r\ntype BrowserEventConstructor = (type: string, event: Event) => void;\r\n\r\nclass SyntheticEvent<E extends Event, T = TagNativeElement> {\r\n  public type = '';\r\n  public sourceEvent: E = null;\r\n  public target: T = null;\r\n  private propagation = true;\r\n\r\n  constructor(options: Pick<SyntheticEvent<E, T>, 'sourceEvent' | 'target'>) {\r\n    this.type = options.sourceEvent.type;\r\n    this.sourceEvent = options.sourceEvent;\r\n    this.target = options.target;\r\n  }\r\n\r\n  public stopPropagation() {\r\n    this.propagation = false;\r\n    this.sourceEvent.stopPropagation();\r\n  }\r\n\r\n  public preventDefault() {\r\n    this.sourceEvent.preventDefault();\r\n  }\r\n\r\n  public getPropagation() {\r\n    return this.propagation;\r\n  }\r\n}\r\n\r\nfunction delegateEvent(\r\n  target: Element,\r\n  eventName: string,\r\n  handler: (e: Event) => void | [fn: () => void, ...args: Array<any>],\r\n) {\r\n  const $scope = $$scope();\r\n  const eventsMap = $scope.getEvents();\r\n  const handlersMap = eventsMap.get(eventName);\r\n  const $handler = detectIsArray(handler) ? (e: Event) => handler[0](...handler.slice(1), e) : handler;\r\n\r\n  if (!handlersMap) {\r\n    const rootHandler = (event: Event) => {\r\n      const handler = eventsMap.get(eventName).get(event.target);\r\n      const target = event.target as TagNativeElement;\r\n      let $event: SyntheticEvent<Event> = null;\r\n\r\n      if (detectIsFunction(handler)) {\r\n        $event = new SyntheticEvent({ sourceEvent: event, target });\r\n\r\n        $scope.setIsEventZone(true);\r\n        handler($event);\r\n        $scope.setIsEventZone(false);\r\n      }\r\n\r\n      if (target.parentElement) {\r\n        const shouldPropagate = $event ? $event.getPropagation() : true;\r\n\r\n        if (shouldPropagate) {\r\n          const constructor = event.constructor as BrowserEventConstructor;\r\n\r\n          target.parentElement.dispatchEvent(new constructor(event.type, event));\r\n        }\r\n      }\r\n    };\r\n\r\n    eventsMap.set(eventName, new WeakMap([[target, $handler]]));\r\n    document.addEventListener(eventName, rootHandler, true);\r\n    $scope.addEventUnsubscriber(() => document.removeEventListener(eventName, rootHandler, true));\r\n  } else {\r\n    handlersMap.set(target, $handler);\r\n  }\r\n}\r\n\r\nconst detectIsEvent = (attrName: string) => attrName.startsWith('on');\r\n\r\nconst getEventName = (attrName: string) => attrName.slice(2, attrName.length).toLowerCase();\r\n\r\nexport { SyntheticEvent, delegateEvent, detectIsEvent, getEventName };\r\n","export const VERSION = '0.25.1';\r\nexport const STYLE_ATTR = 'style';\r\nexport const CLASS_ATTR = 'class';\r\nexport const CLASS_NAME_ATTR = 'className';\r\nexport const EXCLUDE_ATTR_MARK = '$';\r\n","import {\r\n  type Fiber,\r\n  type VirtualNode,\r\n  type TagVirtualNode,\r\n  type TextVirtualNode,\r\n  type CommentVirtualNode,\r\n  type PlainVirtualNode,\r\n  type Callback,\r\n  REF_ATTR,\r\n  ATTR_BLACK_LIST,\r\n  CREATE_EFFECT_TAG,\r\n  UPDATE_EFFECT_TAG,\r\n  DELETE_EFFECT_TAG,\r\n  SKIP_EFFECT_TAG,\r\n  MOVE_MASK,\r\n  FLUSH_MASK,\r\n  SHADOW_MASK,\r\n  detectIsUndefined,\r\n  detectIsBoolean,\r\n  detectIsObject,\r\n  NodeType,\r\n  detectIsTagVirtualNode,\r\n  detectIsTextVirtualNode,\r\n  detectIsPlainVirtualNode,\r\n  getFiberWithElement,\r\n  collectElements,\r\n  walk,\r\n  dummyFn,\r\n  $$scope,\r\n  applyRef,\r\n} from '@dark-engine/core';\r\n\r\nimport { detectIsPortal } from '../portal';\r\nimport { delegateEvent, detectIsEvent, getEventName } from '../events';\r\nimport { STYLE_ATTR, CLASS_ATTR, CLASS_NAME_ATTR, EXCLUDE_ATTR_MARK } from '../constants';\r\nimport type {\r\n  NativeElement,\r\n  TagNativeElement,\r\n  TextNativeElement,\r\n  CommentNativeElement,\r\n  NativeNode,\r\n  AttributeValue,\r\n} from '../native-element';\r\n\r\nlet moves: Array<Callback> = [];\r\nlet patches: Array<Callback> = [];\r\nlet trackUpdate: (nativeElement: NativeElement) => void = null;\r\nconst svgTagNames = new Set([\r\n  'svg',\r\n  'animate',\r\n  'animateMotion',\r\n  'animateTransform',\r\n  'circle',\r\n  'clipPath',\r\n  'defs',\r\n  'desc',\r\n  'ellipse',\r\n  'feBlend',\r\n  'feColorMatrix',\r\n  'feComponentTransfer',\r\n  'feComposite',\r\n  'feConvolveMatrix',\r\n  'feDiffuseLighting',\r\n  'feDisplacementMap',\r\n  'feDistantLight',\r\n  'feDropShadow',\r\n  'feFlood',\r\n  'feFuncA',\r\n  'feFuncB',\r\n  'feFuncG',\r\n  'feFuncR',\r\n  'feGaussianBlur',\r\n  'feImage',\r\n  'feMerge',\r\n  'feMergeNode',\r\n  'feMorphology',\r\n  'feOffset',\r\n  'fePointLight',\r\n  'feSpecularLighting',\r\n  'feSpotLight',\r\n  'feTile',\r\n  'feTurbulence',\r\n  'filter',\r\n  'foreignObject',\r\n  'g',\r\n  'image',\r\n  'line',\r\n  'linearGradient',\r\n  'marker',\r\n  'mask',\r\n  'metadata',\r\n  'mpath',\r\n  'path',\r\n  'pattern',\r\n  'polygon',\r\n  'polyline',\r\n  'radialGradient',\r\n  'rect',\r\n  'stop',\r\n  'switch',\r\n  'symbol',\r\n  'text',\r\n  'textPath',\r\n  'tspan',\r\n  'use',\r\n  'view',\r\n]);\r\nconst voidTagNames = new Set([\r\n  'area',\r\n  'base',\r\n  'br',\r\n  'col',\r\n  'embed',\r\n  'hr',\r\n  'img',\r\n  'input',\r\n  'link',\r\n  'meta',\r\n  'param',\r\n  'source',\r\n  'track',\r\n  'wbr',\r\n]);\r\n\r\nconst createNativeElementMap = {\r\n  [NodeType.TAG]: (vNode: VirtualNode): TagNativeElement => {\r\n    const tagNode = vNode as TagVirtualNode;\r\n    const name = tagNode.name;\r\n\r\n    return detectIsSvgElement(name)\r\n      ? document.createElementNS('http://www.w3.org/2000/svg', name)\r\n      : document.createElement(name);\r\n  },\r\n  [NodeType.TEXT]: (vNode: VirtualNode): TextNativeElement => {\r\n    return document.createTextNode((vNode as TextVirtualNode).value);\r\n  },\r\n  [NodeType.COMMENT]: (vNode: VirtualNode): CommentNativeElement => {\r\n    return document.createComment((vNode as CommentVirtualNode).value);\r\n  },\r\n};\r\n\r\nfunction createNativeElement(node: VirtualNode): NativeElement {\r\n  return createNativeElementMap[node.type](node);\r\n}\r\n\r\nfunction detectIsSvgElement(name: string) {\r\n  return svgTagNames.has(name);\r\n}\r\n\r\nfunction detectIsVoidElement(name: string) {\r\n  return voidTagNames.has(name);\r\n}\r\n\r\nfunction setObjectStyle(element: TagNativeElement, style: object) {\r\n  const keys = Object.keys(style);\r\n\r\n  for (const key of keys) {\r\n    element.style.setProperty(key, String(style[key]));\r\n  }\r\n}\r\n\r\nfunction addAttributes(element: NativeElement, node: TagVirtualNode, isHydrateZone: boolean) {\r\n  const attrNames = Object.keys(node.attrs);\r\n  const tagElement = element as TagNativeElement;\r\n\r\n  for (const attrName of attrNames) {\r\n    const attrValue = node.attrs[attrName];\r\n\r\n    if (attrName[0] === EXCLUDE_ATTR_MARK) continue;\r\n\r\n    if (attrName === REF_ATTR) {\r\n      applyRef(attrValue, element);\r\n      continue;\r\n    }\r\n\r\n    if (attrName === CLASS_ATTR || attrName === CLASS_NAME_ATTR) {\r\n      toggleAttribute(tagElement, CLASS_ATTR, attrValue);\r\n      continue;\r\n    }\r\n\r\n    if (attrName === STYLE_ATTR && attrValue && detectIsObject(attrValue)) {\r\n      setObjectStyle(tagElement, attrValue);\r\n      continue;\r\n    }\r\n\r\n    if (detectIsEvent(attrName)) {\r\n      delegateEvent(tagElement, getEventName(attrName), attrValue);\r\n    } else if (!isHydrateZone && !detectIsUndefined(attrValue) && !ATTR_BLACK_LIST[attrName]) {\r\n      const stop = patchProperties({\r\n        tagName: node.name,\r\n        element: tagElement,\r\n        attrValue,\r\n        attrName,\r\n      });\r\n\r\n      !stop && tagElement.setAttribute(attrName, attrValue);\r\n    }\r\n  }\r\n}\r\n\r\nfunction updateAttributes(element: NativeElement, prevNode: TagVirtualNode, nextNode: TagVirtualNode) {\r\n  const attrNames = getAttributeNames(prevNode, nextNode);\r\n  const tagElement = element as TagNativeElement;\r\n\r\n  for (const attrName of attrNames) {\r\n    const prevAttrValue = prevNode.attrs[attrName];\r\n    const nextAttrValue = nextNode.attrs[attrName];\r\n\r\n    if (attrName[0] === EXCLUDE_ATTR_MARK) continue;\r\n\r\n    if (attrName === REF_ATTR) {\r\n      applyRef(prevAttrValue, element);\r\n      continue;\r\n    }\r\n\r\n    if ((attrName === CLASS_ATTR || attrName === CLASS_NAME_ATTR) && prevAttrValue !== nextAttrValue) {\r\n      toggleAttribute(tagElement, CLASS_ATTR, nextAttrValue);\r\n      continue;\r\n    }\r\n\r\n    if (attrName === STYLE_ATTR && nextAttrValue && prevAttrValue !== nextAttrValue && detectIsObject(nextAttrValue)) {\r\n      setObjectStyle(tagElement, nextAttrValue);\r\n      continue;\r\n    }\r\n\r\n    if (!detectIsUndefined(nextAttrValue)) {\r\n      if (detectIsEvent(attrName)) {\r\n        prevAttrValue !== nextAttrValue && delegateEvent(tagElement, getEventName(attrName), nextAttrValue);\r\n      } else if (!ATTR_BLACK_LIST[attrName] && prevAttrValue !== nextAttrValue) {\r\n        const stop = patchProperties({\r\n          tagName: nextNode.name,\r\n          element: tagElement,\r\n          attrValue: nextAttrValue,\r\n          attrName,\r\n        });\r\n\r\n        !stop && tagElement.setAttribute(attrName, nextAttrValue);\r\n      }\r\n    } else {\r\n      tagElement.removeAttribute(attrName);\r\n    }\r\n  }\r\n}\r\n\r\nfunction toggleAttribute(element: TagNativeElement, name: string, value: string) {\r\n  value ? element.setAttribute(name, value) : element.removeAttribute(name);\r\n}\r\n\r\nfunction getAttributeNames(prevNode: TagVirtualNode, nextNode: TagVirtualNode) {\r\n  const attrNames = new Set<string>();\r\n  const prevAttrs = Object.keys(prevNode.attrs);\r\n  const nextAttrs = Object.keys(nextNode.attrs);\r\n  const size = Math.max(prevAttrs.length, nextAttrs.length);\r\n\r\n  for (let i = 0; i < size; i++) {\r\n    attrNames.add(prevAttrs[i] || nextAttrs[i]);\r\n  }\r\n\r\n  return attrNames;\r\n}\r\n\r\ntype PatchPropertiesOptions = {\r\n  tagName: string;\r\n  element: TagNativeElement;\r\n  attrName: string;\r\n  attrValue: AttributeValue;\r\n};\r\n\r\nfunction patchProperties(options: PatchPropertiesOptions): boolean {\r\n  const { tagName, element, attrName, attrValue } = options;\r\n  const fn = patchPropertiesSpecialCasesMap[tagName];\r\n  let stop = fn ? fn(element, attrName, attrValue) : false;\r\n\r\n  if (canSetProperty(element, attrName)) {\r\n    element[attrName] = attrValue;\r\n  }\r\n\r\n  if (!stop && detectIsBoolean(attrValue)) {\r\n    stop = !attrName.includes('-');\r\n  }\r\n\r\n  return stop;\r\n}\r\n\r\nfunction canSetProperty(element: TagNativeElement, key: string) {\r\n  const prototype = Object.getPrototypeOf(element);\r\n  const descriptor = Object.getOwnPropertyDescriptor(prototype, key);\r\n\r\n  return Boolean(descriptor?.set);\r\n}\r\n\r\nconst patchPropertiesSpecialCasesMap: Record<\r\n  string,\r\n  (element: NativeElement, attrName: string, attrValue: AttributeValue) => boolean\r\n> = {\r\n  input: (element: HTMLInputElement, attrName: string, attrValue: AttributeValue) => {\r\n    if (attrName === 'value') {\r\n      patches.push(() => {\r\n        detectIsBoolean(attrValue) ? (element.checked = attrValue) : (element.value = String(attrValue));\r\n      });\r\n    } else if (attrName === 'autoFocus') {\r\n      patches.push(() => {\r\n        element.autofocus = Boolean(attrValue);\r\n        element.autofocus && element.focus();\r\n      });\r\n    }\r\n\r\n    return false;\r\n  },\r\n  textarea: (element: HTMLTextAreaElement, attrName: string, attrValue: AttributeValue) => {\r\n    if (attrName === 'value') {\r\n      element.innerText = String(attrValue);\r\n\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  },\r\n};\r\n\r\nfunction commitCreation(fiber: Fiber<NativeElement>) {\r\n  const parentFiber = getFiberWithElement<NativeElement, TagNativeElement>(fiber.parent);\r\n  const parentElement = parentFiber.element;\r\n  const childNodes = parentElement.childNodes;\r\n  const isHydrateZone = $$scope().getIsHydrateZone();\r\n\r\n  if (isHydrateZone) {\r\n    const nativeElement = childNodes[fiber.eidx] as NativeElement;\r\n\r\n    if (\r\n      detectIsTextVirtualNode(fiber.inst) &&\r\n      nativeElement instanceof Text &&\r\n      fiber.inst.value.length !== nativeElement.length\r\n    ) {\r\n      nativeElement.splitText(fiber.inst.value.length);\r\n    }\r\n\r\n    fiber.element = nativeElement;\r\n  } else {\r\n    if (!(fiber.mask & SHADOW_MASK)) {\r\n      if (childNodes.length === 0 || fiber.eidx > childNodes.length - 1) {\r\n        !detectIsVoidElement((parentFiber.inst as TagVirtualNode).name) &&\r\n          appendNativeElement(fiber.element, parentElement);\r\n      } else {\r\n        insertNativeElement(fiber.element, parentElement.childNodes[fiber.eidx], parentElement);\r\n      }\r\n    }\r\n  }\r\n\r\n  detectIsTagVirtualNode(fiber.inst) && addAttributes(fiber.element, fiber.inst, isHydrateZone);\r\n}\r\n\r\nfunction commitUpdate(fiber: Fiber<NativeElement>) {\r\n  const element = fiber.element;\r\n  const prevInstance = fiber.alt.inst as VirtualNode;\r\n  const nextInstance = fiber.inst as VirtualNode;\r\n\r\n  detectIsPlainVirtualNode(nextInstance)\r\n    ? (prevInstance as PlainVirtualNode).value !== nextInstance.value && (element.textContent = nextInstance.value)\r\n    : updateAttributes(element, prevInstance as TagVirtualNode, nextInstance as TagVirtualNode);\r\n}\r\n\r\nfunction commitDeletion(fiber: Fiber<NativeElement>) {\r\n  const parentFiber = getFiberWithElement<NativeElement, TagNativeElement>(fiber.parent);\r\n\r\n  if (fiber.mask & FLUSH_MASK) {\r\n    parentFiber.element.innerHTML && (parentFiber.element.innerHTML = '');\r\n    return;\r\n  }\r\n\r\n  walk<NativeElement>(fiber, (fiber, skip) => {\r\n    if (fiber.element) {\r\n      !detectIsPortal(fiber.inst) &&\r\n        canRemoveNativeElement(fiber.element, parentFiber.element) &&\r\n        removeNativeElement(fiber.element, parentFiber.element);\r\n      return skip();\r\n    }\r\n  });\r\n}\r\n\r\nfunction move(fiber: Fiber<NativeElement>) {\r\n  const sourceNodes = collectElements(fiber, x => x.element);\r\n  const sourceNode = sourceNodes[0];\r\n  const parentElement = sourceNode.parentElement;\r\n  const sourceFragment = new DocumentFragment();\r\n  const elementIdx = fiber.eidx;\r\n  let idx = 0;\r\n  const move = () => {\r\n    for (let i = 1; i < sourceNodes.length; i++) {\r\n      removeNativeElement(parentElement.childNodes[elementIdx + 1], parentElement);\r\n    }\r\n\r\n    replaceNativeElement(sourceFragment, parentElement.childNodes[elementIdx], parentElement);\r\n  };\r\n\r\n  for (const node of sourceNodes) {\r\n    insertNativeElement(document.createComment(`${elementIdx}:${idx}`), node, parentElement);\r\n    appendNativeElement(node, sourceFragment);\r\n    idx++;\r\n  }\r\n\r\n  moves.push(move);\r\n}\r\n\r\nconst commitMap: Record<string, (fiber: Fiber<NativeElement>) => void> = {\r\n  [CREATE_EFFECT_TAG]: (fiber: Fiber<NativeElement>) => {\r\n    if (!fiber.element || detectIsPortal(fiber.inst)) return;\r\n    trackUpdate && trackUpdate(fiber.element);\r\n    commitCreation(fiber);\r\n  },\r\n  [UPDATE_EFFECT_TAG]: (fiber: Fiber<NativeElement>) => {\r\n    fiber.mask & MOVE_MASK && (move(fiber), (fiber.mask &= ~MOVE_MASK));\r\n    if (!fiber.element || detectIsPortal(fiber.inst)) return;\r\n    trackUpdate && trackUpdate(fiber.element);\r\n    commitUpdate(fiber);\r\n  },\r\n  [DELETE_EFFECT_TAG]: commitDeletion,\r\n  [SKIP_EFFECT_TAG]: dummyFn,\r\n};\r\n\r\nfunction finishCommit() {\r\n  moves.forEach(x => x());\r\n  patches.forEach(x => x());\r\n  moves = [];\r\n  patches = [];\r\n}\r\n\r\nconst commit = (fiber: Fiber<NativeElement>) => commitMap[fiber.tag](fiber);\r\n\r\nconst setTrackUpdate = (fn: typeof trackUpdate) => (trackUpdate = fn);\r\n\r\nconst appendNativeElement = (element: NativeNode, parent: NativeNode) => parent.appendChild(element);\r\n\r\nconst insertNativeElement = (element: NativeNode, sibling: NativeNode, parent: TagNativeElement) =>\r\n  parent.insertBefore(element, sibling);\r\n\r\nconst insertNativeElementByIndex = (element: NativeNode, idx: number, parent: TagNativeElement) =>\r\n  parent.insertBefore(element, parent.childNodes[idx]);\r\n\r\nconst replaceNativeElement = (element: NativeNode, candidate: NativeNode, parent: TagNativeElement) =>\r\n  parent.replaceChild(element, candidate);\r\n\r\nconst canRemoveNativeElement = (element: NativeNode, parent: NativeNode) => element.parentElement === parent;\r\n\r\nconst removeNativeElement = (element: NativeNode, parent: TagNativeElement) => parent.removeChild(element);\r\n\r\nexport { createNativeElement, commit, finishCommit, setTrackUpdate, insertNativeElementByIndex };\r\n","import {\r\n  type DarkElement,\r\n  type Callback,\r\n  ROOT,\r\n  Fiber,\r\n  CREATE_EFFECT_TAG,\r\n  UPDATE_EFFECT_TAG,\r\n  platform,\r\n  flatten,\r\n  detectIsUndefined,\r\n  detectIsFunction,\r\n  trueFn,\r\n  TagVirtualNode,\r\n  TaskPriority,\r\n  createReplacer,\r\n  setRootId,\r\n  $$scope,\r\n  dummyFn,\r\n  scheduler,\r\n} from '@dark-engine/core';\r\n\r\nimport { createNativeElement, insertNativeElementByIndex, commit, finishCommit } from '../dom';\r\nimport { detectIsPortal, unmountPortal } from '../portal';\r\nimport type { TagNativeElement } from '../native-element';\r\n\r\nconst roots = new Map<Element, number>();\r\nconst raf = requestAnimationFrame.bind(window);\r\nconst caf = cancelAnimationFrame.bind(window);\r\nconst spawn = raf;\r\nlet isInjected = false;\r\n\r\nfunction inject() {\r\n  platform.createElement = createNativeElement as typeof platform.createElement;\r\n  platform.insertElement = insertNativeElementByIndex as typeof platform.insertElement;\r\n  platform.raf = raf;\r\n  platform.caf = caf;\r\n  platform.spawn = spawn;\r\n  platform.commit = commit;\r\n  platform.finishCommit = finishCommit;\r\n  platform.detectIsDynamic = trueFn;\r\n  platform.detectIsPortal = detectIsPortal;\r\n  platform.unmountPortal = unmountPortal;\r\n  platform.chunk = dummyFn;\r\n  isInjected = true;\r\n}\r\n\r\nfunction render(element: DarkElement, container: TagNativeElement, hydrate?: Callback) {\r\n  !isInjected && inject();\r\n  if (process.env.NODE_ENV !== 'production') {\r\n    if (!(container instanceof Element)) {\r\n      throw new Error(`[Dark]: render receives only Element as container!`);\r\n    }\r\n  }\r\n\r\n  const isMounted = !detectIsUndefined(roots.get(container));\r\n  const isHydrate = detectIsFunction(hydrate);\r\n  let rootId: number = null;\r\n\r\n  if (!isMounted) {\r\n    rootId = roots.size;\r\n    roots.set(container, rootId);\r\n    !isHydrate && (container.innerHTML = '');\r\n  } else {\r\n    rootId = roots.get(container);\r\n  }\r\n\r\n  const $scope = $$scope(rootId);\r\n\r\n  // insertion effect can't schedule renders\r\n  if ($scope?.getIsInsertionEffectsZone()) return;\r\n\r\n  const callback = () => {\r\n    setRootId(rootId); // !\r\n    const $scope = $$scope();\r\n    const rootFiber = $scope.getRoot();\r\n    const isUpdate = Boolean(rootFiber);\r\n    const fiber = new Fiber().mutate({\r\n      element: container,\r\n      inst: new TagVirtualNode(ROOT, {}, flatten([element || createReplacer()]) as TagVirtualNode['children']),\r\n      alt: rootFiber,\r\n      tag: isUpdate ? UPDATE_EFFECT_TAG : CREATE_EFFECT_TAG,\r\n    });\r\n\r\n    $scope.resetMount();\r\n    $scope.setWorkInProgress(fiber);\r\n    $scope.setIsHydrateZone(isHydrate);\r\n    $scope.setNextUnitOfWork(fiber);\r\n    isHydrate && hydrate();\r\n  };\r\n\r\n  scheduler.schedule(callback, { priority: TaskPriority.NORMAL });\r\n}\r\n\r\nexport { render, roots, inject };\r\n","export const VERSION = '0.25.1';\r\nexport const STYLE_TAG = 'style';\r\nexport const STYLED_ATTR = 'dark-styled';\r\nexport const GLOBAL_ATTR_VALUE = 'global';\r\nexport const COMPONENTS_ATTR_VALUE = 'components';\r\nexport const INTERLEAVE_GLOBAL_ATTR_VALUE = 'interleave-global';\r\nexport const INTERLEAVE_COMPONENTS_ATTR_VALUE = 'interleave-components';\r\nexport const CLASS_NAME_PREFIX = 'dk';\r\nexport const ANIMATION_NAME_PREFIX = 'dka';\r\nexport const OPENING_CURLY_BRACE_MARK = '{';\r\nexport const CLOSING_CURLY_BRACE_MARK = '}';\r\nexport const OPENING_PARENTHESIS_MARK = '(';\r\nexport const CLOSING_PARENTHESIS_MARK = ')';\r\nexport const COLON_MARK = ':';\r\nexport const SEMICOLON_MARK = ';';\r\nexport const DOT_MARK = '.';\r\nexport const BLANK_SPACE = ' ';\r\nexport const MEDIA_QUERY_MARK = '@media';\r\nexport const CONTAINER_QUERY_MARK = '@container';\r\nexport const KEYFRAMES_MARK = '@keyframes';\r\nexport const NESTING_MARK = '>';\r\nexport const SELF_MARK = '&';\r\nexport const FUNCTION_MARK = '[$]';\r\nexport const SINGLE_LINE_COMMENT_START_MARK = '//';\r\nexport const SINGLE_LINE_COMMENT_END_MARK = '\\n';\r\nexport const MULTI_LINE_COMMENT_START_MARK = '/*';\r\nexport const MULTI_LINE_COMMENT_END_MARK = '*/';\r\nexport const URL_FN_MARK = 'url';\r\n","import { STYLE_TAG, BLANK_SPACE } from '../constants';\r\n\r\nconst uniq = <T>(items: Array<T>, selector: (x: T) => unknown = x => x) => {\r\n  const arr: Array<T> = [];\r\n  const set = new Set();\r\n\r\n  for (const item of items) {\r\n    const key = selector(item);\r\n\r\n    !set.has(key) && arr.push(item);\r\n    set.add(key);\r\n  }\r\n\r\n  return arr;\r\n};\r\n\r\nconst mapProps = <T extends object>(props: T) => Object.keys(props).map(key => props[key]);\r\n\r\nconst mergeClassNames = (classNames: Array<string>) => uniq(classNames.filter(Boolean)).join(BLANK_SPACE);\r\n\r\nconst getElement = (selector: string) => document.querySelector(selector);\r\n\r\nconst getElements = (selector: string) => Array.from(document.querySelectorAll(selector));\r\n\r\nconst createStyleElement = () => document.createElement(STYLE_TAG);\r\n\r\nconst setAttr = (element: Element, attrName: string, attrValue: string) => element.setAttribute(attrName, attrValue);\r\n\r\nconst append = (parent: Element, element: Element) => parent.appendChild(element);\r\n\r\nconst insertBefore = (parent: Element, element: Element, sibling: Element) => parent.insertBefore(element, sibling);\r\n\r\nconst mergeTemplates = (t1: TemplateStringsArray, t2: TemplateStringsArray) => {\r\n  const [first] = t2;\r\n  const $t1 = [...t1];\r\n  const $t2: Array<string> = [];\r\n  let result: Omit<TemplateStringsArray, 'raw'> = null;\r\n\r\n  for (let i = 0; i < t2.length; i++) {\r\n    if (i > 0) {\r\n      $t2.push(t2[i]);\r\n    }\r\n  }\r\n\r\n  $t1[$t1.length - 1] = $t1[$t1.length - 1] + first;\r\n  result = [...$t1, ...$t2];\r\n\r\n  Object.assign(result, { raw: result });\r\n\r\n  return result as TemplateStringsArray;\r\n};\r\n\r\nconst detectIsBrowser = () => typeof window !== 'undefined';\r\n\r\nexport {\r\n  uniq,\r\n  mapProps,\r\n  mergeClassNames,\r\n  getElement,\r\n  getElements,\r\n  createStyleElement,\r\n  setAttr,\r\n  append,\r\n  insertBefore,\r\n  mergeTemplates,\r\n  detectIsBrowser,\r\n};\r\n","import { detectIsTextBased } from '@dark-engine/core';\r\n\r\nimport { type TextBased } from '../shared';\r\nimport { hash } from '../hash';\r\nimport { parse } from '../parse';\r\nimport {\r\n  KEYFRAMES_MARK,\r\n  FUNCTION_MARK,\r\n  OPENING_CURLY_BRACE_MARK,\r\n  CLOSING_CURLY_BRACE_MARK,\r\n  ANIMATION_NAME_PREFIX,\r\n} from '../constants';\r\nimport { type KeyframesRule } from '../tokens';\r\n\r\nclass Keyframes {\r\n  constructor(private name: string, private token: KeyframesRule) {}\r\n\r\n  getName() {\r\n    return this.name;\r\n  }\r\n\r\n  getToken() {\r\n    return this.token;\r\n  }\r\n}\r\n\r\nfunction keyframes(source: TemplateStringsArray, ...args: Array<TextBased>) {\r\n  const joined = join(pad(source), args);\r\n  const name = genAnimationName(joined);\r\n  const [token] = parse(joined.replace(FUNCTION_MARK, name)).children;\r\n  const keyframes = new Keyframes(name, token as KeyframesRule);\r\n\r\n  return keyframes;\r\n}\r\n\r\nfunction pad(source: TemplateStringsArray) {\r\n  const start = `${KEYFRAMES_MARK} ${FUNCTION_MARK} ${OPENING_CURLY_BRACE_MARK}`;\r\n  const end = CLOSING_CURLY_BRACE_MARK;\r\n  const strings: Array<string> = [];\r\n\r\n  for (let i = 0; i < source.length; i++) {\r\n    const isStart = i === 0;\r\n    const isEnd = i === source.length - 1;\r\n\r\n    if (isStart) {\r\n      strings.push(start + source[i]);\r\n    } else if (isEnd) {\r\n      strings.push(source[i] + end);\r\n    } else {\r\n      strings.push(source[i]);\r\n    }\r\n  }\r\n\r\n  return strings;\r\n}\r\n\r\nfunction join(source: Array<string>, args: Array<TextBased>) {\r\n  let joined = '';\r\n\r\n  for (let i = 0; i < source.length; i++) {\r\n    joined += source[i];\r\n\r\n    if (detectIsTextBased(args[i])) {\r\n      joined += args[i];\r\n    }\r\n  }\r\n\r\n  return joined;\r\n}\r\n\r\nconst genAnimationName = (key: string) => `${ANIMATION_NAME_PREFIX}-${hash(key)}`;\r\n\r\nconst detectIsKeyframes = (x: unknown): x is Keyframes => x instanceof Keyframes;\r\n\r\nexport { Keyframes, keyframes, detectIsKeyframes };\r\n","import {\r\n  OPENING_CURLY_BRACE_MARK,\r\n  CLOSING_CURLY_BRACE_MARK,\r\n  COLON_MARK,\r\n  SEMICOLON_MARK,\r\n  MEDIA_QUERY_MARK,\r\n  CONTAINER_QUERY_MARK,\r\n  KEYFRAMES_MARK,\r\n  NESTING_MARK,\r\n  SELF_MARK,\r\n  DOT_MARK,\r\n  FUNCTION_MARK,\r\n  BLANK_SPACE,\r\n} from '../constants';\r\n\r\nimport { detectIsKeyframes } from '../keyframes';\r\n\r\nabstract class Token {\r\n  name = '';\r\n  value = '';\r\n  parent: Parent;\r\n  isDynamic = false;\r\n\r\n  normalize() {\r\n    this.name = this.name.trim();\r\n    this.value = this.value.trim();\r\n  }\r\n\r\n  markAsDynamic() {\r\n    this.isDynamic = true;\r\n    detectIsToken(this.parent) && !this.parent.isDynamic && this.parent.markAsDynamic();\r\n  }\r\n\r\n  abstract generate(): string | Tuple;\r\n  abstract generate(props: object, args: Array<Function>): string | Tuple;\r\n  abstract generate(className: string | null, props: object, args: Array<Function>): string | Tuple;\r\n}\r\n\r\nclass StyleRule extends Token {\r\n  override generate(): string {\r\n    return `${this.name}${COLON_MARK}${this.value}${SEMICOLON_MARK}`;\r\n  }\r\n}\r\n\r\nclass NestingRule<P extends object = {}> extends Token {\r\n  name = NESTING_MARK;\r\n  children: Children = [];\r\n\r\n  override generate(...args: Array<unknown>): string {\r\n    const className = args[0] as string | null;\r\n    const props = args[1] as P;\r\n    const fns = args[2] as Array<Function>;\r\n    let styles = `${this.value.replaceAll(SELF_MARK, `${DOT_MARK}${className}`)}${OPENING_CURLY_BRACE_MARK}`;\r\n    let keyframes = '';\r\n\r\n    for (const token of this.children) {\r\n      const [$styles, _, __, ___, $keyframes] = generate({ token, className, props, fns });\r\n\r\n      styles += $styles;\r\n      keyframes += $keyframes;\r\n    }\r\n\r\n    styles += `${CLOSING_CURLY_BRACE_MARK}${keyframes}`;\r\n\r\n    return styles;\r\n  }\r\n}\r\n\r\nclass MediaQueryRule<P extends object = {}> extends Token {\r\n  name = MEDIA_QUERY_MARK;\r\n  children: Children = [];\r\n\r\n  override generate(...args: Array<unknown>): string {\r\n    const className = args[0] as string | null;\r\n    const props = args[1] as P;\r\n    const fns = args[2] as Array<Function>;\r\n    let styles = className\r\n      ? `${this.value}${OPENING_CURLY_BRACE_MARK}${DOT_MARK}${className}${OPENING_CURLY_BRACE_MARK}`\r\n      : `${this.value}${OPENING_CURLY_BRACE_MARK}`;\r\n    let nesting = '';\r\n\r\n    for (const token of this.children) {\r\n      const [$styles, $nesting] = generate({ token, className, props, fns });\r\n\r\n      styles += $styles;\r\n      nesting += $nesting;\r\n    }\r\n\r\n    if (className) {\r\n      styles += `${CLOSING_CURLY_BRACE_MARK}${nesting}${CLOSING_CURLY_BRACE_MARK}`;\r\n    } else {\r\n      styles += `${nesting}${CLOSING_CURLY_BRACE_MARK}`;\r\n    }\r\n\r\n    return styles;\r\n  }\r\n}\r\n\r\nclass ContainerQueryRule<P extends object = {}> extends Token {\r\n  name = CONTAINER_QUERY_MARK;\r\n  children: Children = [];\r\n\r\n  override generate(...args: Array<unknown>): string {\r\n    const className = args[0] as string | null;\r\n    const props = args[1] as P;\r\n    const fns = args[2] as Array<Function>;\r\n    let styles = className\r\n      ? `${this.value}${OPENING_CURLY_BRACE_MARK}${DOT_MARK}${className}${OPENING_CURLY_BRACE_MARK}`\r\n      : `${this.value}${OPENING_CURLY_BRACE_MARK}`;\r\n    let nesting = '';\r\n\r\n    for (const token of this.children) {\r\n      const [$styles, $nesting] = generate({ token, className, props, fns });\r\n\r\n      styles += $styles;\r\n      nesting += $nesting;\r\n    }\r\n\r\n    if (className) {\r\n      styles += `${CLOSING_CURLY_BRACE_MARK}${nesting}${CLOSING_CURLY_BRACE_MARK}`;\r\n    } else {\r\n      styles += `${nesting}${CLOSING_CURLY_BRACE_MARK}`;\r\n    }\r\n\r\n    return styles;\r\n  }\r\n}\r\n\r\nclass KeyframesRule<P extends object = {}> extends Token {\r\n  name = KEYFRAMES_MARK;\r\n  children: Children = [];\r\n\r\n  override generate(...args: Array<unknown>): string {\r\n    const props = args[0] as P;\r\n    const fns = args[1] as Array<Function>;\r\n    let keyframes = `${this.value}${OPENING_CURLY_BRACE_MARK}`;\r\n\r\n    for (const token of this.children) {\r\n      const [$styles, $nesting] = generate({ token, props, fns });\r\n\r\n      keyframes += $styles;\r\n      keyframes += $nesting;\r\n    }\r\n\r\n    keyframes += `${CLOSING_CURLY_BRACE_MARK}`;\r\n\r\n    return keyframes;\r\n  }\r\n}\r\n\r\nclass FunctionRule<P extends object = {}> extends Token {\r\n  name = FUNCTION_MARK;\r\n  args: Array<number> = [];\r\n  style: StyleRule = null;\r\n  private end = '';\r\n  private isSealed = false;\r\n\r\n  add(idx: number) {\r\n    this.args.push(idx);\r\n  }\r\n\r\n  seal(end: string) {\r\n    this.isSealed = true;\r\n    this.end = end;\r\n  }\r\n\r\n  getIsSealed() {\r\n    return this.isSealed;\r\n  }\r\n\r\n  getEnd() {\r\n    return this.end;\r\n  }\r\n\r\n  generate(...args: Array<unknown>): Tuple {\r\n    const className = args[0] as string | null;\r\n    const props = args[1] as P;\r\n    const fns = args[2] as Array<Function>;\r\n    const styleExp = this.style;\r\n    const [idx, ...rest] = this.args;\r\n    const value = fns[idx](props);\r\n    let styles = '';\r\n    let nesting = '';\r\n    let media = '';\r\n    let container = '';\r\n    let keyframes = '';\r\n\r\n    if (detectIsStyleSheet(value)) {\r\n      for (const token of value.children) {\r\n        const [$styles, $nesting, $media, $container, $keyframes] = generate({ token, className, props, fns });\r\n\r\n        styles += $styles;\r\n        nesting += $nesting;\r\n        media += $media;\r\n        container += $container;\r\n        keyframes += $keyframes;\r\n      }\r\n    } else if (styleExp) {\r\n      const end = rest.reduce((acc, x) => (acc += BLANK_SPACE + fns[x](props)), '') + this.end;\r\n\r\n      if (detectIsKeyframes(value)) {\r\n        styleExp.value = replace(this.name, value.getName()) + end;\r\n        styles += styleExp.generate();\r\n        keyframes += value.getToken().generate(props, fns);\r\n      } else {\r\n        styleExp.value = replace(this.name, value) + end;\r\n        styles += styleExp.generate();\r\n      }\r\n    }\r\n\r\n    return [styles, nesting, media, container, keyframes];\r\n  }\r\n}\r\n\r\ntype GenerateOptions<P extends object> = {\r\n  className?: string;\r\n  props?: P;\r\n  fns?: Array<Function>;\r\n};\r\n\r\nclass StyleSheet<P extends object = {}> {\r\n  children: Children = [];\r\n\r\n  generate(options: GenerateOptions<P> = {}) {\r\n    const { className = null, props, fns } = options;\r\n    let styles = className ? `${DOT_MARK}${className}${OPENING_CURLY_BRACE_MARK}` : '';\r\n    let nesting = '';\r\n    let media = '';\r\n    let container = '';\r\n    let keyframes = '';\r\n\r\n    for (const token of this.children) {\r\n      const [$styles, $nesting, $media, $container, $keyframes] = generate({ token, className, props, fns });\r\n\r\n      styles += $styles;\r\n      nesting += $nesting;\r\n      media += $media;\r\n      container += $container;\r\n      keyframes += $keyframes;\r\n    }\r\n\r\n    if (className) {\r\n      styles += `${CLOSING_CURLY_BRACE_MARK}${nesting}${media}${container}${keyframes}`;\r\n    } else {\r\n      styles += `${nesting}${media}${container}${keyframes}`;\r\n    }\r\n\r\n    return styles;\r\n  }\r\n}\r\n\r\ntype GenerateProps<P extends object> = {\r\n  token: Token;\r\n  className?: string | null;\r\n  props?: P;\r\n  fns?: Array<Function>;\r\n};\r\n\r\nfunction generate<P extends object = {}>(options: GenerateProps<P>): Tuple {\r\n  const { token, className = null, props, fns } = options;\r\n  let styles = '';\r\n  let nesting = '';\r\n  let media = '';\r\n  let container = '';\r\n  let keyframes = '';\r\n\r\n  if (detectIsStyleRule(token)) {\r\n    styles += token.generate();\r\n  } else if (detectIsNestingRule(token)) {\r\n    nesting += token.generate(className, props, fns);\r\n  } else if (detectIsMediaQueryRule(token)) {\r\n    media += token.generate(className, props, fns);\r\n  } else if (detectIsContainerQueryRule(token)) {\r\n    container += token.generate(className, props, fns);\r\n  } else if (detectIsKeyframesRule(token)) {\r\n    keyframes += token.generate(props, fns);\r\n  } else if (detectIsFunctionRule(token)) {\r\n    const [$styles, $nesting, $media, $container, $keyframes] = token.generate(className, props, fns);\r\n\r\n    styles += $styles;\r\n    nesting += $nesting;\r\n    media += $media;\r\n    container += $container;\r\n    keyframes += $keyframes;\r\n  }\r\n\r\n  return [styles, nesting, media, container, keyframes];\r\n}\r\n\r\ntype Tuple = [string, string, string, string, string];\r\n\r\nexport type Parent = StyleSheet | Token;\r\n\r\nexport type Children = Array<Token>;\r\n\r\nconst detectIsToken = (x: unknown): x is Token => x instanceof Token;\r\n\r\nconst detectIsStyleRule = (x: unknown): x is StyleRule => x instanceof StyleRule;\r\n\r\nconst detectIsMediaQueryRule = (x: unknown): x is MediaQueryRule => x instanceof MediaQueryRule;\r\n\r\nconst detectIsContainerQueryRule = (x: unknown): x is ContainerQueryRule => x instanceof ContainerQueryRule;\r\n\r\nconst detectIsKeyframesRule = (x: unknown): x is KeyframesRule => x instanceof KeyframesRule;\r\n\r\nconst detectIsNestingRule = (x: unknown): x is NestingRule => x instanceof NestingRule;\r\n\r\nconst detectIsFunctionRule = (x: unknown): x is FunctionRule => x instanceof FunctionRule;\r\n\r\nconst detectIsStyleSheet = (x: unknown): x is StyleSheet => x instanceof StyleSheet;\r\n\r\nconst replace = (target: string, x: string) => target.replace(FUNCTION_MARK, x);\r\n\r\nexport {\r\n  StyleSheet,\r\n  StyleRule,\r\n  MediaQueryRule,\r\n  ContainerQueryRule,\r\n  KeyframesRule,\r\n  NestingRule,\r\n  FunctionRule,\r\n  detectIsStyleSheet,\r\n  detectIsStyleRule,\r\n  detectIsMediaQueryRule,\r\n  detectIsContainerQueryRule,\r\n  detectIsKeyframesRule,\r\n  detectIsNestingRule,\r\n  detectIsFunctionRule,\r\n};\r\n","import type { DarkElement, Subscribe, SubscriberWithValue, SlotProps, KeyProps } from '../shared';\r\nimport { type ComponentFactory, component } from '../component';\r\nimport type { Fiber } from '../fiber';\r\nimport { detectIsFunction } from '../utils';\r\nimport { $$scope } from '../scope';\r\nimport { useEffect } from '../use-effect';\r\nimport { useMemo } from '../use-memo';\r\nimport { useUpdate } from '../use-update';\r\n\r\ntype CreateContextOptions = {\r\n  displayName?: string;\r\n};\r\n\r\nfunction createContext<T>(defaultValue: T, options?: CreateContextOptions): Context<T> {\r\n  const { displayName = 'Context' } = options || {};\r\n  const context: Context<T> = {\r\n    displayName,\r\n    defaultValue,\r\n    Provider: null,\r\n    Consumer: null,\r\n  };\r\n\r\n  context.Provider = createProvider(context, defaultValue, displayName);\r\n  context.Consumer = createConsumer(context, displayName);\r\n\r\n  return context;\r\n}\r\n\r\nfunction createProvider<T>(context: Context<T>, defaultValue: T, displayName: string) {\r\n  return component<ContexProviderProps<T>>(\r\n    ({ value = defaultValue, slot }) => {\r\n      const fiber = $$scope().getCursorFiber();\r\n\r\n      if (!fiber.provider) {\r\n        const providerValue: ContextProviderValue<T> = {\r\n          value,\r\n          subscribers: new Set(),\r\n          subscribe: (subscriber: (value: T) => void) => {\r\n            providerValue.subscribers.add(subscriber);\r\n\r\n            return () => providerValue.subscribers.delete(subscriber);\r\n          },\r\n        };\r\n\r\n        fiber.provider = new Map();\r\n        fiber.provider.set(context, providerValue);\r\n      }\r\n\r\n      const provider = fiber.provider.get(context);\r\n\r\n      useEffect(() => {\r\n        provider.subscribers.forEach(fn => fn(value));\r\n      }, [value]);\r\n\r\n      provider.value = value;\r\n\r\n      return slot;\r\n    },\r\n    { displayName: `${displayName}.Provider` },\r\n  );\r\n}\r\n\r\ntype ConsumerProps<T> = {\r\n  slot: (value: T) => DarkElement;\r\n};\r\n\r\nfunction createConsumer<T>(context: Context<T>, displayName: string) {\r\n  return component<ConsumerProps<T>>(\r\n    ({ slot }) => {\r\n      const value = useContext(context);\r\n\r\n      return detectIsFunction(slot) ? slot(value) : null;\r\n    },\r\n    { displayName: `${displayName}.Consumer` },\r\n  );\r\n}\r\n\r\nfunction useContext<T>(context: Context<T>): T {\r\n  const { defaultValue } = context;\r\n  const fiber = $$scope().getCursorFiber();\r\n  const provider = useMemo(() => getProvider<T>(context, fiber), []);\r\n  const value = provider ? provider.value : defaultValue;\r\n  const update = useUpdate();\r\n  const scope = useMemo(() => ({ value }), []);\r\n  const hasProvider = Boolean(provider);\r\n\r\n  useEffect(() => {\r\n    if (!hasProvider) return;\r\n    const unsubscribe = provider.subscribe((value: T) => {\r\n      if (!Object.is(scope.value, value)) {\r\n        update();\r\n      }\r\n    });\r\n\r\n    return unsubscribe;\r\n  }, [hasProvider]);\r\n\r\n  scope.value = value;\r\n\r\n  return value;\r\n}\r\n\r\nfunction getProvider<T>(context: Context<T>, fiber: Fiber): ContextProviderValue<T> {\r\n  let nextFiber = fiber;\r\n\r\n  while (nextFiber) {\r\n    if (nextFiber.provider && nextFiber.provider.get(context)) {\r\n      return nextFiber.provider.get(context) as ContextProviderValue<T>;\r\n    }\r\n\r\n    nextFiber = nextFiber.parent;\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\ntype ContexProviderProps<T> = {\r\n  value: T;\r\n} & SlotProps &\r\n  KeyProps;\r\n\r\nexport type Context<T = unknown> = {\r\n  Provider: ComponentFactory<ContexProviderProps<T>>;\r\n  Consumer: ComponentFactory<SlotProps<(value: T) => DarkElement>>;\r\n  displayName?: string;\r\n  defaultValue: T;\r\n};\r\n\r\nexport type ContextProviderValue<T = unknown> = {\r\n  value: T;\r\n  subscribers: Set<(value: T) => void>;\r\n  subscribe: Subscribe<SubscriberWithValue<T>>;\r\n};\r\n\r\nexport { createContext, useContext };\r\n","import { type DarkElement, createContext, useContext, component } from '@dark-engine/core';\r\n\r\nimport { type DefaultTheme } from '../';\r\n\r\n// styled.d.ts\r\n// type Theme = {\r\n//   color1: string;\r\n//   color2: string;\r\n//   color3: string;\r\n// };\r\n// declare module '@dark-engine/styled' {\r\n//   export interface DefaultTheme extends Theme {}\r\n// }\r\n\r\nexport type ThemeProps = { theme: DefaultTheme };\r\n\r\nexport type ThemeContextValue = DefaultTheme;\r\n\r\nconst ThemeContext = createContext<ThemeContextValue>(null, { displayName: 'Theme' });\r\n\r\nconst useTheme = () => useContext(ThemeContext);\r\n\r\ntype ThemeProviderProps = {\r\n  theme: DefaultTheme;\r\n  slot: DarkElement;\r\n};\r\n\r\nconst ThemeProvider = component<ThemeProviderProps>(({ theme, slot }) => {\r\n  return ThemeContext.Provider({ value: theme, slot });\r\n});\r\n\r\nexport { ThemeProvider, useTheme };\r\n","import { type DarkElement, type Callback, createContext, useContext, component } from '@dark-engine/core';\r\n\r\nexport enum STYLE_LEVEL {\r\n  GLOBAL,\r\n  COMPONENT,\r\n}\r\n\r\nclass Manager {\r\n  private styles = createStyles();\r\n  private resets = new Set<Callback>();\r\n\r\n  collectGlobalStyle(css: string) {\r\n    this.styles[STYLE_LEVEL.GLOBAL].add(css);\r\n  }\r\n\r\n  collectComponentStyle(css: string) {\r\n    this.styles[STYLE_LEVEL.COMPONENT].add(css);\r\n  }\r\n\r\n  getStyles() {\r\n    return this.styles;\r\n  }\r\n\r\n  reset(fn: Callback) {\r\n    this.resets.add(fn);\r\n  }\r\n\r\n  seal() {\r\n    this.styles = createStyles();\r\n    this.resets.forEach(x => x());\r\n    this.resets = new Set();\r\n  }\r\n}\r\n\r\nconst createStyles = () => ({\r\n  [STYLE_LEVEL.GLOBAL]: new Set<string>(),\r\n  [STYLE_LEVEL.COMPONENT]: new Set<string>(),\r\n});\r\n\r\nconst ManagerContext = createContext<Manager>(null, { displayName: 'Manager' });\r\n\r\nfunction useManager() {\r\n  return useContext(ManagerContext);\r\n}\r\n\r\ntype ThemeProviderProps = {\r\n  manager: Manager;\r\n  slot: DarkElement;\r\n};\r\n\r\nconst ManagerProvider = component<ThemeProviderProps>(({ manager, slot }) => {\r\n  return ManagerContext.Provider({ value: manager, slot });\r\n});\r\n\r\nexport { Manager, useManager, ManagerProvider };\r\n","import {\r\n  OPENING_CURLY_BRACE_MARK,\r\n  CLOSING_CURLY_BRACE_MARK,\r\n  COLON_MARK,\r\n  SEMICOLON_MARK,\r\n  MEDIA_QUERY_MARK,\r\n  CONTAINER_QUERY_MARK,\r\n  KEYFRAMES_MARK,\r\n  FUNCTION_MARK,\r\n  SINGLE_LINE_COMMENT_START_MARK,\r\n  SINGLE_LINE_COMMENT_END_MARK,\r\n  MULTI_LINE_COMMENT_START_MARK,\r\n  MULTI_LINE_COMMENT_END_MARK,\r\n  OPENING_PARENTHESIS_MARK,\r\n  CLOSING_PARENTHESIS_MARK,\r\n  URL_FN_MARK,\r\n} from '../constants';\r\nimport {\r\n  type Children,\r\n  StyleSheet,\r\n  StyleRule,\r\n  MediaQueryRule,\r\n  ContainerQueryRule,\r\n  KeyframesRule,\r\n  NestingRule,\r\n  FunctionRule,\r\n  detectIsStyleSheet,\r\n  detectIsStyleRule,\r\n  detectIsMediaQueryRule,\r\n  detectIsContainerQueryRule,\r\n  detectIsKeyframesRule,\r\n  detectIsNestingRule,\r\n  detectIsFunctionRule,\r\n} from '../tokens';\r\n\r\nfunction parse<P extends object>(css: string) {\r\n  const stylesheet = new StyleSheet<P>();\r\n  const stack: Array<NestingRule | MediaQueryRule> = [];\r\n  let buffer = '';\r\n  let end = '';\r\n  let fnIdx = -1;\r\n  let isSingleLineComment = false;\r\n  let isMultiLineComment = false;\r\n  let isPropValue = false;\r\n  let isUrl = false;\r\n\r\n  for (let i = 0; i < css.length; i++) {\r\n    const char = css[i];\r\n    const parent = stack[stack.length - 1] || stylesheet;\r\n    const last = parent.children[parent.children.length - 1];\r\n\r\n    buffer += char;\r\n\r\n    if (!isSingleLineComment && detectHasSingleLineCommentStartMark(buffer)) {\r\n      isSingleLineComment = !isUrl;\r\n    } else if (isSingleLineComment && detectHasSingleLineCommentEndMark(buffer)) {\r\n      isSingleLineComment = false;\r\n      buffer = '';\r\n    }\r\n\r\n    if (!isMultiLineComment && detectHasMultiLineCommentStartMark(buffer)) {\r\n      isMultiLineComment = true;\r\n      end = detectIsStyleRule(last) ? createEnd(buffer) : '';\r\n    } else if (isMultiLineComment && detectHasMultiLineCommentEndMark(buffer)) {\r\n      isMultiLineComment = false;\r\n      buffer = '';\r\n    }\r\n\r\n    if (isSingleLineComment || isMultiLineComment) continue;\r\n\r\n    if (detectHasFunctionMark(buffer)) {\r\n      const token = new FunctionRule();\r\n\r\n      if (detectIsFunctionRule(last) && !last.getIsSealed() && last.style) {\r\n        last.add(++fnIdx);\r\n        buffer = '';\r\n        continue;\r\n      }\r\n\r\n      token.add(++fnIdx);\r\n      token.parent = parent;\r\n      token.markAsDynamic();\r\n\r\n      if (detectIsStyleRule(last) && !last.value) {\r\n        token.style = last;\r\n        token.name = buffer.trim();\r\n        last.normalize();\r\n        last.isDynamic = true;\r\n        parent.children[parent.children.length - 1] = token;\r\n      } else {\r\n        parent.children.push(token);\r\n      }\r\n\r\n      buffer = '';\r\n      continue;\r\n    }\r\n\r\n    switch (char) {\r\n      case OPENING_CURLY_BRACE_MARK:\r\n        {\r\n          const token = detectHasMediaQueryMark(buffer)\r\n            ? new MediaQueryRule()\r\n            : detectHasContainerQueryMark(buffer)\r\n            ? new ContainerQueryRule()\r\n            : detectHasKeyframesMark(buffer)\r\n            ? new KeyframesRule()\r\n            : new NestingRule();\r\n          const canNest =\r\n            detectIsMediaQueryRule(token) || detectIsContainerQueryRule(token) || detectIsKeyframesRule(token)\r\n              ? detectIsStyleSheet(parent)\r\n              : detectIsNestingRule(token)\r\n              ? detectIsStyleSheet(parent) ||\r\n                detectIsMediaQueryRule(parent) ||\r\n                detectIsContainerQueryRule(parent) ||\r\n                detectIsKeyframesRule(parent)\r\n              : false;\r\n\r\n          if (!canNest) {\r\n            throw new Error('Illegal style nesting!');\r\n          }\r\n\r\n          token.value = sub(buffer);\r\n          token.normalize();\r\n          token.parent = parent;\r\n\r\n          if (!token.value) {\r\n            throw new Error('Empty style nesting!');\r\n          }\r\n\r\n          parent.children.push(token);\r\n          stack.push(token);\r\n          buffer = '';\r\n        }\r\n        break;\r\n      case CLOSING_CURLY_BRACE_MARK:\r\n        stack.pop();\r\n        buffer = '';\r\n        break;\r\n      case COLON_MARK:\r\n        {\r\n          if (!detectIsPropName(buffer, i, css, parent.children)) continue;\r\n          const token = new StyleRule();\r\n\r\n          token.name = sub(buffer);\r\n          token.parent = parent;\r\n          parent.children.push(token);\r\n        }\r\n        buffer = '';\r\n        isPropValue = true;\r\n        break;\r\n      case SEMICOLON_MARK:\r\n        if (!last) {\r\n          throw new Error('Incorrect style!');\r\n        }\r\n\r\n        if (detectIsFunctionRule(last)) {\r\n          last.seal(sub(buffer));\r\n          buffer = '';\r\n          continue;\r\n        }\r\n\r\n        last.value = end || sub(buffer);\r\n        last.normalize();\r\n\r\n        buffer = '';\r\n        end = '';\r\n        isPropValue = false;\r\n        break;\r\n      case OPENING_PARENTHESIS_MARK:\r\n        if (isPropValue && detectHasUrlFnMark(buffer)) {\r\n          isUrl = true;\r\n        }\r\n        break;\r\n      case CLOSING_PARENTHESIS_MARK:\r\n        isUrl = false;\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n\r\n  return stylesheet;\r\n}\r\n\r\nfunction detectIsPropName(name: string, idx: number, css: string, children: Children) {\r\n  const last = children[children.length - 1];\r\n  if (detectHasMediaQueryMark(name) || detectHasContainerQueryMark(name)) return false;\r\n  if (detectIsStyleRule(last) && !last.value) return false;\r\n\r\n  for (let i = idx; i < css.length; i++) {\r\n    const char = css[i];\r\n\r\n    if (char === OPENING_CURLY_BRACE_MARK) return false;\r\n    if (char === SEMICOLON_MARK) return true;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nconst detectHasSingleLineCommentStartMark = (x: string) => x.endsWith(SINGLE_LINE_COMMENT_START_MARK);\r\n\r\nconst detectHasSingleLineCommentEndMark = (x: string) => x.endsWith(SINGLE_LINE_COMMENT_END_MARK);\r\n\r\nconst detectHasMultiLineCommentStartMark = (x: string) => x.endsWith(MULTI_LINE_COMMENT_START_MARK);\r\n\r\nconst detectHasMultiLineCommentEndMark = (x: string) => x.endsWith(MULTI_LINE_COMMENT_END_MARK);\r\n\r\nconst detectHasFunctionMark = (x: string) => x.endsWith(FUNCTION_MARK);\r\n\r\nconst detectHasUrlFnMark = (x: string) => x.endsWith(URL_FN_MARK + OPENING_PARENTHESIS_MARK);\r\n\r\nconst detectHasMediaQueryMark = (x: string) => x.trim().startsWith(MEDIA_QUERY_MARK);\r\n\r\nconst detectHasContainerQueryMark = (x: string) => x.trim().startsWith(CONTAINER_QUERY_MARK);\r\n\r\nconst detectHasKeyframesMark = (x: string) => x.trim().startsWith(KEYFRAMES_MARK);\r\n\r\nconst sub = (x: string) => x.substring(0, x.length - 1);\r\n\r\nconst createEnd = (x: string) => x.replace(MULTI_LINE_COMMENT_START_MARK, '').trim();\r\n\r\nexport { parse };\r\n","const SEED = 5381;\r\nconst SIZE = 6;\r\nconst map = { 0: 'a', 1: 'b', 2: 'c', 3: 'd', 4: 'e', 5: 'f', 6: 'g', 7: 'h', 8: 'i', 9: 'j' };\r\n\r\nfunction phash(h: number, x: string) {\r\n  let i = x.length;\r\n\r\n  while (i) {\r\n    h = (h * 33) ^ x.charCodeAt(--i);\r\n  }\r\n\r\n  return h;\r\n}\r\n\r\nfunction hash(x: string) {\r\n  const source = phash(SEED, x);\r\n  const hash = String(Math.abs(source))\r\n    .slice(0, SIZE)\r\n    .split('')\r\n    .map(x => map[x])\r\n    .join('');\r\n\r\n  return hash;\r\n}\r\n\r\nexport { hash };\r\n","import {\r\n  type ComponentFactory,\r\n  type TagVirtualNodeFactory,\r\n  type StandardComponentProps,\r\n  type Component,\r\n  type VirtualNode,\r\n  View,\r\n  component,\r\n  forwardRef,\r\n  useMemo,\r\n  detectIsString,\r\n  detectIsFunction,\r\n  detectIsTextBased,\r\n  detectIsServer,\r\n  useInsertionEffect,\r\n} from '@dark-engine/core';\r\n\r\nimport {\r\n  detectIsBrowser,\r\n  mapProps,\r\n  mergeClassNames,\r\n  getElement,\r\n  getElements,\r\n  createStyleElement,\r\n  setAttr,\r\n  append,\r\n  mergeTemplates,\r\n} from '../utils';\r\nimport {\r\n  CLASS_NAME_PREFIX,\r\n  FUNCTION_MARK,\r\n  DOT_MARK,\r\n  STYLED_ATTR,\r\n  COMPONENTS_ATTR_VALUE,\r\n  INTERLEAVE_COMPONENTS_ATTR_VALUE,\r\n  BLANK_SPACE,\r\n} from '../constants';\r\nimport { type KeyframesRule, StyleSheet, detectIsStyleSheet, detectIsKeyframesRule } from '../tokens';\r\nimport { type Keyframes, detectIsKeyframes } from '../keyframes';\r\nimport { type ThemeProps, useTheme } from '../theme';\r\nimport { type TextBased } from '../shared';\r\nimport { useManager } from '../server/manager';\r\nimport { parse } from '../parse';\r\nimport { hash } from '../hash';\r\n\r\nlet cache: Map<string, [string, string]> = null;\r\nlet injections: Set<string> = null;\r\nlet tag: HTMLStyleElement = null;\r\nlet isLoaded = false;\r\nconst $$styled = Symbol('styled');\r\n\r\nsetupGlobal();\r\nfunction styled<P extends object, T extends object = {}>(tagName: string | ComponentFactory<P>) {\r\n  const factory = detectIsString(tagName) ? (props: P) => View({ as: tagName, ...props }) : tagName;\r\n\r\n  if (!isLoaded && detectIsBrowser()) {\r\n    reuse(getInterleavedElements(), createTag);\r\n    isLoaded = true;\r\n  }\r\n\r\n  return createStyledComponent<P & T>(factory as Factory<P & T>);\r\n}\r\n\r\nfunction createStyledComponent<P extends StyledProps>(factory: Factory<P>) {\r\n  let transform: TransformFn<P> = x => x;\r\n  const isExtending = detectIsStyled(factory);\r\n  const config = isExtending ? getExtendingConfig(factory as StyledComponentFactory<P>) : null;\r\n  const fn = <T extends P>(source: TemplateStringsArray, ...args: Args<T & ThemeProps>) => {\r\n    const $source = isExtending ? mergeTemplates(config.source, source) : source;\r\n    const $args = isExtending ? [...config.args, ...args] : args;\r\n    const $transform = isExtending ? (p: T) => transform(config.transform(p)) : transform;\r\n    const fns = filterArgs<T>($args);\r\n    const [sheet, sheets] = slice<T>(css($source, ...$args));\r\n    const [baseName, baseStyle, baseKeyframes] = generate({ sheet, cache });\r\n    const styled = forwardRef<T, unknown>(\r\n      component((props, ref) => {\r\n        const { as: component, ...rest } = props;\r\n        const theme = useTheme();\r\n        const isSwap = detectIsFunction(component);\r\n        const $props = (isSwap ? rest : props) as unknown as T;\r\n        const $factory = isSwap ? component : isExtending ? config.factory : factory;\r\n        const [className, styles, keyframes] = useMemo(() => {\r\n          const [names, styles, keyframes] = sheets.reduce(\r\n            (acc, sheet) => {\r\n              const [className, style, keyframes] = generate({ sheet, cache, props: { ...props, theme }, fns });\r\n              const [names, styles, keyframesList] = acc;\r\n\r\n              names.push(className);\r\n              styles.push(style);\r\n              keyframesList.push(keyframes);\r\n\r\n              return acc;\r\n            },\r\n            [[], [baseStyle], [baseKeyframes]] as [Array<string>, Array<string>, Array<string>],\r\n          );\r\n          const className = mergeClassNames([...getClassNamesFrom(props), baseName, ...names]);\r\n\r\n          return [className, filter(styles, injections), filter(keyframes, injections)] as [\r\n            string,\r\n            Array<string>,\r\n            Array<string>,\r\n          ];\r\n        }, [...mapProps(props), theme]);\r\n\r\n        useInsertionEffect(() => {\r\n          if (!tag) {\r\n            const $tag = getTag();\r\n\r\n            if ($tag) {\r\n              tag = $tag; // after hydration\r\n              return;\r\n            } else {\r\n              tag = createTag();\r\n            }\r\n          }\r\n\r\n          styles.forEach(css => inject(css, tag));\r\n          keyframes.forEach(css => inject(css, tag));\r\n        }, [...styles, ...keyframes]);\r\n\r\n        if (detectIsServer()) {\r\n          const manager = useManager(); // special case of hook using, should be last in order\r\n\r\n          styles.forEach(css => manager.collectComponentStyle(css));\r\n          keyframes.forEach(css => manager.collectComponentStyle(css));\r\n          manager.reset(setupGlobal);\r\n        }\r\n\r\n        if (detectIsFunction($props.slot)) {\r\n          $props.slot = $props.slot((x: string) => `${className}_${x}`);\r\n        }\r\n\r\n        return $factory({ ...$transform($props), ref, className });\r\n      }),\r\n    ) as StyledComponentFactory<T>;\r\n\r\n    styled[$$styled] = {\r\n      className: baseName,\r\n      source: $source,\r\n      args: $args,\r\n      factory: (config?.factory || factory) as Factory<T>,\r\n      transform: config ? p => transform(config.transform(p)) : transform,\r\n    };\r\n\r\n    return styled;\r\n  };\r\n\r\n  fn.attrs = (t: TransformFn<P>) => {\r\n    transform = detectIsFunction(t) ? t : transform;\r\n\r\n    return fn;\r\n  };\r\n\r\n  return fn;\r\n}\r\n\r\nfunction filter(styles: Array<string>, injections: Set<string>) {\r\n  const $styles: Array<string> = [];\r\n\r\n  for (const css of styles) {\r\n    if (!injections.has(css)) {\r\n      $styles.push(css);\r\n      injections.add(css);\r\n    }\r\n  }\r\n\r\n  return $styles;\r\n}\r\n\r\nfunction setupGlobal() {\r\n  cache = new Map();\r\n  injections = new Set();\r\n  tag = null;\r\n  isLoaded = false;\r\n}\r\n\r\nfunction getExtendingConfig<P extends object>(factory: StyledComponentFactory<P>) {\r\n  const { className, ...rest } = factory[$$styled];\r\n  const config: ExtendingConfig<P> = rest;\r\n\r\n  return config;\r\n}\r\n\r\ntype GenerateOptions<P extends object> = {\r\n  sheet: StyleSheet<P>;\r\n  cache: Map<string, [string, string]>;\r\n  props?: P;\r\n  fns?: Array<Function>;\r\n};\r\n\r\nfunction generate<P extends object>(options: GenerateOptions<P>): [string, string, string] {\r\n  const { sheet: $sheet, cache, props, fns } = options;\r\n  const [sheet, rules] = split($sheet);\r\n  const key = sheet.generate({ className: FUNCTION_MARK, props, fns });\r\n  const item = cache.get(key);\r\n  const className = item ? item[0] : genClassName(key);\r\n  const css = item ? item[1] : key.replaceAll(FUNCTION_MARK, className);\r\n  let style = '';\r\n  let keyframes = '';\r\n\r\n  style += css;\r\n  cache.set(key, [className, css]);\r\n\r\n  for (const rule of rules) {\r\n    keyframes += rule.generate();\r\n  }\r\n\r\n  return [className, style, keyframes];\r\n}\r\n\r\nfunction split<P extends object>(source: StyleSheet<P>): [StyleSheet<P>, Array<KeyframesRule<P>>] {\r\n  const sheet = new StyleSheet<P>();\r\n  const rules: Array<KeyframesRule<P>> = [];\r\n\r\n  for (const token of source.children) {\r\n    if (detectIsKeyframesRule(token)) {\r\n      rules.push(token);\r\n    } else {\r\n      sheet.children.push(token);\r\n    }\r\n  }\r\n\r\n  return [sheet, rules];\r\n}\r\n\r\nfunction slice<P extends object>(source: StyleSheet<P>): [StyleSheet<P>, Array<StyleSheet<P>>] {\r\n  const sheet = new StyleSheet<P>();\r\n  const sheets: Array<StyleSheet> = [];\r\n\r\n  for (const token of source.children) {\r\n    if (token.isDynamic) {\r\n      const style = new StyleSheet<P>();\r\n\r\n      style.children.push(token);\r\n      sheets.push(style);\r\n    } else {\r\n      sheet.children.push(token);\r\n    }\r\n  }\r\n\r\n  return [sheet, sheets];\r\n}\r\n\r\nfunction join<P>(strings: TemplateStringsArray, args: Args<P>) {\r\n  let joined = '';\r\n  let keyframes = '';\r\n\r\n  for (let i = 0; i < strings.length; i++) {\r\n    const arg = args[i];\r\n\r\n    joined += strings[i];\r\n\r\n    if (detectIsStyled(arg)) {\r\n      joined += `${DOT_MARK}${arg[$$styled].className}`;\r\n    } else if (detectIsStyleSheet(arg)) {\r\n      joined += arg.generate();\r\n    } else if (detectIsKeyframes(arg)) {\r\n      joined += arg.getName();\r\n      keyframes += arg.getToken().generate();\r\n    } else if (detectIsFunction(arg)) {\r\n      joined += FUNCTION_MARK;\r\n    } else if (detectIsTextBased(arg)) {\r\n      joined += arg;\r\n    }\r\n  }\r\n\r\n  joined += keyframes;\r\n\r\n  return joined;\r\n}\r\n\r\nfunction createTag() {\r\n  const tag = createStyleElement();\r\n\r\n  setAttr(tag, STYLED_ATTR, COMPONENTS_ATTR_VALUE);\r\n  append(document.head, tag);\r\n\r\n  return tag;\r\n}\r\n\r\nfunction inject(css: string, tag: HTMLStyleElement) {\r\n  tag.textContent = `${tag.textContent}${css}`;\r\n}\r\n\r\nfunction reuse(elements: Array<HTMLStyleElement>, createTag: () => HTMLStyleElement) {\r\n  if (elements.length === 0) return;\r\n  const tag = createTag();\r\n  let content = '';\r\n\r\n  for (const element of elements) {\r\n    content += element.textContent;\r\n    element.remove();\r\n  }\r\n\r\n  tag.textContent = content;\r\n}\r\n\r\nfunction getInterleavedElements() {\r\n  return getElements(`[${STYLED_ATTR}=\"${INTERLEAVE_COMPONENTS_ATTR_VALUE}\"]`) as Array<HTMLStyleElement>;\r\n}\r\n\r\nconst getTag = () => getElement(`[${STYLED_ATTR}=\"${COMPONENTS_ATTR_VALUE}\"]`) as HTMLStyleElement;\r\n\r\nconst css = <P extends object>(strings: TemplateStringsArray, ...args: Args<P>) => parse<P>(join(strings, args));\r\n\r\nconst getClassNamesFrom = (props: StyledProps) => (props.class || props.className || '').split(BLANK_SPACE);\r\n\r\nconst genClassName = (key: string) => `${CLASS_NAME_PREFIX}-${hash(key)}`;\r\n\r\nconst detectIsStyled = (x: unknown): x is StyledComponentFactory => detectIsFunction(x) && Boolean(x[$$styled]);\r\n\r\nconst filterArgs = <P>(args: Args<unknown>) =>\r\n  args.filter(x => detectIsFunction(x) && !detectIsStyled(x)) as DynamicArgs<P>;\r\n\r\ntype Factory<P extends object> = ComponentFactory<P> | ((props: P) => TagVirtualNodeFactory);\r\n\r\ntype ClassNameFn = (className: string) => string;\r\n\r\ntype StyledElement = Component | VirtualNode | string | Array<Component | VirtualNode | string>;\r\n\r\ntype StyledProps = {\r\n  as?: string | ComponentFactory;\r\n  class?: string;\r\n  className?: string;\r\n  style?: string | Record<string, string>;\r\n  slot?: ((fn: ClassNameFn) => StyledElement) | StyledElement;\r\n};\r\n\r\ntype ExtendingConfig<P extends object = {}> = {\r\n  source: TemplateStringsArray;\r\n  args: Args<P>;\r\n  factory: Factory<P>;\r\n  transform: (x: P) => P;\r\n};\r\n\r\ntype TransformFn<P> = (p: P) => any;\r\n\r\ntype DynamicArgs<P> = Array<ArgFn<P>>;\r\n\r\ntype ArgFn<P> = Function | ((p: P) => TextBased | false);\r\n\r\nexport type Args<P> = Array<TextBased | ArgFn<P> | StyleSheet | Keyframes>;\r\n\r\nexport type StyledComponentFactory<P extends object = {}> = {\r\n  [$$styled]: {\r\n    className: string;\r\n  } & ExtendingConfig<P>;\r\n} & ComponentFactory<P & StandardComponentProps & StyledProps>;\r\n\r\nstyled.a = styled('a');\r\nstyled.abbr = styled('abbr');\r\nstyled.address = styled('address');\r\nstyled.area = styled('area');\r\nstyled.article = styled('article');\r\nstyled.aside = styled('aside');\r\nstyled.audio = styled('audio');\r\nstyled.b = styled('b');\r\nstyled.base = styled('base');\r\nstyled.bdi = styled('bdi');\r\nstyled.bdo = styled('bdo');\r\nstyled.blockquote = styled('blockquote');\r\nstyled.body = styled('body');\r\nstyled.br = styled('br');\r\nstyled.button = styled('button');\r\nstyled.canvas = styled('canvas');\r\nstyled.caption = styled('caption');\r\nstyled.cite = styled('cite');\r\nstyled.code = styled('code');\r\nstyled.col = styled('col');\r\nstyled.colgroup = styled('colgroup');\r\nstyled.data = styled('data');\r\nstyled.datalist = styled('datalist');\r\nstyled.dd = styled('dd');\r\nstyled.del = styled('del');\r\nstyled.details = styled('details');\r\nstyled.dfn = styled('dfn');\r\nstyled.dialog = styled('dialog');\r\nstyled.div = styled('div');\r\nstyled.dl = styled('dl');\r\nstyled.dt = styled('dt');\r\nstyled.em = styled('em');\r\nstyled.embed = styled('embed');\r\nstyled.fieldset = styled('fieldset');\r\nstyled.figcaption = styled('figcaption');\r\nstyled.figure = styled('figure');\r\nstyled.footer = styled('footer');\r\nstyled.form = styled('form');\r\nstyled.h1 = styled('h1');\r\nstyled.h2 = styled('h2');\r\nstyled.h3 = styled('h3');\r\nstyled.h4 = styled('h4');\r\nstyled.h5 = styled('h5');\r\nstyled.h6 = styled('h6');\r\nstyled.head = styled('head');\r\nstyled.header = styled('header');\r\nstyled.hgroup = styled('hgroup');\r\nstyled.hr = styled('hr');\r\nstyled.html = styled('html');\r\nstyled.i = styled('i');\r\nstyled.iframe = styled('iframe');\r\nstyled.img = styled('img');\r\nstyled.input = styled('input');\r\nstyled.ins = styled('ins');\r\nstyled.kbd = styled('kbd');\r\nstyled.label = styled('label');\r\nstyled.legend = styled('legend');\r\nstyled.li = styled('li');\r\nstyled.link = styled('link');\r\nstyled.main = styled('main');\r\nstyled.map = styled('map');\r\nstyled.mark = styled('mark');\r\nstyled.menu = styled('menu');\r\nstyled.meta = styled('meta');\r\nstyled.meter = styled('meter');\r\nstyled.nav = styled('nav');\r\nstyled.noscript = styled('noscript');\r\nstyled.object = styled('object');\r\nstyled.ol = styled('ol');\r\nstyled.optgroup = styled('optgroup');\r\nstyled.option = styled('option');\r\nstyled.output = styled('output');\r\nstyled.p = styled('p');\r\nstyled.param = styled('param');\r\nstyled.picture = styled('picture');\r\nstyled.pre = styled('pre');\r\nstyled.progress = styled('progress');\r\nstyled.q = styled('q');\r\nstyled.rp = styled('rp');\r\nstyled.rt = styled('rt');\r\nstyled.ruby = styled('ruby');\r\nstyled.s = styled('s');\r\nstyled.samp = styled('samp');\r\nstyled.script = styled('script');\r\nstyled.section = styled('section');\r\nstyled.select = styled('select');\r\nstyled.small = styled('small');\r\nstyled.source = styled('source');\r\nstyled.span = styled('span');\r\nstyled.strong = styled('strong');\r\nstyled.style = styled('style');\r\nstyled.sub = styled('sub');\r\nstyled.summary = styled('summary');\r\nstyled.sup = styled('sup');\r\nstyled.table = styled('table');\r\nstyled.tbody = styled('tbody');\r\nstyled.td = styled('td');\r\nstyled.template = styled('template');\r\nstyled.textarea = styled('textarea');\r\nstyled.tfoot = styled('tfoot');\r\nstyled.th = styled('th');\r\nstyled.thead = styled('thead');\r\nstyled.time = styled('time');\r\nstyled.title = styled('title');\r\nstyled.tr = styled('tr');\r\nstyled.track = styled('track');\r\nstyled.u = styled('u');\r\nstyled.ul = styled('ul');\r\nstyled.var = styled('var');\r\nstyled.video = styled('video');\r\nstyled.wbr = styled('wbr');\r\nstyled.svg = styled('svg');\r\nstyled.circle = styled('circle');\r\nstyled.clipPath = styled('clipPath');\r\nstyled.defs = styled('defs');\r\nstyled.desc = styled('desc');\r\nstyled.ellipse = styled('ellipse');\r\nstyled.feBlend = styled('feBlend');\r\nstyled.feColorMatrix = styled('feColorMatrix');\r\nstyled.feComponentTransfer = styled('feComponentTransfer');\r\nstyled.feComposite = styled('feComposite');\r\nstyled.feConvolveMatrix = styled('feConvolveMatrix');\r\nstyled.feDiffuseLighting = styled('feDiffuseLighting');\r\nstyled.feDisplacementMap = styled('feDisplacementMap');\r\nstyled.feDistantLight = styled('feDistantLight');\r\nstyled.feFlood = styled('feFlood');\r\nstyled.feFuncA = styled('feFuncA');\r\nstyled.feFuncB = styled('feFuncB');\r\nstyled.feFuncG = styled('feFuncG');\r\nstyled.feFuncR = styled('feFuncR');\r\nstyled.feGaussianBlur = styled('feGaussianBlur');\r\nstyled.feImage = styled('feImage');\r\nstyled.feMerge = styled('feMerge');\r\nstyled.feMergeNode = styled('feMergeNode');\r\nstyled.feMorphology = styled('feMorphology');\r\nstyled.feOffset = styled('feOffset');\r\nstyled.fePointLight = styled('fePointLight');\r\nstyled.feSpecularLighting = styled('feSpecularLighting');\r\nstyled.feSpotLight = styled('feSpotLight');\r\nstyled.feTile = styled('feTile');\r\nstyled.feTurbulence = styled('feTurbulence');\r\nstyled.filter = styled('filter');\r\nstyled.g = styled('g');\r\nstyled.image = styled('image');\r\nstyled.line = styled('line');\r\nstyled.linearGradient = styled('linearGradient');\r\nstyled.marker = styled('marker');\r\nstyled.mask = styled('mask');\r\nstyled.path = styled('path');\r\nstyled.pattern = styled('pattern');\r\nstyled.polygon = styled('polygon');\r\nstyled.polyline = styled('polyline');\r\nstyled.radialGradient = styled('radialGradient');\r\nstyled.rect = styled('rect');\r\nstyled.stop = styled('stop');\r\nstyled.switch = styled('switch');\r\nstyled.symbol = styled('symbol');\r\nstyled.text = styled('text');\r\nstyled.textPath = styled('textPath');\r\nstyled.tspan = styled('tspan');\r\nstyled.use = styled('use');\r\nstyled.view = styled('view');\r\n\r\nexport { setupGlobal, styled, css, inject, reuse, getTag, filterArgs, detectIsStyled };\r\n","import { type ElementKey, type TimerId, detectIsEmpty } from '@dark-engine/core';\r\n\r\nimport { type Controller, type StartFn } from '../controller';\r\nimport { type SpringValue } from '../shared';\r\n\r\nclass SharedState<T extends string = string> {\r\n  private ctrls: Array<Controller<T>> = [];\r\n  private stack = new Set<ElementKey>();\r\n  private flow = Flow.RIGHT;\r\n  private isTrail = false;\r\n  private isPaused = false;\r\n  private isCanceled = false;\r\n  private timeout = 0;\r\n  private timerId: TimerId = null;\r\n  private events = new Map<AnimationEventName, Set<AnimationEventHandler<T>>>();\r\n\r\n  getCtrls() {\r\n    return this.ctrls;\r\n  }\r\n\r\n  setCtrls(ctrls: Array<Controller<T>>) {\r\n    this.ctrls = ctrls;\r\n  }\r\n\r\n  setIsTrail(x: boolean) {\r\n    this.isTrail = x;\r\n  }\r\n\r\n  getIsTrail() {\r\n    return this.isTrail;\r\n  }\r\n\r\n  setFlow(x: Flow) {\r\n    this.flow = x;\r\n  }\r\n\r\n  getIsPaused() {\r\n    return this.isPaused;\r\n  }\r\n\r\n  getIsCanceled() {\r\n    return this.isCanceled;\r\n  }\r\n\r\n  detectIsRightFlow() {\r\n    return this.flow === Flow.RIGHT;\r\n  }\r\n\r\n  setIsPlaying(x: boolean, key: ElementKey) {\r\n    if (x) {\r\n      this.stack.add(key);\r\n    } else {\r\n      this.stack.delete(key);\r\n    }\r\n  }\r\n\r\n  detectIsPlaying(key?: ElementKey) {\r\n    return detectIsEmpty(key) ? this.stack.size > 0 : this.stack.has(key);\r\n  }\r\n\r\n  start(fn?: StartFn<T>) {\r\n    this.defer(() => {\r\n      if (this.ctrls.length === 0) return;\r\n      this.event('series-start');\r\n\r\n      if (this.isTrail) {\r\n        const ctrl = this.flow === Flow.RIGHT ? this.ctrls[0] : this.ctrls[this.ctrls.length - 1];\r\n\r\n        ctrl.start(fn);\r\n      } else {\r\n        this.ctrls.forEach(x => x.start(fn));\r\n      }\r\n    });\r\n  }\r\n\r\n  pause() {\r\n    this.isPaused = true;\r\n  }\r\n\r\n  resume() {\r\n    this.isPaused = false;\r\n  }\r\n\r\n  delay(timeout: number) {\r\n    this.timeout = timeout;\r\n  }\r\n\r\n  reset() {\r\n    this.ctrls.forEach(x => x.reset());\r\n  }\r\n\r\n  cancel() {\r\n    this.ctrls.forEach(x => x.cancel());\r\n    this.resetTimer();\r\n    this.isCanceled = true;\r\n  }\r\n\r\n  on(event: AnimationEventName, handler: AnimationEventHandler<T>) {\r\n    if (!this.events.has(event)) {\r\n      this.events.set(event, new Set());\r\n    }\r\n\r\n    const subs = this.events.get(event);\r\n\r\n    subs.add(handler);\r\n\r\n    return () => subs.delete(handler);\r\n  }\r\n\r\n  event(name: AnimationEventName, value: AnimationEventValue<T> = null) {\r\n    this.events.has(name) && this.events.get(name).forEach(x => x(value));\r\n  }\r\n\r\n  completeSeries() {\r\n    const isCompleted = !this.detectIsPlaying();\r\n\r\n    isCompleted && this.event('series-end');\r\n  }\r\n\r\n  defer(fn: () => void) {\r\n    this.resetTimer();\r\n\r\n    if (this.timeout > 0) {\r\n      this.timerId = setTimeout(() => {\r\n        this.timerId = null;\r\n        fn();\r\n      }, this.timeout);\r\n    } else {\r\n      fn();\r\n    }\r\n  }\r\n\r\n  private resetTimer() {\r\n    this.timerId && clearTimeout(this.timerId);\r\n    this.timerId = null;\r\n  }\r\n}\r\n\r\nexport enum Flow {\r\n  RIGHT = 'RIGHT',\r\n  LEFT = 'LEFT',\r\n}\r\n\r\nlet sharedState: SharedState = null;\r\n\r\nfunction setSharedState(state: SharedState) {\r\n  sharedState = state;\r\n}\r\n\r\nfunction getSharedState() {\r\n  const state = sharedState;\r\n\r\n  sharedState = null;\r\n\r\n  return state;\r\n}\r\n\r\nexport type AnimationEventName = 'series-start' | 'item-start' | 'item-change' | 'item-end' | 'series-end';\r\n\r\nexport type AnimationEventValue<T extends string = string> = {\r\n  value: SpringValue<T>;\r\n  idx: number;\r\n  key: ElementKey;\r\n};\r\n\r\nexport type AnimationEventHandler<T extends string = string> = (value?: AnimationEventValue<T>) => void;\r\n\r\nexport { SharedState, setSharedState, getSharedState };\r\n","import { preset } from '../preset';\r\n\r\nexport type SpringValue<T extends string = string> = Record<T, number>;\r\n\r\nexport type SpringConfig = {\r\n  mass: number;\r\n  tension: number;\r\n  friction: number;\r\n  precision: number;\r\n  fix: number;\r\n};\r\n\r\nconst defaultSpringConfig: SpringConfig = {\r\n  ...preset('no-wobble'),\r\n  mass: 1,\r\n  precision: 3,\r\n  fix: 4,\r\n};\r\n\r\nexport { defaultSpringConfig };\r\n","import { type SpringConfig } from '../shared';\r\n\r\ntype Preset = Pick<SpringConfig, 'tension' | 'friction'>;\r\ntype PresetName = 'no-wobble' | 'gentle' | 'wobbly' | 'stiff';\r\n\r\nconst presets: Record<PresetName, Preset> = {\r\n  'no-wobble': { tension: 170, friction: 26 },\r\n  gentle: { tension: 120, friction: 14 },\r\n  wobbly: { tension: 180, friction: 12 },\r\n  stiff: { tension: 210, friction: 20 },\r\n};\r\n\r\nfunction preset(name: PresetName): Preset {\r\n  return presets[name] || ({} as Preset);\r\n}\r\n\r\nexport { preset };\r\n","import { detectIsFunction, detectIsEmpty, detectAreDepsDifferent, trueFn, error } from '../utils';\r\nimport { useLayoutEffect } from '../use-layout-effect';\r\nimport { type SubscriberWithValue } from '../shared';\r\nimport { ATOM_HOST_MASK } from '../constants';\r\nimport { $$scope, getRootId } from '../scope';\r\nimport { createUpdate } from '../workloop';\r\nimport { useUpdate } from '../use-update';\r\nimport { EventEmitter } from '../emitter';\r\nimport { scheduler } from '../scheduler';\r\nimport { useMemo } from '../use-memo';\r\nimport { type Hook } from '../fiber';\r\nimport { batch } from '../batch';\r\n\r\nclass Atom<T = unknown> {\r\n  private value: T;\r\n  private connections1: Map<Hook, Tuple<T>>;\r\n  private connections2: Map<T, Tuple<T>>;\r\n  private subjects: Set<ReadableAtom>;\r\n  private emitter: EventEmitter<'data', EmitterValue<T>>;\r\n\r\n  constructor(value: T) {\r\n    this.value = value;\r\n  }\r\n\r\n  val(fn?: ShouldUpdate<T>, key?: T) {\r\n    try {\r\n      this.__connect(fn, key);\r\n    } catch (err) {\r\n      if (process.env.NODE_ENV !== 'production') {\r\n        error('[Dark]: Illegal invocation atom.val() outside render process!');\r\n      }\r\n    }\r\n\r\n    return this.value;\r\n  }\r\n\r\n  get() {\r\n    return this.value;\r\n  }\r\n\r\n  on(fn: SubscriberWithValue<EmitterValue<T>>) {\r\n    !this.emitter && (this.emitter = new EventEmitter());\r\n\r\n    return this.emitter.on('data', fn);\r\n  }\r\n\r\n  kill() {\r\n    if (this.connections1) {\r\n      for (const [hook, [_, __, ___, key]] of this.connections1) {\r\n        this.off(hook, key);\r\n      }\r\n    }\r\n\r\n    if (this.connections2) {\r\n      for (const [key, [_, hook]] of this.connections2) {\r\n        this.off(hook, key);\r\n      }\r\n    }\r\n\r\n    this.connections1 = null;\r\n    this.connections2 = null;\r\n    this.emitter = null;\r\n    this.subjects = null;\r\n  }\r\n\r\n  toString() {\r\n    return String(this.value);\r\n  }\r\n\r\n  toJSON() {\r\n    return this.value;\r\n  }\r\n\r\n  valueOf() {\r\n    return this.value;\r\n  }\r\n\r\n  __connect(fn: ShouldUpdate<T>, key: T) {\r\n    const rootId = getRootId();\r\n    const fiber = $$scope().getCursorFiber();\r\n    const { hook } = fiber;\r\n    const disconnect = () => this.off(hook, key);\r\n\r\n    !fiber.atoms && (fiber.atoms = new Map());\r\n    fiber.atoms.set(this, disconnect);\r\n    fiber.markHost(ATOM_HOST_MASK);\r\n\r\n    if (detectIsEmpty(key)) {\r\n      !this.connections1 && (this.connections1 = new Map());\r\n      this.connections1.set(hook, [rootId, hook, fn, key]);\r\n    } else {\r\n      !this.connections2 && (this.connections2 = new Map());\r\n      this.connections2.set(key, [rootId, hook, fn, key]);\r\n    }\r\n\r\n    return disconnect;\r\n  }\r\n\r\n  __addSubject(atom$: ReadableAtom) {\r\n    !this.subjects && (this.subjects = new Set());\r\n    this.subjects.add(atom$);\r\n  }\r\n\r\n  __removeSubject(atom$: ReadableAtom) {\r\n    return this.subjects && this.subjects.delete(atom$);\r\n  }\r\n\r\n  __getSize() {\r\n    const size1 = this.connections1 ? this.connections1.size : 0;\r\n    const size2 = this.connections2 ? this.connections2.size : 0;\r\n    const size3 = this.subjects ? this.subjects.size : 0;\r\n    const size4 = this.emitter ? this.emitter.__getSize() : 0;\r\n\r\n    return size1 + size2 + size3 + size4;\r\n  }\r\n\r\n  protected setValue(value: T | ((prevValue: T) => T)) {\r\n    const prev = this.value;\r\n    const next = detectIsFunction(value) ? value(this.value) : value;\r\n    const data: EmitterValue<T> = { prev, next };\r\n    const make = (tuple: Tuple<T>, prev: T, next: T) => {\r\n      const [rootId, hook, shouldUpdate, key] = tuple;\r\n      const fn = shouldUpdate || trueFn;\r\n\r\n      fn(prev, next, key) && scheduler.schedule(createUpdate({ rootId, hook }));\r\n    };\r\n\r\n    this.value = next;\r\n\r\n    if (this.connections1) {\r\n      for (const [_, tuple] of this.connections1) {\r\n        make(tuple, prev, next);\r\n      }\r\n    }\r\n\r\n    if (this.connections2) {\r\n      if (this.connections2.has(next)) {\r\n        make(this.connections2.get(next), prev, next);\r\n        this.connections2.has(prev) && make(this.connections2.get(prev), prev, next);\r\n      }\r\n    }\r\n\r\n    this.emitter && this.emitter.emit('data', data);\r\n    this.subjects && this.subjects.forEach(x => x.__notify());\r\n  }\r\n\r\n  private off(hook: Hook, key: T) {\r\n    hook.owner.atoms.delete(this);\r\n    this.connections1 && this.connections1.delete(hook);\r\n    this.connections2 && this.connections2.delete(key);\r\n  }\r\n}\r\n\r\nclass WritableAtom<T = unknown> extends Atom<T> {\r\n  set(value: T | ((prevValue: T) => T)) {\r\n    super.setValue(value);\r\n  }\r\n}\r\n\r\nclass ReadableAtom<T = unknown> extends Atom<T> {\r\n  private deps$: Array<Atom> = [];\r\n  private fn: ComputedFn<T> = null;\r\n  private values: Array<unknown> = [];\r\n\r\n  constructor(deps$: Array<Atom>, fn: ComputedFn<T>) {\r\n    const values = ReadableAtom.values(deps$);\r\n\r\n    super(ReadableAtom.compute(fn, values));\r\n    this.deps$ = deps$;\r\n    this.fn = fn;\r\n    this.values = values;\r\n    deps$.forEach(x => x.__addSubject(this));\r\n  }\r\n\r\n  __notify() {\r\n    const values = ReadableAtom.values(this.deps$);\r\n\r\n    if (detectAreDepsDifferent(this.values, values)) {\r\n      super.setValue(ReadableAtom.compute(this.fn, values));\r\n    }\r\n\r\n    this.values = values;\r\n  }\r\n\r\n  override kill() {\r\n    super.kill();\r\n    this.deps$.forEach(x => x.__removeSubject(this));\r\n    this.deps$ = [];\r\n    this.fn = null;\r\n  }\r\n\r\n  private static compute(fn: Function, values: Array<unknown>) {\r\n    return fn(...values);\r\n  }\r\n\r\n  private static values(deps$: Array<Atom>) {\r\n    return deps$.map(x => x.get());\r\n  }\r\n}\r\n\r\nconst detectIsAtom = (x: unknown): x is Atom => x instanceof Atom;\r\n\r\nconst detectIsWritableAtom = (x: unknown): x is WritableAtom => x instanceof WritableAtom;\r\n\r\nconst detectIsReadableAtom = (x: unknown): x is ReadableAtom => x instanceof ReadableAtom;\r\n\r\nconst atom = <T>(value?: T) => new WritableAtom(value);\r\n\r\nconst computed = <T, A, B, C, D, E, F, G, H, I, J, K, L, M, N>(\r\n  deps$: [\r\n    Atom<A>,\r\n    Atom<B>?,\r\n    Atom<C>?,\r\n    Atom<D>?,\r\n    Atom<E>?,\r\n    Atom<F>?,\r\n    Atom<G>?,\r\n    Atom<H>?,\r\n    Atom<I>?,\r\n    Atom<J>?,\r\n    Atom<K>?,\r\n    Atom<L>?,\r\n    Atom<M>?,\r\n    Atom<N>?,\r\n  ],\r\n  fn: ComputedFn<T, A, B, C, D, E, F, G, H, I, J, K, L, M, N>,\r\n) => new ReadableAtom(deps$, fn) as ReadableAtom<ReturnType<typeof fn>>;\r\n\r\nfunction useAtom<T>(value?: T): WritableAtom<T> {\r\n  const atom$ = useMemo(() => atom<T>(value), []);\r\n\r\n  useLayoutEffect(() => () => atom$.kill(), []);\r\n\r\n  return atom$;\r\n}\r\n\r\nfunction useComputed<T, A, B, C, D, E, F, G, H, I, J, K, L, M, N>(\r\n  deps$: [\r\n    Atom<A>,\r\n    Atom<B>?,\r\n    Atom<C>?,\r\n    Atom<D>?,\r\n    Atom<E>?,\r\n    Atom<F>?,\r\n    Atom<G>?,\r\n    Atom<H>?,\r\n    Atom<I>?,\r\n    Atom<J>?,\r\n    Atom<K>?,\r\n    Atom<L>?,\r\n    Atom<M>?,\r\n    Atom<N>?,\r\n  ],\r\n  fn: ComputedFn<T, A, B, C, D, E, F, G, H, I, J, K, L, M, N>,\r\n) {\r\n  const atom$ = useMemo(() => computed(deps$, fn), []);\r\n\r\n  useLayoutEffect(() => () => atom$.kill(), []);\r\n\r\n  return atom$;\r\n}\r\n\r\nfunction useStore<A, B, C, D, E, F, G, H, I, J, K, L, M, N>(\r\n  atoms$: [\r\n    Atom<A>,\r\n    Atom<B>?,\r\n    Atom<C>?,\r\n    Atom<D>?,\r\n    Atom<E>?,\r\n    Atom<F>?,\r\n    Atom<G>?,\r\n    Atom<H>?,\r\n    Atom<I>?,\r\n    Atom<J>?,\r\n    Atom<K>?,\r\n    Atom<L>?,\r\n    Atom<M>?,\r\n    Atom<N>?,\r\n  ],\r\n) {\r\n  const forceUpdate = useUpdate();\r\n  const update = () => batch(forceUpdate);\r\n\r\n  useLayoutEffect(() => {\r\n    const offs = atoms$.map(x => x.on(update));\r\n\r\n    return () => offs.forEach(x => x());\r\n  }, [...atoms$]);\r\n\r\n  return atoms$.map(x => x.get()) as [A, B, C, D, E, F, G, H, I, J, K, L, M, N];\r\n}\r\n\r\ntype ShouldUpdate<T> = (p: T, n: T, key?: T) => boolean;\r\ntype EmitterValue<T> = { prev: T; next: T };\r\ntype Tuple<T> = [number, Hook, ShouldUpdate<T>, T];\r\ntype ComputedFn<\r\n  T,\r\n  A = unknown,\r\n  B = unknown,\r\n  C = unknown,\r\n  D = unknown,\r\n  E = unknown,\r\n  F = unknown,\r\n  G = unknown,\r\n  H = unknown,\r\n  I = unknown,\r\n  J = unknown,\r\n  K = unknown,\r\n  L = unknown,\r\n  M = unknown,\r\n  N = unknown,\r\n> = (a: A, b?: B, c?: C, d?: D, e?: E, f?: F, g?: G, h?: H, i?: I, j?: J, k?: K, l?: L, m?: M, n?: N) => T;\r\n\r\nexport {\r\n  type Atom,\r\n  WritableAtom,\r\n  ReadableAtom,\r\n  detectIsAtom,\r\n  detectIsWritableAtom,\r\n  detectIsReadableAtom,\r\n  atom,\r\n  computed,\r\n  useAtom,\r\n  useComputed,\r\n  useStore,\r\n};\r\n","import { type WritableAtom, type SubscriberWithValue, atom } from '@dark-engine/core';\r\n\r\nimport { type SpringValue } from '../shared';\r\n\r\nclass Spring<T extends string = string> {\r\n  private props: Record<T, WritableAtom<number>> = {} as Record<T, WritableAtom<number>>;\r\n  private subscribers = new Set<SubscriberWithValue<SpringValue<T>>>();\r\n\r\n  prop(key: T) {\r\n    return this.props[key] ? this.props[key].get() : null;\r\n  }\r\n\r\n  prop$(key: T) {\r\n    return this.props[key] || null;\r\n  }\r\n\r\n  setProp(key: T, value: number) {\r\n    !this.props[key] && (this.props[key] = atom(value));\r\n    this.props[key].set(value);\r\n  }\r\n\r\n  value(): SpringValue<T> {\r\n    const value = Object.keys(this.props).reduce((acc, x) => ((acc[x] = this.props[x].get()), acc), {});\r\n\r\n    return value as SpringValue<T>;\r\n  }\r\n\r\n  on(fn: SubscriberWithValue<SpringValue<T>>) {\r\n    this.subscribers.add(fn);\r\n\r\n    return () => this.subscribers.delete(fn);\r\n  }\r\n\r\n  notify() {\r\n    this.subscribers.forEach(x => x(this.value()));\r\n  }\r\n}\r\n\r\nexport { Spring };\r\n","const time = () => performance.now();\r\n\r\nconst fix = (x: number, precision = 4) => Number(x.toFixed(precision));\r\n\r\nconst illegal = (value: string) => {\r\n  throw new Error(value);\r\n};\r\n\r\nconst range = (x: number) =>\r\n  Array(x)\r\n    .fill(null)\r\n    .map((_, idx) => idx);\r\n\r\nconst uniq = <T>(items: Array<T>, selector: (x: T) => unknown) => {\r\n  const arr: Array<T> = [];\r\n  const set = new Set();\r\n\r\n  for (const item of items) {\r\n    const key = selector(item);\r\n\r\n    !set.has(key) && arr.push(item);\r\n    set.add(key);\r\n  }\r\n\r\n  return arr;\r\n};\r\n\r\nexport { time, fix, illegal, range, uniq };\r\n","import { type SpringConfig } from '../shared';\r\n\r\nfunction stepper(pos: number, vel: number, dest: number, step: number, config: Omit<SpringConfig, 'fix'>) {\r\n  const { tension, friction, mass, precision } = config;\r\n  const [nPos, nVel] = spring(pos, vel, dest, step, tension, friction, mass);\r\n\r\n  if (Math.abs(nPos - dest) < 10 ** (-1 * precision)) return [dest, 0];\r\n\r\n  return [nPos, nVel];\r\n}\r\n\r\nfunction spring(pos: number, vel: number, dest: number, step: number, tension: number, friction: number, mass: number) {\r\n  const disp = pos - dest;\r\n  const sf = -1 * tension * disp;\r\n  const df = -1 * friction * vel;\r\n  const a = (sf + df) / mass;\r\n  const nVel = vel + a * step;\r\n  const nPos = pos + nVel * step;\r\n\r\n  return [nPos, nVel];\r\n}\r\n\r\nexport { stepper };\r\n","import { type ElementKey, platform, falseFn, detectIsUndefined } from '@dark-engine/core';\r\n\r\nimport { type SpringValue, type SpringConfig, defaultSpringConfig } from '../shared';\r\nimport { type AnimationEventName, SharedState } from '../state';\r\nimport { Spring } from '../spring';\r\nimport { time, fix } from '../utils';\r\nimport { stepper } from '../stepper';\r\n\r\nconst BASE_FRAME_TIME_IN_MS = 1000 / 60;\r\nconst MAX_SKIPPED_FRAMES = 10;\r\nconst MAX_DELTA_TIME_IN_SEC = MAX_SKIPPED_FRAMES * (BASE_FRAME_TIME_IN_MS / 1000);\r\nconst MIN_STEP = 0.01;\r\n\r\nclass Controller<T extends string, I = unknown> {\r\n  private key: ElementKey;\r\n  private idx: number;\r\n  private from: SpringValue<T>;\r\n  private to: SpringValue<T>;\r\n  private value: SpringValue<T>;\r\n  private dest: SpringValue<T>;\r\n  private state: SharedState = null;\r\n  private frameTime: number;\r\n  private frameId: number;\r\n  private results: Record<string, [number, number]> = {};\r\n  private completed: Record<string, boolean> = {};\r\n  private queue: Array<SpringValue<T>> = [];\r\n  private left: Controller<T> = null;\r\n  private right: Controller<T> = null;\r\n  private springConfigFn: SpringConfigFn<T>;\r\n  private configurator: ConfiguratorFn<T>;\r\n  private immediate: ImmediateFn<T> = falseFn;\r\n  private immediates: Array<() => void> = [];\r\n  private primaryKey: ElementKey;\r\n  private isReplaced = false;\r\n  private item: I = null;\r\n  private spring = new Spring<T>();\r\n\r\n  constructor(state: SharedState) {\r\n    this.state = state;\r\n    this.key = String(++Controller.key);\r\n  }\r\n\r\n  getKey() {\r\n    return this.key;\r\n  }\r\n\r\n  setKey(x: ElementKey) {\r\n    this.key = x;\r\n  }\r\n\r\n  getIdx() {\r\n    return this.idx;\r\n  }\r\n\r\n  setIdx(x: number) {\r\n    this.idx = x;\r\n  }\r\n\r\n  setFrom(x: SpringValue<T>) {\r\n    this.from = x;\r\n    this.value = this.value || { ...x };\r\n  }\r\n\r\n  setTo(x: SpringValue<T>) {\r\n    this.to = x || { ...this.from };\r\n    this.dest = this.dest || { ...(x || this.from) };\r\n  }\r\n\r\n  setSpringConfigFn(fn?: PatialConfigFn<T>) {\r\n    this.springConfigFn = fn ? (key: T) => ({ ...defaultSpringConfig, ...fn(key) }) : () => defaultSpringConfig;\r\n  }\r\n\r\n  setLeft(x: Controller<T>) {\r\n    this.left = x;\r\n  }\r\n\r\n  setRight(x: Controller<T>) {\r\n    this.right = x;\r\n  }\r\n\r\n  notify() {\r\n    this.sync();\r\n    this.event('item-change');\r\n  }\r\n\r\n  setConfigurator(fn: ConfiguratorFn<T>) {\r\n    this.configurator = fn;\r\n  }\r\n\r\n  setImmediate(fn: ImmediateFn<T>) {\r\n    this.immediate = fn || this.immediate;\r\n  }\r\n\r\n  replaceValue(x: SpringValue<T>) {\r\n    this.value = x;\r\n    this.sync();\r\n  }\r\n\r\n  markAsFake(x: ElementKey) {\r\n    this.primaryKey = x;\r\n\r\n    return Controller.generateFakeKey(x);\r\n  }\r\n\r\n  detectIsFake() {\r\n    return !detectIsUndefined(this.primaryKey);\r\n  }\r\n\r\n  getIsReplaced() {\r\n    return this.isReplaced;\r\n  }\r\n\r\n  setIsReplaced(x: boolean) {\r\n    this.isReplaced = x;\r\n  }\r\n\r\n  getItem() {\r\n    return this.item;\r\n  }\r\n\r\n  setItem(x: I) {\r\n    this.item = x;\r\n  }\r\n\r\n  getState() {\r\n    return this.state;\r\n  }\r\n\r\n  getSpring() {\r\n    this.sync();\r\n\r\n    return this.spring;\r\n  }\r\n\r\n  start(fn?: StartFn<T>) {\r\n    if (this.state.getIsCanceled()) return; // !\r\n    const config1 = this.configurator(this.idx);\r\n    const config2 = fn ? fn(this.idx) : this.configurator(this.idx);\r\n    const from = { ...config1.from, ...config2.from };\r\n    const to = { ...config1.to, ...config2.to };\r\n    const config = config2.config || config1.config;\r\n    const immediate = config2.immediate || config1.immediate;\r\n\r\n    this.setFrom(config1.from || from);\r\n    this.setTo(config1.to || to);\r\n    this.setSpringConfigFn(config);\r\n    this.setImmediate(immediate);\r\n    Object.assign(this.dest, to);\r\n\r\n    this.play(this.dest);\r\n  }\r\n\r\n  reset() {\r\n    this.value = { ...this.from };\r\n    this.dest = { ...(this.to || this.from) };\r\n    this.sync();\r\n  }\r\n\r\n  cancel() {\r\n    this.frameId && platform.caf(this.frameId);\r\n    this.frameId = null;\r\n  }\r\n\r\n  setIsPlaying(x: boolean) {\r\n    this.state.setIsPlaying(x, this.key);\r\n  }\r\n\r\n  private play(to: SpringValue<T>) {\r\n    this.queue.push(to);\r\n    if (this.frameId) return false;\r\n    this.setIsPlaying(true);\r\n    this.event('item-start');\r\n    this.motion(to);\r\n  }\r\n\r\n  private motion(to: SpringValue<T>) {\r\n    const { value, results, completed, springConfigFn } = this;\r\n    const keys = Object.keys(value) as Array<T>;\r\n    const make = () => this.motion(to);\r\n\r\n    this.frameTime = time();\r\n    this.frameId = platform.raf(() => {\r\n      if (this.state.getIsPaused()) return make();\r\n      let step = (time() - this.frameTime) / 1000;\r\n\r\n      if (step > MAX_DELTA_TIME_IN_SEC) {\r\n        step = MIN_STEP;\r\n      }\r\n\r\n      if (this.queue.length === 0) {\r\n        this.queue.push(this.dest);\r\n      }\r\n\r\n      for (const key of keys) {\r\n        if (this.immediate(key)) {\r\n          completed[key] = true;\r\n\r\n          const complete = () => {\r\n            value[key] = to[key];\r\n            results[key] = [to[key], 0];\r\n          };\r\n\r\n          if (to[key] === this.from[key]) {\r\n            this.immediates.push(complete);\r\n          } else {\r\n            complete();\r\n          }\r\n        } else {\r\n          if (!results[key]) {\r\n            results[key] = [value[key], 0];\r\n          }\r\n\r\n          const config = springConfigFn(key);\r\n          let pos = results[key][0];\r\n          let vel = results[key][1];\r\n\r\n          for (const update of this.queue) {\r\n            const dest = update[key] as number;\r\n\r\n            [pos, vel] = stepper(pos, vel, dest, step, config);\r\n            results[key] = [pos, vel];\r\n            completed[key] = pos === dest;\r\n          }\r\n\r\n          value[key] = pos;\r\n        }\r\n      }\r\n\r\n      this.queue = [];\r\n      this.change();\r\n\r\n      if (this.checkCompleted(keys)) {\r\n        this.complete();\r\n      } else {\r\n        make();\r\n      }\r\n    });\r\n  }\r\n\r\n  private event(name: AnimationEventName) {\r\n    this.state.event(name, { value: this.value, idx: this.idx, key: this.key });\r\n  }\r\n\r\n  private change() {\r\n    this.notify();\r\n\r\n    if (this.state.getIsTrail()) {\r\n      if (this.state.detectIsRightFlow()) {\r\n        this.right && this.right.start(() => ({ to: this.value }));\r\n      } else {\r\n        this.left && this.left.start(() => ({ to: this.value }));\r\n      }\r\n    }\r\n  }\r\n\r\n  private complete() {\r\n    this.setIsPlaying(false);\r\n    this.frameTime = null;\r\n    this.frameId = null;\r\n    this.results = {};\r\n    this.completed = {};\r\n    this.immediates.forEach(x => x());\r\n    this.immediates.length > 0 && this.notify();\r\n    this.immediates = [];\r\n    this.event('item-end');\r\n    this.state.completeSeries();\r\n  }\r\n\r\n  private checkCompleted(keys: Array<string>) {\r\n    for (const key of keys) {\r\n      if (!this.completed[key]) return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  private sync() {\r\n    const keys = Object.keys(this.value) as Array<T>;\r\n\r\n    for (const key of keys) {\r\n      const config = this.springConfigFn(key);\r\n      const value = fix(this.value[key], config.fix);\r\n\r\n      this.spring.setProp(key, value);\r\n    }\r\n\r\n    this.spring.notify();\r\n  }\r\n\r\n  private static generateFakeKey(x: ElementKey) {\r\n    return `__${x}:${++Controller.fakeKey}__`;\r\n  }\r\n\r\n  private static key = -1;\r\n  private static fakeKey = -1;\r\n}\r\n\r\nexport type BaseItemConfig<T extends string> = {\r\n  from: SpringValue<T>;\r\n  to?: SpringValue<T>;\r\n  config?: PatialConfigFn<T>;\r\n  immediate?: ImmediateFn<T>;\r\n};\r\n\r\nexport type StartFnConfig<T extends string> = {\r\n  from?: SpringValue<T>;\r\n  to: Partial<SpringValue<T>>;\r\n} & Omit<BaseItemConfig<T>, 'from' | 'to'>;\r\n\r\nexport type ConfiguratorFn<T extends string> = (idx: number) => BaseItemConfig<T>;\r\n\r\nexport type StartFn<T extends string> = (idx: number) => StartFnConfig<T>;\r\n\r\nexport type SpringConfigFn<T extends string> = (key: T) => SpringConfig;\r\n\r\nexport type PatialConfigFn<T extends string> = (key: T) => Partial<SpringConfig>;\r\n\r\nexport type ImmediateFn<T extends string> = (key: T) => boolean;\r\n\r\nexport type NotifierFn<T extends string> = (x: SpringValue<T>) => void;\r\n\r\nexport { Controller };\r\n","import {\r\n  type Component,\r\n  type TagVirtualNodeFactory,\r\n  type Callback,\r\n  type ElementKey,\r\n  Fragment,\r\n  batch,\r\n  useMemo,\r\n  useUpdate,\r\n  useEffect,\r\n  useLayoutEffect,\r\n  detectIsArray,\r\n  detectIsNumber,\r\n} from '@dark-engine/core';\r\n\r\nimport { type SpringValue } from '../shared';\r\nimport { type AnimationEventValue, SharedState } from '../state';\r\nimport { type BaseItemConfig, type ConfiguratorFn, Controller } from '../controller';\r\nimport { type SpringApi } from '../use-springs';\r\nimport { type Spring } from '../spring';\r\nimport { uniq } from '../utils';\r\n\r\nexport type TransitionItemConfig<T extends string> = {\r\n  from: SpringValue<T>;\r\n  enter: SpringValue<T>;\r\n  leave?: SpringValue<T>;\r\n  update?: SpringValue<T>;\r\n  trail?: number;\r\n} & Pick<BaseItemConfig<T>, 'config' | 'immediate'>;\r\n\r\nfunction useTransition<T extends string, I = unknown>(\r\n  items: Array<I>,\r\n  getKey: KeyExtractor<I>,\r\n  configurator: TransitionConfiguratorFn<T, I>,\r\n): [TransitionFn<T, I>, TransitionApi<T>] {\r\n  const forceUpdate = useUpdate();\r\n  const update = () => batch(forceUpdate);\r\n  const state = useMemo(() => new SharedState<T>(), []);\r\n  const scope = useMemo<Scope<T, I>>(\r\n    () => ({\r\n      ctrlsMap: new Map(),\r\n      itemsMap: new Map(),\r\n      fakesMap: new Map(),\r\n      items: [],\r\n      queue: [],\r\n      hasReplaces: false,\r\n      fromApi: false,\r\n      inChain: false,\r\n      pending: null,\r\n      configurator,\r\n    }),\r\n    [],\r\n  );\r\n\r\n  scope.configurator = configurator;\r\n\r\n  useMemo(() => setup({ items, getKey, configurator, state, ctrlsMap: scope.ctrlsMap }), []);\r\n\r\n  const transition = useMemo<TransitionFn<T, I>>(\r\n    () => (render: TransitionRenderFn<T, I>) => {\r\n      const { ctrlsMap } = scope;\r\n      const elements: Array<TransitionElement> = [];\r\n\r\n      for (const [key, ctrl] of ctrlsMap) {\r\n        const idx = ctrl.getIdx();\r\n        const item = ctrl.getItem();\r\n        const spring = ctrl.getSpring();\r\n        const element = Fragment({ key, slot: render({ spring, item, idx }) });\r\n\r\n        if (elements[idx]) {\r\n          const sibling = elements[idx];\r\n\r\n          if (detectIsArray(sibling)) {\r\n            sibling.push(element);\r\n          } else {\r\n            elements[idx] = [sibling, element] as unknown as TransitionElement;\r\n          }\r\n        } else {\r\n          elements[idx] = element;\r\n        }\r\n      }\r\n\r\n      return Fragment({ slot: elements });\r\n    },\r\n    [],\r\n  );\r\n\r\n  const api = useMemo<TransitionApi<T>>(() => {\r\n    return {\r\n      start: fn => {\r\n        scope.fromApi = true;\r\n\r\n        if (scope.inChain) {\r\n          scope.pending && scope.pending();\r\n          scope.pending = null;\r\n        } else {\r\n          state.start(fn);\r\n        }\r\n      },\r\n      chain: (value: boolean) => (scope.inChain = value),\r\n      delay: state.delay.bind(state),\r\n      cancel: state.cancel.bind(state),\r\n      pause: state.pause.bind(state),\r\n      resume: state.resume.bind(state),\r\n      on: state.on.bind(state),\r\n      isCanceled: state.getIsCanceled.bind(state),\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const { inChain } = scope;\r\n    const nextItems = uniq(items, getKey);\r\n    const start = (items: Array<I>) => {\r\n      const { ctrlsMap, fakesMap, items: $items } = scope;\r\n      const configurator: TransitionConfiguratorFn<T, I> = (idx, item) => scope.configurator(idx, item);\r\n      const { ctrls, itemsMap } = setup({ items, getKey, configurator, state, ctrlsMap });\r\n      const { hasChanges, insMap, remMap, movMap, stabMap, replaced } = diff($items, items, getKey);\r\n\r\n      scope.hasReplaces = replaced.size > 0;\r\n      state.setCtrls(ctrls);\r\n      replaced.forEach(key => ctrlsMap.get(key).setIsReplaced(true));\r\n\r\n      state.event('series-start');\r\n      animate({ action: Action.LEAVE, space: fakesMap, state, scope }); // !\r\n      animate({ action: Action.ENTER, space: insMap, state, scope });\r\n      animate({ action: Action.LEAVE, space: remMap, state, scope });\r\n      animate({ action: Action.UPDATE, space: movMap, state, scope });\r\n      animate({ action: Action.UPDATE, space: stabMap, state, scope });\r\n\r\n      scope.items = items; // !\r\n      scope.itemsMap = itemsMap;\r\n      scope.fromApi = false;\r\n      hasChanges && forceUpdate(); // !\r\n    };\r\n\r\n    if (inChain) {\r\n      scope.pending = () => state.defer(() => start(nextItems));\r\n    } else {\r\n      start(nextItems);\r\n    }\r\n  }, [items]);\r\n\r\n  useLayoutEffect(() => {\r\n    const offs: Array<Callback> = [];\r\n\r\n    offs.push(\r\n      api.on('item-end', e => handleItemEnd(e, scope)),\r\n      api.on('series-end', () => handleSeriesEnd(update, state, scope)),\r\n    );\r\n\r\n    return () => offs.forEach(x => x());\r\n  }, []);\r\n\r\n  useLayoutEffect(() => () => api.cancel(), []);\r\n\r\n  return [transition, api];\r\n}\r\n\r\ntype SetupOptions<T extends string, I = unknown> = {\r\n  items: Array<I>;\r\n  getKey: KeyExtractor<I>;\r\n  state: SharedState<T>;\r\n} & Pick<Scope<T, I>, 'configurator' | 'ctrlsMap'>;\r\n\r\nfunction setup<T extends string, I = unknown>(options: SetupOptions<T, I>) {\r\n  const { items, getKey, configurator, state, ctrlsMap } = options;\r\n  const itemsMap = new Map<ElementKey, I>();\r\n  const ctrls = items.map((item, idx) => {\r\n    const key = getKey(item);\r\n\r\n    itemsMap.set(key, item);\r\n\r\n    return getController<T, I>({ idx, item, getKey, configurator, state, ctrlsMap });\r\n  });\r\n\r\n  return { ctrls, itemsMap };\r\n}\r\n\r\ntype GetControllerOptions<T extends string, I = unknown> = {\r\n  idx: number;\r\n  item: I;\r\n} & Pick<SetupOptions<T, I>, 'getKey' | 'configurator' | 'state' | 'ctrlsMap'>;\r\n\r\nfunction getController<T extends string, I = unknown>(options: GetControllerOptions<T, I>) {\r\n  const { idx, item, getKey, configurator, state, ctrlsMap } = options;\r\n  const key = getKey(item);\r\n  const ctrl = ctrlsMap.get(key) || new Controller<T, I>(state);\r\n\r\n  prepare({ ctrl, key, idx, item, configurator });\r\n  ctrlsMap.set(key, ctrl);\r\n\r\n  return ctrl;\r\n}\r\n\r\nfunction extractKeys<I = unknown>(prevItems: Array<I>, nextItems: Array<I>, getKey: KeyExtractor<I>) {\r\n  const prevKeys: Array<ElementKey> = [];\r\n  const nextKeys: Array<ElementKey> = [];\r\n  const prevKeysMap: Record<ElementKey, boolean> = {};\r\n  const nextKeysMap: Record<ElementKey, boolean> = {};\r\n  const max = Math.max(prevItems.length, nextItems.length);\r\n\r\n  for (let i = 0; i < max; i++) {\r\n    const prevItem = prevItems[i];\r\n    const nextItem = nextItems[i];\r\n\r\n    if (prevItem) {\r\n      const prevKey = getKey(prevItem);\r\n\r\n      if (!prevKeysMap[prevKey]) {\r\n        prevKeysMap[prevKey] = true;\r\n        prevKeys.push(prevKey);\r\n      }\r\n    }\r\n\r\n    if (nextItem) {\r\n      const nextKey = getKey(nextItem);\r\n\r\n      if (!nextKeysMap[nextKey]) {\r\n        nextKeysMap[nextKey] = true;\r\n        nextKeys.push(nextKey);\r\n      }\r\n    }\r\n  }\r\n\r\n  return {\r\n    prevKeys,\r\n    nextKeys,\r\n    prevKeysMap,\r\n    nextKeysMap,\r\n  };\r\n}\r\n\r\nfunction diff<I = unknown>(prevItems: Array<I>, nextItems: Array<I>, getKey: KeyExtractor<I>) {\r\n  const { prevKeys, nextKeys, prevKeysMap, nextKeysMap } = extractKeys(prevItems, nextItems, getKey);\r\n  let size = Math.max(prevKeys.length, nextKeys.length);\r\n  let p = 0;\r\n  let n = 0;\r\n  let hasChanges = false;\r\n  const insMap = new Map<ElementKey, number>();\r\n  const remMap = new Map<ElementKey, number>();\r\n  const movMap = new Map<ElementKey, number>();\r\n  const stabMap = new Map<ElementKey, number>();\r\n  const replaced = new Set<ElementKey>();\r\n\r\n  for (let i = 0; i < size; i++) {\r\n    const nextKey = nextKeys[i - n] ?? null;\r\n    const prevKey = prevKeys[i - p] ?? null;\r\n\r\n    if (nextKey !== prevKey) {\r\n      if (nextKey !== null && !prevKeysMap[nextKey]) {\r\n        if (prevKey !== null && !nextKeysMap[prevKey]) {\r\n          insMap.set(nextKey, i);\r\n          remMap.set(prevKey, i);\r\n          replaced.add(prevKey);\r\n          hasChanges = true;\r\n        } else {\r\n          insMap.set(nextKey, i);\r\n          hasChanges = true;\r\n          p++;\r\n          size++;\r\n        }\r\n      } else if (!nextKeysMap[prevKey]) {\r\n        remMap.set(prevKey, i);\r\n        hasChanges = true;\r\n        n++;\r\n        size++;\r\n      } else if (nextKeysMap[prevKey] && nextKeysMap[nextKey]) {\r\n        movMap.set(nextKey, i);\r\n        hasChanges = true;\r\n      }\r\n    } else if (nextKey !== null) {\r\n      stabMap.set(nextKey, i);\r\n    }\r\n  }\r\n\r\n  return {\r\n    hasChanges,\r\n    insMap,\r\n    remMap,\r\n    movMap,\r\n    stabMap,\r\n    replaced,\r\n  };\r\n}\r\n\r\ntype AnimateOptions<T extends string, I = unknown> = {\r\n  action: Action;\r\n  space: Map<ElementKey, number>;\r\n  state: SharedState<T>;\r\n  scope: Scope<T, I>;\r\n};\r\n\r\nfunction animate<T extends string, I = unknown>(options: AnimateOptions<T, I>) {\r\n  const { space, action, state, scope } = options;\r\n  const { configurator, ctrlsMap, fakesMap } = scope;\r\n  const ctrls = state.getCtrls();\r\n  const isEnter = action === Action.ENTER;\r\n  const isLeave = action === Action.LEAVE;\r\n  let $idx = 0;\r\n\r\n  for (const [key, idx] of space) {\r\n    const ctrl = ctrlsMap.get(key);\r\n    const item = ctrl.getItem();\r\n    const config = configurator(idx, item);\r\n    const { trail } = config;\r\n    const to = isLeave && !config[action] ? config.from : config[action];\r\n    let $ctrl = ctrl;\r\n\r\n    if (isEnter) {\r\n      const isReplaced = ctrl.getIsReplaced();\r\n      const isPlaying = state.detectIsPlaying(key);\r\n\r\n      if (isReplaced) {\r\n        if (isPlaying) {\r\n          const fake = new Controller<T, I>(state);\r\n          const fakeKey = fake.markAsFake(key);\r\n\r\n          $ctrl = fake;\r\n          prepare({ ctrl: fake, key: fakeKey, idx, item, configurator });\r\n          ctrlsMap.set(fakeKey, fake);\r\n          fakesMap.set(fakeKey, idx);\r\n          ctrls.push(fake);\r\n        } else {\r\n          ctrl.setIsReplaced(false);\r\n        }\r\n      }\r\n    }\r\n\r\n    to && withTrail(() => $ctrl.start(() => ({ to })), $idx, trail);\r\n    $idx++;\r\n  }\r\n}\r\n\r\nfunction withTrail(fn: () => void, idx: number, trail?: number) {\r\n  if (detectIsNumber(trail)) {\r\n    setTimeout(fn, idx * trail);\r\n  } else {\r\n    fn();\r\n  }\r\n}\r\n\r\ntype PrepareOptions<T extends string, I = unknown> = {\r\n  ctrl: Controller<T, I>;\r\n  idx: number;\r\n  key: ElementKey;\r\n  item: I;\r\n  configurator: TransitionConfiguratorFn<T, I>;\r\n};\r\n\r\nfunction prepare<T extends string, I = unknown>(options: PrepareOptions<T, I>) {\r\n  const { ctrl, key, idx, item, configurator } = options;\r\n  const { from, enter, config } = configurator(idx, item);\r\n  const $configurator: ConfiguratorFn<T> = (idx: number) => {\r\n    const { enter, leave, update, trail, ...rest } = configurator(idx, item);\r\n\r\n    return { ...rest };\r\n  };\r\n\r\n  ctrl.setKey(key);\r\n  ctrl.setIdx(idx);\r\n  ctrl.setItem(item);\r\n  ctrl.setFrom(from);\r\n  ctrl.setTo(enter);\r\n  ctrl.setSpringConfigFn(config);\r\n  ctrl.setConfigurator($configurator);\r\n}\r\n\r\nfunction handleItemEnd<T extends string, I = unknown>({ key }: AnimationEventValue<T>, scope: Scope<T, I>) {\r\n  const { ctrlsMap, fakesMap, itemsMap, hasReplaces, queue, fromApi } = scope;\r\n\r\n  if (ctrlsMap.has(key) && ctrlsMap.get(key).detectIsFake()) {\r\n    ctrlsMap.delete(key);\r\n    fakesMap.delete(key);\r\n  }\r\n\r\n  if (fromApi || hasReplaces) {\r\n    !itemsMap.has(key) && ctrlsMap.delete(key);\r\n  } else {\r\n    queue.push(() => !scope.itemsMap.has(key) && ctrlsMap.delete(key));\r\n  }\r\n}\r\n\r\nfunction handleSeriesEnd<T extends string, I = unknown>(update: () => void, state: SharedState<T>, scope: Scope<T, I>) {\r\n  const { ctrlsMap, configurator, fromApi } = scope;\r\n  const ctrls: Array<Controller<T, I>> = [];\r\n\r\n  if (fromApi) return;\r\n  scope.queue.forEach(x => x());\r\n  scope.queue = [];\r\n\r\n  for (const [_, ctrl] of ctrlsMap) {\r\n    const { enter } = configurator(ctrl.getIdx(), ctrl.getItem());\r\n\r\n    ctrl.replaceValue({ ...enter });\r\n    ctrl.notify();\r\n    ctrls.push(ctrl);\r\n  }\r\n\r\n  state.setCtrls(ctrls);\r\n  update();\r\n}\r\n\r\ntype Scope<T extends string, I = unknown> = {\r\n  items: Array<I>;\r\n  configurator: TransitionConfiguratorFn<T, I>;\r\n  ctrlsMap: Map<ElementKey, Controller<T, I>>;\r\n  itemsMap: Map<ElementKey, I>;\r\n  fakesMap: Map<ElementKey, number>;\r\n  queue: Array<Callback>;\r\n  hasReplaces: boolean;\r\n  fromApi: boolean;\r\n  inChain: boolean;\r\n  pending: Callback;\r\n};\r\n\r\nenum Action {\r\n  ENTER = 'enter',\r\n  LEAVE = 'leave',\r\n  UPDATE = 'update',\r\n}\r\n\r\ntype KeyExtractor<I> = (x: I) => ElementKey;\r\n\r\ntype TransitionElement = Component | TagVirtualNodeFactory;\r\n\r\ntype TransitionConfiguratorFn<T extends string = string, I = unknown> = (\r\n  idx: number,\r\n  item: I,\r\n) => TransitionItemConfig<T>;\r\n\r\nexport type TransitionApi<T extends string = string> = Omit<SpringApi<T>, 'reset'>;\r\n\r\nexport type TransitionRenderFn<T extends string = string, I = unknown> = (options: {\r\n  spring: Spring<T>;\r\n  item: I;\r\n  idx: number;\r\n}) => TransitionElement;\r\n\r\nexport type TransitionFn<T extends string = string, I = unknown> = (render: TransitionRenderFn<T, I>) => Component;\r\n\r\nexport { useTransition };\r\n","import {\r\n  type Component,\r\n  type TagVirtualNodeFactory,\r\n  type Callback,\r\n  component,\r\n  useMemo,\r\n  useInsertionEffect,\r\n  $$scope,\r\n  walk,\r\n  nextTick,\r\n} from '@dark-engine/core';\r\n\r\nimport { type SpringValue } from '../shared';\r\nimport { type Spring } from '../spring';\r\n\r\ntype AnimatedProps<E = unknown, T extends string = string> = {\r\n  spring: Spring<T>;\r\n  fn: StyleFn<E, T>;\r\n  slot: Component | TagVirtualNodeFactory;\r\n};\r\n\r\nconst Animated = component<AnimatedProps>(({ spring, fn, slot }) => {\r\n  const cursor = $$scope().getCursorFiber();\r\n  const scope = useMemo<Scope>(() => ({ element: null, notify: null }), []);\r\n  const notify = () => scope.element && fn(scope.element, spring.value());\r\n\r\n  scope.notify = notify;\r\n\r\n  useInsertionEffect(() => {\r\n    const make = () => {\r\n      const fiber = cursor.hook.owner;\r\n\r\n      walk(fiber.child, (fiber, _, stop) => {\r\n        if (fiber.element) {\r\n          scope.element = fiber.element;\r\n          return stop();\r\n        }\r\n      });\r\n\r\n      notify();\r\n    };\r\n\r\n    if ($$scope().getIsHydrateZone()) {\r\n      nextTick(make);\r\n    } else {\r\n      make();\r\n    }\r\n\r\n    return spring.on(() => scope.notify());\r\n  }, [spring]);\r\n\r\n  notify();\r\n\r\n  return slot;\r\n});\r\n\r\ntype Scope = { element: unknown; notify: Callback };\r\ntype StyleFn<E = unknown, T extends string = string> = (element: E, value: SpringValue<T>) => void;\r\n\r\nexport { Animated };\r\n","import { h, Fragment, component, useState } from '@dark-engine/core';\r\nimport { createRoot } from '@dark-engine/platform-browser';\r\nimport { styled } from '@dark-engine/styled';\r\nimport { SpringValue, Animated, useTransition } from '@dark-engine/animations';\r\n\r\nconst next = (current: string) => {\r\n  const map = {\r\n    A: 'B',\r\n    B: 'C',\r\n    C: 'D',\r\n    D: 'A',\r\n  };\r\n\r\n  return map[current];\r\n};\r\n\r\nconst prev = (current: string) => {\r\n  const map = {\r\n    A: 'D',\r\n    B: 'A',\r\n    C: 'B',\r\n    D: 'C',\r\n  };\r\n\r\n  return map[current];\r\n};\r\n\r\nconst colors = {\r\n  A: 'lightpink',\r\n  B: 'lightblue',\r\n  C: 'lightgreen',\r\n  D: 'orchid',\r\n};\r\n\r\ntype SpringProps = 'opacity' | 'x';\r\n\r\nlet isNext = true;\r\n\r\nconst App = component(() => {\r\n  const [items, setItems] = useState(['A']);\r\n  const [transition] = useTransition<SpringProps, string>(\r\n    items,\r\n    x => x,\r\n    () => ({\r\n      from: { opacity: 0, x: isNext ? 100 : -100 },\r\n      enter: { opacity: 1, x: 0 },\r\n      leave: { opacity: 0, x: isNext ? -50 : 50 },\r\n    }),\r\n  );\r\n\r\n  return (\r\n    <>\r\n      <button\r\n        onClick={() => {\r\n          isNext = false;\r\n          setItems([prev(items[0])]);\r\n        }}>\r\n        prev\r\n      </button>\r\n      <button\r\n        onClick={() => {\r\n          isNext = true;\r\n          setItems([next(items[0])]);\r\n        }}>\r\n        next\r\n      </button>\r\n      {items[0]}\r\n      <Container>\r\n        {transition(({ spring, item }) => {\r\n          return (\r\n            <Animated spring={spring} fn={styleFn}>\r\n              <Item $color={colors[item]}>{item}</Item>\r\n            </Animated>\r\n          );\r\n        })}\r\n      </Container>\r\n    </>\r\n  );\r\n});\r\n\r\nconst styleFn = (element: HTMLDivElement, value: SpringValue<SpringProps>) => {\r\n  element.style.setProperty('opacity', `${value.opacity}`);\r\n  element.style.setProperty('transform', `translate3d(${value.x}%, 0, 0)`);\r\n};\r\n\r\nconst Container = styled.div`\r\n  position: fixed;\r\n  top: 50%;\r\n  left: 50%;\r\n  width: 500px;\r\n  height: 400px;\r\n  transform: translate(-50%, -50%);\r\n  overflow: hidden;\r\n`;\r\n\r\nconst Item = styled.div<{ $color: string }>`\r\n  position: absolute;\r\n  width: 100%;\r\n  height: 100%;\r\n  display: flex;\r\n  font-size: 10rem;\r\n  justify-content: center;\r\n  align-items: center;\r\n  transform-origin: 0 0;\r\n  background-color: ${p => p.$color};\r\n  color: #fff;\r\n`;\r\n\r\ncreateRoot(document.getElementById('root')).render(<App />);\r\n","import { detectIsFunction } from '../utils';\r\nimport { type UpdateOptions, useUpdate } from '../use-update';\r\nimport { useMemo } from '../use-memo';\r\nimport { $$scope } from '../scope';\r\nimport { useCallback } from '../use-callback';\r\n\r\ntype Value<T> = T | ((prevValue: T) => T);\r\n\r\nfunction useState<T = unknown>(initialValue: T | (() => T)): [T, (value: Value<T>) => void] {\r\n  const update = useUpdate();\r\n  const scope = useMemo(\r\n    () => ({\r\n      value: detectIsFunction(initialValue) ? initialValue() : initialValue,\r\n    }),\r\n    [],\r\n  );\r\n  const setState = useCallback((sourceValue: Value<T>) => {\r\n    const $scope = $$scope();\r\n    const isBatch = $scope.getIsBatchZone();\r\n    const create = (): UpdateOptions => {\r\n      const prevValue = scope.value;\r\n      const newValue = detectIsFunction(sourceValue) ? sourceValue(prevValue) : sourceValue;\r\n      const shouldUpdate = () => isBatch || !Object.is(prevValue, newValue);\r\n      const setValue = () => (scope.value = newValue);\r\n      const resetValue = () => (scope.value = prevValue);\r\n\r\n      return { shouldUpdate, setValue, resetValue };\r\n    };\r\n\r\n    update(create);\r\n  }, []);\r\n\r\n  return [scope.value, setState];\r\n}\r\n\r\nexport { useState };\r\n","import { useMemo } from '../use-memo';\r\n\r\nfunction useCallback<T = Function>(callback: T, deps: Array<any>): T {\r\n  const value = useMemo(() => callback, deps);\r\n\r\n  return value;\r\n}\r\n\r\nexport { useCallback };\r\n","import { type DarkElement, unmountRoot } from '@dark-engine/core';\r\n\r\nimport { render, roots } from '../render';\r\nimport type { TagNativeElement } from '../native-element';\r\n\r\nfunction createRoot(container: TagNativeElement) {\r\n  return {\r\n    render: (element: DarkElement) => render(element, container),\r\n    unmount: () => unmount(container),\r\n  };\r\n}\r\n\r\nfunction unmount(container: TagNativeElement) {\r\n  const rootId = roots.get(container);\r\n\r\n  unmountRoot(rootId, () => {\r\n    roots.delete(container);\r\n    container.innerHTML = '';\r\n  });\r\n}\r\n\r\nexport { createRoot, unmount };\r\n"],"names":["ROOT","REPLACER","KEY_ATTR","REF_ATTR","CREATE_EFFECT_TAG","UPDATE_EFFECT_TAG","SKIP_EFFECT_TAG","MOVE_MASK","TaskPriority","Flag","ATTR_BLACK_LIST","SKIP_SCAN_OPT","MEMO_SLOT_OPT","STATIC_SLOT_OPT","$$inject","Symbol","Component","constructor","type","token","props","ref","shouldUpdate","displayName","children","this","component","options","$token","factory","defaultInject","detectIsComponent","x","detectIsFunction","o","detectIsUndefined","detectIsString","detectIsObject","detectIsBoolean","detectIsArray","Array","isArray","detectIsNull","detectIsEmpty","getTime","Date","now","dummyFn","trueFn","falseFn","sameFn","flatten","source","transform","length","list","stack","idx","pop","i","push","prevDeps","nextDeps","max","Math","Object","is","nextTick","callback","Promise","resolve","then","createIndexKey","defaultRealisation","Error","platform","createElement","insertElement","raf","caf","spawn","commit","finishCommit","detectIsDynamic","detectIsPortal","unmountPortal","chunk","detectIsServer","EventEmitter","subscribers","Map","on","e","fn","has","set","Set","get","add","delete","emit","data","forEach","kill","__getSize","size","Scope","root","wip","cursor","unit","mountDeep","mountLevel","mountNav","events","unsubs","actions","candidates","deletions","cancels","asyncEffects","layoutEffects","insertionEffects","resourceId","resources","defers","setPendingStatus","isLayoutEffectsZone","isInsertionEffectsZone","isUpdateZone","isBatchZone","isHydrateZone","isStreamZone","isTransitionZone","isEventZone","isHot","isDynamic","isServer","emitter","resetActions","getActionsById","id","addActionMap","map","replace","insert","remove","move","stable","addReplaceAction","nextKey","addInsertAction","addRemoveAction","prevKey","addMoveAction","addStableAction","copy","scope","getRoot","setRoot","fiber","getWorkInProgress","setWorkInProgress","getNextUnitOfWork","setNextUnitOfWork","getCursorFiber","setCursorFiber","navToChild","navToSibling","navToParent","navToPrev","getMountIndex","setMountDeep","getMountDeep","value","resetMount","getEvents","addEventUnsubscriber","unsubscribeEvents","getCandidates","addCandidate","resetCandidates","getDeletions","hasDeletion","nextFiber","parent","addDeletion","resetDeletions","addAsyncEffect","resetAsyncEffects","runAsyncEffects","effects","setTimeout","addLayoutEffect","resetLayoutEffects","runLayoutEffects","setIsLayoutEffectsZone","addInsertionEffect","resetInsertionEffects","runInsertionEffects","setIsInsertionEffectsZone","addCancel","applyCancels","resetCancels","getIsLayoutEffectsZone","getIsInsertionEffectsZone","getIsUpdateZone","setIsUpdateZone","getIsBatchZone","setIsBatchZone","getIsHydrateZone","setIsHydrateZone","getIsStreamZone","setIsStreamZone","getIsTransitionZone","setIsTransitionZone","getIsEventZone","setIsEventZone","getIsHot","setIsHot","getPendingStatusSetter","setPendingStatusSetter","flush","getEmitter","defer","getDefers","resetDefers","getResource","setResource","res","getResources","getResourceId","setResourceId","getNextResourceId","runAfterCommit","rootId","scopes","getRootId","setRootId","$$scope","$$vNode","ATTR_TYPE","VirtualNode","TagVirtualNode","name","attrs","super","NodeType","TAG","TextVirtualNode","TEXT","String","CommentVirtualNode","text","COMMENT","View","as","slot","_void","key","from","detectIsTextVirtualNode","detectIsVirtualNode","vNode","detectIsTagVirtualNode","detectIsCommentVirtualNode","detectIsVirtualNodeFactory","detectIsPlainVirtualNode","createReplacer","getElementKey","inst","hasElementFlag","flag","Boolean","hasComponentFlag","hasVirtualNodeFactoryFlag","hasTagVirtualNodeFlag","getElementType","hasChildrenProp","detectAreSameInstanceTypes","prevInst","nextInst","isComponentFactories","nc","Fiber","hook","provider","cc","cec","eidx","mask","element","tag","child","next","alt","atoms","nextId","mutate","keys","markHost","increment","count","force","$scope","wipFiber","stop","setError","error","catch","static","Hook","values","owner","$$memo","defaultShouldUpdate","nextProps","detectIsMemo","instance","walk","onWalk","shouldDeep","shouldStop","skip","getFiberWithElement","$fiber","buildChildNodes","onNode","getKey","buildChildNode","altMap","startEidx","prevIdx","nextIdx","left","right","isFirst","isLast","notifyParents","$$fragment","Fragment","Memo","memo","getValue","p","n","deps","state","$value","detectIsElement","$$useEffect","createEffect","useEffect","effect","cleanup","undefined","isInsertionEffect","EffectType","INSERTION","isLayoutEffect","LAYOUT","isAsyncEffect","ASYNC","runEffect","dropEffects","$$useLayoutEffect","dropLayoutEffects","$$useInsertionEffect","useInsertionEffect","dropInsertionEffects","shouldUnmountFiber","INSERTION_EFFECT_HOST_MASK","unmountFiber","_","hasPendingPromise","hasRenderError","workLoop","isAsync","shouldYield","hasMoreWork","performUnitOfWork","scheduler","hasPrimaryTask","fork","unmounts","diff","parentFiber","isRight","sync","err","finally","isDeepWalking","isStream","hasChildren","$inst","createFiber","getAlternate","share","mountChild","mountSibling","prev","shouldMount","pc","mount","hasSameCount","prevKeys","nextKeys","prevKeysMap","nextKeysMap","keyedFibersMap","usedKeysMap","extractKeys","prevKeyFiber","tryOptStaticSlot","hasMove","hasRemove","hasInsert","hasReplace","detectIsStableMemoTree","tryOptMov","tryOptRem","tryOptMemoSlot","reconcile","isUpdate","setup","detectAreSameComponentTypesWithSameKeys","getHook","fromChild","parentId","isMove","isStable","isComponent","result","promise","all","setNextId","args","console","supportConditional","cancel","$$scope$","cancelTask","setValue","resetValue","assign","replaceScope","createUpdate","isTransition","createChanger","$createChanger","restore","fromRestore","detectIsFiberAlive","MessageChannel","port1","port2","MessagePort","channel","offs","event","off","postMessage","unref","Task","priority","forceAsync","taskRestorer","pendingSetter","nextTaskId","getPriority","getForceAsync","setIsTransition","getIsTransition","run","pending","markAsPending","isPending","canPending","markAsUnnecessary","isUnnecessary","getIsUnnecessary","setTaskRestorer","setLocationCreator","locationCreator","createLocation","setPendingSetter","loc","tasks","deep","$loc","split","some","$$loc","indexOf","createRootLocation","queue","HIGH","NORMAL","LOW","deadline","task","scheduledCallback","isMessageLoopRunning","port","performWorkUntilDeadline","bind","reset","schedule","put","execute","high","normal","low","getQueues","hasPrimary","hasLow","detectHasRelatedUpdate","complete","filter","splice","pick","shift","requestCallbackAsync","requestCallback","isBusy","unshift","hasChanger","isBatch","isEvent","callbackOptions","createHookLocation","change","batch","timer","changes","clearTimeout","addBatch","applyRef","current","mutableRef","hasOwnProperty","detectIsMutableRef","$$portal","container","innerHTML","getPortalContainer","SyntheticEvent","sourceEvent","target","propagation","stopPropagation","preventDefault","getPropagation","delegateEvent","eventName","handler","eventsMap","handlersMap","$handler","slice","rootHandler","$event","parentElement","dispatchEvent","WeakMap","document","addEventListener","removeEventListener","detectIsEvent","attrName","startsWith","getEventName","toLowerCase","STYLE_ATTR","CLASS_ATTR","CLASS_NAME_ATTR","moves","patches","svgTagNames","voidTagNames","createNativeElementMap","detectIsSvgElement","createElementNS","createTextNode","createComment","createNativeElement","node","setObjectStyle","style","setProperty","toggleAttribute","setAttribute","removeAttribute","patchProperties","tagName","attrValue","patchPropertiesSpecialCasesMap","prototype","getPrototypeOf","descriptor","getOwnPropertyDescriptor","canSetProperty","includes","input","checked","autofocus","focus","textarea","innerText","commitMap","childNodes","nativeElement","Text","splitText","appendNativeElement","insertNativeElement","attrNames","tagElement","addAttributes","commitCreation","sourceNodes","elements","collectElements","sourceFragment","DocumentFragment","elementIdx","removeNativeElement","replaceNativeElement","prevInstance","nextInstance","textContent","prevNode","nextNode","prevAttrs","nextAttrs","getAttributeNames","prevAttrValue","nextAttrValue","updateAttributes","commitUpdate","canRemoveNativeElement","appendChild","sibling","insertBefore","insertNativeElementByIndex","candidate","replaceChild","removeChild","roots","requestAnimationFrame","window","cancelAnimationFrame","isInjected","STYLED_ATTR","COMPONENTS_ATTR_VALUE","DOT_MARK","MEDIA_QUERY_MARK","CONTAINER_QUERY_MARK","mapProps","Keyframes","getName","getToken","detectIsKeyframes","Token","normalize","trim","markAsDynamic","detectIsToken","StyleRule","generate","NestingRule","className","fns","styles","replaceAll","keyframes","$styles","__","___","$keyframes","MediaQueryRule","nesting","$nesting","ContainerQueryRule","KeyframesRule","FunctionRule","end","isSealed","seal","getIsSealed","getEnd","styleExp","rest","media","detectIsStyleSheet","$media","$container","reduce","acc","StyleSheet","detectIsStyleRule","detectIsNestingRule","detectIsMediaQueryRule","detectIsContainerQueryRule","detectIsKeyframesRule","detectIsFunctionRule","createContext","defaultValue","context","Provider","Consumer","providerValue","subscribe","subscriber","createProvider","useContext","createConsumer","getProvider","update","hasProvider","unsubscribe","ThemeContext","STYLE_LEVEL","theme","ManagerContext","detectIsPropName","css","last","detectHasMediaQueryMark","detectHasContainerQueryMark","char","manager","detectHasSingleLineCommentEndMark","endsWith","detectHasMultiLineCommentStartMark","detectHasMultiLineCommentEndMark","detectHasFunctionMark","detectHasUrlFnMark","URL_FN_MARK","detectHasKeyframesMark","sub","substring","createEnd","cache","injections","isLoaded","$$styled","styled","selector","createTag","content","reuse","querySelectorAll","isExtending","detectIsStyled","config","getExtendingConfig","$source","t1","t2","first","$t1","$t2","raw","mergeTemplates","$args","$transform","filterArgs","sheet","sheets","baseName","baseStyle","baseKeyframes","forwardRef","isSwap","$props","$factory","names","keyframesList","classNames","getClassNamesFrom","items","arr","item","uniq","join","$tag","getTag","collectComponentStyle","setupGlobal","t","createStyledComponent","$sheet","rules","genClassName","rule","head","getElement","querySelector","strings","stylesheet","buffer","fnIdx","isSingleLineComment","isMultiLineComment","isPropValue","isUrl","joined","arg","class","h","charCodeAt","phash","abs","a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","iframe","img","ins","kbd","label","legend","li","link","main","mark","menu","meta","meter","nav","noscript","object","ol","optgroup","option","output","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","span","strong","summary","sup","table","tbody","td","template","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","svg","circle","clipPath","defs","desc","ellipse","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","g","image","line","linearGradient","marker","path","pattern","polygon","polyline","radialGradient","rect","switch","symbol","textPath","tspan","use","view","SharedState","ctrls","flow","Flow","RIGHT","isTrail","isPaused","isCanceled","timeout","timerId","getCtrls","setCtrls","setIsTrail","getIsTrail","setFlow","getIsPaused","getIsCanceled","detectIsRightFlow","setIsPlaying","detectIsPlaying","start","pause","resume","delay","resetTimer","subs","completeSeries","defaultSpringConfig","tension","friction","mass","precision","fix","Atom","val","__connect","connections1","connections2","subjects","toString","toJSON","valueOf","disconnect","__addSubject","atom$","__removeSubject","make","tuple","__notify","WritableAtom","Spring","prop","prop$","setProp","atom","notify","performance","Number","toFixed","stepper","pos","vel","dest","step","nPos","nVel","spring","Controller","results","completed","immediate","immediates","isReplaced","setKey","getIdx","setIdx","setFrom","setTo","to","setSpringConfigFn","springConfigFn","setLeft","setRight","setConfigurator","configurator","setImmediate","replaceValue","markAsFake","primaryKey","generateFakeKey","detectIsFake","getIsReplaced","setIsReplaced","getItem","setItem","getState","getSpring","config1","config2","play","frameId","motion","frameTime","MAX_SKIPPED_FRAMES","checkCompleted","fakeKey","ctrlsMap","itemsMap","ctrl","prepare","getController","animate","space","action","fakesMap","isEnter","Action","ENTER","isLeave","LEAVE","$idx","trail","$ctrl","isPlaying","fake","withTrail","enter","leave","Animated","colors","A","B","C","D","isNext","App","setItems","initialValue","setState","sourceValue","prevValue","newValue","useState","transition","forceUpdate","hasReplaces","fromApi","inChain","render","api","chain","nextItems","$items","hasChanges","insMap","remMap","movMap","stabMap","replaced","prevItems","prevItem","nextItem","UPDATE","handleItemEnd","handleSeriesEnd","useTransition","opacity","onClick","Container","styleFn","Item","$color","getElementById","hydrate","isMounted","isHydrate","rootFiber","unmount","onCompleted","unmountRoot"],"sourceRoot":""}